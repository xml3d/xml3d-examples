(function e$$0(m,l,e){function b(c,g){if(!l[c]){if(!m[c]){var f="function"==typeof require&&require;if(!g&&f)return f(c,!0);if(a)return a(c,!0);f=Error("Cannot find module '"+c+"'");throw f.code="MODULE_NOT_FOUND",f;}f=l[c]={exports:{}};m[c][0].call(f.exports,function(a){var g=m[c][1][a];return b(g?g:a)},f,f.exports,e$$0,m,l,e)}return l[c].exports}for(var a="function"==typeof require&&require,c=0;c<e.length;c++)b(e[c]);return b})({1:[function(d,m,l){l.glMatrix=d("./gl-matrix/common.js");l.mat2=d("./gl-matrix/mat2.js");
l.mat2d=d("./gl-matrix/mat2d.js");l.mat3=d("./gl-matrix/mat3.js");l.mat4=d("./gl-matrix/mat4.js");l.quat=d("./gl-matrix/quat.js");l.vec2=d("./gl-matrix/vec2.js");l.vec3=d("./gl-matrix/vec3.js");l.vec4=d("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":2,"./gl-matrix/mat2.js":3,"./gl-matrix/mat2d.js":4,"./gl-matrix/mat3.js":5,"./gl-matrix/mat4.js":6,"./gl-matrix/quat.js":7,"./gl-matrix/vec2.js":8,"./gl-matrix/vec3.js":9,"./gl-matrix/vec4.js":10}],2:[function(d,m,l){d={EPSILON:1E-6};d.ARRAY_TYPE="undefined"!==
typeof Float32Array?Float32Array:Array;d.RANDOM=Math.random;d.setMatrixArrayType=function(b){GLMAT_ARRAY_TYPE=b};var e=Math.PI/180;d.toRadian=function(b){return b*e};m.exports=d},{}],3:[function(d,m,l){var e=d("./common.js");d={create:function(){var b=new e.ARRAY_TYPE(4);b[0]=1;b[1]=0;b[2]=0;b[3]=1;return b},clone:function(b){var a=new e.ARRAY_TYPE(4);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(b){b[0]=1;
b[1]=0;b[2]=0;b[3]=1;return b},transpose:function(b,a){if(b===a){var c=a[1];b[1]=a[2];b[2]=c}else b[0]=a[0],b[1]=a[2],b[2]=a[1],b[3]=a[3];return b},invert:function(b,a){var c=a[0],h=a[1],g=a[2],f=a[3],k=c*f-g*h;if(!k)return null;k=1/k;b[0]=f*k;b[1]=-h*k;b[2]=-g*k;b[3]=c*k;return b},adjoint:function(b,a){var c=a[0];b[0]=a[3];b[1]=-a[1];b[2]=-a[2];b[3]=c;return b},determinant:function(b){return b[0]*b[3]-b[2]*b[1]},multiply:function(b,a,c){var h=a[0],g=a[1],f=a[2];a=a[3];var k=c[0],e=c[1],d=c[2];c=
c[3];b[0]=h*k+f*e;b[1]=g*k+a*e;b[2]=h*d+f*c;b[3]=g*d+a*c;return b}};d.mul=d.multiply;d.rotate=function(b,a,c){var h=a[0],g=a[1],f=a[2];a=a[3];var k=Math.sin(c);c=Math.cos(c);b[0]=h*c+f*k;b[1]=g*c+a*k;b[2]=h*-k+f*c;b[3]=g*-k+a*c;return b};d.scale=function(b,a,c){var h=a[1],g=a[2],f=a[3],k=c[0];c=c[1];b[0]=a[0]*k;b[1]=h*k;b[2]=g*c;b[3]=f*c;return b};d.fromRotation=function(b,a){var c=Math.sin(a),h=Math.cos(a);b[0]=h;b[1]=c;b[2]=-c;b[3]=h;return b};d.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;
b[3]=a[1];return b};d.str=function(b){return"mat2("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")"};d.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2))};d.LDU=function(b,a,c,h){b[2]=h[2]/h[0];c[0]=h[0];c[1]=h[1];c[3]=h[3]-b[2]*c[1];return[b,a,c]};m.exports=d},{"./common.js":2}],4:[function(d,m,l){var e=d("./common.js");d={create:function(){var b=new e.ARRAY_TYPE(6);b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b},clone:function(b){var a=new e.ARRAY_TYPE(6);
a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b},invert:function(b,a){var c=a[0],h=a[1],g=a[2],f=a[3],k=a[4],e=a[5],d=c*f-h*g;if(!d)return null;d=1/d;b[0]=f*d;b[1]=-h*d;b[2]=-g*d;b[3]=c*d;b[4]=(g*e-f*k)*d;b[5]=(h*k-c*e)*d;return b},determinant:function(b){return b[0]*b[3]-b[1]*b[2]},multiply:function(b,a,c){var h=a[0],
g=a[1],f=a[2],k=a[3],e=a[4];a=a[5];var d=c[0],n=c[1],p=c[2],r=c[3],t=c[4];c=c[5];b[0]=h*d+f*n;b[1]=g*d+k*n;b[2]=h*p+f*r;b[3]=g*p+k*r;b[4]=h*t+f*c+e;b[5]=g*t+k*c+a;return b}};d.mul=d.multiply;d.rotate=function(b,a,c){var h=a[0],g=a[1],f=a[2],k=a[3],e=a[4];a=a[5];var d=Math.sin(c);c=Math.cos(c);b[0]=h*c+f*d;b[1]=g*c+k*d;b[2]=h*-d+f*c;b[3]=g*-d+k*c;b[4]=e;b[5]=a;return b};d.scale=function(b,a,c){var h=a[1],g=a[2],f=a[3],k=a[4],e=a[5],d=c[0];c=c[1];b[0]=a[0]*d;b[1]=h*d;b[2]=g*c;b[3]=f*c;b[4]=k;b[5]=e;
return b};d.translate=function(b,a,c){var h=a[0],g=a[1],f=a[2],k=a[3],e=a[4];a=a[5];var d=c[0];c=c[1];b[0]=h;b[1]=g;b[2]=f;b[3]=k;b[4]=h*d+f*c+e;b[5]=g*d+k*c+a;return b};d.fromRotation=function(b,a){var c=Math.sin(a),h=Math.cos(a);b[0]=h;b[1]=c;b[2]=-c;b[3]=h;b[4]=0;b[5]=0;return b};d.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=a[1];b[4]=0;b[5]=0;return b};d.fromTranslation=function(b,a){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=a[0];b[5]=a[1];return b};d.str=function(b){return"mat2d("+b[0]+", "+
b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+")"};d.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+1)};m.exports=d},{"./common.js":2}],5:[function(d,m,l){var e=d("./common.js");d={create:function(){var b=new e.ARRAY_TYPE(9);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b},fromMat4:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},
clone:function(b){var a=new e.ARRAY_TYPE(9);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b},transpose:function(b,a){if(b===a){var c=a[1],h=a[2],g=a[5];b[1]=a[3];b[2]=a[6];b[3]=c;b[5]=a[7];b[6]=h;b[7]=g}else b[0]=a[0],b[1]=a[3],b[2]=a[6],
b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b},invert:function(b,a){var c=a[0],h=a[1],g=a[2],f=a[3],k=a[4],e=a[5],d=a[6],n=a[7],p=a[8],r=p*k-e*n,t=-p*f+e*d,v=n*f-k*d,x=c*r+h*t+g*v;if(!x)return null;x=1/x;b[0]=r*x;b[1]=(-p*h+g*n)*x;b[2]=(e*h-g*k)*x;b[3]=t*x;b[4]=(p*c-g*d)*x;b[5]=(-e*c+g*f)*x;b[6]=v*x;b[7]=(-n*c+h*d)*x;b[8]=(k*c-h*f)*x;return b},adjoint:function(b,a){var c=a[0],h=a[1],g=a[2],f=a[3],k=a[4],e=a[5],d=a[6],n=a[7],p=a[8];b[0]=k*p-e*n;b[1]=g*n-h*p;b[2]=h*e-g*k;b[3]=
e*d-f*p;b[4]=c*p-g*d;b[5]=g*f-c*e;b[6]=f*n-k*d;b[7]=h*d-c*n;b[8]=c*k-h*f;return b},determinant:function(b){var a=b[3],c=b[4],h=b[5],g=b[6],f=b[7],k=b[8];return b[0]*(k*c-h*f)+b[1]*(-k*a+h*g)+b[2]*(f*a-c*g)},multiply:function(b,a,c){var h=a[0],g=a[1],f=a[2],k=a[3],e=a[4],d=a[5],n=a[6],p=a[7];a=a[8];var r=c[0],t=c[1],v=c[2],x=c[3],y=c[4],w=c[5],z=c[6],l=c[7];c=c[8];b[0]=r*h+t*k+v*n;b[1]=r*g+t*e+v*p;b[2]=r*f+t*d+v*a;b[3]=x*h+y*k+w*n;b[4]=x*g+y*e+w*p;b[5]=x*f+y*d+w*a;b[6]=z*h+l*k+c*n;b[7]=z*g+l*e+c*p;
b[8]=z*f+l*d+c*a;return b}};d.mul=d.multiply;d.translate=function(b,a,c){var h=a[0],g=a[1],f=a[2],k=a[3],e=a[4],d=a[5],n=a[6],p=a[7];a=a[8];var r=c[0];c=c[1];b[0]=h;b[1]=g;b[2]=f;b[3]=k;b[4]=e;b[5]=d;b[6]=r*h+c*k+n;b[7]=r*g+c*e+p;b[8]=r*f+c*d+a;return b};d.rotate=function(b,a,c){var h=a[0],g=a[1],f=a[2],k=a[3],e=a[4],d=a[5],n=a[6],p=a[7];a=a[8];var r=Math.sin(c);c=Math.cos(c);b[0]=c*h+r*k;b[1]=c*g+r*e;b[2]=c*f+r*d;b[3]=c*k-r*h;b[4]=c*e-r*g;b[5]=c*d-r*f;b[6]=n;b[7]=p;b[8]=a;return b};d.scale=function(b,
a,c){var h=c[0];c=c[1];b[0]=h*a[0];b[1]=h*a[1];b[2]=h*a[2];b[3]=c*a[3];b[4]=c*a[4];b[5]=c*a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};d.fromTranslation=function(b,a){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};d.fromRotation=function(b,a){var c=Math.sin(a),h=Math.cos(a);b[0]=h;b[1]=c;b[2]=0;b[3]=-c;b[4]=h;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};d.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};d.fromMat2d=function(b,
a){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};d.fromQuat=function(b,a){var c=a[0],h=a[1],g=a[2],f=a[3],k=c+c,e=h+h,d=g+g,c=c*k,n=h*k,h=h*e,p=g*k,r=g*e,g=g*d,k=f*k,e=f*e,f=f*d;b[0]=1-h-g;b[3]=n-f;b[6]=p+e;b[1]=n+f;b[4]=1-c-g;b[7]=r-k;b[2]=p-e;b[5]=r+k;b[8]=1-c-h;return b};d.normalFromMat4=function(b,a){var c=a[0],h=a[1],g=a[2],f=a[3],k=a[4],e=a[5],d=a[6],n=a[7],p=a[8],r=a[9],t=a[10],v=a[11],x=a[12],y=a[13],w=a[14],z=a[15],l=c*e-h*k,m=c*d-g*k,B=c*n-f*
k,A=h*d-g*e,C=h*n-f*e,H=g*n-f*d,E=p*y-r*x,G=p*w-t*x,p=p*z-v*x,I=r*w-t*y,r=r*z-v*y,t=t*z-v*w,v=l*t-m*r+B*I+A*p-C*G+H*E;if(!v)return null;v=1/v;b[0]=(e*t-d*r+n*I)*v;b[1]=(d*p-k*t-n*G)*v;b[2]=(k*r-e*p+n*E)*v;b[3]=(g*r-h*t-f*I)*v;b[4]=(c*t-g*p+f*G)*v;b[5]=(h*p-c*r-f*E)*v;b[6]=(y*H-w*C+z*A)*v;b[7]=(w*B-x*H-z*m)*v;b[8]=(x*C-y*B+z*l)*v;return b};d.str=function(b){return"mat3("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+")"};d.frob=function(b){return Math.sqrt(Math.pow(b[0],
2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+Math.pow(b[6],2)+Math.pow(b[7],2)+Math.pow(b[8],2))};m.exports=d},{"./common.js":2}],6:[function(d,m,l){var e=d("./common.js"),b={create:function(){var a=new e.ARRAY_TYPE(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var c=new e.ARRAY_TYPE(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=
a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,c){if(a===c){var h=
c[1],b=c[2],f=c[3],k=c[6],e=c[7],d=c[11];a[1]=c[4];a[2]=c[8];a[3]=c[12];a[4]=h;a[6]=c[9];a[7]=c[13];a[8]=b;a[9]=k;a[11]=c[14];a[12]=f;a[13]=e;a[14]=d}else a[0]=c[0],a[1]=c[4],a[2]=c[8],a[3]=c[12],a[4]=c[1],a[5]=c[5],a[6]=c[9],a[7]=c[13],a[8]=c[2],a[9]=c[6],a[10]=c[10],a[11]=c[14],a[12]=c[3],a[13]=c[7],a[14]=c[11],a[15]=c[15];return a},invert:function(a,c){var h=c[0],b=c[1],f=c[2],k=c[3],e=c[4],d=c[5],n=c[6],p=c[7],r=c[8],t=c[9],v=c[10],x=c[11],y=c[12],w=c[13],z=c[14],l=c[15],m=h*d-b*e,B=h*n-f*e,A=
h*p-k*e,C=b*n-f*d,H=b*p-k*d,E=f*p-k*n,G=r*w-t*y,I=r*z-v*y,K=r*l-x*y,L=t*z-v*w,M=t*l-x*w,N=v*l-x*z,J=m*N-B*M+A*L+C*K-H*I+E*G;if(!J)return null;J=1/J;a[0]=(d*N-n*M+p*L)*J;a[1]=(f*M-b*N-k*L)*J;a[2]=(w*E-z*H+l*C)*J;a[3]=(v*H-t*E-x*C)*J;a[4]=(n*K-e*N-p*I)*J;a[5]=(h*N-f*K+k*I)*J;a[6]=(z*A-y*E-l*B)*J;a[7]=(r*E-v*A+x*B)*J;a[8]=(e*M-d*K+p*G)*J;a[9]=(b*K-h*M-k*G)*J;a[10]=(y*H-w*A+l*m)*J;a[11]=(t*A-r*H-x*m)*J;a[12]=(d*I-e*L-n*G)*J;a[13]=(h*L-b*I+f*G)*J;a[14]=(w*B-y*C-z*m)*J;a[15]=(r*C-t*B+v*m)*J;return a},adjoint:function(a,
c){var h=c[0],b=c[1],f=c[2],k=c[3],e=c[4],d=c[5],n=c[6],p=c[7],r=c[8],t=c[9],v=c[10],x=c[11],y=c[12],w=c[13],z=c[14],l=c[15];a[0]=d*(v*l-x*z)-t*(n*l-p*z)+w*(n*x-p*v);a[1]=-(b*(v*l-x*z)-t*(f*l-k*z)+w*(f*x-k*v));a[2]=b*(n*l-p*z)-d*(f*l-k*z)+w*(f*p-k*n);a[3]=-(b*(n*x-p*v)-d*(f*x-k*v)+t*(f*p-k*n));a[4]=-(e*(v*l-x*z)-r*(n*l-p*z)+y*(n*x-p*v));a[5]=h*(v*l-x*z)-r*(f*l-k*z)+y*(f*x-k*v);a[6]=-(h*(n*l-p*z)-e*(f*l-k*z)+y*(f*p-k*n));a[7]=h*(n*x-p*v)-e*(f*x-k*v)+r*(f*p-k*n);a[8]=e*(t*l-x*w)-r*(d*l-p*w)+y*(d*x-
p*t);a[9]=-(h*(t*l-x*w)-r*(b*l-k*w)+y*(b*x-k*t));a[10]=h*(d*l-p*w)-e*(b*l-k*w)+y*(b*p-k*d);a[11]=-(h*(d*x-p*t)-e*(b*x-k*t)+r*(b*p-k*d));a[12]=-(e*(t*z-v*w)-r*(d*z-n*w)+y*(d*v-n*t));a[13]=h*(t*z-v*w)-r*(b*z-f*w)+y*(b*v-f*t);a[14]=-(h*(d*z-n*w)-e*(b*z-f*w)+y*(b*n-f*d));a[15]=h*(d*v-n*t)-e*(b*v-f*t)+r*(b*n-f*d);return a},determinant:function(a){var c=a[0],h=a[1],b=a[2],f=a[3],k=a[4],e=a[5],d=a[6],n=a[7],p=a[8],r=a[9],t=a[10],v=a[11],x=a[12],y=a[13],w=a[14];a=a[15];return(c*e-h*k)*(t*a-v*w)-(c*d-b*k)*
(r*a-v*y)+(c*n-f*k)*(r*w-t*y)+(h*d-b*e)*(p*a-v*x)-(h*n-f*e)*(p*w-t*x)+(b*n-f*d)*(p*y-r*x)},multiply:function(a,c,h){var b=c[0],f=c[1],k=c[2],e=c[3],d=c[4],n=c[5],p=c[6],r=c[7],t=c[8],v=c[9],x=c[10],y=c[11],w=c[12],z=c[13],l=c[14];c=c[15];var m=h[0],B=h[1],A=h[2],C=h[3];a[0]=m*b+B*d+A*t+C*w;a[1]=m*f+B*n+A*v+C*z;a[2]=m*k+B*p+A*x+C*l;a[3]=m*e+B*r+A*y+C*c;m=h[4];B=h[5];A=h[6];C=h[7];a[4]=m*b+B*d+A*t+C*w;a[5]=m*f+B*n+A*v+C*z;a[6]=m*k+B*p+A*x+C*l;a[7]=m*e+B*r+A*y+C*c;m=h[8];B=h[9];A=h[10];C=h[11];a[8]=
m*b+B*d+A*t+C*w;a[9]=m*f+B*n+A*v+C*z;a[10]=m*k+B*p+A*x+C*l;a[11]=m*e+B*r+A*y+C*c;m=h[12];B=h[13];A=h[14];C=h[15];a[12]=m*b+B*d+A*t+C*w;a[13]=m*f+B*n+A*v+C*z;a[14]=m*k+B*p+A*x+C*l;a[15]=m*e+B*r+A*y+C*c;return a}};b.mul=b.multiply;b.translate=function(a,c,b){var g=b[0],f=b[1];b=b[2];var k,e,d,n,p,r,t,v,x,y,w,z;c===a?(a[12]=c[0]*g+c[4]*f+c[8]*b+c[12],a[13]=c[1]*g+c[5]*f+c[9]*b+c[13],a[14]=c[2]*g+c[6]*f+c[10]*b+c[14],a[15]=c[3]*g+c[7]*f+c[11]*b+c[15]):(k=c[0],e=c[1],d=c[2],n=c[3],p=c[4],r=c[5],t=c[6],
v=c[7],x=c[8],y=c[9],w=c[10],z=c[11],a[0]=k,a[1]=e,a[2]=d,a[3]=n,a[4]=p,a[5]=r,a[6]=t,a[7]=v,a[8]=x,a[9]=y,a[10]=w,a[11]=z,a[12]=k*g+p*f+x*b+c[12],a[13]=e*g+r*f+y*b+c[13],a[14]=d*g+t*f+w*b+c[14],a[15]=n*g+v*f+z*b+c[15]);return a};b.scale=function(a,c,b){var g=b[0],f=b[1];b=b[2];a[0]=c[0]*g;a[1]=c[1]*g;a[2]=c[2]*g;a[3]=c[3]*g;a[4]=c[4]*f;a[5]=c[5]*f;a[6]=c[6]*f;a[7]=c[7]*f;a[8]=c[8]*b;a[9]=c[9]*b;a[10]=c[10]*b;a[11]=c[11]*b;a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a};b.rotate=function(a,
c,b,g){var f=g[0],k=g[1];g=g[2];var d=Math.sqrt(f*f+k*k+g*g),q,n,p,r,t,v,x,y,w,z,l,m,B,A,C,H,E,G,I,K;if(Math.abs(d)<e.EPSILON)return null;d=1/d;f*=d;k*=d;g*=d;q=Math.sin(b);n=Math.cos(b);p=1-n;b=c[0];d=c[1];r=c[2];t=c[3];v=c[4];x=c[5];y=c[6];w=c[7];z=c[8];l=c[9];m=c[10];B=c[11];A=f*f*p+n;C=k*f*p+g*q;H=g*f*p-k*q;E=f*k*p-g*q;G=k*k*p+n;I=g*k*p+f*q;K=f*g*p+k*q;f=k*g*p-f*q;k=g*g*p+n;a[0]=b*A+v*C+z*H;a[1]=d*A+x*C+l*H;a[2]=r*A+y*C+m*H;a[3]=t*A+w*C+B*H;a[4]=b*E+v*G+z*I;a[5]=d*E+x*G+l*I;a[6]=r*E+y*G+m*I;a[7]=
t*E+w*G+B*I;a[8]=b*K+v*f+z*k;a[9]=d*K+x*f+l*k;a[10]=r*K+y*f+m*k;a[11]=t*K+w*f+B*k;c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);return a};b.rotateX=function(a,c,b){var g=Math.sin(b);b=Math.cos(b);var f=c[4],k=c[5],e=c[6],d=c[7],n=c[8],p=c[9],r=c[10],t=c[11];c!==a&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[4]=f*b+n*g;a[5]=k*b+p*g;a[6]=e*b+r*g;a[7]=d*b+t*g;a[8]=n*b-f*g;a[9]=p*b-k*g;a[10]=r*b-e*g;a[11]=t*b-d*g;return a};b.rotateY=function(a,
c,b){var g=Math.sin(b);b=Math.cos(b);var f=c[0],k=c[1],e=c[2],d=c[3],n=c[8],p=c[9],r=c[10],t=c[11];c!==a&&(a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[0]=f*b-n*g;a[1]=k*b-p*g;a[2]=e*b-r*g;a[3]=d*b-t*g;a[8]=f*g+n*b;a[9]=k*g+p*b;a[10]=e*g+r*b;a[11]=d*g+t*b;return a};b.rotateZ=function(a,c,b){var g=Math.sin(b);b=Math.cos(b);var f=c[0],k=c[1],e=c[2],d=c[3],n=c[4],p=c[5],r=c[6],t=c[7];c!==a&&(a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],
a[14]=c[14],a[15]=c[15]);a[0]=f*b+n*g;a[1]=k*b+p*g;a[2]=e*b+r*g;a[3]=d*b+t*g;a[4]=n*b-f*g;a[5]=p*b-k*g;a[6]=r*b-e*g;a[7]=t*b-d*g;return a};b.fromTranslation=function(a,c){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};b.fromScaling=function(a,c){a[0]=c[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=c[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotation=function(a,c,
b){var g=b[0],f=b[1];b=b[2];var k=Math.sqrt(g*g+f*f+b*b),d;if(Math.abs(k)<e.EPSILON)return null;k=1/k;g*=k;f*=k;b*=k;k=Math.sin(c);c=Math.cos(c);d=1-c;a[0]=g*g*d+c;a[1]=f*g*d+b*k;a[2]=b*g*d-f*k;a[3]=0;a[4]=g*f*d-b*k;a[5]=f*f*d+c;a[6]=b*f*d+g*k;a[7]=0;a[8]=g*b*d+f*k;a[9]=f*b*d-g*k;a[10]=b*b*d+c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromXRotation=function(a,c){var b=Math.sin(c),g=Math.cos(c);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=g;a[6]=b;a[7]=0;a[8]=0;a[9]=-b;a[10]=g;a[11]=0;a[12]=0;
a[13]=0;a[14]=0;a[15]=1;return a};b.fromYRotation=function(a,c){var b=Math.sin(c),g=Math.cos(c);a[0]=g;a[1]=0;a[2]=-b;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=b;a[9]=0;a[10]=g;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromZRotation=function(a,c){var b=Math.sin(c),g=Math.cos(c);a[0]=g;a[1]=b;a[2]=0;a[3]=0;a[4]=-b;a[5]=g;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotationTranslation=function(a,c,b){var g=c[0],f=c[1],k=c[2],e=c[3],d=g+g,n=f+f,
p=k+k;c=g*d;var r=g*n,g=g*p,t=f*n,f=f*p,k=k*p,d=e*d,n=e*n,e=e*p;a[0]=1-(t+k);a[1]=r+e;a[2]=g-n;a[3]=0;a[4]=r-e;a[5]=1-(c+k);a[6]=f+d;a[7]=0;a[8]=g+n;a[9]=f-d;a[10]=1-(c+t);a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};b.fromRotationTranslationScale=function(a,c,b,g){var f=c[0],k=c[1],e=c[2],d=c[3],n=f+f,p=k+k,r=e+e;c=f*n;var t=f*p,f=f*r,v=k*p,k=k*r,e=e*r,n=d*n,p=d*p,d=d*r,r=g[0],x=g[1];g=g[2];a[0]=(1-(v+e))*r;a[1]=(t+d)*r;a[2]=(f-p)*r;a[3]=0;a[4]=(t-d)*x;a[5]=(1-(c+e))*x;a[6]=(k+n)*x;
a[7]=0;a[8]=(f+p)*g;a[9]=(k-n)*g;a[10]=(1-(c+v))*g;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};b.fromRotationTranslationScaleOrigin=function(a,c,b,g,f){var k=c[0],e=c[1],d=c[2],n=c[3],p=k+k,r=e+e,t=d+d;c=k*p;var v=k*r,k=k*t,x=e*r,e=e*t,d=d*t,p=n*p,r=n*r,n=n*t,t=g[0],y=g[1];g=g[2];var w=f[0],l=f[1];f=f[2];a[0]=(1-(x+d))*t;a[1]=(v+n)*t;a[2]=(k-r)*t;a[3]=0;a[4]=(v-n)*y;a[5]=(1-(c+d))*y;a[6]=(e+p)*y;a[7]=0;a[8]=(k+r)*g;a[9]=(e-p)*g;a[10]=(1-(c+x))*g;a[11]=0;a[12]=b[0]+w-(a[0]*w+a[4]*l+
a[8]*f);a[13]=b[1]+l-(a[1]*w+a[5]*l+a[9]*f);a[14]=b[2]+f-(a[2]*w+a[6]*l+a[10]*f);a[15]=1;return a};b.fromQuat=function(a,c){var b=c[0],g=c[1],f=c[2],k=c[3],e=b+b,d=g+g,n=f+f,b=b*e,p=g*e,g=g*d,r=f*e,t=f*d,f=f*n,e=k*e,d=k*d,k=k*n;a[0]=1-g-f;a[1]=p+k;a[2]=r-d;a[3]=0;a[4]=p-k;a[5]=1-b-f;a[6]=t+e;a[7]=0;a[8]=r+d;a[9]=t-e;a[10]=1-b-g;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.frustum=function(a,c,b,g,f,k,e){var d=1/(b-c),n=1/(f-g),p=1/(k-e);a[0]=2*k*d;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*k*n;a[6]=
0;a[7]=0;a[8]=(b+c)*d;a[9]=(f+g)*n;a[10]=(e+k)*p;a[11]=-1;a[12]=0;a[13]=0;a[14]=e*k*2*p;a[15]=0;return a};b.perspective=function(a,c,b,g,f){c=1/Math.tan(c/2);var k=1/(g-f);a[0]=c/b;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(f+g)*k;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*f*g*k;a[15]=0;return a};b.perspectiveFromFieldOfView=function(a,c,b,g){var f=Math.tan(c.upDegrees*Math.PI/180),k=Math.tan(c.downDegrees*Math.PI/180),e=Math.tan(c.leftDegrees*Math.PI/180);c=Math.tan(c.rightDegrees*
Math.PI/180);var d=2/(e+c),n=2/(f+k);a[0]=d;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=n;a[6]=0;a[7]=0;a[8]=-((e-c)*d*.5);a[9]=(f-k)*n*.5;a[10]=g/(b-g);a[11]=-1;a[12]=0;a[13]=0;a[14]=g*b/(b-g);a[15]=0;return a};b.ortho=function(a,c,b,g,f,k,e){var d=1/(c-b),n=1/(g-f),p=1/(k-e);a[0]=-2*d;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*n;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*p;a[11]=0;a[12]=(c+b)*d;a[13]=(f+g)*n;a[14]=(e+k)*p;a[15]=1;return a};b.lookAt=function(a,c,h,g){var f,k,d,q,n,p,r,t,v=c[0],x=c[1];c=c[2];d=g[0];q=g[1];
k=g[2];r=h[0];g=h[1];f=h[2];if(Math.abs(v-r)<e.EPSILON&&Math.abs(x-g)<e.EPSILON&&Math.abs(c-f)<e.EPSILON)return b.identity(a);h=v-r;g=x-g;r=c-f;t=1/Math.sqrt(h*h+g*g+r*r);h*=t;g*=t;r*=t;f=q*r-k*g;k=k*h-d*r;d=d*g-q*h;(t=Math.sqrt(f*f+k*k+d*d))?(t=1/t,f*=t,k*=t,d*=t):d=k=f=0;q=g*d-r*k;n=r*f-h*d;p=h*k-g*f;(t=Math.sqrt(q*q+n*n+p*p))?(t=1/t,q*=t,n*=t,p*=t):p=n=q=0;a[0]=f;a[1]=q;a[2]=h;a[3]=0;a[4]=k;a[5]=n;a[6]=g;a[7]=0;a[8]=d;a[9]=p;a[10]=r;a[11]=0;a[12]=-(f*v+k*x+d*c);a[13]=-(q*v+n*x+p*c);a[14]=-(h*v+
g*x+r*c);a[15]=1;return a};b.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+
Math.pow(a[14],2)+Math.pow(a[15],2))};m.exports=b},{"./common.js":2}],7:[function(d,m,l){var e=d("./common.js"),b=d("./mat3.js"),a=d("./vec3.js");d=d("./vec4.js");var c={create:function(){var a=new e.ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}};c.rotationTo=function(){var b=a.create(),g=a.fromValues(1,0,0),f=a.fromValues(0,1,0);return function(k,e,d){var n=a.dot(e,d);if(-.999999>n)return a.cross(b,g,e),1E-6>a.length(b)&&a.cross(b,f,e),a.normalize(b,b),c.setAxisAngle(k,b,Math.PI),k;if(.999999<
n)return k[0]=0,k[1]=0,k[2]=0,k[3]=1,k;a.cross(b,e,d);k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=1+n;return c.normalize(k,k)}}();c.setAxes=function(){var a=b.create();return function(b,f,k,e){a[0]=k[0];a[3]=k[1];a[6]=k[2];a[1]=e[0];a[4]=e[1];a[7]=e[2];a[2]=-f[0];a[5]=-f[1];a[8]=-f[2];return c.normalize(b,c.fromMat3(b,a))}}();c.clone=d.clone;c.fromValues=d.fromValues;c.copy=d.copy;c.set=d.set;c.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};c.setAxisAngle=function(a,c,b){b*=.5;var k=Math.sin(b);
a[0]=k*c[0];a[1]=k*c[1];a[2]=k*c[2];a[3]=Math.cos(b);return a};c.add=d.add;c.multiply=function(a,c,b){var k=c[0],e=c[1],d=c[2];c=c[3];var n=b[0],p=b[1],r=b[2];b=b[3];a[0]=k*b+c*n+e*r-d*p;a[1]=e*b+c*p+d*n-k*r;a[2]=d*b+c*r+k*p-e*n;a[3]=c*b-k*n-e*p-d*r;return a};c.mul=c.multiply;c.scale=d.scale;c.rotateX=function(a,c,b){b*=.5;var k=c[0],e=c[1],d=c[2];c=c[3];var n=Math.sin(b);b=Math.cos(b);a[0]=k*b+c*n;a[1]=e*b+d*n;a[2]=d*b-e*n;a[3]=c*b-k*n;return a};c.rotateY=function(a,c,b){b*=.5;var k=c[0],e=c[1],
d=c[2];c=c[3];var n=Math.sin(b);b=Math.cos(b);a[0]=k*b-d*n;a[1]=e*b+c*n;a[2]=d*b+k*n;a[3]=c*b-e*n;return a};c.rotateZ=function(a,c,b){b*=.5;var k=c[0],e=c[1],d=c[2];c=c[3];var n=Math.sin(b);b=Math.cos(b);a[0]=k*b+e*n;a[1]=e*b-k*n;a[2]=d*b+c*n;a[3]=c*b-d*n;return a};c.calculateW=function(a,c){var b=c[0],k=c[1],e=c[2];a[0]=b;a[1]=k;a[2]=e;a[3]=Math.sqrt(Math.abs(1-b*b-k*k-e*e));return a};c.dot=d.dot;c.lerp=d.lerp;c.slerp=function(a,c,b,k){var e=c[0],d=c[1],n=c[2];c=c[3];var p=b[0],r=b[1],t=b[2];b=b[3];
var v,x,y;x=e*p+d*r+n*t+c*b;0>x&&(x=-x,p=-p,r=-r,t=-t,b=-b);1E-6<1-x?(v=Math.acos(x),y=Math.sin(v),x=Math.sin((1-k)*v)/y,k=Math.sin(k*v)/y):x=1-k;a[0]=x*e+k*p;a[1]=x*d+k*r;a[2]=x*n+k*t;a[3]=x*c+k*b;return a};c.sqlerp=function(){var a=c.create(),b=c.create();return function(f,k,e,d,n,p){c.slerp(a,k,n,p);c.slerp(b,e,d,p);c.slerp(f,a,b,2*p*(1-p));return f}}();c.invert=function(a,c){var b=c[0],k=c[1],e=c[2],d=c[3],n=b*b+k*k+e*e+d*d,n=n?1/n:0;a[0]=-b*n;a[1]=-k*n;a[2]=-e*n;a[3]=d*n;return a};c.conjugate=
function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=c[3];return a};c.length=d.length;c.len=c.length;c.squaredLength=d.squaredLength;c.sqrLen=c.squaredLength;c.normalize=d.normalize;c.fromMat3=function(a,c){var b=c[0]+c[4]+c[8];if(0<b)b=Math.sqrt(b+1),a[3]=.5*b,b=.5/b,a[0]=(c[5]-c[7])*b,a[1]=(c[6]-c[2])*b,a[2]=(c[1]-c[3])*b;else{var k=0;c[4]>c[0]&&(k=1);c[8]>c[3*k+k]&&(k=2);var e=(k+1)%3,d=(k+2)%3,b=Math.sqrt(c[3*k+k]-c[3*e+e]-c[3*d+d]+1);a[k]=.5*b;b=.5/b;a[3]=(c[3*e+d]-c[3*d+e])*b;a[e]=(c[3*e+k]+
c[3*k+e])*b;a[d]=(c[3*d+k]+c[3*k+d])*b}return a};c.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};m.exports=c},{"./common.js":2,"./mat3.js":5,"./vec3.js":9,"./vec4.js":10}],8:[function(d,m,l){var e=d("./common.js"),b={create:function(){var a=new e.ARRAY_TYPE(2);a[0]=0;a[1]=0;return a},clone:function(a){var c=new e.ARRAY_TYPE(2);c[0]=a[0];c[1]=a[1];return c},fromValues:function(a,c){var b=new e.ARRAY_TYPE(2);b[0]=a;b[1]=c;return b},copy:function(a,c){a[0]=c[0];a[1]=c[1];return a},
set:function(a,c,b){a[0]=c;a[1]=b;return a},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];return a},subtract:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];return a}};b.sub=b.subtract;b.multiply=function(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];return a};b.mul=b.multiply;b.divide=function(a,c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];return a};b.div=b.divide;b.min=function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],b[1]);return a};b.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);a[1]=Math.max(c[1],b[1]);
return a};b.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;return a};b.scaleAndAdd=function(a,c,b,g){a[0]=c[0]+b[0]*g;a[1]=c[1]+b[1]*g;return a};b.distance=function(a,c){var b=c[0]-a[0],g=c[1]-a[1];return Math.sqrt(b*b+g*g)};b.dist=b.distance;b.squaredDistance=function(a,c){var b=c[0]-a[0],g=c[1]-a[1];return b*b+g*g};b.sqrDist=b.squaredDistance;b.length=function(a){var c=a[0];a=a[1];return Math.sqrt(c*c+a*a)};b.len=b.length;b.squaredLength=function(a){var c=a[0];a=a[1];return c*c+a*a};b.sqrLen=b.squaredLength;
b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];return a};b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];return a};b.normalize=function(a,c){var b=c[0],g=c[1],b=b*b+g*g;0<b&&(b=1/Math.sqrt(b),a[0]=c[0]*b,a[1]=c[1]*b);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]};b.cross=function(a,c,b){c=c[0]*b[1]-c[1]*b[0];a[0]=a[1]=0;a[2]=c;return a};b.lerp=function(a,c,b,g){var f=c[0];c=c[1];a[0]=f+g*(b[0]-f);a[1]=c+g*(b[1]-c);return a};b.random=function(a,c){c=c||1;var b=2*e.RANDOM()*Math.PI;a[0]=Math.cos(b)*
c;a[1]=Math.sin(b)*c;return a};b.transformMat2=function(a,c,b){var g=c[0];c=c[1];a[0]=b[0]*g+b[2]*c;a[1]=b[1]*g+b[3]*c;return a};b.transformMat2d=function(a,c,b){var g=c[0];c=c[1];a[0]=b[0]*g+b[2]*c+b[4];a[1]=b[1]*g+b[3]*c+b[5];return a};b.transformMat3=function(a,c,b){var g=c[0];c=c[1];a[0]=b[0]*g+b[3]*c+b[6];a[1]=b[1]*g+b[4]*c+b[7];return a};b.transformMat4=function(a,c,b){var g=c[0];c=c[1];a[0]=b[0]*g+b[4]*c+b[12];a[1]=b[1]*g+b[5]*c+b[13];return a};b.forEach=function(){var a=b.create();return function(c,
b,g,f,k,e){b||(b=2);g||(g=0);for(f=f?Math.min(f*b+g,c.length):c.length;g<f;g+=b)a[0]=c[g],a[1]=c[g+1],k(a,a,e),c[g]=a[0],c[g+1]=a[1];return c}}();b.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};m.exports=b},{"./common.js":2}],9:[function(d,m,l){var e=d("./common.js"),b={create:function(){var a=new e.ARRAY_TYPE(3);a[0]=0;a[1]=0;a[2]=0;return a},clone:function(a){var c=new e.ARRAY_TYPE(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c},fromValues:function(a,c,b){var g=new e.ARRAY_TYPE(3);g[0]=a;g[1]=c;
g[2]=b;return g},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];return a},set:function(a,c,b,g){a[0]=c;a[1]=b;a[2]=g;return a},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];return a},subtract:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];return a}};b.sub=b.subtract;b.multiply=function(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];a[2]=c[2]*b[2];return a};b.mul=b.multiply;b.divide=function(a,c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];a[2]=c[2]/b[2];return a};b.div=b.divide;b.min=
function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],b[1]);a[2]=Math.min(c[2],b[2]);return a};b.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);a[1]=Math.max(c[1],b[1]);a[2]=Math.max(c[2],b[2]);return a};b.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;return a};b.scaleAndAdd=function(a,c,b,g){a[0]=c[0]+b[0]*g;a[1]=c[1]+b[1]*g;a[2]=c[2]+b[2]*g;return a};b.distance=function(a,c){var b=c[0]-a[0],g=c[1]-a[1],f=c[2]-a[2];return Math.sqrt(b*b+g*g+f*f)};b.dist=b.distance;b.squaredDistance=
function(a,c){var b=c[0]-a[0],g=c[1]-a[1],f=c[2]-a[2];return b*b+g*g+f*f};b.sqrDist=b.squaredDistance;b.length=function(a){var c=a[0],b=a[1];a=a[2];return Math.sqrt(c*c+b*b+a*a)};b.len=b.length;b.squaredLength=function(a){var c=a[0],b=a[1];a=a[2];return c*c+b*b+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];return a};b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];return a};b.normalize=function(a,c){var b=c[0],g=c[1],f=c[2],b=b*b+g*g+f*f;0<b&&(b=
1/Math.sqrt(b),a[0]=c[0]*b,a[1]=c[1]*b,a[2]=c[2]*b);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};b.cross=function(a,c,b){var g=c[0],f=c[1];c=c[2];var k=b[0],e=b[1];b=b[2];a[0]=f*b-c*e;a[1]=c*k-g*b;a[2]=g*e-f*k;return a};b.lerp=function(a,c,b,g){var f=c[0],k=c[1];c=c[2];a[0]=f+g*(b[0]-f);a[1]=k+g*(b[1]-k);a[2]=c+g*(b[2]-c);return a};b.hermite=function(a,c,b,g,f,k){var e=k*k,d=e*(2*k-3)+1,n=e*(k-2)+k,p=e*(k-1);k=e*(3-2*k);a[0]=c[0]*d+b[0]*n+g[0]*p+f[0]*k;a[1]=c[1]*d+b[1]*n+g[1]*
p+f[1]*k;a[2]=c[2]*d+b[2]*n+g[2]*p+f[2]*k;return a};b.bezier=function(a,c,b,g,f,k){var e=1-k,d=e*e,n=k*k,p=d*e,d=3*k*d,e=3*n*e;k*=n;a[0]=c[0]*p+b[0]*d+g[0]*e+f[0]*k;a[1]=c[1]*p+b[1]*d+g[1]*e+f[1]*k;a[2]=c[2]*p+b[2]*d+g[2]*e+f[2]*k;return a};b.random=function(a,c){c=c||1;var b=2*e.RANDOM()*Math.PI,g=2*e.RANDOM()-1,f=Math.sqrt(1-g*g)*c;a[0]=Math.cos(b)*f;a[1]=Math.sin(b)*f;a[2]=g*c;return a};b.transformMat4=function(a,c,b){var g=c[0],f=c[1];c=c[2];var k=b[3]*g+b[7]*f+b[11]*c+b[15],k=k||1;a[0]=(b[0]*
g+b[4]*f+b[8]*c+b[12])/k;a[1]=(b[1]*g+b[5]*f+b[9]*c+b[13])/k;a[2]=(b[2]*g+b[6]*f+b[10]*c+b[14])/k;return a};b.transformMat3=function(a,c,b){var g=c[0],f=c[1];c=c[2];a[0]=g*b[0]+f*b[3]+c*b[6];a[1]=g*b[1]+f*b[4]+c*b[7];a[2]=g*b[2]+f*b[5]+c*b[8];return a};b.transformQuat=function(a,c,b){var g=c[0],f=c[1],k=c[2];c=b[0];var e=b[1],d=b[2];b=b[3];var n=b*g+e*k-d*f,p=b*f+d*g-c*k,r=b*k+c*f-e*g,g=-c*g-e*f-d*k;a[0]=n*b+g*-c+p*-d-r*-e;a[1]=p*b+g*-e+r*-c-n*-d;a[2]=r*b+g*-d+n*-e-p*-c;return a};b.rotateX=function(a,
c,b,g){var f=[],k=[];f[0]=c[0]-b[0];f[1]=c[1]-b[1];f[2]=c[2]-b[2];k[0]=f[0];k[1]=f[1]*Math.cos(g)-f[2]*Math.sin(g);k[2]=f[1]*Math.sin(g)+f[2]*Math.cos(g);a[0]=k[0]+b[0];a[1]=k[1]+b[1];a[2]=k[2]+b[2];return a};b.rotateY=function(a,c,b,g){var f=[],k=[];f[0]=c[0]-b[0];f[1]=c[1]-b[1];f[2]=c[2]-b[2];k[0]=f[2]*Math.sin(g)+f[0]*Math.cos(g);k[1]=f[1];k[2]=f[2]*Math.cos(g)-f[0]*Math.sin(g);a[0]=k[0]+b[0];a[1]=k[1]+b[1];a[2]=k[2]+b[2];return a};b.rotateZ=function(a,c,b,g){var f=[],k=[];f[0]=c[0]-b[0];f[1]=
c[1]-b[1];f[2]=c[2]-b[2];k[0]=f[0]*Math.cos(g)-f[1]*Math.sin(g);k[1]=f[0]*Math.sin(g)+f[1]*Math.cos(g);k[2]=f[2];a[0]=k[0]+b[0];a[1]=k[1]+b[1];a[2]=k[2]+b[2];return a};b.forEach=function(){var a=b.create();return function(c,b,g,f,k,e){b||(b=3);g||(g=0);for(f=f?Math.min(f*b+g,c.length):c.length;g<f;g+=b)a[0]=c[g],a[1]=c[g+1],a[2]=c[g+2],k(a,a,e),c[g]=a[0],c[g+1]=a[1],c[g+2]=a[2];return c}}();b.angle=function(a,c){var h=b.fromValues(a[0],a[1],a[2]),g=b.fromValues(c[0],c[1],c[2]);b.normalize(h,h);b.normalize(g,
g);h=b.dot(h,g);return 1<h?0:Math.acos(h)};b.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};m.exports=b},{"./common.js":2}],10:[function(d,m,l){var e=d("./common.js"),b={create:function(){var a=new e.ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a},clone:function(a){var c=new e.ARRAY_TYPE(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c},fromValues:function(a,c,b,g){var f=new e.ARRAY_TYPE(4);f[0]=a;f[1]=c;f[2]=b;f[3]=g;return f},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];
a[3]=c[3];return a},set:function(a,c,b,g,f){a[0]=c;a[1]=b;a[2]=g;a[3]=f;return a},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];a[3]=c[3]+b[3];return a},subtract:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];a[3]=c[3]-b[3];return a}};b.sub=b.subtract;b.multiply=function(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];a[2]=c[2]*b[2];a[3]=c[3]*b[3];return a};b.mul=b.multiply;b.divide=function(a,c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];a[2]=c[2]/b[2];a[3]=c[3]/b[3];return a};b.div=b.divide;
b.min=function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],b[1]);a[2]=Math.min(c[2],b[2]);a[3]=Math.min(c[3],b[3]);return a};b.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);a[1]=Math.max(c[1],b[1]);a[2]=Math.max(c[2],b[2]);a[3]=Math.max(c[3],b[3]);return a};b.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;a[3]=c[3]*b;return a};b.scaleAndAdd=function(a,c,b,g){a[0]=c[0]+b[0]*g;a[1]=c[1]+b[1]*g;a[2]=c[2]+b[2]*g;a[3]=c[3]+b[3]*g;return a};b.distance=function(a,c){var b=c[0]-a[0],g=c[1]-
a[1],f=c[2]-a[2],k=c[3]-a[3];return Math.sqrt(b*b+g*g+f*f+k*k)};b.dist=b.distance;b.squaredDistance=function(a,c){var b=c[0]-a[0],g=c[1]-a[1],f=c[2]-a[2],k=c[3]-a[3];return b*b+g*g+f*f+k*k};b.sqrDist=b.squaredDistance;b.length=function(a){var c=a[0],b=a[1],g=a[2];a=a[3];return Math.sqrt(c*c+b*b+g*g+a*a)};b.len=b.length;b.squaredLength=function(a){var c=a[0],b=a[1],g=a[2];a=a[3];return c*c+b*b+g*g+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=-c[3];return a};
b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];a[3]=1/c[3];return a};b.normalize=function(a,c){var b=c[0],g=c[1],f=c[2],k=c[3],e=b*b+g*g+f*f+k*k;0<e&&(e=1/Math.sqrt(e),a[0]=b*e,a[1]=g*e,a[2]=f*e,a[3]=k*e);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};b.lerp=function(a,c,b,g){var f=c[0],k=c[1],e=c[2];c=c[3];a[0]=f+g*(b[0]-f);a[1]=k+g*(b[1]-k);a[2]=e+g*(b[2]-e);a[3]=c+g*(b[3]-c);return a};b.random=function(a,c){c=c||1;a[0]=e.RANDOM();a[1]=e.RANDOM();a[2]=
e.RANDOM();a[3]=e.RANDOM();b.normalize(a,a);b.scale(a,a,c);return a};b.transformMat4=function(a,c,b){var g=c[0],f=c[1],k=c[2];c=c[3];a[0]=b[0]*g+b[4]*f+b[8]*k+b[12]*c;a[1]=b[1]*g+b[5]*f+b[9]*k+b[13]*c;a[2]=b[2]*g+b[6]*f+b[10]*k+b[14]*c;a[3]=b[3]*g+b[7]*f+b[11]*k+b[15]*c;return a};b.transformQuat=function(a,c,b){var g=c[0],f=c[1],k=c[2],e=b[0],d=b[1],n=b[2];b=b[3];var p=b*g+d*k-n*f,r=b*f+n*g-e*k,t=b*k+e*f-d*g,g=-e*g-d*f-n*k;a[0]=p*b+g*-e+r*-n-t*-d;a[1]=r*b+g*-d+t*-e-p*-n;a[2]=t*b+g*-n+p*-d-r*-e;a[3]=
c[3];return a};b.forEach=function(){var a=b.create();return function(c,b,g,f,k,e){b||(b=4);g||(g=0);for(f=f?Math.min(f*b+g,c.length):c.length;g<f;g+=b)a[0]=c[g],a[1]=c[g+1],a[2]=c[g+2],a[3]=c[g+3],k(a,a,e),c[g]=a[0],c[g+1]=a[1],c[g+2]=a[2],c[g+3]=a[3];return c}}();b.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};m.exports=b},{"./common.js":2}],11:[function(d,m,l){function e(a,c){return q.isUndefined(c)?""+c:q.isNumber(c)&&!isFinite(c)||q.isFunction(c)||q.isRegExp(c)?c.toString():
c}function b(a,c){return q.isString(a)?a.length<c?a:a.slice(0,c):a}function a(a,c,b,f,g){throw new r.AssertionError({message:b,actual:a,expected:c,operator:f,stackStartFunction:g});}function c(c,b){c||a(c,!0,b,"==",r.ok)}function h(a,c){if(a===c)return!0;if(q.isBuffer(a)&&q.isBuffer(c)){if(a.length!=c.length)return!1;for(var b=0;b<a.length;b++)if(a[b]!==c[b])return!1;return!0}return q.isDate(a)&&q.isDate(c)?a.getTime()===c.getTime():q.isRegExp(a)&&q.isRegExp(c)?a.source===c.source&&a.global===c.global&&
a.multiline===c.multiline&&a.lastIndex===c.lastIndex&&a.ignoreCase===c.ignoreCase:q.isObject(a)||q.isObject(c)?f(a,c):a==c}function g(a){return"[object Arguments]"==Object.prototype.toString.call(a)}function f(a,c){if(q.isNullOrUndefined(a)||q.isNullOrUndefined(c)||a.prototype!==c.prototype)return!1;if(q.isPrimitive(a)||q.isPrimitive(c))return a===c;var b=g(a),f=g(c);if(b&&!f||!b&&f)return!1;if(b)return a=n.call(a),c=n.call(c),h(a,c);var b=t(a),k=t(c);if(b.length!=k.length)return!1;b.sort();k.sort();
for(f=b.length-1;0<=f;f--)if(b[f]!=k[f])return!1;for(f=b.length-1;0<=f;f--)if(k=b[f],!h(a[k],c[k]))return!1;return!0}function k(a,c){return a&&c?"[object RegExp]"==Object.prototype.toString.call(c)?c.test(a):a instanceof c||!0===c.call({},a)?!0:!1:!1}function u(c,b,f,g){var h;q.isString(f)&&(g=f,f=null);try{b()}catch(e){h=e}g=(f&&f.name?" ("+f.name+").":".")+(g?" "+g:".");c&&!h&&a(h,f,"Missing expected exception"+g);!c&&k(h,f)&&a(h,f,"Got unwanted exception"+g);if(c&&h&&f&&!k(h,f)||!c&&h)throw h;
}var q=d("util/"),n=Array.prototype.slice,p=Object.prototype.hasOwnProperty,r=m.exports=c;r.AssertionError=function(c){this.name="AssertionError";this.actual=c.actual;this.expected=c.expected;this.operator=c.operator;c.message?(this.message=c.message,this.generatedMessage=!1):(this.message=b(JSON.stringify(this.actual,e),128)+" "+this.operator+" "+b(JSON.stringify(this.expected,e),128),this.generatedMessage=!0);var f=c.stackStartFunction||a;Error.captureStackTrace?Error.captureStackTrace(this,f):
(c=Error(),c.stack&&(c=c.stack,f=c.indexOf("\n"+f.name),0<=f&&(f=c.indexOf("\n",f+1),c=c.substring(f+1)),this.stack=c))};q.inherits(r.AssertionError,Error);r.fail=a;r.ok=c;r.equal=function(c,b,f){c!=b&&a(c,b,f,"==",r.equal)};r.notEqual=function(c,b,f){c==b&&a(c,b,f,"!=",r.notEqual)};r.deepEqual=function(c,b,f){h(c,b)||a(c,b,f,"deepEqual",r.deepEqual)};r.notDeepEqual=function(c,b,f){h(c,b)&&a(c,b,f,"notDeepEqual",r.notDeepEqual)};r.strictEqual=function(c,b,f){c!==b&&a(c,b,f,"===",r.strictEqual)};r.notStrictEqual=
function(c,b,f){c===b&&a(c,b,f,"!==",r.notStrictEqual)};r["throws"]=function(a,c,b){u.apply(this,[!0].concat(n.call(arguments)))};r.doesNotThrow=function(a,c){u.apply(this,[!1].concat(n.call(arguments)))};r.ifError=function(a){if(a)throw a;};var t=Object.keys||function(a){var c=[],b;for(b in a)p.call(a,b)&&c.push(b);return c}},{"util/":16}],12:[function(d,m,l){function e(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function b(a){return"function"===typeof a}function a(a){return"object"===
typeof a&&null!==a}m.exports=e;e.EventEmitter=e;e.prototype._events=void 0;e.prototype._maxListeners=void 0;e.defaultMaxListeners=10;e.prototype.setMaxListeners=function(a){if("number"!==typeof a||0>a||isNaN(a))throw TypeError("n must be a positive number");this._maxListeners=a;return this};e.prototype.emit=function(c){var h,g,f,k;this._events||(this._events={});if("error"===c&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){h=arguments[1];if(h instanceof Error)throw h;throw TypeError('Uncaught, unspecified "error" event.');
}g=this._events[c];if(void 0===g)return!1;if(b(g))switch(arguments.length){case 1:g.call(this);break;case 2:g.call(this,arguments[1]);break;case 3:g.call(this,arguments[1],arguments[2]);break;default:h=arguments.length;f=Array(h-1);for(k=1;k<h;k++)f[k-1]=arguments[k];g.apply(this,f)}else if(a(g)){h=arguments.length;f=Array(h-1);for(k=1;k<h;k++)f[k-1]=arguments[k];g=g.slice();h=g.length;for(k=0;k<h;k++)g[k].apply(this,f)}return!0};e.prototype.addListener=function(c,h){var g;if(!b(h))throw TypeError("listener must be a function");
this._events||(this._events={});this._events.newListener&&this.emit("newListener",c,b(h.listener)?h.listener:h);this._events[c]?a(this._events[c])?this._events[c].push(h):this._events[c]=[this._events[c],h]:this._events[c]=h;a(this._events[c])&&!this._events[c].warned&&(g=void 0!==this._maxListeners?this._maxListeners:e.defaultMaxListeners)&&0<g&&this._events[c].length>g&&(this._events[c].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",
this._events[c].length),"function"===typeof console.trace&&console.trace());return this};e.prototype.on=e.prototype.addListener;e.prototype.once=function(a,h){function g(){this.removeListener(a,g);f||(f=!0,h.apply(this,arguments))}if(!b(h))throw TypeError("listener must be a function");var f=!1;g.listener=h;this.on(a,g);return this};e.prototype.removeListener=function(c,h){var g,f,k;if(!b(h))throw TypeError("listener must be a function");if(!this._events||!this._events[c])return this;g=this._events[c];
k=g.length;f=-1;if(g===h||b(g.listener)&&g.listener===h)delete this._events[c],this._events.removeListener&&this.emit("removeListener",c,h);else if(a(g)){for(;0<k--;)if(g[k]===h||g[k].listener&&g[k].listener===h){f=k;break}if(0>f)return this;1===g.length?(g.length=0,delete this._events[c]):g.splice(f,1);this._events.removeListener&&this.emit("removeListener",c,h)}return this};e.prototype.removeAllListeners=function(a){var h;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?
this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(h in this._events)"removeListener"!==h&&this.removeAllListeners(h);this.removeAllListeners("removeListener");this._events={};return this}h=this._events[a];if(b(h))this.removeListener(a,h);else for(;h.length;)this.removeListener(a,h[h.length-1]);delete this._events[a];return this};e.prototype.listeners=function(a){return this._events&&this._events[a]?b(this._events[a])?[this._events[a]]:this._events[a].slice():
[]};e.listenerCount=function(a,h){return a._events&&a._events[h]?b(a._events[h])?1:a._events[h].length:0}},{}],13:[function(d,m,l){m.exports="function"===typeof Object.create?function(e,b){e.super_=b;e.prototype=Object.create(b.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,b){e.super_=b;var a=function(){};a.prototype=b.prototype;e.prototype=new a;e.prototype.constructor=e}},{}],14:[function(d,m,l){function e(){g=!1;f.length?h=f.concat(h):k=-1;h.length&&b()}
function b(){if(!g){var a=setTimeout(e);g=!0;for(var c=h.length;c;){f=h;for(h=[];++k<c;)f[k].run();k=-1;c=h.length}f=null;g=!1;clearTimeout(a)}}function a(a,c){this.fun=a;this.array=c}function c(){}d=m.exports={};var h=[],g=!1,f,k=-1;d.nextTick=function(c){var f=Array(arguments.length-1);if(1<arguments.length)for(var k=1;k<arguments.length;k++)f[k-1]=arguments[k];h.push(new a(c,f));1!==h.length||g||setTimeout(b,0)};a.prototype.run=function(){this.fun.apply(null,this.array)};d.title="browser";d.browser=
!0;d.env={};d.argv=[];d.version="";d.versions={};d.on=c;d.addListener=c;d.once=c;d.off=c;d.removeListener=c;d.removeAllListeners=c;d.emit=c;d.binding=function(a){throw Error("process.binding is not supported");};d.cwd=function(){return"/"};d.chdir=function(a){throw Error("process.chdir is not supported");};d.umask=function(){return 0}},{}],15:[function(d,m,l){m.exports=function(e){return e&&"object"===typeof e&&"function"===typeof e.copy&&"function"===typeof e.fill&&"function"===typeof e.readUInt8}},
{}],16:[function(d,m,l){(function(e,b){function a(a,b){var g={seen:[],stylize:h};3<=arguments.length&&(g.depth=arguments[2]);4<=arguments.length&&(g.colors=arguments[3]);t(b)?g.showHidden=b:b&&l._extend(g,b);y(g.showHidden)&&(g.showHidden=!1);y(g.depth)&&(g.depth=2);y(g.colors)&&(g.colors=!1);y(g.customInspect)&&(g.customInspect=!0);g.colors&&(g.stylize=c);return f(g,a,g.depth)}function c(c,b){var f=a.styles[b];return f?"\u001b["+a.colors[f][0]+"m"+c+"\u001b["+a.colors[f][1]+"m":c}function h(a,c){return a}
function g(a){var c={};a.forEach(function(a,b){c[a]=!0});return c}function f(a,c,b){if(a.customInspect&&c&&B(c.inspect)&&c.inspect!==l.inspect&&(!c.constructor||c.constructor.prototype!==c)){var h=c.inspect(b,a);x(h)||(h=f(a,h,b));return h}if(h=k(a,c))return h;var e=Object.keys(c),d=g(e);a.showHidden&&(e=Object.getOwnPropertyNames(c));if(D(c)&&(0<=e.indexOf("message")||0<=e.indexOf("description")))return u(c);if(0===e.length){if(B(c))return a.stylize("[Function"+(c.name?": "+c.name:"")+"]","special");
if(w(c))return a.stylize(RegExp.prototype.toString.call(c),"regexp");if(m(c))return a.stylize(Date.prototype.toString.call(c),"date");if(D(c))return u(c)}var h="",t=!1,y=["{","}"];r(c)&&(t=!0,y=["[","]"]);B(c)&&(h=" [Function"+(c.name?": "+c.name:"")+"]");w(c)&&(h=" "+RegExp.prototype.toString.call(c));m(c)&&(h=" "+Date.prototype.toUTCString.call(c));D(c)&&(h=" "+u(c));if(0===e.length&&(!t||0==c.length))return y[0]+h+y[1];if(0>b)return w(c)?a.stylize(RegExp.prototype.toString.call(c),"regexp"):a.stylize("[Object]",
"special");a.seen.push(c);e=t?q(a,c,b,d,e):e.map(function(f){return n(a,c,b,d,f,t)});a.seen.pop();return p(e,h,y)}function k(a,c){if(y(c))return a.stylize("undefined","undefined");if(x(c)){var b="'"+JSON.stringify(c).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(b,"string")}if(v(c))return a.stylize(""+c,"number");if(t(c))return a.stylize(""+c,"boolean");if(null===c)return a.stylize("null","null")}function u(a){return"["+Error.prototype.toString.call(a)+"]"}function q(a,
c,b,f,g){for(var h=[],k=0,e=c.length;k<e;++k)Object.prototype.hasOwnProperty.call(c,String(k))?h.push(n(a,c,b,f,String(k),!0)):h.push("");g.forEach(function(g){g.match(/^\d+$/)||h.push(n(a,c,b,f,g,!0))});return h}function n(a,c,b,g,h,k){var e,d;c=Object.getOwnPropertyDescriptor(c,h)||{value:c[h]};c.get?d=c.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):c.set&&(d=a.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(g,h)||(e="["+h+"]");d||(0>a.seen.indexOf(c.value)?
(d=null===b?f(a,c.value,null):f(a,c.value,b-1),-1<d.indexOf("\n")&&(d=k?d.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+d.split("\n").map(function(a){return"   "+a}).join("\n"))):d=a.stylize("[Circular]","special"));if(y(e)){if(k&&h.match(/^\d+$/))return d;e=JSON.stringify(""+h);e.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(e=e.substr(1,e.length-2),e=a.stylize(e,"name")):(e=e.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e=a.stylize(e,"string"))}return e+": "+d}
function p(a,c,b){var f=0;return 60<a.reduce(function(a,c){f++;0<=c.indexOf("\n")&&f++;return a+c.replace(/\u001b\[\d\d?m/g,"").length+1},0)?b[0]+(""===c?"":c+"\n ")+" "+a.join(",\n  ")+" "+b[1]:b[0]+c+" "+a.join(", ")+" "+b[1]}function r(a){return Array.isArray(a)}function t(a){return"boolean"===typeof a}function v(a){return"number"===typeof a}function x(a){return"string"===typeof a}function y(a){return void 0===a}function w(a){return z(a)&&"[object RegExp]"===Object.prototype.toString.call(a)}function z(a){return"object"===
typeof a&&null!==a}function m(a){return z(a)&&"[object Date]"===Object.prototype.toString.call(a)}function D(a){return z(a)&&("[object Error]"===Object.prototype.toString.call(a)||a instanceof Error)}function B(a){return"function"===typeof a}function A(a){return 10>a?"0"+a.toString(10):a.toString(10)}function C(){var a=new Date,c=[A(a.getHours()),A(a.getMinutes()),A(a.getSeconds())].join(":");return[a.getDate(),I[a.getMonth()],c].join(" ")}var H=/%[sdj%]/g;l.format=function(c){if(!x(c)){for(var b=
[],f=0;f<arguments.length;f++)b.push(a(arguments[f]));return b.join(" ")}for(var f=1,g=arguments,h=g.length,b=String(c).replace(H,function(a){if("%%"===a)return"%";if(f>=h)return a;switch(a){case "%s":return String(g[f++]);case "%d":return Number(g[f++]);case "%j":try{return JSON.stringify(g[f++])}catch(c){return"[Circular]"}default:return a}}),k=g[f];f<h;k=g[++f])b=null!==k&&z(k)?b+(" "+a(k)):b+(" "+k);return b};l.deprecate=function(a,c){if(y(b.process))return function(){return l.deprecate(a,c).apply(this,
arguments)};if(!0===e.noDeprecation)return a;var f=!1;return function(){if(!f){if(e.throwDeprecation)throw Error(c);e.traceDeprecation?console.trace(c):console.error(c);f=!0}return a.apply(this,arguments)}};var E={},G;l.debuglog=function(a){y(G)&&(G=e.env.NODE_DEBUG||"");a=a.toUpperCase();if(!E[a])if((new RegExp("\\b"+a+"\\b","i")).test(G)){var c=e.pid;E[a]=function(){var b=l.format.apply(l,arguments);console.error("%s %d: %s",a,c,b)}}else E[a]=function(){};return E[a]};l.inspect=a;a.colors={bold:[1,
22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};a.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};l.isArray=r;l.isBoolean=t;l.isNull=function(a){return null===a};l.isNullOrUndefined=function(a){return null==a};l.isNumber=v;l.isString=x;l.isSymbol=function(a){return"symbol"===typeof a};l.isUndefined=
y;l.isRegExp=w;l.isObject=z;l.isDate=m;l.isError=D;l.isFunction=B;l.isPrimitive=function(a){return null===a||"boolean"===typeof a||"number"===typeof a||"string"===typeof a||"symbol"===typeof a||"undefined"===typeof a};l.isBuffer=d("./support/isBuffer");var I="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");l.log=function(){console.log("%s - %s",C(),l.format.apply(l,arguments))};l.inherits=d("inherits");l._extend=function(a,c){if(!c||!z(c))return a;for(var b=Object.keys(c),f=b.length;f--;)a[b[f]]=
c[b[f]];return a}}).call(this,d("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":15,_process:14,inherits:13}],17:[function(d,m,l){var e=d("lodash._baseassign");l=d("lodash._createassigner");var b=d("lodash.keys");d=l(function(a,c,h){if(h)for(var g=-1,f=b(c),k=f.length;++g<k;){var d=f[g],q=a[d],n=h(q,c[d],d,a,c);(n===n?n===q:q!==q)&&(void 0!==q||d in a)||(a[d]=n)}else a=e(a,c);return a});m.exports=d},{"lodash._baseassign":18,
"lodash._createassigner":24,"lodash.keys":28}],18:[function(d,m,l){var e=d("lodash._basecopy"),b=d("lodash.keys");m.exports=function(a,c){return null==c?a:e(c,b(c),a)}},{"lodash._basecopy":19,"lodash.keys":20}],19:[function(d,m,l){m.exports=function(e,b,a){a||(a={});for(var c=-1,h=b.length;++c<h;){var g=b[c];a[g]=e[g]}return a}},{}],20:[function(d,m,l){function e(a,c){a="number"==typeof a||f.test(a)?+a:-1;return-1<a&&0==a%1&&a<(null==c?9007199254740991:c)}function b(a){return"number"==typeof a&&-1<
a&&0==a%1&&9007199254740991>=a}function a(a){var f;f=a;if(null==f)f=[];else{c(f)||(f=Object(f));for(var d=f.length,d=d&&b(d)&&(g(f)||h(f))&&d||0,q=f.constructor,u=-1,q="function"==typeof q&&q.prototype===f,x=Array(d),y=0<d;++u<d;)x[u]=u+"";for(var w in f)y&&e(w,d)||"constructor"==w&&(q||!k.call(f,w))||x.push(w);f=x}u=(d=f.length)&&a.length;w=!!u&&b(u)&&(g(a)||h(a));q=-1;for(x=[];++q<d;)y=f[q],(w&&e(y,u)||k.call(a,y))&&x.push(y);return x}function c(a){var c=typeof a;return!!a&&("object"==c||"function"==
c)}l=d("lodash._getnative");var h=d("lodash.isarguments"),g=d("lodash.isarray"),f=/^\d+$/,k=Object.prototype.hasOwnProperty,u=l(Object,"keys"),q=function(a){return function(c){return null==c?void 0:c[a]}}("length");m.exports=u?function(f){var g=null==f?void 0:f.constructor;return"function"==typeof g&&g.prototype===f||"function"!=typeof f&&null!=f&&b(q(f))?a(f):c(f)?u(f):[]}:a},{"lodash._getnative":21,"lodash.isarguments":22,"lodash.isarray":23}],21:[function(d,m,l){var e=/^\[object .+?Constructor\]$/;
d=Object.prototype;var b=Function.prototype.toString,a=d.toString,c=RegExp("^"+b.call(d.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");m.exports=function(h,g){var f=null==h?void 0:h[g];var k;null==f?k=!1:(k=typeof f,k=!f||"object"!=k&&"function"!=k||"[object Function]"!=a.call(f)?!!f&&"object"==typeof f&&e.test(f):c.test(b.call(f)));return k?f:void 0}},{}],22:[function(d,m,l){d=Object.prototype;var e=d.hasOwnProperty,
b=d.propertyIsEnumerable,a=function(a){return function(b){return null==b?void 0:b[a]}}("length");m.exports=function(c){var h;if(h=!!c&&"object"==typeof c)if(h=null!=c)h=a(c),h="number"==typeof h&&-1<h&&0==h%1&&9007199254740991>=h;return h&&e.call(c,"callee")&&!b.call(c,"callee")}},{}],23:[function(d,m,l){var e=/^\[object .+?Constructor\]$/;d=Object.prototype;var b=Function.prototype.toString,a=d.toString,c=RegExp("^"+b.call(d.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,
"$1.*?")+"$");d=function(h,g){var f=null==h?void 0:h[g];var k;null==f?k=!1:(k=typeof f,k=!f||"object"!=k&&"function"!=k||"[object Function]"!=a.call(f)?!!f&&"object"==typeof f&&e.test(f):c.test(b.call(f)));return k?f:void 0}(Array,"isArray")||function(c){var b;if(b=!!c&&"object"==typeof c)b=c.length,b="number"==typeof b&&-1<b&&0==b%1&&9007199254740991>=b;return b&&"[object Array]"==a.call(c)};m.exports=d},{}],24:[function(d,m,l){var e=d("lodash._bindcallback"),b=d("lodash._isiterateecall"),a=d("lodash.restparam");
m.exports=function(c){return a(function(a,g){var f=-1,k=null==a?0:g.length,d=2<k?g[k-2]:void 0,q=2<k?g[2]:void 0,n=1<k?g[k-1]:void 0;"function"==typeof d?(d=e(d,n,5),k-=2):(d="function"==typeof n?n:void 0,k-=d?1:0);q&&b(g[0],g[1],q)&&(d=3>k?void 0:d,k=1);for(;++f<k;)(q=g[f])&&c(a,q,d);return a})}},{"lodash._bindcallback":25,"lodash._isiterateecall":26,"lodash.restparam":27}],25:[function(d,m,l){function e(b){return b}m.exports=function(b,a,c){if("function"!=typeof b)return e;if(void 0===a)return b;
switch(c){case 1:return function(c){return b.call(a,c)};case 3:return function(c,g,f){return b.call(a,c,g,f)};case 4:return function(c,g,f,k){return b.call(a,c,g,f,k)};case 5:return function(c,g,f,k,e){return b.call(a,c,g,f,k,e)}}return function(){return b.apply(a,arguments)}}},{}],26:[function(d,m,l){var e=/^\d+$/,b=function(a){return function(c){return null==c?void 0:c[a]}}("length");m.exports=function(a,c,h){var g=typeof h;if(!h||"object"!=g&&"function"!=g)return!1;g=typeof c;if("number"==g){if(g=
null!=h)g=b(h),g="number"==typeof g&&-1<g&&0==g%1&&9007199254740991>=g;if(g)var g=c,f=h.length,g="number"==typeof g||e.test(g)?+g:-1,g=-1<g&&0==g%1&&g<(null==f?9007199254740991:f)}else g="string"==g&&c in h;return g?(c=h[c],a===a?a===c:c!==c):!1}},{}],27:[function(d,m,l){var e=Math.max;m.exports=function(b,a){if("function"!=typeof b)throw new TypeError("Expected a function");a=e(void 0===a?b.length-1:+a||0,0);return function(){for(var c=arguments,h=-1,g=e(c.length-a,0),f=Array(g);++h<g;)f[h]=c[a+
h];switch(a){case 0:return b.call(this,f);case 1:return b.call(this,c[0],f);case 2:return b.call(this,c[0],c[1],f)}g=Array(a+1);for(h=-1;++h<a;)g[h]=c[h];g[a]=f;return b.apply(this,g)}}},{}],28:[function(d,m,l){arguments[4][20][0].apply(l,arguments)},{dup:20,"lodash._getnative":29,"lodash.isarguments":30,"lodash.isarray":31}],29:[function(d,m,l){arguments[4][21][0].apply(l,arguments)},{dup:21}],30:[function(d,m,l){arguments[4][22][0].apply(l,arguments)},{dup:22}],31:[function(d,m,l){arguments[4][23][0].apply(l,
arguments)},{dup:23}],32:[function(d,m,l){var e=d("lodash._baseassign"),b=d("lodash._basecreate"),a=d("lodash._isiterateecall");m.exports=function(c,h,g){var f=b(c);g&&a(c,h,g)&&(h=void 0);return h?e(f,h):f}},{"lodash._baseassign":33,"lodash._basecreate":39,"lodash._isiterateecall":40}],33:[function(d,m,l){arguments[4][18][0].apply(l,arguments)},{dup:18,"lodash._basecopy":34,"lodash.keys":35}],34:[function(d,m,l){arguments[4][19][0].apply(l,arguments)},{dup:19}],35:[function(d,m,l){arguments[4][20][0].apply(l,
arguments)},{dup:20,"lodash._getnative":36,"lodash.isarguments":37,"lodash.isarray":38}],36:[function(d,m,l){arguments[4][21][0].apply(l,arguments)},{dup:21}],37:[function(d,m,l){arguments[4][22][0].apply(l,arguments)},{dup:22}],38:[function(d,m,l){arguments[4][23][0].apply(l,arguments)},{dup:23}],39:[function(d,m,l){d=function(){function e(){}return function(b){var a=typeof b;if(b&&("object"==a||"function"==a)){e.prototype=b;var c=new e;e.prototype=void 0}return c||{}}}();m.exports=d},{}],40:[function(d,
m,l){arguments[4][26][0].apply(l,arguments)},{dup:26}],41:[function(d,m,l){l=d("lodash.assign");var e=d("lodash.restparam");d=function(b,a){return e(function(c){var h=c[0];if(null==h)return h;c.push(a);return b.apply(void 0,c)})}(l,function(b,a){return void 0===b?a:b});m.exports=d},{"lodash.assign":17,"lodash.restparam":42}],42:[function(d,m,l){arguments[4][27][0].apply(l,arguments)},{dup:27}],43:[function(d,m,l){(function(e){(function(){var b,a,c;"undefined"!==typeof performance&&null!==performance&&
performance.now?m.exports=function(){return performance.now()}:"undefined"!==typeof e&&null!==e&&e.hrtime?(m.exports=function(){return(b()-c)/1E6},a=e.hrtime,b=function(){var c;c=a();return 1E9*c[0]+c[1]},c=b()):Date.now?(m.exports=function(){return Date.now()-c},c=Date.now()):(m.exports=function(){return(new Date).getTime()-c},c=(new Date).getTime())}).call(this)}).call(this,d("_process"))},{_process:14}],44:[function(d,m,l){m.exports=d("./lib/")},{"./lib/":45}],45:[function(d,m,l){m.exports=function(){function e(a,
b){if(null==a)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!==typeof b)throw new TypeError("predicate must be a function");for(var g=Object(a),f=g.length>>>0,k,e=0;e<f;e++)if(k=g[e],b.call(null,k,e,g))return k}var b=d("performance-now"),a=function(a){a=a||{};this._units=[];for(var b=0;b<(a.units||8);b++)this._units[b]={slot:b,use:0}};a.NOT_FOUND=-1;a.FULL=-2;a.prototype={_set:function(a,b){var g=this._units[a];g.dispose&&g.dispose(g,this);b?(this._units[a]=
b,this._units[a].slot=a):this._units[a]={slot:a,use:0}},bind:function(c,h){h=h||{};var g=!!h.fixed,f="function"==typeof h.dispose?h.dispose:null,k=this.get(c);if(k!==a.NOT_FOUND)return k;k=this._units.filter(function(a){return!a.fixed});if(!k.length)return a.FULL;k=k.reduce(function(a,c){return a?c.use<a.use?c:a:c},null).slot;this._set(k,{fixed:g,use:b(),id:c,dispose:f});return k},dispose:function(a){a=this.getEntry(a);this._set(a.slot,null)},has:function(a){return!!this.getEntry(a)},get:function(c){return(c=
this.getEntry(c))?(c.use=b(),c.slot):a.NOT_FOUND},use:function(a){if(a=this.getEntry(a))a.use=b()},getEntry:function(a){return e(this._units,function(b){return b.id===a})}};return{SimpleTextureManager:a}}()},{"performance-now":43}],46:[function(d,m,l){(function(){function e(a){"string"!==typeof a&&(a=String(a));if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(a))throw new TypeError("Invalid character in header field name");return a.toLowerCase()}function b(a){"string"!==typeof a&&(a=String(a));return a}function a(c){this.map=
{};c instanceof a?c.forEach(function(a,c){this.append(c,a)},this):c&&Object.getOwnPropertyNames(c).forEach(function(a){this.append(a,c[a])},this)}function c(a){if(a.bodyUsed)return Promise.reject(new TypeError("Already read"));a.bodyUsed=!0}function h(a){return new Promise(function(c,b){a.onload=function(){c(a.result)};a.onerror=function(){b(a.error)}})}function g(a){var c=new FileReader;c.readAsArrayBuffer(a);return h(c)}function f(){this.bodyUsed=!1;this._initBody=function(a){this._bodyInit=a;if("string"===
typeof a)this._bodyText=a;else if(t.blob&&Blob.prototype.isPrototypeOf(a))this._bodyBlob=a;else if(t.formData&&FormData.prototype.isPrototypeOf(a))this._bodyFormData=a;else if(!a)this._bodyText="";else if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(a))throw Error("unsupported BodyInit type");};t.blob?(this.blob=function(){var a=c(this);if(a)return a;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},
this.arrayBuffer=function(){return this.blob().then(g)},this.text=function(){var a=c(this);if(a)return a;if(this._bodyBlob){var a=this._bodyBlob,b=new FileReader;b.readAsText(a);return h(b)}if(this._bodyFormData)throw Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var a=c(this);return a?a:Promise.resolve(this._bodyText)};t.formData&&(this.formData=function(){return this.text().then(d)});this.json=function(){return this.text().then(JSON.parse)};
return this}function k(c,b){b=b||{};var f=b.body;if(k.prototype.isPrototypeOf(c)){if(c.bodyUsed)throw new TypeError("Already read");this.url=c.url;this.credentials=c.credentials;b.headers||(this.headers=new a(c.headers));this.method=c.method;this.mode=c.mode;f||(f=c._bodyInit,c.bodyUsed=!0)}else this.url=c;this.credentials=b.credentials||this.credentials||"omit";if(b.headers||!this.headers)this.headers=new a(b.headers);var g=b.method||this.method||"GET",h=g.toUpperCase();this.method=-1<v.indexOf(h)?
h:g;this.mode=b.mode||this.mode||null;this.referrer=null;if(("GET"===this.method||"HEAD"===this.method)&&f)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(f)}function d(a){var c=new FormData;a.trim().split("&").forEach(function(a){if(a){var b=a.split("=");a=b.shift().replace(/\+/g," ");b=b.join("=").replace(/\+/g," ");c.append(decodeURIComponent(a),decodeURIComponent(b))}});return c}function q(c){var b=new a;c.getAllResponseHeaders().trim().split("\n").forEach(function(a){var c=
a.trim().split(":");a=c.shift().trim();c=c.join(":").trim();b.append(a,c)});return b}function n(c,b){b||(b={});this._initBody(c);this.type="default";this.status=b.status;this.ok=200<=this.status&&300>this.status;this.statusText=b.statusText;this.headers=b.headers instanceof a?b.headers:new a(b.headers);this.url=b.url||""}if(!self.fetch){a.prototype.append=function(a,c){a=e(a);c=b(c);var f=this.map[a];f||(f=[],this.map[a]=f);f.push(c)};a.prototype["delete"]=function(a){delete this.map[e(a)]};a.prototype.get=
function(a){return(a=this.map[e(a)])?a[0]:null};a.prototype.getAll=function(a){return this.map[e(a)]||[]};a.prototype.has=function(a){return this.map.hasOwnProperty(e(a))};a.prototype.set=function(a,c){this.map[e(a)]=[b(c)]};a.prototype.forEach=function(a,c){Object.getOwnPropertyNames(this.map).forEach(function(b){this.map[b].forEach(function(f){a.call(c,f,b,this)},this)},this)};var p;if(p="FileReader"in self&&"Blob"in self)try{new Blob,p=!0}catch(r){p=!1}var t={blob:p,formData:"FormData"in self,
arrayBuffer:"ArrayBuffer"in self},v="DELETE GET HEAD OPTIONS POST PUT".split(" ");k.prototype.clone=function(){return new k(this)};f.call(k.prototype);f.call(n.prototype);n.prototype.clone=function(){return new n(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new a(this.headers),url:this.url})};n.error=function(){var a=new n(null,{status:0,statusText:""});a.type="error";return a};var x=[301,302,303,307,308];n.redirect=function(a,c){if(-1===x.indexOf(c))throw new RangeError("Invalid status code");
return new n(null,{status:c,headers:{location:a}})};self.Headers=a;self.Request=k;self.Response=n;self.fetch=function(a,c){return new Promise(function(b,f){var g;g=k.prototype.isPrototypeOf(a)&&!c?a:new k(a,c);var h=new XMLHttpRequest;h.onload=function(){var a=1223===h.status?204:h.status;if(100>a||599<a)f(new TypeError("Network request failed"));else{var c=h.statusText,g=q(h),k;k="responseURL"in h?h.responseURL:/^X-Request-URL:/m.test(h.getAllResponseHeaders())?h.getResponseHeader("X-Request-URL"):
void 0;b(new n("response"in h?h.response:h.responseText,{status:a,statusText:c,headers:g,url:k}))}};h.onerror=function(){f(new TypeError("Network request failed"))};h.open(g.method,g.url,!0);"include"===g.credentials&&(h.withCredentials=!0);"responseType"in h&&t.blob&&(h.responseType="blob");g.headers.forEach(function(a,c){h.setRequestHeader(c,a)});h.send("undefined"===typeof g._bodyInit?null:g._bodyInit)})};self.fetch.polyfill=!0}})()},{}],47:[function(d,m,l){function e(a,c){this.message=a;this.node=
c}function b(a){a.srcAsset&&b(a.srcAsset);for(var c=[],f=0;f<a.children.length;++f){var g=a.children[f],h=g.name;if(h&&-1!=c.indexOf(h))throw new e("Two subdata elements with the same name: '"+h+"'",g.refNode);h&&c.push(h)}for(f=0;f<a.subAssets.length;++f)b(a.subAssets[f])}function a(c){c.assetResult&&(c.assetResult=null);for(var b=c.listener,f=0;f<b.length;++f)b[f].onAssetChange&&b[f].onAssetChange(this);for(f=c.parents.length;f--;)a(c.parents[f])}function c(a){var b=a.loading?a.loadLevel:Infinity;
b&&a.srcAsset&&(b=Math.min(b,Math.max(a.srcAsset.loadLevel,a.srcAsset.progressLevel)));for(var f=a.subAssets.length;b&&f--;)b=Math.min(b,Math.max(a.subAssets[f].loadLevel,a.subAssets[f].progressLevel));for(f=a.children.length;b&&f--;)b=Math.min(b,a.children[f].progressLevel);f=a.progressLevel;a.progressLevel=b;if(f!=a.progressLevel)for(a._callLoadListeners(a.progressLevel,f),f=0;f<a.parents.length;++f)c(a.parents[f])}function h(c){c.assetParent&&a(c.assetParent)}function g(a,c){for(var b=0;b<c.length;++b)f(a,
c[b])}function f(a,c){var b=c.subdata;b.isMesh()==a.isMesh()&&c.filter.check(a)&&a.pushPostEntry(b)}function k(a,c,b){if(0<c.matchEntries.length)for(var f=a.allEntries.length;f--;){var h=a.allEntries[f];h.name&&c.namedEntries[h.name]||g(h,c.matchEntries)}for(f=c.allEntries.length;f--;){var h=c.allEntries[f],k,e=!1;h.name&&a.namedEntries[h.name]?k=a.namedEntries[h.name]:(k=new p,e=!0,a.allEntries.push(k));k.pushTableEntry(h);e&&g(k,a.matchEntries);k.name&&(a.namedEntries[k.name]=k)}a.matchEntries.push.apply(a.matchEntries,
c.matchEntries);for(f=c.allSubResults.length;f--;)u(a,c.allSubResults[f]);b&&c.pickFilter?(a.pickFilter=new t,a.pickFilter.intersection(b,c.pickFilter)):a.pickFilter=b||c.pickFilter;c.material&&(a.material=c.material);c.transform&&(a.transform=c.transform)}function u(a,c){var b;c.name&&a.namedSubResults[c.name]?b=a.namedSubResults[c.name]:(b=new w,b.parentResult=a,b.name=c.name,a.allSubResults.push(b),b.name&&(a.namedSubResults[b.name]=b));k(b,c,b.pickFilter)}function q(a){for(var c={meshes:[],groups:[],
transform:a.transform,material:a.material,postTransformXflowNode:null},b=0;b<a.allEntries.length;++b){var f=a.allEntries[b];!f.meshType||a.pickFilter&&!a.pickFilter.check(f)||(n(a,f),c.meshes.push({xflowNode:f.accumulatedXflowNode,type:f.meshType,material:f.material,transform:f.transform,visible:f.visible,refNode:f.refNode}))}if(b=a.namedEntries._postTransform)n(a,b),c.postTransformXflowNode=b.accumulatedXflowNode;for(b=0;b<a.allSubResults.length;++b)f=q(a.allSubResults[b]),c.groups.push(f);return c}
function n(a,c){if(c.outOfSync){c.accumulatedXflowNode?(c.accumulatedXflowNode.setCompute(""),c.accumulatedXflowNode.setFilter(""),c.accumulatedXflowNode.dataflowNode=null,c.accumulatedXflowNode.setLoading(!1)):c.accumulatedXflowNode=new D(!1);for(var b=1==c.postQueue.length?c.accumulatedXflowNode:new D(!1),f=0;f<c.postQueue.length;++f){for(var g=c.postQueue[f].includes,h=0;h<g.length;++h){for(var k=a,e=g[h],d=e.split("."),q=0;q<d.length-1;++q){var u=d[q];if("parent"==u){if(!k.parentResult)throw Error("Includes entry '"+
e+"' (token "+q+") accesses non existent parent.");k=k.parentResult}else{if(!k.namedSubResults[u])throw Error("Includes entry '"+e+"' (token "+q+") accesses non existent sub result '"+u+"'");k=k.namedSubResults[u]}}d=d[d.length-1];q=k.namedEntries[d];if(!q)throw Error("Includes entry '"+e+"' accesses non existent asset entry '"+d+"'");F.push(e);if(-1!=z.indexOf(q))throw f=F.join(" > "),Error("Recursive include dependencies detected: "+f);z.push(q);n(k,q);z.pop();F.pop();b.appendChild(q.accumulatedXflowNode)}c.postQueue[f].xflowNode&&
b.appendChild(c.postQueue[f].xflowNode)}g=null;for(f=0;f<c.postQueue.length;++f)h=c.postQueue[f],b||(b=f==c.postQueue.length-1?c.accumulatedXflowNode:new D(!1)),b.setCompute(h.compute),b.setFilter(h.filter),b.dataflowNode=h.dataflow,b.setLoading(h.dataflowLoading),g&&b.appendChild(g),g=b,b=null;c.outOfSync=!1}}function p(a){this.name=null;this.classNames=[];this.meshType=null;this.postQueue=[];this.transform=this.material=null;this.visible=!0;this.accumulatedXflowNode=null;this.outOfSync=!0;this.refNode=
null;a&&(this.name=a.name,v.add(this.classNames,a.classNames))}function r(a){if(void 0!==a._children){for(var c=0;c<a._children.length;c++)r(a._children[c]);a.isAssetDataNode&&(a.clear(),a._channelNode.setStructureOutOfSync())}}function t(){this.all=!1;this.names=[];this.classNames=[]}var v=d("../xflow/utils/utils.js").set,x=d("../xflow/interface/graph.js").DataNode;d=d("../xflow/base.js");l=function(a){this.srcAsset=this.name=null;this.children=[];this.subAssets=[];this.pickFilter=null;this.parents=
[];this.listener=[];this.loading=!1;this.refNode=a||null;this.assetResult=this.transform=this.material=null;this.loadLevel=0;this.progressLevel=Infinity};l.prototype.checkValidity=function(){this.isSubtreeLoading()||b(this)};l.prototype.setLoading=function(b){b!=this.loading&&(this.loading=b,c(this),a(this))};l.prototype.isSubtreeLoading=function(){return 0==this.progressLevel};l.prototype.getProgressLevel=function(){return this.progressLevel};l.prototype.setName=function(c){this.name=c;a(this)};
l.prototype.setMaterial=function(c){this.material=c;a(this)};l.prototype.setTransform=function(c){this.transform=c;"model"!==this.refNode.localName.toLowerCase()&&a(this)};l.prototype.appendChild=function(b){this.children.push(b);b.assetParent=this;c(this);a(this)};l.prototype.setPickFilter=function(c){"string"==typeof c?(this.pickFilter=new t,this.pickFilter.parse(c)):this.pickFilter=null;a(this)};l.prototype.appendSubAsset=function(b){b._addParent(this);this.subAssets.push(b);c(this);a(this)};l.prototype.setSrcAsset=
function(b){this.srcAsset&&this.srcAsset._removeParent(this);(this.srcAsset=b)&&this.srcAsset._addParent(this);c(this);a(this)};l.prototype.clearChildren=function(){for(var b=this.children.length;b--;)this.children[b].assetParent=null;this.children=[];c(this);a(this)};l.prototype.clearSubAssets=function(){for(var b=this.subAssets.length;b--;)this.subAssets[b]._removeParent(this);this.subAssets.length=0;c(this);a(this)};l.prototype._addParent=function(a){this.parents.push(a)};l.prototype._removeParent=
function(a){a=this.parents.indexOf(a);-1!=a&&this.parents.splice(a,1)};l.prototype._callLoadListeners=function(a,c){for(var b=this.listener,f=0;f<b.length;++f)b[f].onAssetLoadChange&&b[f].onAssetLoadChange(this,a,c)};l.prototype.addChangeListener=function(a){v.add(this.listener,a)};l.prototype.removeChangeListener=function(a){v.remove(this.listener,a);this.listener.length||this.dispose()};l.prototype.dispose=function(){this.assetResult.dispose();this.clearSubAssets();this.clearChildren()};l.prototype.getResult=
function(){this.assetResult||(this.assetResult=new w,this.assetResult.construct(this));return this.assetResult};var y=function(a,c,b){this.xflowNodeOut=a;this.xflowNodeIn=c;this.refNode=b||null;this.matchFilter=this.name=null;this.classNames=[];this.postFilter=this.postCompute=this.postDataflow=null;this.includes=[];this.meshType=this.transform=this.material=null;this.visible=!0;this.assetParent=null;this.loading=!1;this.loadLevel=0;this.progressLevel=Infinity;c.addLoadListener(this.onXflowLoadEvent.bind(this));
this._updateLoadingState()};y.prototype.setLoading=function(a){a!=this.loading&&(this.loading=a,this._updateLoadingState(),h(this))};y.prototype._updateLoadingState=function(){var a=this.loading?this.loadLevel:Infinity,a=Math.min(a,this.xflowNodeIn.getProgressLevel()),b=this.progressLevel;this.progressLevel=a;b!=this.progressLevel&&(this.assetParent&&c(this.assetParent),h(this))};y.prototype.onXflowLoadEvent=function(){this._updateLoadingState()};y.prototype.isSubtreeLoading=function(){return this.loading};
y.prototype.isMesh=function(){return!!this.meshType};y.prototype.setName=function(a){this.name=a;h(this)};y.prototype.setMatchFilter=function(a){"string"==typeof a?(this.matchFilter=new t,this.matchFilter.parse(a)):this.matchFilter=null;h(this)};y.prototype.setClassNames=function(a){this.classNames=a;h(this)};y.prototype.setClassNamesString=function(a){if(a){a=a.split(/\s+/);for(var c=a.length;c--;)a[c]=a[c].trim();this.setClassNames(a)}else this.setClassNames([])};y.prototype.setPostDataflow=function(a){this.postDataflow=
a;h(this)};y.prototype.setPostCompute=function(a){this.postCompute=a;h(this)};y.prototype.setPostFilter=function(a){this.postFilter=a;h(this)};y.prototype.setIncludes=function(a){this.includes=a;h(this)};y.prototype.setMaterial=function(a){this.material=a;h(this)};y.prototype.setTransform=function(a){this.transform=a;h(this)};y.prototype.setMeshType=function(a){this.meshType=a;h(this)};y.prototype.setVisibility=function(a){this.visible=a;h(this)};var w=function(){this.name=this.parentResult=null;
this.namedEntries={};this.allEntries=[];this.matchEntries=[];this.namedSubResults={};this.allSubResults=[];this.pickFilter=this.transform=this.material=null};w.prototype.construct=function(a){this.name=a.name;var c=a.srcAsset;c&&c.getResult()?k(this,c.getResult(),a.pickFilter):this.pickFilter=a.pickFilter;a.material&&(this.material=a.material);a.transform&&(this.transform=a.transform);for(var b=a.subAssets,c=b.length;c--;){var h=b[c].getResult();u(this,h)}b=[];a=a.children;for(c=0;c<a.length;++c){var h=
a[c],e=h.name,d;h.name&&h.matchFilter&&XML3D.debug.logWarning("Asset entry defines both name and match attribute. Match attribute will be ignored",h.refNode);if(e)this.namedEntries[e]?d=this.namedEntries[e]:(d=new p(h),g(d,this.matchEntries),this.namedEntries[e]=d,this.allEntries.push(d));else if(h.matchFilter){b.push(h);continue}else d=new p(h),g(d,this.matchEntries),this.allEntries.push(d);d.pushPostEntry(h)}for(c=0;c<b.length;++c)for(h=b[c],a={filter:h.matchFilter,subdata:h},this.matchEntries.push(a),
h=0;h<this.allEntries.length;++h)f(this.allEntries[h],a)};w.prototype.dispose=function(){for(var a=0;a<this.allEntries.length;a++)this.allEntries[a].dispose();for(a=0;a<this.allSubResults.length;a++)this.allSubResults[a].dispose()};w.prototype.getDataTree=function(){return q(this)};var z=[],F=[];p.prototype.isMesh=function(){return!!this.meshType};p.prototype.dispose=function(){r(this.accumulatedXflowNode);this.accumulatedXflowNode.clear()};p.prototype.pushTableEntry=function(a){this.name=a.name;
v.add(this.classNames,a.classNames);a.meshType&&(this.meshType=a.meshType);void 0!==a.visible&&(this.visible=a.visible);a.transform&&(this.transform=a.transform);a.material&&(this.material=a.material);this.postQueue.push.apply(this.postQueue,a.postQueue)};p.prototype.pushPostEntry=function(a){this.name=a.name;this.postQueue.push({dataflow:a.postDataflow,dataflowLoading:a.loading,compute:a.postCompute,filter:a.postFilter,includes:a.includes,xflowNode:a.xflowNodeIn});this.refNode=a.refNode;this.accumulatedXflowNode=
a.xflowNodeOut;v.add(this.classNames,a.classNames);a.meshType&&(this.meshType=a.meshType);a.material&&(this.material=a.material);void 0!==a.visible&&(this.visible=a.visible);a.transform&&(this.transform=a.transform)};t.prototype.parse=function(a){a=a.split(",");for(var c=a.length;c--;){var b=a[c].trim();if("*"==b)this.all=!0;else if(0==b.indexOf(".")){for(var b=b.split("."),f=b.length;f--;)b[f].trim()||b.splice(f,1);this.classNames.push(b)}else v.add(this.names,b)}};t.prototype.intersection=function(a,
c){v.intersection(this.names,a.names,c.names);v.intersection(this.classNames,a.classNames,c.classNames)};t.prototype.check=function(a){if(this.all)return!0;if(0<a.classNames.length)for(var c=this.classNames.length;c--;)if(v.isSubset(this.classNames[c],a.classNames))return!0;return a.name&&-1!=this.names.indexOf(a.name)};var D=function(a){x.call(this,a);this.isAssetDataNode=!0};d.createClass(D,x);m.exports={Asset:l,SubData:y,AssetResult:w}},{"../xflow/base.js":188,"../xflow/interface/graph.js":191,
"../xflow/utils/utils.js":240}],48:[function(d,m,l){function e(a){for(var c in this.connectedAdapterHandles)if(this.connectedAdapterHandles[c]==a.adapterHandle){var g=new b.ConnectedAdapterNotification(a,c);this.notifyChanged(g)}}var b=d("../interface/notification.js"),a=d("../interface/elements.js").config,c=d("../resource"),h=d("../utils/uri.js").URI;l=function(a){this.factory=a};l.prototype.connectAdapterHandle=function(a,c){this.connectedAdapterHandles||(this.connectedAdapterHandles={},this._bindedAdapterHandleCallback=
e.bind(this));this.disconnectAdapterHandle(a);c?(this.connectedAdapterHandles[a]=c,this.connectedAdapterHandles[a].addListener(this._bindedAdapterHandleCallback)):delete this.connectedAdapterHandles[a]};l.prototype.disconnectAdapterHandle=function(a){this.connectedAdapterHandles&&this.connectedAdapterHandles[a]&&(this.connectedAdapterHandles[a].removeListener(this._bindedAdapterHandleCallback),delete this.connectedAdapterHandles[a])};l.prototype.clearAdapterHandles=function(){for(var a in this.connectedAdapterHandles)this.connectedAdapterHandles[a].removeListener(this._bindedAdapterHandleCallback);
this.connectedAdapterHandles=null};l.prototype.getConnectedAdapterHandle=function(a){return this.connectedAdapterHandles&&this.connectedAdapterHandles[a]};l.prototype.getConnectedAdapter=function(a){return(a=this.getConnectedAdapterHandle(a))&&a.getAdapter()};l.prototype.dispose=function(){};d=function(a,c){this.factory=a;this.node=c};XML3D.createClass(d,l);d.prototype.init=function(){};d.prototype.notifyChanged=function(a){};d.prototype.getAdapterHandle=function(a,b,g){g=void 0===g?this.factory.canvasId:
g;"string"==typeof a&&(a=new h(a));return c.getAdapterHandle(this.node,a,b||this.factory.aspect,g)};d.prototype.notifyOppositeAdapters=function(a){a=a||b.ADAPTER_HANDLE_CHANGED;return c.notifyNodeAdapterChange(this.node,this.factory.aspect,this.factory.canvasId,a)};d.prototype.traverse=function(a){a(this);for(var c=this.getChildren(),b=0;b<c.length;b++){var g=this.factory.getAdapter(c[b]);g&&g.traverse(a)}};d.prototype.getChildren=function(){var a=this.node.children;this.node.shadowRoot?a=this.node.shadowRoot.children:
this.node.getDistributedNodes&&(a=this.node.getDistributedNodes());return a};var g=function(a,c,b){this.aspect=a;this.canvasId=b||0;this.mimetypes="string"==typeof c?[c]:c};g.prototype.createAdapter=function(a){return null};g.prototype.supportsMimetype=function(a){return-1!=this.mimetypes.indexOf(a)};l=function(a,c){g.call(this,a,["text/xml","application/xml"],c)};XML3D.createClass(l,g);l.prototype.getAdapter=function(c){c&&void 0===c._configured&&a.element(c);if(!c||void 0===c._configured)return null;
var b=c._configured,g=this.aspect+"_"+this.canvasId,h=b.adapters[g];if(void 0!==h)return h;if(h=this.createAdapter(c))b.adapters[g]=h,h.init();return h};m.exports={NodeAdapter:d,AdapterFactory:g,NodeAdapterFactory:l}},{"../interface/elements.js":72,"../interface/notification.js":74,"../resource":167,"../utils/uri.js":186}],49:[function(d,m,l){var e=d("../interface/notification.js");"use strict";d=function(b){this.url=b;this.adapter=null;this.listeners=[];this.status=0};d.STATUS={LOADING:0,NOT_FOUND:1,
READY:2};d.prototype.hasAdapter=function(){return null!=this.adapter};d.prototype.getAdapter=function(){return this.adapter};d.prototype.setAdapter=function(b,a){this.adapter=b;this.status=a;this.notifyListeners(e.ADAPTER_HANDLE_CHANGED)};d.prototype.notifyListeners=function(b){b=new e.AdapterHandleNotification(this,b);for(var a=this.listeners.length;a--;)this.listeners[a](b)};d.prototype.addListener=function(b){-1==this.listeners.indexOf(b)&&this.listeners.push(b)};d.prototype.removeListener=function(b){b=
this.listeners.indexOf(b);-1!=b&&this.listeners.splice(b,1)};m.exports=d},{"../interface/notification.js":74}],50:[function(d,m,l){var e={unProject:function(b,a,c,h,g,f,k){b=[b,a,c,1];a=[];e.multMatrices(h,g,a);if(!e.invertMatrix(a,a))return!1;b[0]=(b[0]-f[0])/f[2];b[1]=(b[1]-f[1])/f[3];b[0]=2*b[0]-1;b[1]=2*b[1]-1;b[2]=2*b[2]-1;h=[];e.multMatrixVec(a,b,h);if(0===h[3])return!1;h[0]/=h[3];h[1]/=h[3];h[2]/=h[3];k[0]=h[0];k[1]=h[1];k[2]=h[2];return!0},multMatrixVec:function(b,a,c){for(var h=0;4>h;h+=
1)c[h]=a[0]*b[0+h]+a[1]*b[4+h]+a[2]*b[8+h]+a[3]*b[12+h]},multMatrices:function(b,a,c){for(var h=0;4>h;h+=1)for(var g=0;4>g;g+=1)c[4*h+g]=b[4*h+0]*a[0+g]+b[4*h+1]*a[4+g]+b[4*h+2]*a[8+g]+b[4*h+3]*a[12+g]},invertMatrix:function(b,a){var c=[];c[0]=b[5]*b[10]*b[15]-b[5]*b[11]*b[14]-b[9]*b[6]*b[15]+b[9]*b[7]*b[14]+b[13]*b[6]*b[11]-b[13]*b[7]*b[10];c[4]=-b[4]*b[10]*b[15]+b[4]*b[11]*b[14]+b[8]*b[6]*b[15]-b[8]*b[7]*b[14]-b[12]*b[6]*b[11]+b[12]*b[7]*b[10];c[8]=b[4]*b[9]*b[15]-b[4]*b[11]*b[13]-b[8]*b[5]*b[15]+
b[8]*b[7]*b[13]+b[12]*b[5]*b[11]-b[12]*b[7]*b[9];c[12]=-b[4]*b[9]*b[14]+b[4]*b[10]*b[13]+b[8]*b[5]*b[14]-b[8]*b[6]*b[13]-b[12]*b[5]*b[10]+b[12]*b[6]*b[9];c[1]=-b[1]*b[10]*b[15]+b[1]*b[11]*b[14]+b[9]*b[2]*b[15]-b[9]*b[3]*b[14]-b[13]*b[2]*b[11]+b[13]*b[3]*b[10];c[5]=b[0]*b[10]*b[15]-b[0]*b[11]*b[14]-b[8]*b[2]*b[15]+b[8]*b[3]*b[14]+b[12]*b[2]*b[11]-b[12]*b[3]*b[10];c[9]=-b[0]*b[9]*b[15]+b[0]*b[11]*b[13]+b[8]*b[1]*b[15]-b[8]*b[3]*b[13]-b[12]*b[1]*b[11]+b[12]*b[3]*b[9];c[13]=b[0]*b[9]*b[14]-b[0]*b[10]*
b[13]-b[8]*b[1]*b[14]+b[8]*b[2]*b[13]+b[12]*b[1]*b[10]-b[12]*b[2]*b[9];c[2]=b[1]*b[6]*b[15]-b[1]*b[7]*b[14]-b[5]*b[2]*b[15]+b[5]*b[3]*b[14]+b[13]*b[2]*b[7]-b[13]*b[3]*b[6];c[6]=-b[0]*b[6]*b[15]+b[0]*b[7]*b[14]+b[4]*b[2]*b[15]-b[4]*b[3]*b[14]-b[12]*b[2]*b[7]+b[12]*b[3]*b[6];c[10]=b[0]*b[5]*b[15]-b[0]*b[7]*b[13]-b[4]*b[1]*b[15]+b[4]*b[3]*b[13]+b[12]*b[1]*b[7]-b[12]*b[3]*b[5];c[14]=-b[0]*b[5]*b[14]+b[0]*b[6]*b[13]+b[4]*b[1]*b[14]-b[4]*b[2]*b[13]-b[12]*b[1]*b[6]+b[12]*b[2]*b[5];c[3]=-b[1]*b[6]*b[11]+
b[1]*b[7]*b[10]+b[5]*b[2]*b[11]-b[5]*b[3]*b[10]-b[9]*b[2]*b[7]+b[9]*b[3]*b[6];c[7]=b[0]*b[6]*b[11]-b[0]*b[7]*b[10]-b[4]*b[2]*b[11]+b[4]*b[3]*b[10]+b[8]*b[2]*b[7]-b[8]*b[3]*b[6];c[11]=-b[0]*b[5]*b[11]+b[0]*b[7]*b[9]+b[4]*b[1]*b[11]-b[4]*b[3]*b[9]-b[8]*b[1]*b[7]+b[8]*b[3]*b[5];c[15]=b[0]*b[5]*b[10]-b[0]*b[6]*b[9]-b[4]*b[1]*b[10]+b[4]*b[2]*b[9]+b[8]*b[1]*b[6]-b[8]*b[2]*b[5];var h=b[0]*c[0]+b[1]*c[4]+b[2]*c[8]+b[3]*c[12];if(0===h)return!1;for(var h=1/h,g=0;16>g;g+=1)a[g]=c[g]*h;return!0}};m.exports=e},
{}],51:[function(d,m,l){var e=function(b){b=b||{guess:!0};var a=b.e||null;b=!!b.guess;var c=new e.implementation,a=c.run(a);return b?c.guessAnonymousFunctions(a):a};e.implementation=function(){};e.implementation.prototype={run:function(b,a){b=b||this.createException();a=a||this.mode(b);return"other"===a?this.other(arguments.callee):this[a](b)},createException:function(){try{this.undef()}catch(b){return b}},mode:function(b){return b.arguments&&b.stack?"chrome":b.stack&&b.sourceURL?"safari":"string"===
typeof b.message&&"undefined"!==typeof window&&window.opera?!b.stacktrace||-1<b.message.indexOf("\n")&&b.message.split("\n").length>b.stacktrace.split("\n").length?"opera9":b.stack?0>b.stacktrace.indexOf("called from line")?"opera10b":"opera11":"opera10a":b.stack?"firefox":"other"},instrumentFunction:function(b,a,c){b=b||window;var h=b[a];b[a]=function(){c.call(this,e().slice(4));return b[a]._instrumented.apply(this,arguments)};b[a]._instrumented=h},deinstrumentFunction:function(b,a){b[a].constructor===
Function&&b[a]._instrumented&&b[a]._instrumented.constructor===Function&&(b[a]=b[a]._instrumented)},chrome:function(b){b=(b.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");b.pop();return b},safari:function(b){return b.stack.replace(/\[native code\]\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},firefox:function(b){return b.stack.replace(/(?:\n@:0)?\s+$/m,
"").replace(/^[\(@]/gm,"{anonymous}()@").split("\n")},opera11:function(b){var a=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;b=b.stacktrace.split("\n");for(var c=[],h=0,g=b.length;h<g;h+=2){var f=a.exec(b[h]);if(f){var e=f[4]+":"+f[1]+":"+f[2],f=f[3]||"global code",f=f.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");c.push(f+"@"+e+" -- "+b[h+1].replace(/^\s+/,""))}}return c},opera10b:function(b){var a=/^(.*)@(.+):(\d+)$/;b=b.stacktrace.split("\n");
for(var c=[],h=0,g=b.length;h<g;h++){var f=a.exec(b[h]);f&&c.push((f[1]?f[1]+"()":"global code")+"@"+f[2]+":"+f[3])}return c},opera10a:function(b){var a=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;b=b.stacktrace.split("\n");for(var c=[],h=0,g=b.length;h<g;h+=2){var f=a.exec(b[h]);f&&c.push((f[3]||"{anonymous}")+"()@"+f[2]+":"+f[1]+" -- "+b[h+1].replace(/^\s+/,""))}return c},opera9:function(b){var a=/Line (\d+).*script (?:in )?(\S+)/i;b=b.message.split("\n");for(var c=[],h=2,g=b.length;h<
g;h+=2){var f=a.exec(b[h]);f&&c.push("{anonymous}()@"+f[2]+":"+f[1]+" -- "+b[h+1].replace(/^\s+/,""))}return c},other:function(b){for(var a=/function\s*([\w\-$]+)?\s*\(/i,c=[],h,g;b&&b.arguments&&10>c.length;)h=a.test(b.toString())?RegExp.$1||"{anonymous}":"{anonymous}",g=Array.prototype.slice.call(b.arguments||[]),c[c.length]=h+"("+this.stringifyArguments(g)+")",b=b.caller;return c},stringifyArguments:function(b){for(var a=[],c=Array.prototype.slice,h=0;h<b.length;++h){var g=b[h];void 0===g?a[h]=
"undefined":null===g?a[h]="null":g.constructor&&(g.constructor===Array?a[h]=3>g.length?"["+this.stringifyArguments(g)+"]":"["+this.stringifyArguments(c.call(g,0,1))+"..."+this.stringifyArguments(c.call(g,-1))+"]":g.constructor===Object?a[h]="#object":g.constructor===Function?a[h]="#function":g.constructor===String?a[h]='"'+g+'"':g.constructor===Number&&(a[h]=g))}return a.join(",")},sourceCache:{},ajax:function(b){var a=this.createXMLHTTPObject();if(a)try{return a.open("GET",b,!1),a.send(null),a.responseText}catch(c){}return""},
createXMLHTTPObject:function(){for(var b,a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],c=0;c<a.length;c++)try{return b=a[c](),this.createXMLHTTPObject=a[c],b}catch(h){}},isSameDomain:function(b){return"undefined"!==typeof location&&-1!==b.indexOf(location.hostname)},getSource:function(b){b in this.sourceCache||(this.sourceCache[b]=this.ajax(b).split("\n"));
return this.sourceCache[b]},guessAnonymousFunctions:function(b){for(var a=0;a<b.length;++a){var c=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,h=b[a],g=/\{anonymous\}\(.*\)@(.*)/.exec(h);if(g){var f=c.exec(g[1]);f&&(c=f[1],g=f[2],f=f[3]||0,c&&this.isSameDomain(c)&&g&&(c=this.guessAnonymousFunction(c,g,f),b[a]=h.replace("{anonymous}",c)))}}return b},guessAnonymousFunction:function(b,a,c){var h;try{h=this.findFunctionName(this.getSource(b),a)}catch(g){h="getSource failed with url: "+b+", exception: "+
g.toString()}return h},findFunctionName:function(b,a){for(var c=/function\s+([^(]*?)\s*\(([^)]*)\)/,h=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,g=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,f="",e,d=Math.min(a,20),q,n=0;n<d;++n)if(e=b[a-n-1],q=e.indexOf("//"),0<=q&&(e=e.substr(0,q)),e)if(f=e+f,(e=h.exec(f))&&e[1]||(e=c.exec(f))&&e[1]||(e=g.exec(f))&&e[1])return e[1];return"(?)"}};m.exports=e},{}],52:[function(d,m,l){var e={VERSION:"2.2.0",Result:{SUCCEEDED:1,NOTRANSITION:2,
CANCELLED:3,ASYNC:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(b,a){var c="string"==typeof b.initial?{state:b.initial}:b.initial,h=a||b.target||{},g=b.events||[],f=b.callbacks||{},k={},d=function(a){var c=a.from instanceof Array?a.from:a.from?[a.from]:[e.WILDCARD];k[a.name]=k[a.name]||{};for(var b=0;b<c.length;b++)k[a.name][c[b]]=a.to||c[b]};c&&(c.event=c.event||"startup",d({name:c.event,from:"none",to:c.state}));for(var q=
0;q<g.length;q++)d(g[q]);for(var n in k)k.hasOwnProperty(n)&&(h[n]=e.buildEvent(n,k[n]));for(n in f)f.hasOwnProperty(n)&&(h[n]=f[n]);h.current="none";h.is=function(a){return this.current==a};h.can=function(a){return!this.transition&&(k[a].hasOwnProperty(this.current)||k[a].hasOwnProperty(e.WILDCARD))};h.cannot=function(a){return!this.can(a)};h.error=b.error||function(a,c,b,f,g,h,e){throw e||h;};if(c&&!c.defer)h[c.event]();return h},doCallback:function(b,a,c,h,g,f){if(a)try{return a.apply(b,[c,h,g].concat(f))}catch(k){return b.error(c,
h,g,f,e.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",k)}},beforeEvent:function(b,a,c,h,g){return e.doCallback(b,b["onbefore"+a],a,c,h,g)},afterEvent:function(b,a,c,h,g){return e.doCallback(b,b["onafter"+a]||b["on"+a],a,c,h,g)},leaveState:function(b,a,c,h,g){return e.doCallback(b,b["onleave"+c],a,c,h,g)},enterState:function(b,a,c,h,g){return e.doCallback(b,b["onenter"+h]||b["on"+h],a,c,h,g)},changeState:function(b,a,c,h,g){return e.doCallback(b,b.onchangestate,
a,c,h,g)},buildEvent:function(b,a){return function(){var c=this.current,h=a[c]||a[e.WILDCARD]||c,g=Array.prototype.slice.call(arguments);if(this.transition)return this.error(b,c,h,g,e.Error.PENDING_TRANSITION,"event "+b+" inappropriate because previous transition did not complete");if(this.cannot(b))return this.error(b,c,h,g,e.Error.INVALID_TRANSITION,"event "+b+" inappropriate in current state "+this.current);if(!1===e.beforeEvent(this,b,c,h,g))return e.Result.CANCELLED;if(c===h)return e.afterEvent(this,
b,c,h,g),e.Result.NOTRANSITION;var f=this;this.transition=function(){f.transition=null;f.current=h;e.enterState(f,b,c,h,g);e.changeState(f,b,c,h,g);e.afterEvent(f,b,c,h,g)};this.transition.cancel=function(){f.transition=null;e.afterEvent(f,b,c,h,g)};var k=e.leaveState(this,b,c,h,g);if(!1===k)return this.transition=null,e.Result.CANCELLED;if("async"===k)return e.Result.ASYNC;this.transition&&this.transition();return e.Result.SUCCEEDED}}};window.StateMachine=e;m.exports=e},{}],53:[function(d,m,l){function e(a){a.asset.clearChildren();
a.asset.clearSubAssets();for(var c=a.node.firstElementChild;null!==c;c=c.nextElementSibling){var b=a.factory.getAdapter(c);b&&b.getAsset&&a.asset.appendSubAsset(b.getAsset());b&&b.assetEntry&&a.asset.appendChild(b.assetEntry)}}function b(a,c,b){var f=(b=a.getAdapterHandle(b))&&b.status;f===D.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find element of url '"+b.url+"' for "+c,a.node);a.connectAdapterHandle(c,b);a.connectedAdapterChanged(c,b?b.getAdapter():null,f)}function a(a){if(a.node.hasAttribute("pick")){var c=
a.node.getAttribute("pick");a.asset.setPickFilter(c)}else a.asset.setPickFilter(null)}function c(a,c){c?a.setIncludes(c.trim().split(/\s*,\s*/)):a.setIncludes([])}function h(a){var c=a.node.getAttribute("class");a.assetEntry.setClassNamesString(c)}function g(a){var c=a.node.getAttribute("compute"),g=p(c);g?b(a,"postDataflow",g):(a.disconnectAdapterHandle("postDataflow"),f(a));a.assetEntry.setPostCompute(c)}function f(a){var c=!1,b;(b=a.getConnectedAdapterHandle("postDataflow"))&&b.status===D.STATUS.LOADING&&
(c=!0);a.assetEntry.setLoading(c)}function k(a,c){var b=a.node,f=b.getAttribute("material");f?(b=y.getAbsoluteURI(b.ownerDocument._documentURL||b.ownerDocument.URL,f),c.setMaterial(b.toString())):c.setMaterial(null)}var u=d("../transform-fetcher.js"),q=d("./data.js");l=d("../../xflow/base.js");var n=d("../../xflow/interface/graph.js").DataNode,p=d("../../xflow/interface/graph.js").getComputeDataflowUrl,r=d("../../asset/asset.js").Asset,t=d("../../asset/asset.js").SubData,v=d("../../interface/notification.js"),
x=d("../../utils/misc.js").dispatchCustomEvent,y=d("../../resource"),w=d("../../utils/css.js"),z=d("../../base/adapter.js").NodeAdapter,F=XML3D.createClass,D=d("../../base/adapterhandle.js");d=function(a,c){z.call(this,a,c);this.asset=new r(this.node);this.style=c.style?window.getComputedStyle(c):w.getComputedStyle(c);"model"!==c.localName.toLowerCase()&&(this.transformFetcher=new u(this,"transform","transform"))};F(d,z);d.prototype.init=function(){this.asset.addChangeListener(this);this.asset.setName(this.node.getAttribute("name"));
b(this,"src",this.node.getAttribute("src"));a(this);e(this);k(this,this.asset);this.transformFetcher&&this.transformFetcher.update()};d.prototype.onAssetLoadChange=function(a,c,b){Infinity==c?x(this.node,"load",!1,!0,null):c>b&&x(this.node,"progress",!1,!0,null)};d.prototype.getAssetComplete=function(){return Infinity==this.asset.getProgressLevel()};d.prototype.getAssetProgressLevel=function(){return this.asset.getProgressLevel()};d.prototype.getAsset=function(){return this.asset};d.prototype.connectedAdapterChanged=
function(a,c){"src"==a&&this.asset.setSrcAsset(c&&c.getAsset()||null);var b=!1,f;(f=this.getConnectedAdapterHandle("src"))&&f.status===D.STATUS.LOADING&&(b=!0);this.asset.setLoading(b)};d.prototype.onTransformChange=function(a,c){this.asset.setTransform(c)};d.prototype.attributeChangedCallback=function(c,f,g){switch(c){case "name":this.asset.setName(g);break;case "material":k(this,this.asset);break;case "style":case "transform":this.transformFetcher&&this.transformFetcher.update();break;case "src":b(this,
"src",g);break;case "pick":a(this)}};d.prototype.notifyChanged=function(a){a.type==v.ADAPTER_HANDLE_CHANGED?(this.connectedAdapterChanged(a.key,a.adapter),a.handleStatus==D.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find <asset> element of url '"+a.url+"' for "+a.key)):a.type==v.NODE_INSERTED?e(this):a.type==v.NODE_REMOVED?e(this):a.type==v.THIS_REMOVED&&(this.clearAdapterHandles(),this.asset.removeChangeListener(this))};var B=function(a,c){this.assetData=!0;q.call(this,a,c);this.outputXflowNode=
this.assetEntry=null};F(B,q);B.prototype.init=function(){q.prototype.init.call(this);this.outputXflowNode=new C(!1);this.assetEntry=new t(this.outputXflowNode,this.getXflowNode(),this.node);this.assetEntry.setName(this.node.getAttribute("name"));h(this);g(this);this.assetEntry.setPostFilter(this.node.getAttribute("filter"));c(this.assetEntry,this.node.getAttribute("includes"))};B.prototype.connectedAdapterChanged=function(a,c){"postDataflow"==a?(this.assetEntry.setPostDataflow(c&&c.getXflowNode()||
null),f(this)):q.prototype.connectedAdapterChanged.call(this,a,c)};B.prototype.attributeChangedCallback=function(a,b,f){q.prototype.attributeChangedCallback.call(this,a,b,f);switch(a){case "name":this.assetEntry.setName(f);break;case "compute":g(this);break;case "class":h(this);break;case "filter":this.assetEntry.setPostFilter(f);break;case "includes":c(f)}};B.prototype.notifyChanged=function(a){q.prototype.notifyChanged.call(this,a)};B.prototype.onTransformChange=function(a,c){this.assetEntry.setTransform(c)};
var A=function(a,c){B.call(this,a,c);this.style=c.style?window.getComputedStyle(c):w.getComputedStyle(c);this.transformFetcher=new u(this,"transform","transform")};F(A,B,{init:function(){B.prototype.init.call(this);k(this,this.assetEntry);this.assetEntry.setMeshType(this.node.getAttribute("type")||"triangles");this.assetEntry.setMatchFilter(this.node.getAttribute("match"));this.transformFetcher.update();this.updateVisibility()},attributeChangedCallback:function(a,c,b){B.prototype.attributeChangedCallback.call(this,
a,c,b);switch(a){case "material":k(this,this.assetEntry);break;case "match":this.assetEntry.setMatchFilter(b);break;case "transform":this.transformFetcher.update();break;case "style":this.styleChangedCallback();break;case "type":this.assetEntry.setMeshType(b||"triangles")}},styleChangedCallback:function(){this.transformFetcher.update();this.updateVisibility()},notifyChanged:function(a){B.prototype.notifyChanged.call(this,a)},updateVisibility:function(){var a="none"==this.style.display;this.assetEntry&&
this.assetEntry.setVisibility(!a)}});var C=function(a){n.call(this,a);this.isAssetDataNode=!0};l.createClass(C,n);m.exports={AssetAdapter:d,AssetMeshAdapter:A,AssetDataAdapter:B}},{"../../asset/asset.js":47,"../../base/adapter.js":48,"../../base/adapterhandle.js":49,"../../interface/notification.js":74,"../../resource":167,"../../utils/css.js":181,"../../utils/misc.js":184,"../../xflow/base.js":188,"../../xflow/interface/graph.js":191,"../transform-fetcher.js":66,"./data.js":56}],54:[function(d,m,
l){var e=d("../../xflow/interface/request.js").ComputeRequest;l=d("../../xflow/processing/vs-connect.js").setShaderConstant;var b=d("../../xflow/base.js").registerErrorCallback,a=d("../../xflow/interface/constants.js"),c=d("../../utils/uri.js").URI,h=d("../../base/adapter.js").NodeAdapter;d=XML3D.createClass;var g=function(a,c){h.call(this,a,c);this.xflowDataNode=null};d(g,h);g.prototype.getXflowNode=function(){return this.xflowDataNode};g.prototype.getComputeRequest=function(a,c){return new e(this.xflowDataNode,
a,c)};g.prototype.getComputeResult=function(c){return this.xflowDataNode._getResult(a.RESULT_TYPE.COMPUTE,c)};g.prototype.getOutputNames=function(){return this.xflowDataNode.getOutputNames()};g.prototype.getOutputChannelInfo=function(a){return this.xflowDataNode.getOutputChannelInfo(a)};l(a.SHADER_CONSTANT_KEY.OBJECT_ID,"objectID");l(a.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM,"modelViewProjectionMatrix");l(a.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM_NORMAL,"modelViewProjectionNormalMatrix");l(a.SHADER_CONSTANT_KEY.VIEW_TRANSFORM,
"modelViewMatrix");l(a.SHADER_CONSTANT_KEY.VIEW_TRANSFORM_NORMAL,"modelViewMatrixN");l(a.SHADER_CONSTANT_KEY.WORLD_TRANSFORM,"modelMatrix");b(function(a,b){a="Xflow: "+a;var g=b?b.userData:null;if(g&&g.ownerDocument)if(g.ownerDocument===document)XML3D.debug.logError(a,g);else if(g.id){var h=new c("#"+g.id),h=h.getAbsoluteURI(g.ownerDocument._documentURL||g.ownerDocument.URL);XML3D.debug.logError(a,"External Node: "+h)}else XML3D.debug.logError(a,"External Document: "+g.ownerDocument.URL);else"string"==
typeof g?XML3D.debug.logError(a,g):XML3D.debug.logError(a)});m.exports=g},{"../../base/adapter.js":48,"../../utils/uri.js":186,"../../xflow/base.js":188,"../../xflow/interface/constants.js":189,"../../xflow/interface/request.js":192,"../../xflow/processing/vs-connect.js":239}],55:[function(d,m,l){var e=d("../../interface/notification.js"),b=d("../../base/adapter.js").NodeAdapter;d=function(a,c){b.call(this,a,c)};XML3D.createClass(d,b);d.prototype.getComputeCode=function(){return this.node.value};
d.prototype.notifyChanged=function(a){switch(a.type){case e.VALUE_MODIFIED:case e.NODE_INSERTED:case e.NODE_REMOVED:(a=this.node.parentNode)&&(a=this.factory.getAdapter(a))&&a.updateXflowNode()}};m.exports=d},{"../../base/adapter.js":48,"../../interface/notification.js":74}],56:[function(d,m,l){function e(a){var c=a._children,b;if(c&&0<c.length)for(b=c.length;b--;)c[b]instanceof h&&(c[b].setPlatform(a._platform),e(c[b]))}function b(c){var b=c.xflowDataNode;b.setCompute(c.node.getAttribute("compute"));
b.computeDataflowUrl?c.updateAdapterHandle("dataflow",b.computeDataflowUrl):(c.disconnectAdapterHandle("dataflow"),a(c))}function a(a){var c=!1,b;(b=a.getConnectedAdapterHandle("src"))&&b.status===u.STATUS.LOADING&&(c=!0);(b=a.getConnectedAdapterHandle("dataflow"))&&b.status===u.STATUS.LOADING&&(c=!0);for(var f in a.externalScripts)(b=a.getConnectedAdapterHandle(f))&&b.status===u.STATUS.LOADING&&(c=!0);a.xflowDataNode.setLoading(c)}var c=d("./base.js"),h=d("../../xflow/interface/graph.js").DataNode,
g=d("../../xflow/interface/constants.js"),f=d("../../interface/notification.js"),k=d("../../utils/misc.js").dispatchCustomEvent,u=d("../../base/adapterhandle.js"),q=d("../../xflow/base.js");d=function(a,b){c.call(this,a,b);this.xflowDataNode=null;this.externalScripts={}};XML3D.createClass(d,c);d.prototype.init=function(){this.xflowDataNode=new h(!1);this.xflowDataNode.addLoadListener(this.onXflowLoadEvent.bind(this));this.xflowDataNode.userData=this.node;this.srcDataNode=new h(!1);this.xflowDataNode.appendChild(this.srcDataNode);
this.xflowDataNode.setPlatform(this.node.getAttribute("platform"));this.updateAdapterHandle("src",this.node.getAttribute("src"));this.assetData||(this.xflowDataNode.setFilter(this.node.getAttribute("filter")),b(this));for(var a=this.getChildren(),c=0;c<a.length;c++){var f=this.factory.getAdapter(a[c]);if(f){if(f.getXflowNode)this.xflowDataNode.appendChild(f.getXflowNode());else if(f.getScriptType){var g=f.node.name;g||(XML3D.debug.logError("Parsing error: Externally referenced operators must have a 'name' attribute matching the name they were registered with. ",
f.node),g="unknown_operator");this.externalScripts[g]=f;f.connectedAdapterHandle&&this.connectAdapterHandle(g,f.connectedAdapterHandle);this.xflowDataNode.setLoading(!0)}null!==this.xflowDataNode._platform&&e(this.xflowDataNode)}}};d.prototype.updateAdapterHandle=function(a,c){var b=this.getConnectedAdapterHandle(a),f=this.getAdapterHandle(c),g=f&&f.status;b!=f&&(g===u.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find element of url '"+f.url+"' for "+a,this.node),this.connectAdapterHandle(a,
f),this.connectedAdapterChanged(a,f?f.getAdapter():null,g))};d.prototype.onXflowLoadEvent=function(a,c,b){Infinity==c?k(this.node,"load",!1,!0,null):c>b&&k(this.node,"progress",!1,!0,null)};d.prototype.getDataComplete=function(){return Infinity==this.xflowDataNode.getProgressLevel()};d.prototype.getDataProgressLevel=function(){return this.xflowDataNode.getProgressLevel()};d.prototype.notifyChanged=function(a){if(a.type===f.ADAPTER_HANDLE_CHANGED)this.connectedAdapterChanged(a.key,a.adapter,a.handleStatus);
else if(a.type===f.NODE_INSERTED){var c=a.affectedNode;if(a=this.factory.getAdapter(c)){a=a.getXflowNode();var b=null;do c=c.nextSibling;while(c&&!(b=this.factory.getAdapter(c)));b?this.xflowDataNode.insertBefore(a,b.getXflowNode()):this.xflowDataNode.appendChild(a)}}else if(a.type===f.NODE_REMOVED){if(a=this.factory.getAdapter(a.affectedNode))a=a.getXflowNode(),this.xflowDataNode.removeChild(a)}else a.type===f.THIS_REMOVED&&(this.clearAdapterHandles(),this.xflowDataNode.clear(),this.node=this.srcDataNode=
null)};d.prototype.attributeChangedCallback=function(a,c,f){"filter"!==a||this.assetData?"compute"!==a||this.assetData?"src"===a?this.updateAdapterHandle(a,f):"platform"===a&&(a=this.xflowDataNode,a.setPlatform(this.node.getAttribute("platform")),e(a)):b(this):this.xflowDataNode.setFilter(f)};d.prototype.connectedAdapterChanged=function(c,b){"src"===c?this.srcDataNode.sourceNode=b?b.getXflowNode():null:"dataflow"===c?this.xflowDataNode.dataflowNode=b?b.getXflowNode():null:this.externalScripts[c]&&
(window.eval(b.script),this.xflowDataNode.notify(g.RESULT_STATE.CHANGED_STRUCTURE),q._flushResultCallbacks());this.xflowDataNode.setLoading(!0);a(this)};d.prototype.toString=function(){return"DataAdapter"};m.exports=d},{"../../base/adapterhandle.js":49,"../../interface/notification.js":74,"../../utils/misc.js":184,"../../xflow/base.js":188,"../../xflow/interface/constants.js":189,"../../xflow/interface/graph.js":191,"./base.js":54}],57:[function(d,m,l){function e(a,c,b){a._computeOperator===c&&a.setLoading(b);
if(a._children)for(var f=a._children.length;f--;)e(a._children[f],c,b)}function b(a){var c=a.node.getAttribute("out");c?a.xflowDataNode.setFilter("keep("+c+")"):a.xflowDataNode.setFilter("")}function a(a,c){var f=c.getAttribute("platform");a.xflowDataNode.setCompute("");a.clearAdapterHandles();a.dataflowRefs=[];a.externalScripts={};b(a);var g=c.lastElementChild,k=!0,d=null,u=a.xflowDataNode,y,w;do if(y=a.factory.getAdapter(g))if(y.getXflowNode)w=y.getXflowNode(),d?u.insertBefore(w,d):u.appendChild(w),
d=w;else if(y.getComputeCode){y=y.getComputeCode().split(";");for(var l=y.length;l--;)y[l].trim()&&(k?k=!1:(w=new h(!1),d?u.insertBefore(w,d):u.appendChild(w),u=w,d=null),u.userData=g,u.setPlatform(f),u.setCompute(y[l].trim()),u.computeDataflowUrl&&(w=a.dataflowRefs.length,a.dataflowRefs.push(u),a.updateAdapterHandle(w,u.computeDataflowUrl)))}else y.getScriptType&&(l=y.node.name,l||(XML3D.debug.logError("Parsing error: Externally referenced operators must have a 'name' attribute matching the name they were registered with. ",
y.node),l="unknown_operator"),a.externalScripts[l]=y,y.connectedAdapterHandle&&a.connectAdapterHandle(l,y.connectedAdapterHandle));while(g=g.previousElementSibling);for(var m in a.externalScripts)e(a.xflowDataNode,m,!0)}var c=d("./base.js"),h=d("../../xflow/interface/graph.js").DataNode,g=d("../../xflow/interface/constants.js"),f=d("../../interface/notification.js"),k=d("../../base/adapterhandle.js"),u=d("../../xflow/base.js");d=function(a,b){c.call(this,a,b);this.xflowDataNode=null;this.externalScripts=
{}};XML3D.createClass(d,c);d.prototype.init=function(){this.xflowDataNode=new h(!1);this.dataflowRefs=[];a(this,this.node)};d.prototype.updateAdapterHandle=function(a,c){var b=this.getConnectedAdapterHandle(a),f=this.getAdapterHandle(c),g=f&&f.status;b!=f&&(g===k.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find element of url '"+f.url+"' for "+a,this.node),this.connectAdapterHandle(a,f),this.connectedAdapterChanged(a,f?f.getAdapter():null,g))};d.prototype.notifyChanged=function(c){c.type===
f.ADAPTER_HANDLE_CHANGED&&this.externalScripts[c.key]&&(window.eval(c.adapter.script),e(this.xflowDataNode,c.key,!1),this.xflowDataNode.notify(g.RESULT_STATE.CHANGED_STRUCTURE),u._flushResultCallbacks());switch(c.type){case f.ADAPTER_HANDLE_CHANGED:this.connectedAdapterChanged(c.key,c.adapter,c.handleStatus);c.handleStatus===k.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find dataflow of url '"+c.url,this.node);break;case f.NODE_INSERTED:case f.NODE_REMOVED:a(this);break;case f.VALUE_MODIFIED:c=
c.mutation.attributeName,"out"===c?b(this):"platform"===c&&a(this,this.node)}};d.prototype.updateXflowNode=function(){a(this,this.node)};d.prototype.connectedAdapterChanged=function(a,c,b){if(a=this.dataflowRefs[a])a.dataflowNode=c?c.getXflowNode():null,a.setLoading(b===k.STATUS.LOADING)};m.exports=d},{"../../base/adapterhandle.js":49,"../../interface/notification.js":74,"../../xflow/base.js":188,"../../xflow/interface/constants.js":189,"../../xflow/interface/graph.js":191,"./base.js":54}],58:[function(d,
m,l){var e=d("../../base/adapter.js").NodeAdapterFactory;l=d("./asset.js");var b=d("./misc.js"),a=d("./script.js"),c=d("./texture.js"),h=d("./transform.js"),g=d("./values.js"),f=d("./data.js"),k=d("./compute.js"),u=d("./dataflow.js");d("./json/factory.js");d("./javascript/factory.js");d=function(){e.call(this,"data")};XML3D.createClass(d,e);var q={mesh:b.SinkDataAdapter,material:b.SinkDataAdapter,light:b.SinkDataAdapter,view:b.SinkDataAdapter,"float":g,float2:g,float3:g,float4:g,float4x4:g,"int":g,
int4:g,bool:g,"byte":g,string:g,ubyte:g,img:b.ImgDataAdapter,texture:c,data:f,proto:f,dataflow:u,compute:k,video:b.VideoDataAdapter,script:a,transform:h,asset:l.AssetAdapter,assetdata:l.AssetDataAdapter,assetmesh:l.AssetMeshAdapter,model:l.AssetAdapter,content:f};d.prototype.createAdapter=function(a){var c=q[a.localName];return void 0!==c?new c(this,a):0<a.localName.indexOf("-")?new q.data(this,a):null};m.exports=d},{"../../base/adapter.js":48,"./asset.js":53,"./compute.js":55,"./data.js":56,"./dataflow.js":57,
"./javascript/factory.js":59,"./json/factory.js":60,"./misc.js":61,"./script.js":62,"./texture.js":63,"./transform.js":64,"./values.js":65}],59:[function(d,m,l){d=function(){XML3D.resource.FormatHandler.call(this)};XML3D.createClass(d,XML3D.resource.FormatHandler);d.prototype.isFormatSupported=function(b){b=b.headers.get("Content-Type");return!!b&&b.match(/\/javascript/)};d.prototype.getFormatData=function(b){return b.text()};d.prototype.getAdapter=function(b,a,c){if("data"===a)return new e(b);throw Error("Unsupported aspect '"+
a+"' encountered in JavaScript format handler.");};XML3D.resource.registerFormatHandler(new d);var e=function(b){this.script=b};e.prototype.getScriptType=function(){return"application/javascript"};e.prototype.getScript=function(){return this.script}},{}],60:[function(d,m,l){function e(b,h,e,k,d){d=new f[h](d);h=a.DATA_TYPE.fromString(h);h=new g(h,d);d=new c;d.data=h;d.name=e;d.key=k;b.appendChild(d)}function b(b,h,d){if(f[d.type])for(var u=0;u<d.seq.length;++u){var t=d.seq[u],v=t.value,x=t.key;if("Object"===
Object.prototype.toString.call(v).slice(8,-1)&&v.url){if(!k())throw Error("Big-endian binary data are not supported yet");XML3D.resource.fetch(v.url).then(function(a){return a.arrayBuffer()}).then(function(e){var k=d.type,u=x,r=f[k];e=new r(e,v.byteOffset,v.byteLength/r.BYTES_PER_ELEMENT);k=a.DATA_TYPE.fromString(k);k=new g(k,e);e=new c;e.data=k;e.name=h;e.key=u;b.appendChild(e)})}else e(b,d.type,h,x,v)}}var a=d("../../../xflow/interface/constants.js"),c=d("../../../xflow/interface/graph.js").InputNode,
h=d("../../../xflow/interface/graph.js").DataNode,g=d("../../../xflow/interface/data.js").BufferEntry;d("../../../base/adapter.js");d=function(){XML3D.resource.FormatHandler.call(this)};XML3D.createClass(d,XML3D.resource.FormatHandler);d.prototype.isFormatSupported=function(a){if(a.headers.has("Content-Type"))return a.headers.get("Content-Type").match(/\/json/);if(a.url.match(/\.json/))return!0};d.prototype.getFormatData=function(a){return a.json().then(function(a){if("xml3d-json"!=a.format)throw Error("Unknown JSON format: "+
a.format);if("0.4.0"!=a.version)throw Error("Unknown JSON version: "+a.version);return a})};d.prototype.getAdapter=function(a,c,f){if("data"===c||"scene"===c){f=new h(!1);f.userData="External Json";a="scene"===c?a.material:a.data;for(var g in a)b(f,g,a[g]);return new u(f)}throw Error("Unsupported aspect '"+c+"' encountered in JSON format handler.");};XML3D.resource.registerFormatHandler(new d);var f={"int":Int32Array,int4:Int32Array,"float":Float32Array,float2:Float32Array,float3:Float32Array,float4:Float32Array,
float4x4:Float32Array,bool:Uint8Array,"byte":Int8Array,ubyte:Uint8Array,string:Array},k=function(){var a=new ArrayBuffer(4),c=new DataView(a);(new Int32Array(a))[0]=16909060;var b=16909060===c.getInt32(0,!0);return function(){return b}}(),u=function(a){this.xflowDataNode=a};u.prototype.getXflowNode=function(){return this.xflowDataNode}},{"../../../base/adapter.js":48,"../../../xflow/interface/constants.js":189,"../../../xflow/interface/data.js":190,"../../../xflow/interface/graph.js":191}],61:[function(d,
m,l){var e=d("./data.js");d("../../interface/notification.js");var b=d("../../utils/uri.js").URI,a=d("../../utils/misc.js"),c=d("../../resource/coordinator.js"),h=d("../../base/adapter.js").NodeAdapter;d=XML3D.createClass;l=function(a,c){e.call(this,a,c)};d(l,e,{isSinkAdapter:function(){return!0},toString:function(){return"XML3D.data.SinkDataAdapter"}});var g=function(a,c){h.call(this,a,c);this.image=this.textureEntry=null;c.src&&this.createImageFromURL(c.src)};d(g,h,{createImageFromURL:function(a){var f=
this;a=(new b(a)).getAbsoluteURI(this.node.ownerDocument._documentURL||this.node.ownerDocument.URL);this.image=c.getImage(a,function(a,c){f.textureEntry&&f.textureEntry.setImage(c,!0)},function(a,c){XML3D.debug.logError("Could not load image URI="+c.src)});f.textureEntry&&f.textureEntry.setImage(this.image,!0)},setTextureEntry:function(a){this.textureEntry=a;this.image&&this.textureEntry.setImage(this.image,!0)},attributeChangedCallback:function(a,c,b){"src"==a&&this.createImageFromURL(b)},notifyChanged:function(a){},
getValue:function(a,c){return this.image},getOutputs:function(){return{image:this}},resolveScript:function(){return null}});var f=function(a,c){e.call(this,a,c);this.video=this.textureEntry=null;this._ticking=!1;this._boundTick=this._tick.bind(this);c.src&&this.createVideoFromURL(c.src)};d(f,h);f.prototype.createVideoFromURL=function(f){var g=this;f=(new b(f)).getAbsoluteURI(this.node.ownerDocument._documentURL||this.node.ownerDocument.URL);this.video=c.getVideo(f,this.node.autoplay,this.node.loop,
this.node.muted,{canplay:function(c,b){a.dispatchCustomEvent(g.node,"canplay",!0,!0,null);g._startVideoRefresh()},ended:function(c,b){a.dispatchCustomEvent(g.node,"ended",!0,!0,null)},load:function(c,b){a.dispatchEvent(g.node,"load")},error:function(c,b){a.dispatchCustomEvent(g.node,"error",!0,!0,null);XML3D.debug.logError("Could not load video URI="+b.src)}});this.textureEntry&&this.textureEntry.setImage(this.video,!0)};f.prototype.play=function(){this.video&&this.video.play()};f.prototype.pause=
function(){this.video&&this.video.pause()};f.prototype._startVideoRefresh=function(){this._ticking||this._tick()};f.prototype._tick=function(){this._ticking=!0;window.requestAnimationFrame(this._boundTick);this.textureEntry&&this.textureEntry.setImage(this.video)};f.prototype.setTextureEntry=function(a){this.textureEntry=a;this.video&&this.textureEntry.setImage(this.video,!0)};f.prototype.notifyChanged=function(a){};f.prototype.attributeChangedCallback=function(a,c,b){"src"==a&&this.createVideoFromURL(b)};
f.prototype.getValue=function(a,c){return this.video};f.prototype.getOutputs=function(){return{video:this}};m.exports={ImgDataAdapter:g,VideoDataAdapter:f,SinkDataAdapter:l}},{"../../base/adapter.js":48,"../../interface/notification.js":74,"../../resource/coordinator.js":163,"../../utils/misc.js":184,"../../utils/uri.js":186,"./data.js":56}],62:[function(d,m,l){var e=d("../../interface/notification.js");l=XML3D.createClass;var b=d("../../base/adapter.js").NodeAdapter;d=function(a,c){b.call(this,a,
c);this.connectedAdapterHandle=null;c.src&&(this.connectedAdapterHandle=this.getAdapterHandle(c.src),this.connectAdapterHandle(c.name,this.connectedAdapterHandle))};l(d,b,{getScriptType:function(){return this.node.type},getScript:function(){return this.node.src?this.externalScript:this.node.value},attributeChangedCallback:function(a,c,b){this.notifyOppositeAdapters()},notifyChanged:function(a){switch(a.type){case e.NODE_INSERTED:case e.NODE_REMOVED:case e.VALUE_MODIFIED:this.notifyOppositeAdapters();
break;case e.ADAPTER_HANDLE_CHANGED:this.externalScript=a.adapter.script,this.notifyOppositeAdapters()}}});m.exports=d},{"../../base/adapter.js":48,"../../interface/notification.js":74}],63:[function(d,m,l){function e(a,c){return a!=g.NEAREST&&a!=g.LINEAR||c!=g.NEAREST&&c!=g.LINEAR}var b=d("../../xflow/interface/data.js").TextureEntry,a=d("../../xflow/interface/graph.js").InputNode,c=d("../../xflow/interface/constants.js");d("../../interface/notification.js");var h=d("../../base/adapter.js").NodeAdapter,
g=d("../../renderer/webgl/constants.js"),f=d("lodash.defaults"),k=d("lodash.assign");d=function(a,c){h.call(this,a,c)};XML3D.createClass(d,h,{init:function(){this.xflowInputNode=this.createXflowNode();this.xflowInputNode.data=this.createTextureEntry()},createTextureEntry:function(){var a=this.node,h=new b(null),d=h.getSamplerConfig(),t=a.getAttribute("wrap"),v=a.getAttribute("filter"),a=a.getAttribute("anisotropy"),x={};t&&(t=t.split(/(\s+)/),x.wrapS=u[t[0]],x.wrapT=u[t[t.length-1]]);v&&(t=v.split(/(\s+)/),
x.minFilter=q[t[0]],x.magFilter=q[t[t.length-1]]);a&&(v=parseFloat(a),v=isNaN(v)?"max"==a?Infinity:void 0:Math.min(1,v),x.anisotropy=v);f(x,{wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE,minFilter:g.LINEAR_MIPMAP_LINEAR,magFilter:g.LINEAR,textureType:c.TEX_TYPE.TEXTURE_2D,anisotropy:1});k(d,x);d.generateMipMap=e(d.minFilter,d.magFilter);(d=this.factory.getAdapter(this.node.firstElementChild))&&d.setTextureEntry(h);return h},shouldGenerateMipMaps:e,createXflowNode:function(){var c=new a;c.name=this.node.name;
c.paramName=this.node.param?this.node.name:null;c.key=this.node.key;return c},setScriptValue:function(){XML3D.debug.logError("Texture currently does not support setScriptValue()")},getOutputs:function(){var a={};a[this.node.name]=this;return a},getValue:function(){return this.value},attributeChangedCallback:function(a,c,b){switch(a){case "name":this.xflowInputNode.name=b;break;case "param":this.xflowInputNode.paramName=b?this.node.name:null;break;case "key":this.xflowInputNode.key=b;break;case "wrap":case "filter":case "samples":this.xflowInputNode.data=
this.createTextureEntry()}},notifyChanged:function(){},getXflowNode:function(){return this.xflowInputNode}});var u={clamp:g.CLAMP_TO_EDGE,repeat:g.REPEAT},q={nearest:g.NEAREST,linear:g.LINEAR,"nearest-mipmap-nearest":g.NEAREST_MIPMAP_NEAREST,"linear-mipmap-nearest":g.LINEAR_MIPMAP_NEAREST,"nearest-mipmap-linear":g.NEAREST_MIPMAP_LINEAR,"linear-mipmap-linear":g.LINEAR_MIPMAP_LINEAR};m.exports=d},{"../../base/adapter.js":48,"../../interface/notification.js":74,"../../renderer/webgl/constants.js":121,
"../../xflow/interface/constants.js":189,"../../xflow/interface/data.js":190,"../../xflow/interface/graph.js":191,"lodash.assign":17,"lodash.defaults":41}],64:[function(d,m,l){var e=d("../../interface/notification.js"),b=d("../../base/adapter.js").NodeAdapter,a=d("gl-matrix").mat4,c=d("gl-matrix").vec3;d=function(a,c){b.call(this,a,c);this.needsUpdate=this.isValid=!0};XML3D.createClass(d,b);var h=a.create();d.prototype.init=function(){this.matrix=a.create();this.transform={translate:a.create(),scale:a.create(),
scaleOrientation:a.create(),scaleOrientationInv:a.create(),center:a.create(),centerInverse:a.create(),rotation:a.create()};this.needsUpdate=!0;this.checkForImproperNesting()};d.prototype.updateMatrix=function(){var b=this.node,f=this.transform,e=b.center.data,d=b.scaleOrientation.data,q=b.rotation.data;a.fromRotation(f.scaleOrientation,d[3],d);a.fromRotation(f.rotation,q[3],q);a.translate(f.translate,h,b.translation.data);a.translate(f.center,h,e);a.translate(f.centerInverse,h,c.negate(e,e));a.scale(f.scale,
h,b.scale.data);a.invert(f.scaleOrientationInv,f.scaleOrientation);b=this.matrix;a.multiply(b,f.translate,f.center);a.multiply(b,b,f.rotation);a.multiply(b,b,f.scaleOrientation);a.multiply(b,b,f.scale);a.multiply(b,b,f.scaleOrientationInv);a.multiply(b,b,f.centerInverse);this.needsUpdate=!1};d.prototype.getMatrix=function(){this.needsUpdate&&this.updateMatrix();return this.matrix};d.prototype.attributeChangedCallback=function(a,c,b){this.needsUpdate=!0;this.notifyOppositeAdapters(e.ADAPTER_VALUE_CHANGED)};
d.prototype.notifyChanged=function(a){a.type==e.NODE_REMOVED&&(this.dispose(),this.notifyOppositeAdapters(e.ADAPTER_HANDLE_CHANGED))};d.prototype.dispose=function(){this.isValid=!1};d.prototype.checkForImproperNesting=function(){for(var a=0;a<this.node.childNodes.length;a++)"transform"===this.node.childNodes[a].localName&&XML3D.debug.logError("Parsing error: Transform elements cannot be nested!",this.node)};m.exports=d},{"../../base/adapter.js":48,"../../interface/notification.js":74,"gl-matrix":1}],
65:[function(d,m,l){var e=d("../../xflow/interface/data.js").BufferEntry,b=d("../../xflow/interface/graph.js").InputNode,a=d("../../xflow/interface/constants.js"),c=d("../../interface/notification.js"),h=d("../../base/adapter.js").NodeAdapter;d=function(c,b){h.call(this,c,b);this.xflowInputNode=null;this.type=a.DATA_TYPE.fromString(b.localName)};XML3D.createClass(d,h);d.prototype.init=function(){var c=this.node._configured;"[value set by script]"==this.node.textContent?c=c.scriptValue:(delete c.scriptValue,
c=this.node.value);this.type===a.DATA_TYPE.STRING&&(c=c?c.split(","):[]);c=new e(this.type,c);this.xflowInputNode=new b(null);this.xflowInputNode.name=this.node.name;this.xflowInputNode.data=c;this.xflowInputNode.key=this.node.key;this.xflowInputNode.paramName=this.node.param?this.node.name:null;this.checkForImproperNesting()};d.prototype.getXflowNode=function(){return this.xflowInputNode};d.prototype.notifyChanged=function(b){b.type!=c.VALUE_MODIFIED||b.mutation.attributeName||(delete this.node._configured.scriptValue,
b=this.node.value,this.type===a.DATA_TYPE.STRING&&(b=b?b.split(","):[]),this.xflowInputNode.data.setValue(b))};d.prototype.attributeChangedCallback=function(a,c,b){"name"==a?this.xflowInputNode.name=b:"key"==a?this.xflowInputNode.key=b:"param"==a&&(this.xflowInputNode.paramName=b?this.node.name:null)};d.prototype.setScriptValue=function(c){this.type===a.DATA_TYPE.STRING&&(c=c?c.split(","):[]);this.xflowInputNode.data.setValue(c)};d.prototype.toString=function(){return"XML3D.data.ValueDataAdapter"};
d.prototype.checkForImproperNesting=function(){for(var c=0;c<this.node.childNodes.length;c++)a.DATA_TYPE.fromString(this.node.childNodes[c].localName)&&XML3D.debug.logIssue("Parsing error: Value elements cannot be nested!",176,this.node)};m.exports=d},{"../../base/adapter.js":48,"../../interface/notification.js":74,"../../xflow/interface/constants.js":189,"../../xflow/interface/data.js":190,"../../xflow/interface/graph.js":191}],66:[function(d,m,l){var e=d("../xflow/interface/request.js").ComputeRequest,
b=d("../interface/notification.js"),a=d("../utils/css.js"),c=d("gl-matrix").mat4;d=function(a,c,b,e){this.owner=a;this.node=a.node;this.attrName=c;this.dataName=b;this.xflowRequest=this.adapterHandle=null;this.onlyDataTransform=e||!1;this._bindedCallback=this._onChange.bind(this)};d.prototype.clear=function(){this.xflowRequest&&this.xflowRequest.clear();this.xflowRequest=null;this.adapterHandle&&this.adapterHandle.removeListener(this._bindedCallback)};d.prototype.dispose=function(){this.clear();delete this.owner;
delete this.node};d.prototype.update=function(){var a=this.owner.getAdapterHandle(this.node.getAttribute(this.attrName),"data",0);a!=this.adapterHandle&&(this.clear(),(this.adapterHandle=a)&&a.addListener(this._bindedCallback));this.updateMatrix()};d.prototype.updateMatrix=function(){this.owner.onTransformChange(this.attrName,this.getMatrix())};d.prototype.updateCSSTransition=function(){var c=this.owner.style.transform;if(c&&"none"!==c)this.owner.onTransformChange(this.attrName,a.matrixStringToMat4(c).data)};
d.prototype.getMatrix=function(){var b=c.create();return function(){if(!this.onlyDataTransform){var c=this.owner.style.transform;if(c&&"none"!==c)return"0s"!==this.owner.style.transitionDuration&&this.handleCSSTransition(),a.matrixStringToMat4(c).data}var f;if(this.adapterHandle&&(f=this.adapterHandle.getAdapter())){if(f.getXflowNode&&(this.xflowRequest||(this.xflowRequest=new e(f.getXflowNode(),[this.dataName],this._bindedCallback)),c=this.xflowRequest.getResult(),c=c.getOutputData(this.dataName)&&
c.getOutputData(this.dataName).getValue()))return c;if(f.getMatrix)return f.getMatrix()}return this.onlyDataTransform?null:b}}();d.prototype.handleCSSTransition=function(){var c=a.getLargestTransitionDurationMS(this.owner.style.transitionDuration);c&&a.addTransitionCallback(this.updateCSSTransition.bind(this),c)};d.prototype._onChange=function(a){if(a.type==b.ADAPTER_VALUE_CHANGED)this.owner.onTransformChange(this.attrName,a.adapterHandle.getAdapter().getMatrix());else this.updateMatrix()};m.exports=
d},{"../interface/notification.js":74,"../utils/css.js":181,"../xflow/interface/request.js":192,"gl-matrix":1}],67:[function(d,m,l){var e=d("lodash.assign"),b=d("lodash.create");if(void 0!==window.XML3D)throw Error("Tried to define the XML3D namespace a second time. Please ensure xml3d.js is only loaded once!");var a=a||{},c=c||{};window.XML3D=a;window.Xflow=c;a.version="5.2.0";a.xml3dNS="http://www.xml3d.org/2009/xml3d";a.xhtmlNS="http://www.w3.org/1999/xhtml";a.webglNS="http://www.xml3d.org/2009/xml3d/webgl";
a._xml3d=document.createElementNS(a.xml3dNS,"xml3d");a._parallel=void 0!=a._parallel?a._parallel:!1;a.xhtml=!(!document.doctype||!(new XMLSerializer).serializeToString(document.doctype).match(/xhtml/i));a.createElement=function(c){a.debug.logWarning("This function is deprecated and will be removed in the next major release. Use document.createElement instead.");return document.createElement(c)};a.extend=e;a.createClass=function(a,c,f){c?a.prototype=b(c.prototype,f):e(a.prototype,f);return a};a.debug=
d("./utils/debug.js");a.util=d("./utils/misc.js");a.options=d("./utils/options.js");a.materials=d("./renderer/webgl/materials/urn/registery.js");a.resource={};a.extend(a.resource,d("./resource"));a.extend(a.resource,d("./utils/uri.js"));a.resource.Asset=d("./asset/asset.js").Asset;a.resource.SubData=d("./asset/asset.js").SubData;a.webcl=d("./utils/webcl.js").webcl;a.math=d("gl-matrix");d("./math/math.js")(a.math);a.Mat2=d("./types/mat2.js");a.Mat3=d("./types/mat3.js");a.Mat4=d("./types/mat4.js");
a.Vec2=d("./types/vec2.js");a.Vec3=d("./types/vec3.js");a.Vec4=d("./types/vec4.js");a.AxisAngle=d("./types/axisangle.js");a.Quat=d("./types/quat.js");a.Ray=d("./types/ray.js");a.Box=d("./types/box.js");a.extend(window,d("./types/data-observer.js"));c.registerOperator=d("./xflow/operator/operator.js").registerOperator;c.constants=d("./xflow/interface/constants.js");a.extend(c,d("./xflow/interface/graph.js"));a.extend(c,d("./xflow/interface/data.js"));c.ComputeRequest=d("./xflow/interface/request.js").ComputeRequest;
a.asset=d("./asset/asset.js");a.webgl={};a.webgl.BaseRenderTree=d("./renderer/webgl/render-trees/base.js");a.webgl.BaseRenderPass=d("./renderer/webgl/render-passes/base.js");a.registerComponent=d("./interface/web-component.js");d("./resource/xml3dformathandler.js");d("./xflow/operator/default");m.exports={XML3D:a,Xflow:c}},{"./asset/asset.js":47,"./interface/web-component.js":76,"./math/math.js":77,"./renderer/webgl/materials/urn/registery.js":134,"./renderer/webgl/render-passes/base.js":140,"./renderer/webgl/render-trees/base.js":151,
"./resource":167,"./resource/xml3dformathandler.js":168,"./types/axisangle.js":169,"./types/box.js":170,"./types/data-observer.js":171,"./types/mat2.js":172,"./types/mat3.js":173,"./types/mat4.js":174,"./types/quat.js":175,"./types/ray.js":176,"./types/vec2.js":177,"./types/vec3.js":178,"./types/vec4.js":179,"./utils/debug.js":183,"./utils/misc.js":184,"./utils/options.js":185,"./utils/uri.js":186,"./utils/webcl.js":187,"./xflow/interface/constants.js":189,"./xflow/interface/data.js":190,"./xflow/interface/graph.js":191,
"./xflow/interface/request.js":192,"./xflow/operator/default":210,"./xflow/operator/operator.js":229,"gl-matrix":1,"lodash.assign":17,"lodash.create":32}],68:[function(d,m,l){function e(a){if(!(-1<v.indexOf(a))){for(var c=a.parentNode;c&&!t.elementIs(c,"body");)c=c.parentNode;if(c&&t.elementIs(c,"body"))if(v.push(a),c=f.debug.setup(),r()){f.debug.logInfo("Configuring",a.querySelectorAll("*").length,"elements");try{k.configure(a)}catch(b){c&&f.debug.logException(b);v.splice(v.indexOf(a),1);return}try{p(a)}catch(g){c&&
f.debug.logException(g);v.splice(v.indexOf(a),1);return}u(a,{onConfigured:[]});v.splice(v.indexOf(a),1);x&&x.takeRecords()}else{c&&f.debug.logWarning("Could not initialise WebGL, sorry :-(");a.hasAttribute("onunsupported")&&(c=new Function("event",a.getAttribute("onunsupported")),a.addEventListener("unsupported",c,!1));if(f.util.dispatchCustomEvent(a,"unsupported",!1,!0,null)){c=document.createElement("div");a.parentNode.insertBefore(c,a);c.appendChild(a);var h=document.createElement("div");a.hasAttribute("class")&&
h.setAttribute("class",a.getAttribute("class"));h.setAttribute("style",a.getAttribute("style"));h.style.border="2px solid red";h.style.fontFamily="verdana,sans-serif";h.style.color="red";h.style.padding="10px";h.style.backgroundColor="rgba(255, 0, 0, 0.3)";var e=a.getAttribute("width");null!==e&&(h.style.width=e);e=a.getAttribute("height");null!==e&&(h.style.height=e);var e=document.createElement("h3"),d=document.createTextNode("Sorry, your browser doesn't appear to support XML3D.");e.appendChild(d);
d=document.createElement("p");d.appendChild(document.createTextNode("Please visit "));var q=document.createElement("a");q.setAttribute("href","http://www.xml3d.org/help");q.appendChild(document.createTextNode("http://www.xml3d.org/help"));d.appendChild(q);d.appendChild(document.createTextNode(" for more information."));h.appendChild(e);h.appendChild(d);c.parentNode.insertBefore(h,c)}v.splice(v.indexOf(a),1)}}}function b(a){if(!(-1<v.indexOf(a))&&a._configured){var c=a._configured.canvas;a._configured.destroy();
a._configured=void 0;c&&t.elementIs(c,"canvas")&&(a.parentNode||(a=c.nextElementSibling,t.elementIs(a,"div")&&"_xml3d_hideDiv"==a.getAttribute("class")&&a.parentNode&&a.parentNode.removeChild(a)),c.parentNode&&c.parentNode.removeChild(c))}}function a(){q.setOptionsFromQuery();n.init();var a=f.debug.setup();a&&f.debug.logInfo("xml3d.js version: "+f.version);var c=document.querySelectorAll("xml3d");a&&f.debug.logInfo("Found "+c.length+" xml3d node(s)");for(a=0;a<c.length;a++)e(c[a]);x=new MutationObserver(h);
x.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!1})}function c(){if(f.document)f.document.onunload()}function h(a){for(var c=0;c<a.length;++c){var f=a[c];"childList"==f.type&&(g(f.addedNodes,e),g(f.removedNodes,b))}}function g(a,c){Array.forEach(a,function(a){if(a.getElementsByTagNameNS)if(t.elementIs(a,"xml3d"))c(a);else{var b=a.getElementsByTagName("xml3d"),b=b.length?b:a.getElementsByTagNameNS(f.xml3dNS,"xml3d");Array.forEach(b,c)}})}var f=d("./global.js").XML3D,k=d("./interface/elements.js").config,
u=d("./utils/misc.js").sendAdapterEvent,q=d("./utils/options.js"),n=d("./utils/css.js"),p=d("./renderer/renderer/configure.js"),r=d("./renderer/webgl/base/utils.js").supported,t=d("./utils/misc.js");d("./interface/dom.js");d("./utils/debug.js");(function(){if(navigator.userAgent.match(/(iPad|iPhone|iPod touch)/i)){var a=document.createElement("meta");a.name="format-detection";a.content="telephone=no";document.head.appendChild(a)}})();var v=[],x=null;f.flushCSSChanges=function(){x&&h(x.takeRecords())};
"complete"===document.readyState||"interactive"===document.readyState?a():document.addEventListener("DOMContentLoaded",a,!1);window.addEventListener("unload",c,!1);window.addEventListener("reload",c,!1);m.exports=f},{"./global.js":67,"./interface/dom.js":71,"./interface/elements.js":72,"./renderer/renderer/configure.js":92,"./renderer/webgl/base/utils.js":119,"./utils/css.js":181,"./utils/debug.js":183,"./utils/misc.js":184,"./utils/options.js":185}],69:[function(d,m,l){var e=d("../resource"),b=function(a){if(!a)return!1;
switch(a.toLowerCase()){case "true":case "1":return!0;case "false":case "0":return!1;default:return Boolean(a)}};d={};l=function(a){};d.IDHandler=function(a){a=a.toLowerCase();this.setFromAttribute=function(a,c,b){e.notifyNodeIdChange(b,c,a)};this.desc={get:function(){return this.getAttribute(a)||""},set:function(c){this.setAttribute(a,c)}}};d.StringAttributeHandler=function(a,c){a=a.toLowerCase();var b=c?c.defaultValue:"";this.desc={get:function(){return this.getAttribute(a)||b},set:function(c){this.setAttribute(a,
c||b)}}};d.EnumAttributeHandler=function(a,c){a=a.toLowerCase();this.init=function(b,e){e[a]=c.defaultValue;b.hasAttribute(a)&&this.setFromAttribute(b.getAttribute(a),null,b,e)};this.setFromAttribute=function(b,e,d,q){b=b.toLowerCase();q[a]=b&&void 0!==c.values[b]?c.values[b]:c.defaultValue;return!1};this.desc={get:function(){XML3D.flushDOMChanges();return c.values[this._configured.storage[a]]},set:function(b){this.setAttribute(a,b);var e=this._configured.storage;b="string"==typeof b?b.toLowerCase():
void 0;e[a]=b&&void 0!==c.values[b]?c.values[b]:c.defaultValue}}};d.EnumAttributeHandler.prototype=new l;d.EnumAttributeHandler.prototype.constructor=d.EnumAttributeHandler;d.EventAttributeHandler=function(a){a=a.toLowerCase();var c=a.substring(2);this.init=function(c,b){b[a]=null;c.hasAttribute(a)&&this.setFromAttribute(c.getAttribute(a),null,c,b)};this.setFromAttribute=function(b,e,d,q){null!=q[a]&&d.removeEventListener(c,q[a]);b?(q[a]=eval("crx = function "+a+"(event){\n  "+b+"\n}"),XML3D.xhtml&&
d.addEventListener(c,q[a],!1)):q[a]=null;return!1};this.desc={get:function(){XML3D.flushDOMChanges();return this._configured.storage[a]},set:function(b){var e=this._configured.storage;XML3D.xhtml&&e[a]&&this.removeEventListener(c,e[a]);e[a]="function"==typeof b?b:void 0;XML3D.xhtml&&e[a]&&this.addEventListener(c,e[a],!1);return!1}}};d.EventAttributeHandler.prototype=new l;d.EventAttributeHandler.prototype.constructor=d.EventAttributeHandler;d.IntAttributeHandler=function(a,c){a=a.toLowerCase();this.init=
function(b,e){e[a]=c;b.hasAttribute(a)&&this.setFromAttribute(b.getAttribute(a),null,b,e)};this.setFromAttribute=function(b,e,d,q){var n=b.match(/^\d+/);!n||isNaN(+n[0])?(XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+b,d),d.setAttribute(a,e),q[a]=c):q[a]=+n[0];d._configured.canvas&&(d._configured.canvas[a]=q[a]);return!1};this.desc={get:function(){XML3D.flushDOMChanges();return this._configured.storage[a]},set:function(b){var e=this._configured.storage,d=+b;isNaN(d)?(XML3D.debug.logWarning("Invalid attribute ["+
a+"] value: "+b,this),e[a]=c):e[a]=Math.floor(d);this.setAttribute(a,e[a]+"")}}};d.IntAttributeHandler.prototype=new l;d.IntAttributeHandler.prototype.constructor=d.IntAttributeHandler;d.FloatAttributeHandler=function(a,c){a=a.toLowerCase();this.init=function(b,e){e[a]=c;b.hasAttribute(a)&&this.setFromAttribute(b.getAttribute(a),null,b,e)};this.setFromAttribute=function(b,e,d,q){var n=+b;isNaN(n)?(XML3D.debug.logWarning("Invalid attribute value: "+b,d),d.setAttribute(a,e),q[a]=c):q[a]=n;return!1};
this.desc={get:function(){XML3D.flushDOMChanges();return this._configured.storage[a]},set:function(b){var e=this._configured.storage,d=+b;isNaN(d)?(XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+b,this),e[a]=c):e[a]=d;this.setAttribute(a,e[a]+"")}}};d.BoolAttributeHandler=function(a,c){a=a.toLowerCase();this.init=function(b,e){e[a]=c;b.hasAttribute(a)&&this.setFromAttribute(b.getAttribute(a),null,b,e)};this.setFromAttribute=function(c,b,g,e){e[a]=null!==c&&"false"!==c.toLowerCase();return!1};
this.desc={get:function(){XML3D.flushDOMChanges();return this._configured.storage[a]},set:function(c){var b=this._configured.storage;b[a]=c;this.setAttribute(a,b[a]+"")}}};d.Vec3AttributeHandler=function(a,c){var b=this;a=a.toLowerCase();this.init=function(c,b){b[a]=null};this.setFromAttribute=function(b,f,e,d,p){d[a]||(d[a]=XML3D.math.vec3.create());f=d[a];d=/^\s*(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(b);!d||isNaN(+d[1])||isNaN(+d[2])||isNaN(+d[3])?(f[0]=c[0],f[1]=c[1],f[2]=c[2],!p&&XML3D.debug.logWarning("Invalid attribute ["+
a+"] value: "+b,e)):(f[0]=+d[1],f[1]=+d[2],f[2]=+d[3]);return!1};this.desc={get:function(){XML3D.flushDOMChanges();var c=this._configured.storage;c[a]||b.setFromAttribute(this.getAttribute(a),null,this,c,!0);return new XML3D.Vec3(c[a])},set:function(e){var d=this._configured.storage;d[a]||b.setFromAttribute(this.getAttribute(a),null,this,d,!0);var d=d[a],q=e.data?e.data:e;3!==q.length||isNaN(q[0])||isNaN(q[1])||isNaN(q[2])?(XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+e,this),d=c):(d[0]=
q[0],d[1]=q[1],d[2]=q[2]);this.setAttribute(a,XML3D.math.vec3.toDOMString(d))}}};d.AxisAngleAttributeHandler=function(a,c){var b=this;a=a.toLowerCase();this.init=function(c,b){b[a]=null};this.setFromAttribute=function(b,f,e,d,p){d[a]||(d[a]=XML3D.math.vec4.create());f=d[a];d=/^\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(b);!d||isNaN(+d[1])||isNaN(+d[2])||isNaN(+d[3])||isNaN(+d[4])?(XML3D.math.vec4.copy(f,c),!p&&XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+b,e)):XML3D.math.vec4.set(f,
+d[1],+d[2],+d[3],+d[4]);return!1};this.desc={get:function(){XML3D.flushDOMChanges();var c=this._configured.storage;c[a]||b.setFromAttribute(this.getAttribute(a),null,this,c,!0);return new XML3D.AxisAngle(c[a])},set:function(e){var d=this._configured.storage;d[a]||b.setFromAttribute(this.getAttribute(a),null,this,d,!0);var d=d[a],q=e.data?e.data:e;4!==q.length||isNaN(q[0])||isNaN(q[1])||isNaN(q[2])||isNaN(q[3])?(XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+e,this),XML3D.math.vec4.copy(d,
c)):XML3D.math.quat.copy(d,q);this.setAttribute(a,XML3D.math.vec4.toDOMString(d))}}};var a=function(a){a.init=function(a,c){a._configured.registerMixed()};a.desc={get:function(){XML3D.flushDOMChanges();var c=this._configured.storage;c.value||(c.value=a.parse(this));return c.value},set:function(a){throw Error("Can't set "+this.nodeName+"::value: it's readonly");}};a.resetValue=function(a){a.value=null}},c=function(a){var c="";for(a=a.firstChild;a;)c+=3==a.nodeType?a.textContent:" ",a=a.nextSibling;
return c};d.FloatArrayValueHandler=function(c){a(this)};d.FloatArrayValueHandler.prototype.parse=function(a){return(a=c(a).match(/([+\-0-9eE\.]+)/g))?new Float32Array(a):new Float32Array};d.Float2ArrayValueHandler=d.FloatArrayValueHandler;d.Float3ArrayValueHandler=d.FloatArrayValueHandler;d.Float4ArrayValueHandler=d.FloatArrayValueHandler;d.Float4x4ArrayValueHandler=d.FloatArrayValueHandler;d.IntArrayValueHandler=function(c){a(this)};d.IntArrayValueHandler.prototype.parse=function(a){return(a=c(a).match(/([+\-0-9]+)/g))?
new Int32Array(a):new Int32Array};d.BoolArrayValueHandler=function(c){a(this)};d.BoolArrayValueHandler.prototype.parse=function(a){a=c(a).match(/(true|false|0|1)/ig);return a?(a=a.map(b))?new Uint8Array(a):new Uint8Array:new Uint8Array};d.StringValueHandler=function(c){a(this)};d.StringValueHandler.prototype.parse=function(a){return a.textContent};d.CanvasStyleHandler=function(a,c){a=a.toLowerCase();this.init=function(c,b){c.hasAttribute(a)&&this.setFromAttribute(c.getAttribute(a),null,c,b)};this.setFromAttribute=
function(c,b,g,e){g._configured.canvas.setAttribute(a,c)};this.desc={get:function(){return this._configured.canvas.style},set:function(a){}}};d.CanvasClassHandler=function(a){a=a.toLowerCase();this.init=function(c,b){c._configured.canvas.className="_xml3d";c.hasAttribute(a)&&this.setFromAttribute(c.getAttribute(a),null,c,b)};this.setFromAttribute=function(c,b,e,d){e._configured.canvas.setAttribute(a,c+" _xml3d")};this.desc={get:function(){return this._configured?this._configured.canvas.className:
""},set:function(a){this._configured&&(this._configured.canvas.className=a)}}};m.exports=d},{"../resource":167}],70:[function(d,m,l){l=d("./methods.js");var e=d("./attributes.js");d=d("./properties.js");var b={triangles:0,0:"triangles",trianglestrips:1,1:"trianglestrips",lines:2,2:"lines",linestrips:3,3:"linestrips",points:4,4:"points",derived:5,5:"derived"},a={"2d":0,0:"2d","1d":1,1:"1d","3d":2,2:"3d"},c={auto:1,1:"auto",js:2,2:"js",gl:3,3:"gl",cl:4,4:"cl"},h={};h.xml3d={id:{a:e.IDHandler},className:{a:e.CanvasClassHandler,
id:"class"},style:{a:e.CanvasStyleHandler},onclick:{a:e.EventAttributeHandler},ondblclick:{a:e.EventAttributeHandler},onmousedown:{a:e.EventAttributeHandler},onmouseup:{a:e.EventAttributeHandler},onmouseover:{a:e.EventAttributeHandler},onmousemove:{a:e.EventAttributeHandler},onmouseout:{a:e.EventAttributeHandler},onkeypress:{a:e.EventAttributeHandler},onkeydown:{a:e.EventAttributeHandler},onkeyup:{a:e.EventAttributeHandler},onload:{a:e.EventAttributeHandler},onframedrawn:{a:e.EventAttributeHandler},
complete:{p:d.xml3dComplete},height:{a:e.IntAttributeHandler,params:600},width:{a:e.IntAttributeHandler,params:800},getElementByPoint:{m:l.xml3dGetElementByPoint},generateRay:{m:l.xml3dGenerateRay},getElementByRay:{m:l.xml3dGetElementByRay},getWorldBoundingBox:{m:l.getWorldBoundingBox},getLocalBoundingBox:{m:l.getLocalBoundingBox},getRenderInterface:{m:l.xml3dGetRenderInterface},view:{a:e.StringAttributeHandler,params:{defaultValue:"view"}}};h.compute={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,
id:"class"},value:{a:e.StringValueHandler}};h.data={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},compute:{a:e.StringAttributeHandler},platform:{a:e.EnumAttributeHandler,params:{values:c,defaultValues:1}},filter:{a:e.StringAttributeHandler},onload:{a:e.EventAttributeHandler},onprogress:{a:e.EventAttributeHandler},complete:{p:d.XML3DNestedDataContainerTypeComplete},getOutputNames:{m:l.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:l.XML3DNestedDataContainerTypeGetOutputChannelInfo},
getResult:{m:l.XML3DNestedDataContainerTypeGetResult},src:{a:e.StringAttributeHandler}};h.dataflow={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},platform:{a:e.EnumAttributeHandler,params:{values:c,defaultValues:1}},out:{a:e.StringAttributeHandler},onload:{a:e.EventAttributeHandler},onprogress:{a:e.EventAttributeHandler},complete:{p:d.XML3DNestedDataContainerTypeComplete},getOutputNames:{m:l.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:l.XML3DNestedDataContainerTypeGetOutputChannelInfo},
getResult:{m:l.XML3DNestedDataContainerTypeGetResult}};h.asset={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},onload:{a:e.EventAttributeHandler},onprogress:{a:e.EventAttributeHandler},complete:{p:d.AssetComplete},progressLevel:{p:d.AssetProgressLevel},src:{a:e.StringAttributeHandler},name:{a:e.StringAttributeHandler},pick:{a:e.StringAttributeHandler},transform:{a:e.StringAttributeHandler},material:{a:e.StringAttributeHandler}};h.defs={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,
id:"class"}};h.group={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},onclick:{a:e.EventAttributeHandler},ondblclick:{a:e.EventAttributeHandler},onmousedown:{a:e.EventAttributeHandler},onmouseup:{a:e.EventAttributeHandler},onmouseover:{a:e.EventAttributeHandler},onmousemove:{a:e.EventAttributeHandler},onmouseout:{a:e.EventAttributeHandler},onkeypress:{a:e.EventAttributeHandler},onkeydown:{a:e.EventAttributeHandler},onkeyup:{a:e.EventAttributeHandler},getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},
getLocalMatrix:{m:l.XML3DGraphTypeGetLocalMatrix},getWorldBoundingBox:{m:l.getWorldBoundingBox},getLocalBoundingBox:{m:l.getLocalBoundingBox},transform:{a:e.StringAttributeHandler},material:{a:e.StringAttributeHandler}};h.mesh={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},onclick:{a:e.EventAttributeHandler},ondblclick:{a:e.EventAttributeHandler},onmousedown:{a:e.EventAttributeHandler},onmouseup:{a:e.EventAttributeHandler},onmouseover:{a:e.EventAttributeHandler},onmousemove:{a:e.EventAttributeHandler},
onmouseout:{a:e.EventAttributeHandler},onkeypress:{a:e.EventAttributeHandler},onkeydown:{a:e.EventAttributeHandler},onkeyup:{a:e.EventAttributeHandler},onload:{a:e.EventAttributeHandler},onprogress:{a:e.EventAttributeHandler},complete:{p:d.XML3DNestedDataContainerTypeComplete},type:{a:e.EnumAttributeHandler,params:{values:b,defaultValue:0}},compute:{a:e.StringAttributeHandler},transform:{a:e.StringAttributeHandler},material:{a:e.StringAttributeHandler},getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},
getLocalMatrix:{m:l.XML3DGraphTypeGetLocalMatrix},getWorldBoundingBox:{m:l.getWorldBoundingBox},getLocalBoundingBox:{m:l.getLocalBoundingBox},getOutputNames:{m:l.meshGetOutputNames},getOutputChannelInfo:{m:l.meshGetOutputChannelInfo},getResult:{m:l.meshGetResult},src:{a:e.StringAttributeHandler}};h.model={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},onclick:{a:e.EventAttributeHandler},ondblclick:{a:e.EventAttributeHandler},onmousedown:{a:e.EventAttributeHandler},onmouseup:{a:e.EventAttributeHandler},
onmouseover:{a:e.EventAttributeHandler},onmousemove:{a:e.EventAttributeHandler},onmouseout:{a:e.EventAttributeHandler},onkeypress:{a:e.EventAttributeHandler},onkeydown:{a:e.EventAttributeHandler},onkeyup:{a:e.EventAttributeHandler},onload:{a:e.EventAttributeHandler},onprogress:{a:e.EventAttributeHandler},complete:{p:d.AssetComplete},progressLevel:{p:d.AssetProgressLevel},getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},getLocalMatrix:{m:l.XML3DGraphTypeGetLocalMatrix},getWorldBoundingBox:{m:l.getWorldBoundingBox},
getLocalBoundingBox:{m:l.getLocalBoundingBox},src:{a:e.StringAttributeHandler},pick:{a:e.StringAttributeHandler},transform:{a:e.StringAttributeHandler},material:{a:e.StringAttributeHandler}};h.transform={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},translation:{a:e.Vec3AttributeHandler,params:[0,0,0]},scale:{a:e.Vec3AttributeHandler,params:[1,1,1]},rotation:{a:e.AxisAngleAttributeHandler,params:[0,0,1,0]},center:{a:e.Vec3AttributeHandler,params:[0,0,0]},scaleOrientation:{a:e.AxisAngleAttributeHandler,
params:[0,0,1,0]}};h.material={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},onload:{a:e.EventAttributeHandler},onprogress:{a:e.EventAttributeHandler},complete:{p:d.XML3DNestedDataContainerTypeComplete},compute:{a:e.StringAttributeHandler},getOutputNames:{m:l.XML3DShaderProviderTypeGetOutputNames},getOutputChannelInfo:{m:l.XML3DShaderProviderTypeGetOutputChannelInfo},getResult:{m:l.XML3DShaderProviderTypeGetResult},model:{a:e.StringAttributeHandler},src:{a:e.StringAttributeHandler}};
h.light={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},onclick:{a:e.EventAttributeHandler},ondblclick:{a:e.EventAttributeHandler},onmousedown:{a:e.EventAttributeHandler},onmouseup:{a:e.EventAttributeHandler},onmouseover:{a:e.EventAttributeHandler},onmousemove:{a:e.EventAttributeHandler},onmouseout:{a:e.EventAttributeHandler},onkeypress:{a:e.EventAttributeHandler},onkeydown:{a:e.EventAttributeHandler},onkeyup:{a:e.EventAttributeHandler},global:{a:e.BoolAttributeHandler,params:!1},
getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},getLocalMatrix:{m:l.XML3DGraphTypeGetLocalMatrix},onload:{a:e.EventAttributeHandler},onprogress:{a:e.EventAttributeHandler},complete:{p:d.XML3DNestedDataContainerTypeComplete},compute:{a:e.StringAttributeHandler},getOutputNames:{m:l.XML3DShaderProviderTypeGetOutputNames},getOutputChannelInfo:{m:l.XML3DShaderProviderTypeGetOutputChannelInfo},getResult:{m:l.XML3DShaderProviderTypeGetResult},src:{a:e.StringAttributeHandler},model:{a:e.StringAttributeHandler}};
h.script={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},value:{a:e.StringValueHandler},src:{a:e.StringAttributeHandler},name:{a:e.StringAttributeHandler},type:{a:e.StringAttributeHandler}};h.assetmesh={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},name:{a:e.StringAttributeHandler},match:{a:e.StringAttributeHandler},type:{a:e.EnumAttributeHandler,params:{values:b,defaultValue:0}},compute:{a:e.StringAttributeHandler},filter:{a:e.StringAttributeHandler},
includes:{a:e.StringAttributeHandler},material:{a:e.StringAttributeHandler},transform:{a:e.StringAttributeHandler},platform:{a:e.EnumAttributeHandler,params:{values:c,defaultValue:1}},getOutputNames:{m:l.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:l.XML3DNestedDataContainerTypeGetOutputChannelInfo},getResult:{m:l.XML3DNestedDataContainerTypeGetResult},src:{a:e.StringAttributeHandler}};h.assetdata={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},name:{a:e.StringAttributeHandler},
compute:{a:e.StringAttributeHandler},filter:{a:e.StringAttributeHandler},includes:{a:e.StringAttributeHandler},platform:{a:e.EnumAttributeHandler,params:{values:c,defaultValue:1}},getOutputNames:{m:l.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:l.XML3DNestedDataContainerTypeGetOutputChannelInfo},getResult:{m:l.XML3DNestedDataContainerTypeGetResult},src:{a:e.StringAttributeHandler}};h["float"]={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},name:{a:e.StringAttributeHandler},
param:{a:e.BoolAttributeHandler,params:!1},key:{a:e.FloatAttributeHandler,params:0},value:{a:e.FloatArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue}};h.float2={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},name:{a:e.StringAttributeHandler},param:{a:e.BoolAttributeHandler,params:!1},key:{a:e.FloatAttributeHandler,params:0},value:{a:e.Float2ArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue}};h.float3={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,
id:"class"},name:{a:e.StringAttributeHandler},param:{a:e.BoolAttributeHandler,params:!1},key:{a:e.FloatAttributeHandler,params:0},value:{a:e.Float3ArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue}};h.float4={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},name:{a:e.StringAttributeHandler},param:{a:e.BoolAttributeHandler,params:!1},key:{a:e.FloatAttributeHandler,params:0},value:{a:e.Float4ArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue}};
h.float4x4={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},name:{a:e.StringAttributeHandler},param:{a:e.BoolAttributeHandler,params:!1},key:{a:e.FloatAttributeHandler,params:0},value:{a:e.Float4x4ArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue}};h["int"]={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},name:{a:e.StringAttributeHandler},param:{a:e.BoolAttributeHandler,params:!1},key:{a:e.FloatAttributeHandler,params:0},value:{a:e.IntArrayValueHandler},
setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue}};h.int4={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},name:{a:e.StringAttributeHandler},param:{a:e.BoolAttributeHandler,params:!1},key:{a:e.FloatAttributeHandler,params:0},value:{a:e.IntArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue}};h.bool={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},name:{a:e.StringAttributeHandler},param:{a:e.BoolAttributeHandler,params:!1},key:{a:e.FloatAttributeHandler,
params:0},value:{a:e.BoolArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue}};h.string={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},name:{a:e.StringAttributeHandler},param:{a:e.BoolAttributeHandler,params:!1},key:{a:e.FloatAttributeHandler,params:0},value:{a:e.StringValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue}};h.texture={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},name:{a:e.StringAttributeHandler},param:{a:e.BoolAttributeHandler,
params:!1},key:{a:e.FloatAttributeHandler,params:0},type:{a:e.EnumAttributeHandler,params:{values:a,defaultValue:0}},filter:{a:e.StringAttributeHandler},wrap:{a:e.StringAttributeHandler},anisotropy:{a:e.StringAttributeHandler}};h.img={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},src:{a:e.StringAttributeHandler}};h.video={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},src:{a:e.StringAttributeHandler},autoplay:{a:e.BoolAttributeHandler,params:!1},muted:{a:e.BoolAttributeHandler,
params:!1},play:{m:l.videoPlay},pause:{m:l.videoPause}};h.view={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},onclick:{a:e.EventAttributeHandler},ondblclick:{a:e.EventAttributeHandler},onmousedown:{a:e.EventAttributeHandler},onmouseup:{a:e.EventAttributeHandler},onmouseover:{a:e.EventAttributeHandler},onmousemove:{a:e.EventAttributeHandler},onmouseout:{a:e.EventAttributeHandler},onkeypress:{a:e.EventAttributeHandler},onkeydown:{a:e.EventAttributeHandler},onkeyup:{a:e.EventAttributeHandler},
getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},getLocalMatrix:{m:l.XML3DGraphTypeGetLocalMatrix},getProjectionMatrix:{m:l.viewGetProjectionMatrix},getViewMatrix:{m:l.viewGetViewMatrix}};h["_web-component_"]={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},onclick:{a:e.EventAttributeHandler},ondblclick:{a:e.EventAttributeHandler},onmousedown:{a:e.EventAttributeHandler},onmouseup:{a:e.EventAttributeHandler},onmouseover:{a:e.EventAttributeHandler},onmousemove:{a:e.EventAttributeHandler},
onmouseout:{a:e.EventAttributeHandler},onkeypress:{a:e.EventAttributeHandler},onkeydown:{a:e.EventAttributeHandler},onkeyup:{a:e.EventAttributeHandler},getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},getLocalMatrix:{m:l.XML3DGraphTypeGetLocalMatrix},getWorldBoundingBox:{m:l.getWorldBoundingBox},getLocalBoundingBox:{m:l.getLocalBoundingBox}};h._dummy_={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,id:"class"},onclick:{a:e.EventAttributeHandler},ondblclick:{a:e.EventAttributeHandler},onmousedown:{a:e.EventAttributeHandler},
onmouseup:{a:e.EventAttributeHandler},onmouseover:{a:e.EventAttributeHandler},onmousemove:{a:e.EventAttributeHandler},onmouseout:{a:e.EventAttributeHandler},onkeypress:{a:e.EventAttributeHandler},onkeydown:{a:e.EventAttributeHandler},onkeyup:{a:e.EventAttributeHandler},getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},getLocalMatrix:{m:l.XML3DGraphTypeGetLocalMatrix},getWorldBoundingBox:{m:l.getWorldBoundingBox},getLocalBoundingBox:{m:l.getLocalBoundingBox}};h._content_={id:{a:e.IDHandler},className:{a:e.StringAttributeHandler,
id:"class"}};m.exports={classInfo:h,MeshTypes:b,TextureTypes:a,PlatformTypes:c,DataFieldTypes:{"float ":0,0:"float ","float2 ":1,1:"float2 ",float3:2,2:"float3",float4:3,3:"float4",float4x4:4,4:"float4x4","int":10,10:"int",int4:11,11:"int4",bool:20,20:"bool",texture:30,30:"texture"},DataChannelOrigin:{"origin_value ":0,0:"origin_value ",origin_child:1,1:"origin_child",origin_source:2,2:"origin_source",origin_compute:3,3:"origin_compute",origin_proto:4,4:"origin_proto"}}},{"./attributes.js":69,"./methods.js":73,
"./properties.js":75}],71:[function(d,m,l){var e=d("./elements.js").config,b=d("./configuration.js").classInfo;d={};var a=document.getElementById;d.getElementById=function(c){var b=a.call(this,c);if(b)return b;for(var b=this.getElementsByTagName("*"),h=0;h<b.length;h++){var e=b[h];if(e.getAttribute("id")===c)return e}return null};var c=document.createElementNS;d.createElementNS=function(a,f){var h=c.call(this,a,f);(a==XML3D.xml3dNS||b[f.toLowerCase()])&&e.element(h);return h};var h=document.createElement;
d.createElement=function(a){var c=h.call(this,a);b[a.toLowerCase()]&&e.element(c);return c};XML3D.extend(window.document,d)},{"./configuration.js":70,"./elements.js":72}],72:[function(d,m,l){function e(f){for(var h=0;h<f.length;++h){var e=f[h];if("attributes"===e.type){var d=e.target,k=d._configured;if(k){var q=k.handlers[e.attributeName]||k.handlers[e.attributeName.toLowerCase()];if(q&&q.setFromAttribute){var n=d.getAttribute(e.attributeName),d=q.setFromAttribute(n,e.oldValue,d,k.storage);XML3D.debug.assert(!d,
"We assume no attribute handler notifies adapters anymore.")}k.attributeChangedCallback(e)}}else if("childList"===e.type){d=e.addedNodes;for(k=0;k<d.length;k++)if(d[k].nodeType===Node.TEXT_NODE)b(e);else{var n=d[k],u=e;n.parentNode&&(q=u.target._configured)&&(r.element(n),c(n),n=new g.NotificationWrapper(u,g.NODE_INSERTED,n),q.notify(n))}d=e.removedNodes;for(k=0;k<d.length;k++)if(d[k].nodeType!==Node.TEXT_NODE&&(q=d[k],n=e,u=n.target._configured)){var p=new g.NotificationWrapper(n,g.NODE_REMOVED,
q);u.notify(p);q._configured?(p.type=g.THIS_REMOVED,a(q,p)):q.nodeType===Node.TEXT_NODE&&b(n)}}else"characterData"==e.type&&b(e)}}function b(a){for(var c=a.target;!c._configured&&c.parentElement;)c=c.parentElement;var b=c._configured;b&&(a=new g.NotificationWrapper(a,g.VALUE_MODIFIED,c),void 0!==b.handlers.value&&b.handlers.value.resetValue(b.storage),b.notify(a))}function a(c,b){c._configured&&(k.notifyNodeIdChange(c,c.id,null),c._configured.notify(b),delete c._configured);for(var f=c.firstElementChild;f;)a(f,
b),f=f.nextElementSibling;c.shadowRoot&&a(c.shadowRoot,b)}function c(a){for(var b=a.firstElementChild;b;)c(b),b=b.nextElementSibling;k.notifyNodeIdChange(a,null,a.id)}function h(a,c,b){var f={configurable:!0,get:function(){return b[a]}};try{Object.defineProperty(c,a,f)}catch(g){XML3D.debug.logWarning("Can't configure "+c.nodeName+"::"+a)}}var g=d("./notification.js"),f=d("./configuration.js").classInfo,k=d("../resource");d=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;
var u;d?u=new d(e):(XML3D.debug.logError("XML3D requires MutationObservers, which your browser does not support. Please consider upgrading to a newer version."),u={takeRecords:function(){return[]},observe:function(a,c){}});XML3D.flushDOMChanges=function(){var a=u.takeRecords();a.length&&e(a)};var q=function(a){a&&(this.element=a,this.handlers=null,this.storage={},this.adapters={},u.observe(a,{childList:!0,attributes:!0,attributeOldValue:!0}))};q.prototype.registerAttributes=function(a){var c=this.element,
b=c instanceof HTMLElement?"_html":"_xml",f=b+c.nodeName+"handlers",b=b+c.nodeName+"proto",g=!!c.__proto__;a._cache||(a._cache={});if(!a._cache[f]){var h;g&&(h=function(){},h.prototype=c.__proto__,h=new h);var g={},e;for(e in a)if("_cache"!=e)if(void 0===a[e])h&&delete h[e];else if(void 0!==a[e].a){var d=a[e].id||e,k=new a[e].a(d,a[e].params);g[d.toLowerCase()]=k;if(h)try{Object.defineProperty(h,e,k.desc)}catch(q){XML3D.debug.logWarning("Can't configure "+c.nodeName+"::"+e)}}else if(void 0!==a[e].m)h&&
(h[e]=a[e].m);else if(void 0!==a[e].p){if(h)try{Object.defineProperty(h,e,a[e].p)}catch(n){XML3D.debug.logWarning("Can't configure "+c.nodeName+"::"+e)}}else XML3D.debug.logError("Can't configure "+c.nodeName+"::"+e);a._cache[f]=g;a._cache[b]=h}this.handlers=a._cache[f];for(e in a)if("_cache"!=e)if(void 0===a[e])delete c[e];else if(void 0!==a[e].a){d=a[e].id||e;k=this.handlers[d.toLowerCase()];k.init&&k.init(c,this.storage);try{Object.defineProperty(c,e,k.desc)}catch(u){XML3D.debug.logWarning("Can't configure "+
c.nodeName+"::"+e)}}else if(void 0!==a[e].m)c[e]=a[e].m;else if(void 0!==a[e].p)try{Object.defineProperty(c,e,a[e].p)}catch(r){XML3D.debug.logWarning("Can't configure "+c.nodeName+"::"+e)}return c};q.prototype.registerMixed=function(){u.observe(this.element,{childList:!0,attributes:!0,attributeOldValue:!0,characterData:!0,subtree:!0})};q.prototype.notify=function(a){var c=this.adapters,b;for(b in c)try{c[b].notifyChanged(a)}catch(f){XML3D.debug.logException(f)}};q.prototype.attributeChangedCallback=
function(a){var c=this.adapters,b;for(b in c){XML3D.debug.assert(c[b].attributeChangedCallback,"Adapter implements 'attributeChangedCallback': "+this.element.nodeName+" ("+b+")");try{c[b].attributeChangedCallback(a.attributeName,a.oldValue,this.element.getAttribute(a.attributeName),a.attributeNamespace)}catch(f){XML3D.debug.logException(f)}}};q.prototype.remove=function(a){for(var c in this.adapters)a=this.adapters[c],a.dispose&&a.dispose(),a.clearAdapterHandles&&a.clearAdapterHandles();this.adapters=
{};for(c in this.handlers)a=this.handlers[c],a.remove&&a.remove()};q.prototype.toString=function(){return"ElementHandler ("+this.element.nodeName+", id: "+this.element.id+")"};var n="clientHeight clientLeft clientTop clientWidth offsetHeight offsetLeft offsetTop offsetWidth".split(" "),p=function(a){q.call(this,a);var c=document.createElement("canvas");c.width=800;c.height=600;this.canvas=c;this.canvasHandler={destroy:function(){}};for(var b in n)h(n[b],a,c);a.getBoundingClientRect=function(){return c.getBoundingClientRect()};
this.destroy=function(){for(var c in n)delete a[n[c]];this.canvasHandler.destroy()}};XML3D.createClass(p,q);var r={},t=0;r.element=function(a){if(void 0===a._configured){var c=f[a.localName];if(void 0===c){if(1!==a.nodeType)return;-1!==a.nodeName.indexOf("-")?(c=f["_web-component_"],a.componentId=++t):c=f._dummy_}a._configured="xml3d"==a.localName?new p(a):new q(a);a._configured.registerAttributes(c);c=a.firstElementChild;!c&&a.shadowRoot&&(c=a.shadowRoot.firstElementChild);for(k.notifyNodeIdChange(a,
null,a.getAttribute("id"));c;)r.element(c),c=c.nextElementSibling}};r.configure=function(a){Array.isArray(a)?a.forEach(function(a){r.element(a)}):r.element(a)};m.exports={ElementHandler:q,XML3DHandler:p,config:r}},{"../resource":167,"./configuration.js":70,"./notification.js":74}],73:[function(d,m,l){function e(a,c){var b={},g;for(g in c){var e=c[g],h=a.getOutputData(e)&&a.getOutputData(e).getValue();h&&(b[e]=h)}return b}var b=d("../utils/misc.js").sendAdapterEvent,a=d("../utils/misc.js").callAdapterFunc,
c=d("../utils/css.js"),h=d("../resource");d("../types/vec3.js");var g=d("../types/mat4.js");d("gl-matrix");d={xml3dGetElementByRay:function(a,c,b){XML3D.flushDOMChanges();XML3D.flushCSSChanges();var g=this._configured.adapters||{},e;for(e in g)if(g[e].getElementByRay)return g[e].getElementByRay(a,c,b);return null},viewGetViewMatrix:function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},b;for(b in a)if(a[b].getViewMatrix)return a[b].getViewMatrix();a=new XML3D.Mat4;(b=c.getCSSMatrix(this))&&
c.convertCssToMat4(b,a);return a.invert()},viewGetProjectionMatrix:function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},c;for(c in a)if(a[c].getProjectionMatrix)return a[c].getProjectionMatrix();return null},xml3dGetElementByPoint:function(a,c,b,g){XML3D.flushDOMChanges();XML3D.flushCSSChanges();var e=this._configured.adapters||{},h;for(h in e)if(e[h].getElementByPoint)return e[h].getElementByPoint(a,c,b,g);return null},xml3dGenerateRay:function(a,c){var b=this._configured.adapters||
{},g;for(g in b)if(b[g].generateRay)return b[g].generateRay(a,c);return new XML3D.Ray},getWorldBoundingBox:function(){XML3D.flushDOMChanges();XML3D.flushCSSChanges();var a=this._configured.adapters||{},c;for(c in a)if(a[c].getWorldBoundingBox)return a[c].getWorldBoundingBox();return new XML3D.Box},getLocalBoundingBox:function(){XML3D.flushDOMChanges();XML3D.flushCSSChanges();var a=this._configured.adapters||{},c;for(c in a)if(a[c].getLocalBoundingBox)return a[c].getLocalBoundingBox();return new XML3D.Box},
xml3dGetRenderInterface:function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},c;for(c in a)if(a[c].getRenderInterface)return a[c].getRenderInterface();return{}},XML3DGraphTypeGetWorldMatrix:function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},c;for(c in a)if(a[c].getWorldMatrix)return a[c].getWorldMatrix();return new g},XML3DGraphTypeGetLocalMatrix:function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},c;for(c in a)if(a[c].getLocalMatrix)return a[c].getLocalMatrix();
return new g},videoPlay:function(){b(this,{play:[]})},videoPause:function(){b(this,{pause:[]})}};d.XML3DNestedDataContainerTypeGetOutputNames=d.XML3DShaderProviderTypeGetOutputNames=d.meshGetOutputNames=function(){XML3D.flushDOMChanges();var a=h.getAdapter(this,"data");return a?a.getOutputNames():null};d.XML3DNestedDataContainerTypeGetResult=d.XML3DShaderProviderTypeGetResult=d.meshGetResult=function(a){XML3D.flushDOMChanges();var c=h.getAdapter(this,"data");return c?(a=c.getComputeResult(a))?new window.XML3DDataResult(a):
null:null};d.XML3DNestedDataContainerTypeGetOutputChannelInfo=d.XML3DShaderProviderTypeGetOutputChannelInfo=d.meshGetOutputChannelInfo=function(a){XML3D.flushDOMChanges();var c=h.getAdapter(this,"data");return c?(a=c.getOutputChannelInfo(a))?new window.XML3DDataChannelInfo(a.type,a.origin,a.originalName,a.seqLength,a.seqMinKey,a.seqMaxKey):null:null};d.dataAddOutputFieldListener=function(c,b){XML3D.flushDOMChanges();if(!c)return!1;"String"===Object.prototype.toString.call(c).slice(8,-1)&&(c=[c]);
if(0==c.length)return!1;var g=a(this,{getComputeRequest:[c,function(a,g){b(e(a.getResult(),c))}]});if(0==g.length)return!1;g=g[0].getResult();g=e(g,c);Object.keys(g).length&&b(g);return!0};d.XML3DDataSourceTypeSetScriptValue=function(a){var c=this._configured;c&&("[value set by script]"!=this.textContent&&(this.textContent="[value set by script]"),XML3D.flushDOMChanges(),c.scriptValue=a,(c=h.getAdapter(this,"data"))&&c.setScriptValue(a))};m.exports=d},{"../resource":167,"../types/mat4.js":174,"../types/vec3.js":178,
"../utils/css.js":181,"../utils/misc.js":184,"gl-matrix":1}],74:[function(d,m,l){d={NODE_INSERTED:0,VALUE_MODIFIED:1,NODE_REMOVED:2,THIS_REMOVED:3,ADAPTER_HANDLE_CHANGED:4,ADAPTER_VALUE_CHANGED:5,Notification:function(e){this.type=e}};d.Notification.prototype.toString=function(){return"Notification (type:"+this.type+")"};d.NotificationWrapper=function(e,b,a){this.mutation=e;this.type=b;this.affectedNode=a};XML3D.createClass(d.NotificationWrapper,d.Notification);d.NotificationWrapper.prototype.toString=
function(){return"NotificationWrapper (type:"+this.type+", wrapped: "+this.mutation+")"};d.AdapterHandleNotification=function(e,b){this.adapterHandle=e;this.type=b};XML3D.createClass(d.AdapterHandleNotification,d.Notification);d.AdapterHandleNotification.prototype.toString=function(){return"AdapterHandleNotification (type:"+this.type+")"};d.ConnectedAdapterNotification=function(e,b){this.adapter=e.adapterHandle.getAdapter();this.key=b;this.url=e.adapterHandle.url;this.type=e.type;this.handleStatus=
e.adapterHandle.status};XML3D.createClass(d.ConnectedAdapterNotification,d.Notification);d.ConnectedAdapterNotification.prototype.toString=function(){return"ConnectedAdapterNotification (type:"+this.type+", key: "+this.key+")"};m.exports=d},{}],75:[function(d,m,l){m.exports={XML3DNestedDataContainerTypeComplete:{get:function(){XML3D.flushDOMChanges();var e=this._configured.adapters||{},b;for(b in e)if(e[b].getDataComplete)return e[b].getDataComplete();return!1},set:function(){}},AssetComplete:{get:function(){XML3D.flushDOMChanges();
var e=this._configured.adapters||{},b;for(b in e)if(e[b].getAssetComplete)return e[b].getAssetComplete();return!1},set:function(){}},AssetProgressLevel:{get:function(){XML3D.flushDOMChanges();var e=this._configured.adapters||{},b;for(b in e)if(e[b].getAssetProgressLevel)return e[b].getAssetProgressLevel();return!1},set:function(){}},xml3dComplete:{get:function(){XML3D.flushDOMChanges();var e=this._configured.adapters||{},b;for(b in e)if(e[b].getComplete)return e[b].getComplete();return!1},set:function(){}}}},
{}],76:[function(d,m,l){function e(a,c){return new Promise(function(e,h){fetch(a).then(function(a){return a.text()}).then(function(d){var n=document.createElement("div");n.innerHTML=d;(d=n.querySelector("template"))?e(b(d,c)):(XML3D.debug.logError("No component template element found at url "+a),h())})["catch"](function(c){XML3D.debug.logError("Error while registering web component: ",c);h(a)})})}function b(c,b){if(c){"string"===typeof b&&(b={name:b});b=b||{};var e=b.name||c.getAttribute("name"),
d=Object.create(h);d.template=c;b.proto&&a(d,b.proto);document.registerElement(e,{prototype:d});return e}}function a(a,c){for(var b in c)c.hasOwnProperty(b)&&("createdCallback"===b?a.createdCallback=function(){h.createdCallback.call(this);c.createdCallback.call(this)}:"attributeChangedCallback"===b?a.attributeChangedCallback=function(a,b,g){h.attributeChangedCallback.call(this,a,b,g);c.attributeChangedCallback.call(this,a,b,g)}:a[b]=c[b])}var c=d("../utils/css.js"),h=Object.create(HTMLElement.prototype);
h.createdCallback=function(){this.root=this.createShadowRoot();this.root.appendChild(c.XML3DStyleElement());var a=document.importNode(this.template.content,!0);this.root.appendChild(a);this.handlers={};for(a=0;a<this.template.attributes.length;a++){var b=this.template.attributes[a],e=b.localName,h=this.place('.//node()[text()="{{'+e+'}}"]');h||(h=this.place('.//@*[.="{{'+e+'}}"]'));h&&(b=function(a,c){return function(b){b||(b=c);a.textContent=b}}(h,b.textContent),b(this.getAttribute(e)),this.handlers[e]=
b)}this._configured&&(a=this.parentElement,e=this.nextElementSibling,a.removeChild(this),e?a.insertBefore(this,e):a.appendChild(this))};h.place=function(a){for(var c=this.root.firstElementChild;c;){if(node=document.evaluate(a,c,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)return node;c=c.nextElementSibling}};h.attributeChangedCallback=function(a,c,b){(a=this.handlers[a])&&a(b)};m.exports=function(a,c){if("string"===typeof a)return e(a,c);a instanceof HTMLElement?b(a,c):XML3D.debug.logError("Must provide a template element or a URL to a template element when registering a component!")}},
{"../utils/css.js":181}],77:[function(d,m,l){m.exports=function(e){e.vec3.reciprocal=function(a,c){a||(a=c);a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];return a};var b=function(a){return Array.prototype.join.call(a," ")};e.vec2.toDOMString=b;e.vec2.fromDOMString=function(a){var c=a.split(" ");if(2!==c.length||isNaN(+c[0])||isNaN(+c[1]))throw"Could not parse '"+a+"' into a valid vec2 object";return e.vec2.fromValues(+c[0],+c[1])};e.vec3.toDOMString=b;e.vec3.fromDOMString=function(a){var c=a.split(" ");if(3!==
c.length||isNaN(+c[0])||isNaN(+c[1])||isNaN(+c[2]))throw"Could not parse '"+a+"' into a valid vec3 object";return e.vec3.fromValues(+c[0],+c[1],+c[2])};e.vec4.toDOMString=b;e.vec4.fromDOMString=function(a){var c=a.split(" ");if(4!==c.length||isNaN(+c[0])||isNaN(+c[1])||isNaN(+c[2])||isNaN(+c[3]))throw"Could not parse '"+a+"' into a valid vec4 or quat object";return e.vec4.fromValues(+c[0],+c[1],+c[2],+c[3])};e.quat.toDOMString=b;e.quat.fromDOMString=e.vec4.fromDOMString;e.mat3.toDOMString=b;e.mat3.fromDOMString=
function(a){var c=a.split(" ");if(9!==c.length)throw"Could not parse '"+a+"' into a valid mat3 object";for(var b=e.mat3.create(),g=0;9>g;g++)if(b[g]=+c[g],isNaN(b[g]))throw"Could not parse '"+a+"' into a valid mat3 object";return b};e.mat4.toDOMString=b;e.mat4.fromDOMString=function(a){var c=a.split(" ");if(16!==c.length)throw"Could not parse '"+a+"' into a valid mat4 object";for(var b=e.mat4.create(),g=0;16>g;g++)if(b[g]=+c[g],isNaN(b[g]))throw"Could not parse '"+a+"' into a valid mat4 object";return b};
e.mat4.multiplyOffsetVec3=function(a,c,b,g,f){f||(f=b);g||(g=0);var e=b[g+0],d=b[g+1];b=b[g+2];f[0]=a[c+0]*e+a[c+4]*d+a[c+8]*b+a[c+12];f[1]=a[c+1]*e+a[c+5]*d+a[c+9]*b+a[c+13];f[2]=a[c+2]*e+a[c+6]*d+a[c+10]*b+a[c+14];return f};e.mat4.multiplyOffsetDirection=function(a,c,b,g,f){f||(f=b);g||(g=0);var e=b[g+0],d=b[g+1];b=b[g+2];f[0]=a[c+0]*e+a[c+4]*d+a[c+8]*b;f[1]=a[c+1]*e+a[c+5]*d+a[c+9]*b;f[2]=a[c+2]*e+a[c+6]*d+a[c+10]*b;return f};e.mat4.multiplyOffset=function(a,c,b,g,f,e){var d=f[e+0],q=f[e+1],n=
f[e+2],p=f[e+3],r=f[e+4],t=f[e+5],v=f[e+6],l=f[e+7],y=f[e+8],w=f[e+9],z=f[e+10],m=f[e+11],D=f[e+12],B=f[e+13],A=f[e+14];f=f[e+15];e=b[g+0];var C=b[g+1],H=b[g+2],E=b[g+3],G=b[g+4],I=b[g+5],K=b[g+6],L=b[g+7],M=b[g+8],N=b[g+9],J=b[g+10],O=b[g+11],P=b[g+12],Q=b[g+13],R=b[g+14];b=b[g+15];a[c+0]=e*d+C*r+H*y+E*D;a[c+1]=e*q+C*t+H*w+E*B;a[c+2]=e*n+C*v+H*z+E*A;a[c+3]=e*p+C*l+H*m+E*f;a[c+4]=G*d+I*r+K*y+L*D;a[c+5]=G*q+I*t+K*w+L*B;a[c+6]=G*n+I*v+K*z+L*A;a[c+7]=G*p+I*l+K*m+L*f;a[c+8]=M*d+N*r+J*y+O*D;a[c+9]=M*q+
N*t+J*w+O*B;a[c+10]=M*n+N*v+J*z+O*A;a[c+11]=M*p+N*l+J*m+O*f;a[c+12]=P*d+Q*r+R*y+b*D;a[c+13]=P*q+Q*t+R*w+b*B;a[c+14]=P*n+Q*v+R*z+b*A;a[c+15]=P*p+Q*l+R*m+b*f};e.quat.slerpOffset=function(a,c,b,e,f,d,u,q){d||(d=a);var n=c+1,p=c+2,r=c+3,t=e+1,v=e+2,l=e+3,y=u+1,w=u+2,z=u+3,m=a[c]*b[e]+a[n]*b[t]+a[p]*b[v]+a[r]*b[l],D;if(.01>1-Math.abs(m))D=1-f;else{var B=Math.acos(Math.abs(m)),A=Math.sin(B);D=Math.sin(B*(1-f))/A;f=Math.sin(B*f)/A}q&&0>m&&(D=-D);d[u]=D*a[c]+f*b[e];d[y]=D*a[n]+f*b[t];d[w]=D*a[p]+f*b[v];d[z]=
D*a[r]+f*b[l]};e.quat.fromAxisAngle=function(a,c){var b=e.quat.create();4===a.length&&void 0===c?e.quat.setAxisAngle(b,a,a[3]):e.quat.setAxisAngle(b,a,c);return e.quat.normalize(b,b)};e.vec3.transformDirection=function(a,c,b){var e=c[0],f=c[1];c=c[2];a[0]=b[0]*e+b[4]*f+b[8]*c;a[1]=b[1]*e+b[5]*f+b[9]*c;a[2]=b[2]*e+b[6]*f+b[10]*c;return a};e.quat.setFromMat3=function(a,c){var b=c[0]+c[4]+c[8];0<b?(b=2*Math.sqrt(b+1),a[0]=(c[7]-c[5])/b,a[1]=(c[2]-c[6])/b,a[2]=(c[3]-c[1])/b,a[3]=.25*b):c[0]>c[4]&&c[0]>
c[8]?(b=2*Math.sqrt(1+c[0]-c[4]-c[8]),a[3]=(c[7]-c[5])/b,a[0]=.25*b,a[1]=(c[1]+c[3])/b,a[2]=(c[2]+c[6])/b):c[4]>c[8]?(b=2*Math.sqrt(1+c[4]-c[0]-c[8]),a[3]=(c[2]-c[6])/b,a[0]=(c[1]+c[3])/b,a[1]=.25*b,a[2]=(c[5]+c[7])/b):(b=2*Math.sqrt(1+c[8]-c[0]-c[4]),a[3]=(c[3]-c[1])/b,a[0]=(c[2]+c[6])/b,a[1]=(c[5]+c[7])/b,a[2]=.25*b);return a};e.quat.setFromBasis=function(a,c,b,e){var f=1/XML3D.math.vec3.length(c),d=1/XML3D.math.vec3.length(b),u=1/XML3D.math.vec3.length(e),q=XML3D.math.mat3.create();q[0]=c[0]*f;
q[1]=b[0]*d;q[2]=e[0]*u;q[3]=c[1]*f;q[4]=b[1]*d;q[5]=e[1]*u;q[6]=c[2]*f;q[7]=b[2]*d;q[8]=e[2]*u;return XML3D.math.quat.setFromMat3(a,q)};e.vec4.fromQuat=function(a){var c=XML3D.math.vec4.create();1<a[3]&&XML3D.math.quat.normalize(a,a);var b=Math.sqrt(1-a[3]*a[3]),e=2*Math.acos(a[3]);1E-4>b?(c[0]=0,c[1]=0,c[2]=1,c[3]=0):(c[0]=a[0]/b,c[1]=a[1]/b,c[2]=a[2]/b,c[3]=e);return c}}},{}],78:[function(d,m,l){var e=d("../../../base/adapter.js").NodeAdapter;d=function(b,a){e.call(this,b,a)};XML3D.createClass(d,
e,{getParentRenderAdapter:function(){var b=this.node;if(b.getDestinationInsertionPoints){var a=b.getDestinationInsertionPoints();if(a.length)return this.factory.getAdapter(a[0])}do{b=b.parentNode;if(b.host)return this.factory.getAdapter(b.host);if(a=this.factory.getAdapter(b))return a}while(b.parentNode);return null},initElement:function(b){this.factory.getAdapter(b);this.traverse(function(){})},attributeChangedCallback:function(b,a,c){},styleChangedCallback:function(){},getScene:function(){return this.factory.renderer.scene},
dispose:function(){this.node=null}});m.exports=d},{"../../../base/adapter.js":48}],79:[function(d,m,l){var e=d("./base.js");d=function(b,a){e.call(this,b,a)};XML3D.createClass(d,e);m.exports=d},{"./base.js":78}],80:[function(d,m,l){var e=d("../../../base/adapter.js").NodeAdapterFactory,b=d("../../../interface/configuration.js").classInfo;l=function(a){e.call(this,"scene",a);this.type="RenderAdapterFactory"};XML3D.createClass(l,e);var a={xml3d:d("./xml3d.js"),view:d("./view.js"),defs:d("./defs.js"),
mesh:d("./mesh.js"),model:d("./model.js"),material:d("./material.js"),group:d("./group.js"),light:d("./light.js"),"web-component":d("./web-component.js")};l.prototype.createAdapter=function(c){var e=a[c.localName];return void 0!==e?new e(this,c):1!==c.nodeType||void 0!==b[c.nodeName.toLowerCase()]?null:-1!==c.nodeName.indexOf("-")&&c.shadowRoot?new a["web-component"](this,c):new a.group(this,c)};l.prototype.setScene=function(a){this.scene=a};l.prototype.getScene=function(){return this.scene};l.prototype.setRenderer=
function(a){this.renderer=a};l.prototype.getRenderer=function(){return this.renderer};m.exports=l},{"../../../base/adapter.js":48,"../../../interface/configuration.js":70,"./defs.js":79,"./group.js":81,"./light.js":82,"./material.js":83,"./mesh.js":84,"./model.js":85,"./view.js":87,"./web-component.js":88,"./xml3d.js":89}],81:[function(d,m,l){var e=d("./scene-element.js"),b=d("gl-matrix").mat4;d=function(a,c){e.call(this,a,c,!0,!0);this.createRenderNode()};XML3D.createClass(d,e,{createRenderNode:function(){var a=
this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode();this.renderNode=this.getScene().createRenderGroup({parent:a,name:this.node.id});this.updateLocalMatrix();this.updateMaterialHandler();this.updateVisibility();this.renderNode.setWorldSpaceBoundingBox(new XML3D.Box)},getWorldBoundingBox:function(){var a=new XML3D.Box;this.renderNode.getWorldSpaceBoundingBox(a);return a},getLocalBoundingBox:function(){var a=b.create(),c=new XML3D.Box;return function(){var b=new XML3D.Box;Array.prototype.forEach.call(this.node.childNodes,
function(a){a.getLocalBoundingBox&&(c=a.getLocalBoundingBox(),b.extend(c))});this.renderNode.getLocalMatrix(a);b.transformAxisAligned(a);return b}}(),getLocalMatrix:function(){var a=new XML3D.Mat4;this.renderNode.getLocalMatrix(a.data);return a},getWorldMatrix:function(){var a=new XML3D.Mat4;this.renderNode.getWorldMatrix(a.data);return a}});m.exports=d},{"./scene-element.js":86,"gl-matrix":1}],82:[function(d,m,l){var e=d("./scene-element.js"),b=d("../../../interface/notification.js"),a=d("../scene/configuration.js"),
c=d("../../../resource");d=function(a,b){e.call(this,a,b,!1,!0);this.dataAdapter=c.getAdapter(b,"data");this.createRenderNode()};XML3D.createClass(d,e,{createRenderNode:function(){var a=this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode();this.renderNode=this.factory.getScene().createRenderLight({configuration:this.createLightConfiguration(),parent:a});this.updateVisibility();this.updateLocalMatrix()},attributeChangedCallback:function(a,c,b){e.prototype.attributeChangedCallback.call(this,
a,c,b);switch(a){case "model":this.renderNode.remove(),this.createRenderNode()}},updateVisibility:function(){var a="none"==this.style.getPropertyValue("display").trim();this.renderNode.setLocalVisible(!a)},notifyChanged:function(a){switch(a.type){case b.THIS_REMOVED:this.dispose()}},createLightConfiguration:function(){var c=this.node.hasAttribute("model")?this.node.getAttribute("model"):"urn:xml3d:light:directional",b={name:this.node.id};return new a(c,this.dataAdapter.getXflowNode(),b)},dispose:function(){this.getRenderNode().remove();
this.clearAdapterHandles()},getWorldMatrix:function(){var a=new XML3D.Mat4;this.renderNode.getWorldMatrix(a.data);return a},getLocalMatrix:function(){var a=new XML3D.Mat4;this.renderNode.getLocalMatrix(a.data);return a}});m.exports=d},{"../../../interface/notification.js":74,"../../../resource":167,"../scene/configuration.js":98,"./scene-element.js":86}],83:[function(d,m,l){var e=d("./base.js"),b=d("../../../interface/notification.js"),a=d("../../../utils/uri.js").URI,c=d("../../../base/adapterhandle.js"),
h=d("../../../resource");d=function(a,c){e.call(this,a,c);this._dataAdapter=h.getAdapter(c,"data");this._materialModel=this._materialConfiguration=null;this.updateMaterialConfiguration()};XML3D.createClass(d,e,{getMaterialConfiguration:function(){return this._materialConfiguration},updateMaterialConfiguration:function(){this.updateMaterialModel();this._materialConfiguration=this._materialModel?this.getScene().createMaterialConfiguration(this._materialModel,this._dataAdapter.getXflowNode(),{name:this.node.id}):
null;this.notifyOppositeAdapters()},updateMaterialModel:function(){this._materialModel=null;var a=this.getMaterialModel();"urn"==a.scheme?(this.disconnectAdapterHandle("model"),this._materialModel={type:"urn",urn:a}):(this.connectAdapterHandle("model",this.getAdapterHandle(a,"data",0)),(a=this.getConnectedAdapter("model"))&&a.getScriptType&&(this._materialModel={type:a.getScriptType(),script:a.getScript()}))},getMaterialModel:function(){return new a(this.node.getAttribute("model"))},attributeChangedCallback:function(a,
c,b){"model"==a&&this.updateMaterialConfiguration()},notifyChanged:function(a){switch(a.type){case b.ADAPTER_HANDLE_CHANGED:a.handleStatus==c.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find material for url '"+a.url+"'"),this.updateMaterialConfiguration()}}});m.exports=d},{"../../../base/adapterhandle.js":49,"../../../interface/notification.js":74,"../../../resource":167,"../../../utils/uri.js":186,"./base.js":78}],84:[function(d,m,l){var e=d("./scene-element.js"),b=d("../../../utils/misc.js").encodeZIndex,
a=d("../../../resource");d=function(a,b){e.call(this,a,b,!0,!0);this.createRenderNode()};XML3D.createClass(d,e,{createRenderNode:function(){var a=this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode();this.renderNode=this.getScene().createRenderObject({parent:a,node:this.node,configuration:this.createMeshConfiguration(),name:this.node.id});this.updateZIndex();this.updateVisibility();this.updateLocalMatrix();this.updateMaterialHandler()},createMeshConfiguration:function(){return{data:a.getAdapter(this.node,
"data").getXflowNode(),type:this.node.hasAttribute("type")?this.node.getAttribute("type"):"triangles"}},attributeChangedCallback:function(a,b,g){e.prototype.attributeChangedCallback.call(this,a,b,g);"type"==a&&(this.renderNode.remove(),this.createRenderNode())},updateZIndex:function(){for(var a=this.style.getPropertyValue("z-index"),a=b(a,!0),e=this.getParentRenderAdapter();e;){if(e.style){var g=e.style.getPropertyValue("z-index"),g=b(g,!1);""!=g&&(a=g+":"+a)}e=e.getParentRenderAdapter()}this.renderNode.setZIndex(a)},
notifyChanged:function(a){e.prototype.notifyChanged.call(this,a)},getLocalBoundingBox:function(){var a=new XML3D.Box;this.renderNode&&this.renderNode.visible&&this.renderNode.getObjectSpaceBoundingBox(a);return a},getWorldBoundingBox:function(){var a=new XML3D.Box;this.renderNode&&this.renderNode.visible&&this.renderNode.getWorldSpaceBoundingBox(a);return a},getWorldMatrix:function(){var a=new XML3D.Mat4,b=this.renderNode;b&&b.getWorldMatrix(a.data);return a}});m.exports=d},{"../../../resource":167,
"../../../utils/misc.js":184,"./scene-element.js":86}],85:[function(d,m,l){function e(a,c){if(a){c||a.remove();for(var b=a.getChildren(),f=b.length;f--;)e(b[f],!1)}}function b(a,f,e){if(e.postTransformXflowNode){var g=new c(e.postTransformXflowNode,["transform"],a._bindedRequestCallback);f=a.getScene().createRenderGroup({parent:f,visible:!0,name:void 0});a.postTransformXflowRequests.push(g);a.postTransformRenderGroups.push(f);a.updatePostTransform(f,g)}f=a.getScene().createRenderGroup({parent:f,visible:!0,
name:a.node.id});f.setLocalMatrix(e.transform||u);f.setMaterial(a.getMaterialConfiguration(e.material,a._subRenderNodes.length));a._subRenderNodes.push(f);for(var h=e.meshes,g=0;g<h.length;++g){var d=a.getScene().createRenderObject({parent:f,node:h[g].refNode||a.node,configuration:{data:h[g].xflowNode,type:h[g].type},name:a.node.id,visible:h[g].visible});d.setLocalMatrix(h[g].transform||u);d.setMaterial(a.getMaterialConfiguration(h[g].material,a._subRenderNodes.length));a._subRenderNodes.push(d)}e=
e.groups;for(g=0;g<e.length;++g)b(a,f,e[g])}var a=d("./scene-element.js"),c=d("../../../xflow/interface/request.js").ComputeRequest,h=d("../../../interface/notification.js"),g=d("../../../base/adapterhandle.js"),f=d("../../../utils/misc.js").encodeZIndex;l=d("gl-matrix").mat4;var k=d("../../../resource");d=function(c,b){a.call(this,c,b,!1,!0);this.asset=null;this.postTransformXflowRequests=[];this.postTransformRenderGroups=[];this.createRenderNode();this._bindedRequestCallback=this.onXflowRequestChange.bind(this);
this.transformFetcher.update()};var u=l.create();XML3D.createClass(d,a,{createRenderNode:function(){this.asset=k.getAdapter(this.node,"data").getAsset();this.asset.addChangeListener(this);var a=this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode();this.renderNode=this.getScene().createRenderGroup({parent:a,name:this.node.id});this.renderNode.setLocalMatrix(u);this.createModelRenderNodes();this.updateVisibility()},clearModelRenderNodes:function(){this.clearAdapterHandles();this._subRenderNodes=
[];for(var a=this.postTransformXflowRequests.length;a--;)this.postTransformXflowRequests[a].clear();e(this.renderNode,!0);this.postTransformXflowRequests.length=0;this.postTransformRenderGroups.length=0},createModelRenderNodes:function(){this.clearModelRenderNodes();if(!this.asset.isSubtreeLoading())try{this.asset.checkValidity();var a=this.asset.getResult().getDataTree();b(this,this.renderNode,a);this.updateZIndex()}catch(c){XML3D.debug.logError("Asset Error: "+c.message,c.node||this.node),this.clearModelRenderNodes()}},
getMaterialConfiguration:function(a,c){var b=null;if(a){var f=this.getAdapterHandle(a);this.connectAdapterHandle("material_"+c,f);switch(f.status){case g.STATUS.NOT_FOUND:XML3D.debug.logError("Could not find <material> of url '"+f.url+"' ",this.node);break;case g.STATUS.READY:(f=f.getAdapter())&&f.getMaterialConfiguration&&(b=f.getMaterialConfiguration())}}return b},updateVisibility:function(){var a="none"==this.style.getPropertyValue("display").trim(),c="hidden"==this.style.getPropertyValue("visibility").trim(),
b=!(a||c),f=function(a){a.setLocalVisible&&a.setLocalVisible(b);a.children&&a.children.forEach(f)};f(this.renderNode)},updateZIndex:function(){for(var a=this.style.getPropertyValue("z-index"),a=f(a,!0),c=this.getParentRenderAdapter();c;){if(c.style){var b=c.style.getPropertyValue("z-index"),b=f(b,!1);""!=b&&(a=b+":"+a)}c=c.getParentRenderAdapter()}var e=function(c){c.setZIndex&&c.setZIndex(a);c.children&&c.children.forEach(e)};e(this.renderNode)},notifyChanged:function(c){a.prototype.notifyChanged.call(this,
c);switch(c.type){case h.ADAPTER_HANDLE_CHANGED:var b=c.key.split("_");"material"==b[0]&&(b=this._subRenderNodes[+b[1]],XML3D.debug.assert(b),c.handleStatus==g.STATUS.NOT_FOUND?b.setMaterial(null):(c=c.adapter)&&c.getMaterialConfiguration&&b.setMaterial(c.getMaterialConfiguration()),this.factory.renderer.requestRedraw("Material model changed."))}},onAssetChange:function(){this.renderNode&&this.createModelRenderNodes()},onXflowRequestChange:function(a){var c=this.postTransformXflowRequests.indexOf(a);
-1!=c&&this.updatePostTransform(this.postTransformRenderGroups[c],a)},updatePostTransform:function(a,c){var b=c.getResult();(b=b.getOutputData("transform")&&b.getOutputData("transform").getValue())?a.setLocalMatrix(b):(XML3D.debug.logWarning("Post Transform entry does not contain any 'transform' value.",this.node),a.setLocalMatrix(u))},dispose:function(){this.asset.removeChangeListener(this);this.clearModelRenderNodes();this.getRenderNode().remove();this.clearAdapterHandles()}});XML3D.extend(d.prototype,
{getLocalBoundingBox:function(){var a=new XML3D.Box;this.renderNode&&this.renderNode.getObjectSpaceBoundingBox(a);return a},getWorldBoundingBox:function(){var a=new XML3D.Box;this.renderNode&&this.renderNode.getWorldSpaceBoundingBox(a);return a},getWorldMatrix:function(){var a=new XML3D.Mat4,c=this.renderNode;c&&c.getWorldMatrix(a.data);return a}});m.exports=d},{"../../../base/adapterhandle.js":49,"../../../interface/notification.js":74,"../../../resource":167,"../../../utils/misc.js":184,"../../../xflow/interface/request.js":192,
"./scene-element.js":86,"gl-matrix":1}],86:[function(d,m,l){var e=d("./base.js"),b=d("../../../data/transform-fetcher.js"),a=d("../../../interface/notification.js"),c=d("../../../base/adapterhandle.js");d=function(a,c,f){e.call(this,a,c);this.renderNode=null;this.style=window.getComputedStyle(c);this.materialHandler=null;this.handleMaterial=f||!1;this.transformFetcher=new b(this,"transform","transform")};XML3D.createClass(d,e,{updateMaterialHandler:function(){var a,c=this.node;a=c.getAttribute("material");
a||(c=c.getAttribute("style"))&&(c=/material\s*:\s*url\s*\(\s*(\S+)\s*\)/i.exec(c))&&(a=c[1]);a?(this.materialHandler=this.getAdapterHandle(a),this.connectAdapterHandle("material",this.materialHandler)):(this.disconnectAdapterHandle("material"),this.materialHandler=null);this.referencedMaterialChanged()},referencedMaterialChanged:function(){if(this.materialHandler)if(this.materialHandler.status===c.STATUS.NOT_FOUND)this.getRenderNode().setMaterial(null);else{var a=this.materialHandler.getAdapter();
a&&a.getMaterialConfiguration?this.getRenderNode().setMaterial(a.getMaterialConfiguration()):this.getRenderNode().setMaterial(null)}else this.getRenderNode().setMaterial(null)},onConfigured:function(){},getRenderNode:function(){this.renderNode||(this.renderNode=this.createRenderNode?this.createRenderNode():null);return this.renderNode},updateVisibility:function(){var a="none"==this.style.getPropertyValue("display").trim(),c="hidden"==this.style.getPropertyValue("visibility").trim();this.renderNode.setLocalVisible(!(a||
c))},updateZIndex:function(){},dispose:function(){e.prototype.dispose.call(this);this.getRenderNode().remove();this.transformFetcher&&this.transformFetcher.dispose();this.clearAdapterHandles()},styleChangedCallback:function(){this.updateZIndex();this.updateVisibility();this.transformFetcher&&this.transformFetcher.updateMatrix();this.factory.renderer.requestRedraw("Style changed")},updateLocalMatrix:function(){this.transformFetcher&&this.transformFetcher.update()},onTransformChange:function(a,c){"transform"==
a&&this.renderNode.setLocalMatrix(c)},attributeChangedCallback:function(a,c,b){e.prototype.attributeChangedCallback.call(this,a,c,b);"transform"==a?this.transformFetcher&&this.transformFetcher.update():"material"==a&&this.handleMaterial?(this.updateMaterialHandler(),this.factory.renderer.requestRedraw("Transformable material changed.")):"style"==a?this.traverse(function(a){a.styleChangedCallback()}):"class"!=a&&"id"!=a||this.getParentRenderAdapter().traverse(function(a){a.styleChangedCallback()})},
notifyChanged:function(c){switch(c.type){case a.ADAPTER_HANDLE_CHANGED:"material"==c.key&&(this.updateMaterialHandler(),this.factory.renderer.requestRedraw("Material reference changed."));break;case a.THIS_REMOVED:this.dispose();break;case a.NODE_INSERTED:this.initElement(c.affectedNode);break;default:XML3D.debug.logDebug("Unhandled event in SceneElementAdapter:",c)}}});m.exports=d},{"../../../base/adapterhandle.js":49,"../../../data/transform-fetcher.js":66,"../../../interface/notification.js":74,
"./base.js":78}],87:[function(d,m,l){var e=d("./scene-element.js"),b=d("../scene/configuration.js"),a=d("../../../resource");d=function(c,b){e.call(this,c,b,!1,!1);this.dataAdapter=a.getAdapter(b,"data");this.createRenderNode()};XML3D.createClass(d,e,{createRenderNode:function(){var a=this.getParentRenderAdapter(),a=a.getRenderNode?a.getRenderNode():this.factory.renderer.scene.createRootNode();this.renderNode=this.factory.renderer.scene.createRenderView({camera:this.createCameraConfiguration(),parent:a});
this.updateLocalMatrix()},createCameraConfiguration:function(){var a=this.node.hasAttribute("model")?this.node.getAttribute("model"):"urn:xml3d:view:perspective";return new b(a,this.dataAdapter.getXflowNode(),{name:this.node.id})},getViewMatrix:function(){var a=new XML3D.Mat4;this.renderNode.getWorldToViewMatrix(a.data);return a},getWorldMatrix:function(){var a=new XML3D.Mat4;this.renderNode.getViewToWorldMatrix(a.data);return a},getProjectionMatrix:function(){var a=new XML3D.Mat4;this.renderNode.getProjectionMatrix(a.data);
return a},attributeChangedCallback:function(a,b,g){e.prototype.attributeChangedCallback.call(this,a,b,g);switch(a){case "model":this.renderNode.remove(),this.createRenderNode()}}});m.exports=d},{"../../../resource":167,"../scene/configuration.js":98,"./scene-element.js":86}],88:[function(d,m,l){var e=d("./group.js"),b=d("../../../interface/notification.js");d=function(a,c){e.call(this,a,c)};XML3D.createClass(d,e,{notifyChanged:function(a){switch(a.type){case b.ADAPTER_HANDLE_CHANGED:e.prototype.notifyChanged.call(this,
a);break;case b.THIS_REMOVED:this.dispose();this.factory.renderer.requestRedraw("Web component removed");break;case b.NODE_INSERTED:if(a.affectedNode.getDestinationInsertionPoints)for(var c=a.affectedNode.getDestinationInsertionPoints(),d=0;d<c.length;d++){var g=c[d]._configured?c[d]._configured.adapters:{},f;for(f in g)g[f].notifyChanged(a)}else this.initElement(a.affectedNode);break;default:XML3D.debug.logDebug("Unhandled event in WebComponentRenderAdapter:",a)}}});m.exports=d},{"../../../interface/notification.js":74,
"./group.js":81}],89:[function(d,m,l){var e=d("./base.js"),b=d("../utils.js"),a=d("../../../interface/notification.js"),c=d("../../../utils/misc.js").dispatchCustomEvent,h=d("../../../resource/counter.js");d=function(a,c){e.call(this,a,c);this.firstLoadFired=this.fireLoadEventAfterDraw=!1};XML3D.createClass(d,e,{getParentRenderAdapter:function(){return null},activeViewChanged:function(){var a=this.node,c=a.querySelector(a.view)||a.querySelector("view");c||(XML3D.debug.logWarning("xml3d element has no view defined: creating one."),
c=a.ownerDocument.createElement("view"),a.appendChild(c),a.removeAttribute("view"));a=this.factory.getAdapter(c);this.factory.getScene().setActiveView(a.getRenderNode())},attributeChangedCallback:function(a,c,b){"view"==a&&this.activeViewChanged()},notifyChanged:function(c){switch(c.type){case a.NODE_INSERTED:this.initElement(c.mutation.target)}},onConfigured:function(){this.activeViewChanged();var a=this.onLoadComplete.bind(this);h.addLoadCompleteListener(0,a);h.addLoadCompleteListener(this.factory.canvasId,
a);this.onLoadComplete()},onLoadComplete:function(a){h.isLoadComplete(0)&&h.isLoadComplete(this.factory.canvasId)&&(this.fireLoadEventAfterDraw=!0)},onFrameDrawn:function(){this.fireLoadEventAfterDraw&&(this.fireLoadEventAfterDraw=!1,this.firstLoadFired=!0,c(this.node,"load",!1,!0,null))},getComplete:function(){return this.fireLoadEventAfterDraw||!this.firstLoadFired?!1:h.isLoadComplete(0)&&h.isLoadComplete(this.factory.canvasId)},getWorldBoundingBox:function(){var a=new XML3D.Box;Array.prototype.forEach.call(this.node.childNodes,
function(c){c.getWorldBoundingBox&&a.extend(c.getWorldBoundingBox())});return a}});d.prototype.getLocalBoundingBox=d.prototype.getWorldBoundingBox;d.prototype.getElementByPoint=function(a,c,e,d){c=b.convertPageCoords(this.node,a,c);a=c.x;c=c.y;var h=this.factory.getRenderer(),n=h.getRenderObjectFromPickingBuffer(a,c);if(n){if(e){var p=h.getWorldSpacePositionByPoint(a,c,n);XML3D.math.vec3.copy(e.data,p)}d&&(p=h.getWorldSpaceNormalByPoint(a,c,n),XML3D.math.vec3.copy(d.data,p))}else e&&(e.x=NaN,e.y=
NaN,e.z=NaN),d&&(d.x=NaN,d.y=NaN,d.z=NaN);return n?n.node:null};d.prototype.getRenderInterface=function(){return this.factory.getRenderer().getRenderInterface()};d.prototype.generateRay=function(a,c){var e=b.convertPageCoords(this.node,a,c);return this.factory.getRenderer().generateRay(e.x,e.y)};d.prototype.getElementByRay=function(){var a=XML3D.math.mat4.create(),c=XML3D.math.mat4.create();return function(b,e,d){var h=this.factory.getRenderer();h.calculateMatricesForRay(b,a,c);var p=h.getRenderObjectByRay(b,
a,c);if(null!==p&&(e||d)){if(e){var r=h.getWorldSpacePositionByRay(b,p,a,c);XML3D.math.vec3.copy(e.data,r)}d&&(r=h.getWorldSpaceNormalByRay(b,p,a,c),XML3D.math.vec3.copy(d.data,r))}else e&&(e.x=NaN,e.y=NaN,e.z=NaN),d&&(d.x=NaN,d.y=NaN,d.z=NaN);return null!==p?p.node:null}}();m.exports=d},{"../../../interface/notification.js":74,"../../../resource/counter.js":164,"../../../utils/misc.js":184,"../utils.js":112,"./base.js":78}],90:[function(d,m,l){function e(f){var e=new a,g;for(g in f){var d=f[g];if(d["default"]){var k=
e,q=g,n=d.type,d=new h(n,new b.TYPED_ARRAY_MAP[n](d["default"])),n=new c;n.data=d;n.name=q;k.appendChild(n)}}return e}var b=d("../../../xflow/interface/constants.js"),a=d("../../../xflow/interface/graph.js").DataNode,c=d("../../../xflow/interface/graph.js").InputNode,h=d("../../../xflow/interface/data.js").BufferEntry,g=d("../../../xflow/interface/request.js").ComputeRequest,f=d("../tools/frustum.js").Frustum,k=d("gl-matrix").mat4,u=d("assert"),q={projectionMatrix:{type:b.DATA_TYPE.FLOAT4X4,"default":k.perspective(k.create(),
45*Math.PI/180,1,.001,1E4)}},n={fovVertical:{type:b.DATA_TYPE.FLOAT3,"default":[45*Math.PI/180]},fovHorizontal:{type:b.DATA_TYPE.FLOAT3,"default":void 0},near:{type:b.DATA_TYPE.FLOAT3,"default":void 0},far:{type:b.DATA_TYPE.FLOAT3,"default":void 0},aspect:{type:b.DATA_TYPE.FLOAT,"default":void 0},worldBoundingBox:{type:b.DATA_TYPE.FLOAT,"default":void 0}},p=function(c,b,f,d,h){u.equal(typeof f.viewFrustumChanged,"function");u.equal(typeof d,"string");u(h);u(b);this.owner=f;this.model=d;this.scene=
b;this.parameters=Object.keys(h);c?(b=new a,b.insertBefore(e(h),null),b.insertBefore(c,null),this.dataNode=b):this.dataNode=e(h);this.dataNode.insertBefore(this.scene.data.data,null);this.cameraParameterRequest=new g(this.dataNode,this.parameters,this.cameraParametersChanged.bind(this));this.cameraParametersChanged(this.cameraParameterRequest,null)};p.prototype={cameraParametersChanged:function(a,c){c&&this.owner.viewFrustumChanged(c)},destroy:function(){this.cameraParameterRequest.clear();this.dataNode.clear()}};
d=function(a,c,b){p.call(this,a,c,b,"projective",q)};XML3D.createClass(d,p,{getProjectionMatrix:function(a){return this.cameraParameterRequest.getResult().getOutputData("projectionMatrix").getValue()},getFrustum:function(){return null}});l=function(a,c,b){p.call(this,a,c,b,"perspective",n);this.frustum=new f(.01,1E3,0,.78,1)};XML3D.createClass(l,p,{_updateFrustum:function(){var a=this.cameraParameterRequest.getResult(),c,b,f,e,g=a.getOutputData("fovHorizontal");g?b=g.getValue()[0]:c=a.getOutputData("fovVertical").getValue()[0];
(g=a.getOutputData("near"))&&(f=g.getValue()[0]);(g=a.getOutputData("far"))&&(e=g.getValue()[0]);g=a.getOutputData("aspect").getValue()[0];if(void 0==f||void 0==e)a=new XML3D.Box(a.getOutputData("worldBoundingBox").getValue()),a=this.owner.getClippingPlanes(a),f=void 0==f?a.near:f,e=void 0==e?a.far:e;this.frustum.setFrustum(f,e,b,c,g)},getProjectionMatrix:function(){this._updateFrustum();return this.frustum.getProjectionMatrix(k.create())},getFrustum:function(){this._updateFrustum();return this.frustum}});
m.exports={AbstractCameraModel:p,PerspectiveCameraModel:l,ProjectiveCameraModel:d}},{"../../../xflow/interface/constants.js":189,"../../../xflow/interface/data.js":190,"../../../xflow/interface/graph.js":191,"../../../xflow/interface/request.js":192,"../tools/frustum.js":110,assert:11,"gl-matrix":1}],91:[function(d,m,l){function e(e,g){this._xml3dElement=e;this._canvas=g;this.id=++c;this._mouseHandler=new b.MouseEventHandler(e,this);this._registerCanvasListeners(this._mouseHandler,b.EVENTS);this.hasTouchEvents()&&
(this._touchHandler=new a.TouchEventHandler(e,this),this._registerCanvasListeners(this._touchHandler,a.EVENTS))}var b=d("./events/mouse.js"),a=d("./events/touch.js"),c=0;e.prototype.hasTouchEvents=function(){return"ontouchstart"in window};e.prototype.getCanvas=function(){return this._canvas};e.prototype.dispatchEvent=function(a){this._xml3dElement.dispatchEvent(a)};e.prototype._registerCanvasListeners=function(a,c){var b=this._canvas;c.forEach(function(c){b.addEventListener(c,function(b){a[c]&&a[c].call(a,
b);b.stopPropagation()})})};e.prototype.dispatchCustomEvent=function(a,c){c=c||null;var b=document.createEvent("CustomEvent");b.initCustomEvent(a,!0,!0,c);this._xml3dElement.dispatchEvent(b)};e.prototype.dispatchResizeEvent=function(a){this.dispatchCustomEvent("resize",a)};e.prototype.dispatchFrameDrawnEvent=function(a,c,b){b=b||{count:{primitives:0,objects:0}};this.dispatchCustomEvent("framedrawn",{timeStart:a,timeEnd:c,renderTimeInMilliseconds:c-a,count:b.count})};m.exports=e},{"./events/mouse.js":93,
"./events/touch.js":94}],92:[function(d,m,l){var e=d("./renderer-factory.js");m.exports=function(b){b instanceof Array||(b=[b]);b.forEach(function(a){a._configured.canvasHandler.renderer||(XML3D.debug.logDebug("Configuring Renderer for",a.id),e.createRenderer(a))})}},{"./renderer-factory.js":97}],93:[function(d,m,l){var e=d("../../../utils/options.js"),b=d("../../../types/vec3.js");e.register("renderer-mousemove-picking",!0);e.register("renderer-movement-aware-click-handler",!1);d=function(a,c){this._defaultTarget=
a;this._canvasHandler=c;this._lastMousePosition={x:0,y:0}};var a;try{new MouseEvent("click",{}),a=!0}catch(c){a=!1}d.prototype={dispatchMouseEvent:function(a,c,b){b=b||{};c=c||this._defaultTarget;var e=void 0!==b.x?b.x:a.clientX,d=void 0!==b.y?b.y:a.clientY;b.noCopy||(a=this.copyMouseEvent(a));this.initExtendedMouseEvent(a,e,d);c.dispatchEvent(a)},copyMouseEvent:function(c){var b;a?b="[object WheelEvent]"===c.toString()?new WheelEvent(c.type,c):new MouseEvent(c.type,c):"[object WheelEvent]"===c.toString()?
(b=document.createEvent("WheelEvent"),b.initWheelEvent(c.type,c.bubbles,c.cancelable,c.view,c.detail,c.screenX,c.screenY,c.clientX,c.clientY,c.button,c.relatedTarget,"",c.deltaX,c.deltaY,c.deltaZ,c.deltaMode)):(b=document.createEvent("MouseEvent"),b.initMouseEvent(c.type,c.bubbles,c.cancelable,c.view,c.detail,c.screenX,c.screenY,c.clientX,c.clientY,c.ctrlKey,c.altKey,c.shiftKey,c.metaKey,c.button,c.relatedTarget));c.dataTransfer&&(b.data={url:c.dataTransfer.getData("URL"),text:c.dataTransfer.getData("Text")});
b.preventDefault=function(){c.preventDefault()};return b},createMouseEvent:function(c,b){b=b||{};var f={bubbles:void 0!==b.bubbles?b.bubbles:!0,cancelable:void 0!==b.cancelable?b.cancelable:!0,view:b.view||window,detail:void 0!==b.detail?b.detail:0,screenX:void 0!==b.screenX?b.screenX:0,screenY:void 0!==b.screenY?b.screenY:0,clientX:void 0!==b.clientX?b.clientX:0,clientY:void 0!==b.clientY?b.clientY:0,ctrl:void 0!==b.ctrl?b.ctrl:!1,alt:void 0!==b.alt?b.alt:!1,shift:void 0!==b.shift?b.shift:!1,meta:void 0!==
b.meta?b.meta:!1,button:void 0!==b.button?b.button:0,relatedTarget:b.relatedTarget};if(a)return new MouseEvent(c,f);var e=document.createEvent("MouseEvent");e.initMouseEvent(c,f.bubbles,f.cancelable,f.view,f.detail,f.screenX,f.screenY,f.clientX,f.clientY,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.button,f.relatedTarget);return e},initExtendedMouseEvent:function(a,c,e){var d=this._canvasHandler;(function(){var u=void 0,q=void 0;Object.defineProperty(a,"normal",{get:function(){if(!q){var a=d.getWorldSpaceNormalByPoint(c,
e);q=a?b.wrap(a):null}return q}});Object.defineProperty(a,"position",{get:function(){if(!u){var a=d.getWorldSpacePositionByPoint(c,e);u=a?b.wrap(a):null}return u}})})()},dispatchMouseEventOnPickedObject:function(a,c){c=c||{};var b=this.getMousePosition(a),e=null;c.omitUpdate||(e=this._canvasHandler.getPickObjectByPoint(b.x,b.y));this.dispatchMouseEvent(a,e&&e.node,b)},getMousePosition:function(a){return this._canvasHandler.getMousePosition(a)},mouseup:function(a){this.dispatchMouseEventOnPickedObject(a)},
mousedown:function(a){this._lastMousePosition=this.getMousePosition(a);this.dispatchMouseEventOnPickedObject(a)},click:function(a){if(!0===e.getValue("renderer-movement-aware-click-handler")){var c=this.getMousePosition(a);if(4<Math.abs(c.x-this._lastMousePosition.x)||4<Math.abs(c.y-this._lastMousePosition.y))return}this.dispatchMouseEventOnPickedObject(a)},dblclick:function(a){this.dispatchMouseEventOnPickedObject(a)},mousemove:function(a){var c=this.getMousePosition(a),b=e.getValue("renderer-mousemove-picking");
this.dispatchMouseEventOnPickedObject(a,{omitUpdate:!b});b&&(b=this._canvasHandler.getPickedObject(),b!==this.lastPickObj&&(this.lastPickObj&&this.dispatchMouseEvent(this.createMouseEvent("mouseout",{clientX:c.x,clientY:c.y,button:a.button}),this.lastPickObj),b&&this.dispatchMouseEvent(this.createMouseEvent("mouseover",{clientX:c.x,clientY:c.y,button:a.button}),b),this.lastPickObj=b))},mouseout:function(a){var c=this.getMousePosition(a);this.dispatchMouseEvent(a,this.lastPickObj,c)},mouseover:function(a){var c=
e.getValue("renderer-mousemove-picking");this.dispatchMouseEventOnPickedObject(a,{omitUpdate:!c})},wheel:function(a){this.dispatchMouseEventOnPickedObject(a,{type:"wheel"})}};m.exports={EVENTS:"click dblclick mousedown mouseup mouseover mousemove mouseout wheel".split(" "),MouseEventHandler:d}},{"../../../types/vec3.js":178,"../../../utils/options.js":185}],94:[function(d,m,l){d=function(b,a){this._defaultTarget=b;this._canvasHandler=a};var e=/iPhone|iP[oa]d/.test(navigator.userAgent)?"iOS":/Android/.test(navigator.userAgent)?
"Android":"PC";d.prototype={copyTouchEvent:function(b,a){var c=this.copyTouchEventData(b,a);return this.createTouchEvent(c)},copyTouchEventData:function(b,a){return{type:a.type||b.type,timeStamp:Date.now(),bubbles:b.bubbles,cancelable:b.cancelable,detail:b.detail,screenX:b.screenX,screenY:b.screenY,pageX:b.pageX,pageY:b.pageY,clientX:b.clientX,clientY:b.clientY,ctrlKey:b.ctrlKey,altKey:b.altKey,shiftKey:b.shiftKey,metaKey:b.metaKey,scale:b.scale,rotation:b.rotation,view:b.view,touches:b.touches,changedTouches:b.changedTouches,
targetTouches:b.targetTouches}},createTouchEvent:function(b){var a;try{a=document.createEvent("TouchEvent")}catch(c){XML3D.debug.logWarning("Create Touch Event failed, creating UI instead"),a=document.createEvent("UIEvent")}a&&a.initTouchEvent&&(0==a.initTouchEvent.length&&"iOS"!==e?a.initTouchEvent(b.touches,b.targetTouches,b.changedTouches,b.type,b.view,b.screenX,b.screenY,b.clientX,b.clientY):12==a.initTouchEvent.length?a.initTouchEvent(b.type,b.bubbles,b.cancelable,b.view,b.detail,b.ctrlKey,b.altKey,
b.shiftKey,b.metaKey,b.touches,b.targetTouches,b.changedTouches):a.initTouchEvent(b.type,b.bubbles,b.cancelable,b.view,b.detail,b.screenX,b.screenY,b.pageX,b.pageY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.touches,b.targetTouches,b.changedTouches,b.scale,b.rotation));return a},dispatchTouchEventOnPickedObject:function(b,a){a=a||{};var c=this.copyTouchEvent(b,a);c.preventDefault=function(){b.preventDefault()};this._defaultTarget.dispatchEvent(c)},touchstart:function(b){this.dispatchTouchEventOnPickedObject(b)},
touchend:function(b){this.dispatchTouchEventOnPickedObject(b)},touchmove:function(b){this.dispatchTouchEventOnPickedObject(b)},touchcancel:function(b){this.dispatchTouchEventOnPickedObject(b)}};m.exports={EVENTS:["touchstart","touchmove","touchend","touchcancel"],TouchEventHandler:d}},{}],95:[function(d,m,l){function e(){this._lights=[];this._models={};this._inUpdate=!1}e.prototype={add:function(b){this._lights.push(b);this._addModel(b.model)},remove:function(b){var a=this._lights.indexOf(b);-1!=
a&&this._lights.splice(a,1);this._removeModel(b.model)},fillGlobalParameters:function(b,a){for(var c in this._models){var e=this._models[c];if(e.changed||a){var g=c+"Light",f;for(f in e.parameters){var d=g+f.charAt(0).toUpperCase()+f.slice(1);b[d]=e.parameters[f]}e.changed=!1}}},lightValueChanged:function(b){if(!this._inUpdate){this._inUpdate=!0;var a=this;(b?[b]:this._lights).forEach(function(c){c=c.model;var b=a.getModelEntry(c.id),e=b.lightModels.indexOf(c);0>e||(c.fillLightParameters(b.parameters,
e),c.getLightData(b.parameters,e),b.changed=!0)});this._inUpdate=!1}},getModelEntry:function(b){return this._models[b]},getModels:function(b){return Object.keys(this._models)},getModelCount:function(b){return(b=this.getModelEntry(b))?b.lightModels.length:0},_addModel:function(b){var a=this._models[b.id];a||(a=this._models[b.id]={lightModels:[],parameters:{}});a.lightModels.push(b);this._lightStructureChanged(a)},_removeModel:function(b){var a=this.getModelEntry(b.id);b=a.lightModels.indexOf(b);-1!=
b&&a.lightModels.splice(b,1);this._lightStructureChanged(a)},_lightStructureChanged:function(b){this._inUpdate=!0;var a=b.lightModels.length;a?(b.parameters=b.lightModels[0].allocateParameterArray(a),b.lightModels.forEach(function(a,e){a.fillLightParameters(b.parameters,e);a.getLightData(b.parameters,e)}),b.changed=!0):b.parameters={};this._inUpdate=!1}};m.exports=e},{}],96:[function(d,m,l){function e(a){var b=new h,e;for(e in a){var d=a[e],k=b,q=e,n=d.type,d=new f(n,new c.TYPED_ARRAY_MAP[n](d["default"])),
n=new g;n.data=d;n.name=q;k.appendChild(n)}return b}function b(a,c,b){a.getWorldMatrix(x);c&&q.transformMat4(c,c,x);b&&(XML3D.math.vec3.transformDirection(b,b,x),q.normalize(b,b))}var a=d("../tools/frustum.js").Frustum,c=d("../../../xflow/interface/constants.js"),h=d("../../../xflow/interface/graph.js").DataNode,g=d("../../../xflow/interface/graph.js").InputNode,f=d("../../../xflow/interface/data.js").BufferEntry,k=d("../../../xflow/interface/request.js").ComputeRequest,u=d("gl-matrix").mat4,q=d("gl-matrix").vec3,
n=d("gl-matrix").quat,p={intensity:{type:c.DATA_TYPE.FLOAT3,"default":[1,1,1]},attenuation:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,1]},position:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,0]},shadowBias:{type:c.DATA_TYPE.FLOAT,"default":[1E-4]},direction:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,-1]},castShadow:{type:c.DATA_TYPE.BOOL,"default":[!1]},on:{type:c.DATA_TYPE.BOOL,"default":[!0]},matrix:{type:c.DATA_TYPE.FLOAT4X4,"default":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},nearFar:{type:c.DATA_TYPE.FLOAT2,"default":[1,
100]}},r={intensity:{type:c.DATA_TYPE.FLOAT3,"default":[1,1,1]},attenuation:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,1]},position:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,0]},direction:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,-1]},cutoffAngle:{type:c.DATA_TYPE.FLOAT,"default":[Math.PI/4]},softness:{type:c.DATA_TYPE.FLOAT,"default":[0]},shadowBias:{type:c.DATA_TYPE.FLOAT,"default":[1E-4]},castShadow:{type:c.DATA_TYPE.BOOL,"default":[!1]},matrix:{type:c.DATA_TYPE.FLOAT4X4,"default":[1,0,0,0,0,1,0,0,0,
0,1,0,0,0,0,1]},on:{type:c.DATA_TYPE.BOOL,"default":[!0]}},t={intensity:{type:c.DATA_TYPE.FLOAT3,"default":[1,1,1]},direction:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,-1]},shadowBias:{type:c.DATA_TYPE.FLOAT,"default":[1E-4]},position:{type:c.DATA_TYPE.FLOAT3,"default":[0,0,0]},castShadow:{type:c.DATA_TYPE.BOOL,"default":[!1]},on:{type:c.DATA_TYPE.BOOL,"default":[!0]},matrix:{type:c.DATA_TYPE.FLOAT4X4,"default":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},v=function(a,c,b,f){this.id=a;this.light=c;this.configuration=
f;this.parameters=Object.keys(f);b?(a=new h,a.insertBefore(e(f),null),a.insertBefore(b,null),this.dataNode=a):this.dataNode=e(f);this.fovy=Math.PI/2;this.lightParameterRequest=new k(this.dataNode,this.parameters,this.lightParametersChanged.bind(this));this.lightParametersChanged(this.lightParameterRequest,null)};v.prototype={fillLightParameters:function(a,b){var e=this.lightParameterRequest.getResult();this.parameters.forEach(function(f){var g=e.getOutputData(f),d=c.DATA_TYPE_TUPLE_SIZE[g.type],g=
g.getValue();a[f].set(g.subarray(0,d),b*d)});this.transformParameters(a,b)},allocateParameterArray:function(a){var b={},e=this.configuration;this.parameters.forEach(function(f){var g=e[f].type;b[f]=new c.TYPED_ARRAY_MAP[g](c.DATA_TYPE_TUPLE_SIZE[g]*a)});return b},getParameter:function(a){return a in this.configuration?this.lightParameterRequest.getResult().getOutputData(a).getValue():null},lightParametersChanged:function(a,c){c&&this.light.lightValueChanged()},_expandNearFar:function(a){var c=Math.max(.3*
(a.far-a.near),.05);a.near-=c;a.far+=c},getLightData:function(a,c){var b=a.matrix.subarray(16*c,16*c+16);this.getLightViewProjectionMatrix(b)},getLightViewProjectionMatrix:function(a){var c=u.create(),b=u.create();this.getLightViewMatrix(c);this.getLightProjectionMatrix(b);XML3D.math.mat4.multiply(a,b,c)},getLightProjectionMatrix:function(a){this.light.getFrustum(1).getProjectionMatrix(a)},getLightViewMatrix:function(){var a=u.create();return function(c){var b=this.getParameter("direction"),e=this.getParameter("position");
this.light.getWorldMatrix(c);b=XML3D.math.quat.rotationTo(n.create(),y,b);u.fromRotationTranslation(a,b,e);u.mul(c,c,a);u.invert(c,c)}}()};var x=u.create(),y=q.fromValues(0,0,-1);d=function(a,c){v.call(this,"point",c,a,p)};XML3D.createClass(d,v,{getFrustum:function(c,b){var e=this.light.scene.lights.getModelEntry(this.id);if(b.isEmpty())return e.parameters.nearFar[0]=1,e.parameters.nearFar[1]=110,new a(1,110,0,this.fovy,c,!1);var f=u.create();this.getLightViewMatrix(f);b.transformAxisAligned(f);f=
{near:-b.max.z,far:-b.min.z};this._expandNearFar(f);1>f.far&&(f.far=110);e.parameters.nearFar[0]=1;e.parameters.nearFar[1]=f.far;return new a(1,f.far,0,this.fovy,c,!1)},transformParameters:function(a,c){var e=a.position.subarray(3*c,3*c+3);b(this.light,e,null);a.on[c]=this.light.visible}});l=function(a,c){v.call(this,"spot",c,a,r)};XML3D.createClass(l,v,{getFrustum:function(c,b){if(b.isEmpty())return new a(1,110,0,this.fovy,c,!1);var e=u.create();this.getLightViewMatrix(e);b.transformAxisAligned(e);
e={near:-b.max.z,far:-b.min.z};this._expandNearFar(e);1>e.far&&(e.far=110);return new a(1,e.far,0,this.fovy,c,!1)},transformParameters:function(a,c){var e=a.position.subarray(3*c,3*c+3),f=a.direction.subarray(3*c,3*c+3);b(this.light,e,f);a.on[c]=this.light.visible},lightParametersChanged:function(a,c){this.fovy=2*this.getParameter("cutoffAngle")[0];v.prototype.lightParametersChanged.call(this,a,c)}});var w=function(a,c){v.call(this,"directional",c,a,t)};XML3D.createClass(w,v,{getFrustum:function(c,
b){if(b.isEmpty())return new a(1,110,0,this.fovy,c,!0);var e=u.create();this.getLightViewMatrix(e);b.transformAxisAligned(e);e={near:-b.max.z,far:-b.min.z};this._expandNearFar(e);1>e.far&&(e.far=110);return new a(1,e.far,0,this.fovy,c,!0)},transformParameters:function(a,c){var e=a.direction.subarray(3*c,3*c+3);b(this.light,null,e);a.on[c]=this.light.visible},getLightViewMatrix:function(a){var c=this.light.scene.lights.getModelEntry(this.id),b=c.parameters.direction,e=c.parameters.position,f=new XML3D.Box;
this.light.scene.getBoundingBox(f);var g=q.create(),d=f.center(),f=f.size(),f=f.length();q.scale(g,b,-.55*f);e=q.add(e,d.data,g);c.parameters.position=e;u.identity(a);g=u.create();d=q.fromValues(0,1,0);0==b[0]&&0==b[2]&&(d=q.fromValues(0,0,1));var f=q.create(),h=q.len(b);q.scale(f,b,-q.dot(d,b)/(h*h));q.add(f,f,d);q.normalize(f,f);u.lookAt(g,q.fromValues(0,0,0),b,f);u.invert(g,g);u.translate(a,a,e);u.multiply(a,a,g);f=new XML3D.Box;this.light.scene.getBoundingBox(f);f.transformAxisAligned(a);f=f.size().data;
g=f[0]>f[1]?f[0]:f[1];g*=.55;this.fovy=0>=g?Math.PI:2*Math.atan(g);c.parameters.direction=b;c.parameters.position=e;u.invert(a,a)}});m.exports={PointLightModel:d,SpotLightModel:l,DirectionalLightModel:w}},{"../../../xflow/interface/constants.js":189,"../../../xflow/interface/data.js":190,"../../../xflow/interface/graph.js":191,"../../../xflow/interface/request.js":192,"../tools/frustum.js":110,"gl-matrix":1}],97:[function(d,m,l){var e=d("../webgl/renderer.js"),b=d("../webgl/canvas-handler.js");m.exports=
new function(){this.createRenderer=function(a){var c=new b(a,a._configured.canvas),d=new e(a,c);c.setRenderer(d);a._configured.canvasHandler=c;window.requestAnimationFrame(c.tick);return d}}},{"../webgl/canvas-handler.js":120,"../webgl/renderer.js":153}],98:[function(d,m,l){var e=d("../../webgl/base/utils.js").getUniqueCounter();m.exports=function(b,a,c){c=c||{};this.id=e();this.model=b;this.dataNode=a;this.name=c.name||null}},{"../../webgl/base/utils.js":119}],99:[function(d,m,l){m.exports={NODE_TYPE:{GROUP:"group",
OBJECT:"object",LIGHT:"light",VIEW:"view"},EVENT_TYPE:{VIEW_CHANGED:"view_changed",LIGHT_STRUCTURE_CHANGED:"light_structure_changed",LIGHT_VALUE_CHANGED:"light_value_changed",SCENE_SHAPE_CHANGED:"scene_shape_changed",SCENE_STRUCTURE_CHANGED:"scene_structure_changed",DRAWABLE_STATE_CHANGED:"drawable_state_changed",OPACITY_STATE_CHANGED:"opacity_state_changed"}}},{}],100:[function(d,m,l){var e=d("events").EventEmitter;d=function(b,a){e.call(this);this.context=b;this._type=a;this._valid=!1;this.setMaxListeners(0)};
d.TYPES={MESH:"mesh",VOLUME:"volume"};d.READY_STATE={COMPLETE:"complete",INCOMPLETE:"incomplete"};XML3D.createClass(d,e,{getType:function(){return this._type},isValid:function(){return this._valid},setShaderComposer:function(b){},update:function(b){}});m.exports=d},{events:12}],101:[function(d,m,l){d=function(e){e=e||{};this.pageSize=e.pageSize||4096;this.pages=[];this.nextOffset=0;this.freeEntries=[];this.addPage()};XML3D.extend(d.prototype,{addPage:function(){var e=new Float32Array(this.pageSize);
this.pages.push(e);this.nextOffset=0;XML3D.debug.logInfo("Adding page",this.pages.length,"(",this.pageSize*Float32Array.BYTES_PER_ELEMENT*this.pages.length/1024,"kB)")},getPageEntry:function(e){if(!e)throw Error("No size given for page entry");return this.reusePageEntry(e)||this.createPageEntry(e)},reusePageEntry:function(e){return(e=this.freeEntries[e])&&e.length?e.pop():null},createPageEntry:function(e){if(this.nextOffset+e>this.pageSize)return this.addPage(),this.getPageEntry(e);var b=this.pages[this.pages.length-
1],a=this.nextOffset;this.nextOffset+=e;return{page:b,offset:a,size:e}},freePageEntry:function(e){var b=this.freeEntries[e.size];b||(b=this.freeEntries[e.size]=[]);b.push(e)}});m.exports=d},{}],102:[function(d,m,l){var e=d("./rendernode.js");d=d("./constants.js");var b=d.NODE_TYPE,a=d.EVENT_TYPE;d=function(a,d,g){e.call(this,b.GROUP,a,d,g);g=g||{};this._material=g.material||null;this.boundingBoxDirty=!1;this.setWorldSpaceBoundingBox(XML3D.Box.EMPTY_BOX)};d.ENTRY_SIZE=38;XML3D.createClass(d,e);XML3D.extend(d.prototype,
{getLocalMatrix:function(a){for(var b=this.offset+16,e=0;16>e;e++,b++)a[e]=this.page[b]},setLocalMatrix:function(a){for(var b=this.offset+16,e=0;16>e;e++,b++)this.page[b]=a[e];this.setTransformDirty();this.setBoundingBoxDirty()},getWorldSpaceBoundingBox:function(a){this.boundingBoxDirty&&this.updateWorldSpaceBoundingBox();var b=this.offset+32;a.data[0]=this.page[b];a.data[1]=this.page[b+1];a.data[2]=this.page[b+2];a.data[3]=this.page[b+3];a.data[4]=this.page[b+4];a.data[5]=this.page[b+5]},setWorldSpaceBoundingBox:function(a){var b=
this.offset+32;this.page[b]=a.data[0];this.page[b+1]=a.data[1];this.page[b+2]=a.data[2];this.page[b+3]=a.data[3];this.page[b+4]=a.data[4];this.page[b+5]=a.data[5]},updateWorldSpaceBoundingBox:function(){var a=new XML3D.Box;return function(){for(var b=new XML3D.Box,e=0,f=this.children.length;e<f;e++)this.children[e].getWorldSpaceBoundingBox(a),b.extend(a);this.setWorldSpaceBoundingBox(b);this.boundingBoxDirty=!1}}(),addChild:function(c){this.children.push(c);this.setBoundingBoxDirty();this.scene.emit(a.SCENE_STRUCTURE_CHANGED,
c,!1)},removeChild:function(c){var b=this.children.indexOf(c);-1!=b&&this.children.splice(b,1);this.scene.emit(a.SCENE_STRUCTURE_CHANGED,c,!0)},getChildren:function(){return this.children},updateWorldMatrix:function(a){var b=this.page,e=this.offset;XML3D.math.mat4.multiplyOffset(b,e+0,b,e+16,a,0);this.transformDirty=!1},setTransformDirty:function(){if(!this.transformDirty){this.transformDirty=!0;for(var a=this.children,b=0,e=a.length;b<e;b++)a[b].setTransformDirty()}},setMaterial:function(a){this._material!==
a&&(this._material=a,this.children.forEach(function(a){a.parentMaterialChanged&&a.parentMaterialChanged()}))},parentMaterialChanged:function(){this._material||this.children.forEach(function(a){a.parentMaterialChanged&&a.parentMaterialChanged()})},getMaterial:function(){return this._material||this.parent.getMaterial()},visibilityChanged:function(){for(var a=this.children,b=0,e=a.length;b<e;b++)a[b].evaluateVisibility()},setBoundingBoxDirty:function(){this.boundingBoxDirty=!0;this.parent&&this.parent.setBoundingBoxDirty()},
findRayIntersections:function(){var a=new XML3D.Box;return function(b,e){this.getWorldSpaceBoundingBox(a);if(b.intersects(a))for(var f=0;f<this.children.length;f++)this.children[f].findRayIntersections(b,e)}}()});m.exports=d},{"./constants.js":99,"./rendernode.js":104}],103:[function(d,m,l){var e=d("./rendernode.js");l=d("./constants.js");var b=d("../lights/light-models.js"),a=l.NODE_TYPE,c=l.EVENT_TYPE,h=XML3D.math.mat4.create(),g=XML3D.math.mat4.create(),f=new XML3D.Box;d=function(c,b,f){e.call(this,
a.LIGHT,c,b,f);f=f||{};c=f.configuration||{};this.setLocalMatrix(g);this.setWorldMatrix(g);this.setLightType(c.model,c.dataNode)};d.ENTRY_SIZE=32;XML3D.createClass(d,e);XML3D.extend(d.prototype,{setLightType:function(a,c){if(this.model){if(this.model.id==a)return;this.scene.lights.remove(this);this.lightStructureChanged(!0)}var e;a:switch(a){case "urn:xml3d:light:point":e=new b.PointLightModel(c,this);break a;case "urn:xml3d:light:spot":e=new b.SpotLightModel(c,this);break a;case "urn:xml3d:light:directional":e=
new b.DirectionalLightModel(c,this);break a;default:XML3D.debug.logWarning("Unknown light model: ",a,". Using directional instead."),e=new b.DirectionalLightModel(c,this)}this.model=e;this.scene.lights.add(this);this.lightStructureChanged(!1)},getLocalMatrix:function(a){for(var c=this.offset+16,b=0;16>b;b++,c++)a[b]=this.page[c]},setLocalMatrix:function(a){for(var c=this.offset+16,b=0;16>b;b++,c++)this.page[c]=a[b];this.setTransformDirty()},getFrustum:function(a){this.scene.getBoundingBox(f);return this.model.getFrustum(a,
f)},lightValueChanged:function(){this.model&&this.scene.emit(c.LIGHT_VALUE_CHANGED,this)},lightStructureChanged:function(a){this.scene.emit(c.LIGHT_STRUCTURE_CHANGED,this,a)},updateWorldMatrix:function(a){var c=this.page,b=this.offset;XML3D.math.mat4.multiplyOffset(c,b+0,c,b+16,a,0);this.lightValueChanged();this.transformDirty=!1},visibilityChanged:function(a){this.lightValueChanged()},setTransformDirty:function(){this.parent.getWorldMatrix(h);this.updateWorldMatrix(h)},remove:function(){this.parent.removeChild(this);
this.scene.lights.remove(this);this.lightStructureChanged(!0)},getWorldSpaceBoundingBox:function(a){a.setEmpty()}});m.exports=d},{"../lights/light-models.js":96,"./constants.js":99,"./rendernode.js":104}],104:[function(d,m,l){d=function(e,b,a,c){c=c||{};this.scene=b;this.type=e;this.name=c.name||"";this.page=a.page;this.offset=a.offset;this.entrySize=a.size;this.transformDirty=!0;this.children=[];this.parent=null;this.setParent(c.parent||b.rootNode);this.localVisible=void 0!==c.visible?c.visible:
!0;this.visible=!0;this.evaluateVisibility()};XML3D.extend(d.prototype,{getChildren:function(){return this.children},evaluateVisibility:function(){var e=this.visible;this.visible=this.parent&&!this.parent.visible?!1:this.localVisible;e!==this.visible&&(this.visibilityChanged(),this.scene.requestRedraw&&this.scene.requestRedraw("Visibility changed."))},setLocalVisible:function(e){this.localVisible!==e&&(this.localVisible=e,this.evaluateVisibility())},visibilityChanged:function(){},getParent:function(){return this.parent},
setParent:function(e){(this.parent=e)&&e.addChild&&e.addChild(this);this.evaluateVisibility()},traverse:function(e){e(this);this.children.forEach(function(b){b.traverse(e)})},setMat4InPage:function(e,b){for(var a=this.offset+b,c=0;16>c;c++,a++)this.page[a]=e[c]},getMat4FromPage:function(e,b){for(var a=this.offset+b,c=0;16>c;c++,a++)e[c]=this.page[a]},getWorldMatrix:function(e){this.transformDirty&&(this.parent.getWorldMatrix(e),this.updateWorldMatrix(e));this.getMat4FromPage(e,0)},setWorldMatrix:function(e){this.setMat4InPage(e,
0);this.transformDirty=!1;this.setBoundingBoxDirty&&this.setBoundingBoxDirty()},setTransformDirty:function(){this.transformDirty=!0},remove:function(){this.parent.removeChild(this);this.scene.pager.freePageEntry({page:this.page,offset:this.offset,size:this.entrySize});this.node&&(this.node=null)},findRayIntersections:function(){}});m.exports=d},{}],105:[function(d,m,l){var e=d("../../webgl/system/system-notifier.js"),b=d("./rendernode.js"),a=d("./drawableclosure.js"),c=d("./constants.js"),h=d("gl-matrix").mat4,
g=function(a,e,g){b.call(this,c.NODE_TYPE.OBJECT,a,e,g);g=g||{};this.node=g.node;this.configuration=g.configuration||{data:null,type:"triangles"};this.boundingBoxDirty=this.transformDirty=!0;this.drawable=this.createDrawable();this._material=g.material||null;this._zIndex=g.zIndex||"0";this._actualMaterial=null;this.pickId=-1;this.initMaterial();this.override=null};g.ENTRY_SIZE=108;g.IDENTITY_MATRIX=h.create();XML3D.createClass(g,b,{createDrawable:function(){var b=this.scene.createDrawable(this);if(b){var e=
this;b.on(c.EVENT_TYPE.DRAWABLE_STATE_CHANGED,function(c,b){c===a.READY_STATE.COMPLETE?e.scene.moveFromQueueToReady(e):c===a.READY_STATE.INCOMPLETE&&b===a.READY_STATE.COMPLETE&&e.scene.moveFromReadyToQueue(e)});b.updateTypeRequest();b.calculateBoundingBox();b.on(c.EVENT_TYPE.SCENE_SHAPE_CHANGED,function(a){e.scene.emit(c.EVENT_TYPE.SCENE_SHAPE_CHANGED)});b.on(c.EVENT_TYPE.OPACITY_STATE_CHANGED,function(a,c){e.override=e.override||{};e.override.opacity=c})}return b},getLocalMatrix:function(a){this.getMat4FromPage(a,
16)},setLocalMatrix:function(a){this.setMat4InPage(a,16);this.setTransformDirty();this.setBoundingBoxDirty()},dispose:function(){this.scene.remove(this)},onTransformDataChange:function(){this.setTransformDirty()},getModelViewMatrix:function(a){this.getMat4FromPage(a,44)},getModelMatrixN:function(a){var c=this.offset+76;a[0]=this.page[c];a[1]=this.page[c+1];a[2]=this.page[c+2];a[3]=this.page[c+4];a[4]=this.page[c+5];a[5]=this.page[c+6];a[6]=this.page[c+8];a[7]=this.page[c+9];a[8]=this.page[c+10]},
getModelViewMatrixN:function(a){var c=this.offset+92;a[0]=this.page[c];a[1]=this.page[c+1];a[2]=this.page[c+2];a[3]=this.page[c+4];a[4]=this.page[c+5];a[5]=this.page[c+6];a[6]=this.page[c+8];a[7]=this.page[c+9];a[8]=this.page[c+10]},getModelViewProjectionMatrix:function(a){this.getMat4FromPage(a,60)},updateWorldSpaceMatrices:function(a,c){this.transformDirty&&this.updateWorldMatrix();this.updateModelViewMatrix(a);this.updateModelMatrixN();this.updateModelViewMatrixN();this.updateModelViewProjectionMatrix(c)},
updateWorldMatrix:function(){var a=h.create();return function(){this.parent.getWorldMatrix(a);XML3D.math.mat4.multiplyOffset(a,0,this.page,this.offset+16,a,0);this.setWorldMatrix(a);this.boundingBoxDirty=!0;this.transformDirty=!1}}(),updateModelViewMatrix:function(a){this.transformDirty&&this.updateWorldMatrix();var c=this.page,b=this.offset;XML3D.math.mat4.multiplyOffset(c,b+44,c,b+0,a,0)},updateModelMatrixN:function(){var a=h.create();return function(){this.getWorldMatrix(a);h.invert(a,a);var c=
a?h.transpose(a,a):g.IDENTITY_MATRIX;this.setMat4InPage(c,76)}}(),updateModelViewMatrixN:function(){var a=h.create();return function(){this.getModelViewMatrix(a);h.invert(a,a);var c=a?h.transpose(a,a):g.IDENTITY_MATRIX;this.setMat4InPage(c,92)}}(),updateModelViewProjectionMatrix:function(a){var c=this.page,b=this.offset;XML3D.math.mat4.multiplyOffset(c,b+60,c,b+44,a,0)},setTransformDirty:function(){this.transformDirty=!0;this.setBoundingBoxDirty();this.scene.emit(c.EVENT_TYPE.SCENE_SHAPE_CHANGED);
this.scene.requestRedraw("Transformation changed")},setObjectSpaceBoundingBox:function(a){var c=this.offset+32;this.page[c]=a.data[0];this.page[c+1]=a.data[1];this.page[c+2]=a.data[2];this.page[c+3]=a.data[3];this.page[c+4]=a.data[4];this.page[c+5]=a.data[5];this.setBoundingBoxDirty()},getObjectSpaceBoundingBox:function(a){var c=this.offset+32;a.data[0]=this.page[c];a.data[1]=this.page[c+1];a.data[2]=this.page[c+2];a.data[3]=this.page[c+3];a.data[4]=this.page[c+4];a.data[5]=this.page[c+5]},setBoundingBoxDirty:function(){this.boundingBoxDirty=
!0;this.parent.setBoundingBoxDirty()},setWorldSpaceBoundingBox:function(a){var c=this.offset+38;this.page[c]=a.data[0];this.page[c+1]=a.data[1];this.page[c+2]=a.data[2];this.page[c+3]=a.data[3];this.page[c+4]=a.data[4];this.page[c+5]=a.data[5]},getWorldSpaceBoundingBox:function(a){this.boundingBoxDirty&&this.updateWorldSpaceBoundingBox();var c=this.offset+38;a.data[0]=this.page[c];a.data[1]=this.page[c+1];a.data[2]=this.page[c+2];a.data[3]=this.page[c+3];a.data[4]=this.page[c+4];a.data[5]=this.page[c+
5]},updateWorldSpaceBoundingBox:function(){var a=new XML3D.Box,c=h.create();return function(){this.visible?(this.getObjectSpaceBoundingBox(a),this.getWorldMatrix(c),a.transformAxisAligned(c)):a.setEmpty();this.setWorldSpaceBoundingBox(a);this.boundingBoxDirty=!1}}(),visibilityChanged:function(){this.setBoundingBoxDirty()},getProgram:function(){return this.drawable.getProgram()},hasTransparency:function(){if(this.override&&void 0!==this.override.opacity)return 1>this.override.opacity[0];var a=this.getProgram();
return a?a.hasTransparency():!1},updateForRendering:function(){e.setNode(this.node);try{this.drawable&&this.drawable.update(this.scene)}catch(a){XML3D.debug.logError("Mesh Error: "+a.message,this.node)}e.setNode(null)},findRayIntersections:function(){var a=new XML3D.Box,c={dist:0};return function(b,e){this.getWorldSpaceBoundingBox(a);b.intersects(a,c)&&e.push(this)}}(),setMaterial:function(a){this._material!==a&&(this._actualMaterial=(this._material=a)?a:this.parent.getMaterial(),this.materialChanged())},
setZIndex:function(a){this._zIndex=a},parentMaterialChanged:function(){this._material||this.initMaterial()},initMaterial:function(){this._actualMaterial=this._material?this._material:this.parent.getMaterial();this.materialChanged()},materialChanged:function(){XML3D.debug.logDebug("material changed",this._actualMaterial);if(this.drawable){var a=this.scene.shaderFactory.createComposerFromMaterialConfiguration(this._actualMaterial);this.drawable.setShaderComposer(a)}},remove:function(){this.parent.removeChild(this);
this.scene.pager.freePageEntry({page:this.page,offset:this.offset,size:this.entrySize});this.drawable&&this.drawable.destroy()}});m.exports=g},{"../../webgl/system/system-notifier.js":160,"./constants.js":99,"./drawableclosure.js":100,"./rendernode.js":104,"gl-matrix":1}],106:[function(d,m,l){var e=d("./rendernode.js"),b=d("../cameras/camera-models.js");l=d("./constants.js");var a=d("gl-matrix").vec3,c=d("gl-matrix").mat4,h=l.NODE_TYPE,g={model:"urn:xml3d:view:perspective",dataNode:null};d=function(f,
d,u){e.call(this,h.VIEW,f,d,u);u=u||{};this.lastAspectRatio=1;this.projectionDirty=!0;a:switch(d=u.camera?u.camera:g,d.model){case "urn:xml3d:view:perspective":f=new b.PerspectiveCameraModel(d.dataNode,f,this);break a;case "urn:xml3d:view:projective":f=new b.ProjectiveCameraModel(d.dataNode,f,this);break a;default:XML3D.debug.logWarning("Unknown camera model:",d.model),f=new b.PerspectiveCameraModel(d.dataNode,f,this)}this.camera=f;this.localMatrix=c.create();this.worldSpacePosition=a.create();this.viewDirty=
!0;this.frustum=null};d.ENTRY_SIZE=48;XML3D.createClass(d,e);XML3D.extend(d.prototype,{setLocalMatrix:function(a){this.localMatrix=a;this.setTransformDirty()},getFrustum:function(){return this.frustum},updateViewMatrix:function(){var b=c.create(),e=c.create();return function(){c.copy(b,this.localMatrix);this.parent.getWorldMatrix(e);c.multiply(b,e,b);a.set(this.worldSpacePosition,b[12],b[13],b[14]);this.setViewToWorldMatrix(b);c.invert(b,b);this.setWorldToViewMatrix(b);this.viewDirty=!1;this.viewFrustumChanged()}}(),
setWorldToViewMatrix:function(a){this.setMat4InPage(a,16)},setViewToWorldMatrix:function(a){this.setMat4InPage(a,0)},setProjectionMatrix:function(a){this.setMat4InPage(a,32);this.projectionDirty=!1},setTransformDirty:function(){this.viewDirty=!0;this.scene.requestRedraw("view pose changed")},getViewToWorldMatrix:function(a){this.viewDirty&&this.updateViewMatrix();this.getMat4FromPage(a,0)},getWorldToViewMatrix:function(a){this.viewDirty&&this.updateViewMatrix();this.getMat4FromPage(a,16)},getProjectionMatrix:function(a,
b){if(this.projectionDirty||.001<Math.abs(b-this.lastAspectRatio))(this.frustum=this.camera.getFrustum(b))?this.setProjectionMatrix(this.frustum.getProjectionMatrix(c.create())):this.setProjectionMatrix(this.camera.getProjectionMatrix()),this.lastAspectRatio=b;this.getMat4FromPage(a,32)},getWorldSpacePosition:function(){return this.worldSpacePosition},getWorldSpaceBoundingBox:function(a){a.setEmpty()},viewFrustumChanged:function(){this.projectionDirty=!0;this.scene.requestRedraw("view frustum changed")},
getClippingPlanes:function(a){a||(a=new XML3D.Box,this.scene.getBoundingBox(a));if(a.isEmpty())return{near:1,far:10};var b=c.create();this.getWorldToViewMatrix(b);a.transformAxisAligned(b);b=-a.max.z;a=-a.min.z;var e=Math.max(.005*(a-b),.05),b=Math.max(b-e,e,.01);a=Math.max(a+e,b+e);return{near:b,far:a}},remove:function(){this.camera.destroy()}});m.exports=d},{"../cameras/camera-models.js":90,"./constants.js":99,"./rendernode.js":104,"gl-matrix":1}],107:[function(d,m,l){function e(a,c,b,e){Object.defineProperty(a,
c,{get:function(){return b.getOutputData(c).getValue()[0]},set:function(a){e.data.setValue(new Float32Array([a]))}})}function b(a,c,b,e){var d=new f;d.data=new g(b,e);d.name=c;a.appendChild(d);return d}var a=d("../../../xflow/interface/graph.js").DataNode,c=d("../../../xflow/interface/request.js").ComputeRequest,h=d("../../../xflow/interface/constants.js"),g=d("../../../xflow/interface/data.js").BufferEntry,f=d("../../../xflow/interface/graph.js").InputNode,k=["width","height","aspect","worldBoundingBox"];
m.exports=function(){this.data=new a(!1);var f=b(this.data,"width",h.DATA_TYPE.FLOAT,new Float32Array([600])),d=b(this.data,"height",h.DATA_TYPE.FLOAT,new Float32Array([800])),g=b(this.data,"worldBoundingBox",h.DATA_TYPE.FLOAT,(new XML3D.Box).data),p=this.result=(new c(this.data,k,null)).getResult();e(this,"width",p,f);e(this,"height",p,d);Object.defineProperty(this,"worldBoundingBox",{get:function(){return p.getOutputData("worldBoundingBox").getValue()},set:function(a){g.data.setValue(a)}});Object.defineProperty(this,
"aspect",{writeable:!1,get:function(){return p.getOutputData("aspect").getValue()[0]}});this.data.setCompute("aspect = xflow.div(width, height)")}},{"../../../xflow/interface/constants.js":189,"../../../xflow/interface/data.js":190,"../../../xflow/interface/graph.js":191,"../../../xflow/interface/request.js":192}],108:[function(d,m,l){var e=d("./pager.js"),b=d("./renderobject.js"),a=d("./renderview.js"),c=d("./rendergroup.js"),h=d("./renderlight.js"),g=d("./configuration.js"),f=d("../lights/light-manager.js"),
k=d("./constants.js"),u=d("../../../xflow/interface/graph.js").InputNode,q=d("../../../xflow/interface/graph.js").DataNode,n=d("../../../xflow/interface/data.js").BufferEntry,p=d("./scene-data.js"),r=d("../../../xflow/interface/constants.js"),t=d("../../../utils/uri.js").URI,v=d("events").EventEmitter,x=d("gl-matrix").mat4,y=d("assert");d=function(){v.call(this);this.boundingBox=new XML3D.Box;this.lights=new f;this.pager=new e;this._defaultMaterial=this.activeView=null;this.rootNode=this.createRootNode();
var a=this.data=new p;Object.defineProperty(this,"width",{get:function(){return a.width},set:function(c){a.width=c}});Object.defineProperty(this,"height",{get:function(){return a.height},set:function(c){a.height=c}})};XML3D.createClass(d,v,{getActiveView:function(){return this.activeView},setActiveView:function(a){a!=this.activeView&&(y(a,"Active view must not be null"),this.activeView=a,this.emit(k.EVENT_TYPE.VIEW_CHANGED,this.activeView))},createRenderObject:function(a){var c=this.pager.getPageEntry(b.ENTRY_SIZE);
return new b(this,c,a)},createRenderGroup:function(a){var b=this.pager.getPageEntry(c.ENTRY_SIZE);return new c(this,b,a)},createRenderView:function(c){var b=this.pager.getPageEntry(a.ENTRY_SIZE);return new a(this,b,c)},createRenderLight:function(a){var c=this.pager.getPageEntry(h.ENTRY_SIZE);return new h(this,c,a)},createMaterialConfiguration:function(a,c,b){return new g(a,c,b)},createRootNode:function(){var a=this.pager.getPageEntry(c.ENTRY_SIZE),a=new c(this,a,{material:this.getDefaultMaterial(),
name:"@scene"});a.setWorldMatrix(x.create());a.setLocalMatrix(x.create());a.transformDirty=!1;return a},updateBoundingBox:function(){this.rootNode.boundingBoxDirty&&(this.rootNode.getWorldSpaceBoundingBox(this.boundingBox),this.data.worldBoundingBox=this.boundingBox.data)},getBoundingBox:function(a){this.updateBoundingBox();a.copy(this.boundingBox)},createDrawable:function(){throw Error("Scene::createDrawable not implemented");},requestRedraw:function(){throw Error("Scene::requestRedraw not implemented");
},traverse:function(a){this.rootNode.traverse(a)},findRayIntersections:function(a){var c=[];this.rootNode.findRayIntersections(a,c);return c},getDefaultMaterial:function(){if(!this._defaultMaterial){var a=new u;a.data=new n(r.DATA_TYPE.FLOAT3,new Float32Array([1,0,0]));a.name="diffuseColor";var c=new q(!1);c.appendChild(a);this._defaultMaterial=this.createMaterialConfiguration({type:"urn",urn:new t("urn:xml3d:material:matte")},c,{name:"default"})}return this._defaultMaterial},handleResizeEvent:function(a,
c){this.width=a;this.height=c}});m.exports=d},{"../../../utils/uri.js":186,"../../../xflow/interface/constants.js":189,"../../../xflow/interface/data.js":190,"../../../xflow/interface/graph.js":191,"../lights/light-manager.js":95,"./configuration.js":98,"./constants.js":99,"./pager.js":101,"./rendergroup.js":102,"./renderlight.js":103,"./renderobject.js":105,"./renderview.js":106,"./scene-data.js":107,assert:11,events:12,"gl-matrix":1}],109:[function(d,m,l){var e=d("../../../xflow/interface/data.js").DataChangeNotifier;
d=function(){e.addListener(this.dataEntryChanged)};d.prototype.dataEntryChanged=function(b,a){if(b.userData.webglData)for(var c in b.userData.webglData)b.userData.webglData[c].changed=Math.max(b.userData.webglData[c].changed,a)};m.exports=d},{"../../../xflow/interface/data.js":190}],110:[function(d,m,l){var e=d("gl-matrix").vec3,b=e.create(),a=e.create(),c=d("assert");d=function(a,c,b,e,d,h){this.setFrustum(a,c,b,e,d,h)};XML3D.extend(d.prototype,{setFrustum:function(a,b,e,d,h,n){c(0<a&&0<b,"Near or far plane undefined or non-positive");
c(!(e&&d),"fovx and fovy cannot both be non-zero.");c(0<h,"aspect cannot both be non-zero.");e?(this.right=a*Math.tan(e/2),this.left=-this.right,this.top=(this.right-this.left)/h/2,this.bottom=-this.top):(this.top=a*Math.tan(.5*d),this.bottom=-this.top,this.right=(this.top-this.bottom)*h/2,this.left=-this.right);this.nearPlane=a;this.farPlane=b;this.orthographic=void 0==n?!1:n},getProjectionMatrix:function(a){var c=Number.MAX_VALUE,b=this.right+this.left,e=this.right-this.left,d=this.top+this.bottom,
h=this.top-this.bottom,p=this.farPlane+this.nearPlane,r=this.farPlane-this.nearPlane;if(1>Math.abs(e)&&Math.abs(b)>c*Math.abs(e)||1>Math.abs(h)&&Math.abs(d)>c*Math.abs(h)||1>Math.abs(r)&&Math.abs(p)>c*Math.abs(r))throw Error("Bad viewing frustum: projection matrix cannot be computed.");var t=a.data?a.data:a;if(this.orthographic){var v=-b/e,l=-d/h,y=-p/r;if(1>Math.abs(e)&&2>c*Math.abs(e)||1>Math.abs(h)&&2>c*Math.abs(h)||1>Math.abs(r)&&2>c*Math.abs(r))throw Error("Bad viewing frustum:  projection matrix cannot be computed.");
b=2/e;d=2/h;p=-2/r;XML3D.math.mat4.identity(t);t[0]=b;t[5]=d;t[10]=p;t[12]=v;t[13]=l;t[14]=y;t[15]=1}else{b/=e;d/=h;p=-p/r;v=-2*this.farPlane*this.nearPlane;if(1>Math.abs(r)&&Math.abs(v)>c*Math.abs(r))throw Error("Bad viewing frustum: projection matrix cannot be computed.");r=v/r;v=2*this.nearPlane;if(1>Math.abs(e)&&Math.abs(v)>c*Math.abs(e)||1>Math.abs(h)&&Math.abs(v)>c*Math.abs(h))throw Error("Bad viewing frustum: projection matrix cannot be computed.");c=v/e;h=v/h;XML3D.math.mat4.identity(t);t[0]=
c;t[5]=h;t[8]=b;t[9]=d;t[10]=p;t[11]=-1;t[14]=r;t[15]=0}return a},getPlanes:function(){var a=e.create(),c=e.create(),b=e.create(),d=e.create(),h=e.create(),n=e.create(),p=e.create(),r=e.create();return function(t,v){e.transformMat4(a,[this.left,this.bottom,-this.nearPlane],v);e.transformMat4(c,[this.left,this.top,-this.nearPlane],v);e.transformMat4(b,[this.right,this.top,-this.nearPlane],v);e.transformMat4(d,[this.right,this.bottom,-this.nearPlane],v);if(this.orthographic)e.transformMat4(h,[this.left,
this.bottom,-this.farPlane],v),e.transformMat4(n,[this.left,this.top,-this.farPlane],v),e.transformMat4(p,[this.right,this.top,-this.farPlane],v),e.transformMat4(r,[this.right,this.bottom,-this.farPlane],v),t[0].setFromPoints(b,p,n),t[1].setFromPoints(d,r,p),t[2].setFromPoints(a,h,r),t[3].setFromPoints(c,n,h);else{var l=this.farPlane/this.nearPlane,y=l*this.left,w=l*this.right,m=l*this.top;e.transformMat4(h,[y,l*this.bottom,-this.farPlane],v);e.transformMat4(n,[y,m,-this.farPlane],v);e.transformMat4(p,
[w,m,-this.farPlane],v);e.transformMat4(r,[0,0,0],v);t[0].setFromPoints(r,b,c);t[1].setFromPoints(r,d,b);t[2].setFromPoints(r,a,d);t[3].setFromPoints(r,c,a)}t[4].setFromPoints(a,d,b);t[5].setFromPoints(h,n,p)}}()});var h=function(){this.distance=0;this.normal=e.create()};XML3D.extend(h.prototype,{setFromPoints:function(c,f,d){e.cross(this.normal,e.sub(a,d,c),e.sub(b,f,c));e.normalize(this.normal,this.normal);this.distance=-e.dot(this.normal,c)},set:function(a,c,b,d){e.set(this.normal,a,c,b);e.normalize(this.normal,
this.normal);this.distance=d}});l=function(a,c){this.frustumPlanes=[new h,new h,new h,new h,new h,new h];a&&c&&this.set(a,c)};XML3D.extend(l.prototype,{set:function(a,c){a.getPlanes(this.frustumPlanes,c)},isBoxVisible:function(a){if(a.isEmpty())return!1;for(var b=0;b<this.frustumPlanes.length;b++){var e=this.frustumPlanes[b],d=e.normal,e=(0<=d[0]?a.data[3]:a.data[0])*d[0]+(0<=d[1]?a.data[4]:a.data[1])*d[1]+(0<=d[2]?a.data[5]:a.data[2])*d[2]+e.distance;c(!isNaN(e));if(0>e)return!1}return!0}});m.exports=
{Plane:h,Frustum:d,FrustumTest:l}},{assert:11,"gl-matrix":1}],111:[function(d,m,l){var e=d("gl-matrix").vec3;d=function(){};var b=new XML3D.Box,a=e.create();XML3D.extend(d.prototype,{sortObjects:function(c,d){var g={},f={},k,u,q,n,p;q=0;for(n=c.length;q<n;q++)k=c[q],!1!==k.inFrustum&&(k.hasTransparency()?f[k._zIndex]?f[k._zIndex].push(k):f[k._zIndex]=[k]:g[k._zIndex]?g[k._zIndex].push(k):g[k._zIndex]=[k]);n=Object.keys(g).concat(Object.keys(f));n=n.sort(function(a,c){return a.localeCompare(c)}).filter(function(a,
c,b){return!c||a!=b[c-1]});var r={};for(q=0;q<n.length;q++)for(p in u=n[q],r[u]={},g[u]){k=g[u][p];var t=k.getProgram();r[u][t.id]=r[u][t.id]||[];r[u][t.id].push(k)}for(u in n)for(var v in r[u]){g=r[u][v];t=Array(g.length);for(q=0;q<g.length;q++)k=g[q],k.getWorldSpaceBoundingBox(b),b.center(a),d&&e.transformMat4(a,a,d),t[q]={obj:k,depth:a.z};t.sort(function(a,c){return c.depth-a.depth});r[u][v]=t.map(function(a){return a.obj})}v={};for(var l in n){u=n[l];g=[];for(p in f[u])k=f[u][p],k.getWorldSpaceBoundingBox(b),
b.center(a),d&&e.transformMat4(a,a,d),g.push([k,a.z]);g.sort(function(a,c){return a[1]-c[1]});for(q=0;q<g.length;q++)g[q]=g[q][0];v[u]=g}return{opaque:r,transparent:v,zLayers:n}}});m.exports=d},{"gl-matrix":1}],112:[function(d,m,l){m.exports={convertPageCoords:function(e,b,a){var c;c=e.getBoundingClientRect();var d=document.body,g=document.documentElement;e=c.left+(window.pageXOffset||g.scrollLeft||d.scrollLeft)-(g.clientLeft||d.clientLeft||0);c=Math.round(c.top+(window.pageYOffset||g.scrollTop||
d.scrollTop)-(g.clientTop||d.clientTop||0));e=Math.round(e);return{x:b-e,y:a-c}}}},{}],113:[function(d,m,l){var e=d("texture-manager").SimpleTextureManager,b=d("./texture.js").GLTexture,a=d("./texture.js").GLCubeMap,c=d("./rendertarget.js").GLCanvasTarget,h=d("./../shader/programfactory.js"),g=d("../../../xflow/interface/constants.js"),f=d("../constants.js"),k={alpha:!0,premultipliedAlpha:!1,antialias:!0,stencil:!0,preserveDrawingBuffer:!0};d=function(a,b){var d;try{d=a.getContext("experimental-webgl",
k)}catch(g){d=null}this.gl=d;this.id=b;this.canvasTarget=new c(this,a.clientWidth,a.clientHeight);this.programFactory=new h(this);this.textureManager=new e({units:this.gl.getParameter(f.MAX_COMBINED_TEXTURE_IMAGE_UNITS)});this.stats={materials:0,meshes:0};d=this.gl;var t={},v;for(v in u){var l=u[v],y=d.getExtension(l);y?t[l]=y:XML3D.debug.logInfo(l,"is not supported on your graphics card")}this.extensions=t};var u=d.EXTENSIONS={};u.STANDARD_DERIVATES="OES_standard_derivatives";u.MULTIPLE_RENDER_TARGETS=
"WEBGL_draw_buffers";u.DEPTH_TEXTURE="WEBGL_depth_texture";u.FLOAT_COLOR_BUFFER="WEBGL_color_buffer_float";u.FLOAT_TEXTURES="OES_texture_float";u.FLOAT_TEXTURES_LINEAR="OES_texture_float_linear";u.UINT32_INDICES="OES_element_index_uint";XML3D.extend(d.prototype,{getXflowEntryWebGlData:function(a){var c=this.id;a?(a.userData.webglData||(a.userData.webglData={}),a.userData.webglData[c]||(a.userData.webglData[c]={changed:g.DATA_ENTRY_STATE.CHANGED_NEW}),a=a.userData.webglData[c]):a=null;return a},requestRedraw:function(a){},
handleResizeEvent:function(a,b){this.canvasTarget=new c(this,a,b)},getStatistics:function(){return this.stats},getExtensionByName:function(a){return this.extensions[a]},createTexture:function(){return new b(this)},createCubeMap:function(){return new a(this)}});m.exports=d},{"../../../xflow/interface/constants.js":189,"../constants.js":121,"./../shader/programfactory.js":158,"./rendertarget.js":117,"./texture.js":118,"texture-manager":44}],114:[function(d,m,l){d=function(e){this.gl=e.gl;this.createGLAssets()};
XML3D.extend(d.prototype,{createGLAssets:function(){var e=this.gl;this.posBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.posBuffer);e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0]),e.STATIC_DRAW)},draw:function(e){var b=this.gl;e=e.attributes.position;b.enableVertexAttribArray(e.location);b.bindBuffer(b.ARRAY_BUFFER,this.posBuffer);b.vertexAttribPointer(e.location,3,b.FLOAT,!1,0,0);b.drawArrays(b.TRIANGLE_STRIP,0,4);b.disableVertexAttribArray(e.location)}});m.exports=
d},{}],115:[function(d,m,l){var e=d("../constants.js");d=function(b){this.context=b;this.buffers={};this.uniformOverride={};this.maxIndex=this.minIndex=0;this.isIndexed=!1;this.vertexCount=null;this.minAttributeCount=-1;this.context.getStatistics().meshes++;this.glType=null;this.multiDraw=!1};XML3D.extend(d.prototype,{setIndexRange:function(b,a){this.minIndex=b;this.maxIndex=a},setPrimitiveType:function(b){this.glType=b;this.multiDraw=this.glType==e.LINE_STRIP||this.glType==e.TRIANGLE_STRIP},checkBufferCompatible:function(b,
a){var c=a.getIterateCount();this.minAttributeCount=-1==this.minAttributeCount?c:Math.min(this.minAttributeCount,c);if(this.isIndexed){if(c<=this.maxIndex)throw Error("Index range of ["+this.minIndex+", "+this.maxIndex+"]  goes beyond element count "+c+" of attribute '"+b+"'");}else if(null!==this.vertexCount&&c<this.vertexCount)throw Error("VertexCount "+this.vertexCount+" is larger than element count "+c+" of attribute '"+b+"'");},removeBuffer:function(b){delete this.buffers[b]},setBuffer:function(b,
a){this.buffers[b]=a;this.isIndexed=this.isIndexed||"index"==b},clear:function(){this.buffers={};this.uniformOverride={};this.minIndex=this.maxIndex=0;this.isIndexed=!1;this.minAttributeCount=-1},getUniformOverride:function(b){return this.uniformOverride[b]},setUniformOverride:function(b,a){void 0===a&&delete this.uniformOverride[b];this.uniformOverride[b]=a},setVertexCount:function(b){this.vertexCount=b},isReadyToRender:function(){return 0<this.minAttributeCount},getElementCount:function(){try{return this.buffers.index.length}catch(b){return 0}},
getVertexCount:function(){try{return null!=this.vertexCount?this.vertexCount:this.minAttributeCount}catch(b){return 0}},_bindVertexBuffers:function(b){var a=this.context.gl;b=b.attributes;var c=this.buffers,e,d,f=Object.keys(b),k=f.length;for(e=0;e<k;e++){d=f[e];var u=c[d];d=b[d].location;u&&(a.enableVertexAttribArray(d),a.bindBuffer(a.ARRAY_BUFFER,u),a.vertexAttribPointer(d,u.tupleSize,u.glType,!1,0,0))}},_unbindVertexBuffers:function(b){var a=this.context.gl;b=b.attributes;for(var c in b)a.disableVertexAttribArray(b[c].location);
a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)},draw:function(b){var a=this.context.gl,c=this.buffers,e=0,d;this._bindVertexBuffers(b);if(this.isIndexed){e=c.index;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e);if(this.multiDraw&&this.vertexCount)for(d=c=0;d<this.vertexCount.length;d++){var f=this.vertexCount[d];a.drawElements(this.glType,f,e.glType,c*e.bytesPerElement);c+=f}else a.drawElements(this.glType,this.getElementCount(),e.glType,0);e=this.getElementCount()/3}else if(this.multiDraw&&
this.vertexCount)for(d=c=0;d<this.vertexCount.length;d++)f=this.vertexCount[d],a.drawArrays(this.glType,c,f),c+=f;else a.drawArrays(this.glType,0,this.getVertexCount()),e=this.getVertexCount();this._unbindVertexBuffers(b);b.undoUniformVariableOverride&&b.undoUniformVariableOverride(this.uniformOverride);return e}});m.exports=d},{"../constants.js":121}],116:[function(d,m,l){var e=d("./utils.js"),b=d("../system/system-notifier.js"),a=d("../constants.js"),c=function(c,e,d){var h=c.createShader(e);c.shaderSource(h,
d);c.compileShader(h);if(0==c.getShaderParameter(h,a.COMPILE_STATUS)){var h=c.getShaderInfoLog(h),q="",q=e==a.VERTEX_SHADER?"Vertex shader failed to compile: \n":"Fragment shader failed to compile: \n",q=q+(h+"\n--------\n")+"Shader Source:\n--------\n",q=q+XML3D.debug.formatSourceCode(d);c.getError();b.sendEvent("glsl",{glslType:"compile_error",shaderType:e==a.VERTEX_SHADER?"vertex":"fragment",code:d,message:h});throw Error(q);}return h},h=e.getUniqueCounter();d=function(a,c){this.gl=a;this.sources=
c;this.id=h();this.attributes={};this.uniforms={};this.samplers={};this.handle=null;this.create()};XML3D.extend(d.prototype,{create:function(){XML3D.debug.logDebug("Create shader program: ",this.id);var d=this.gl,f=[this.sources.vertex],h=[this.sources.fragment],u,q,n=[];for(q in f)u=f[q],u=c(d,a.VERTEX_SHADER,u),n.push(u);for(q in h)u=h[q],u=c(d,a.FRAGMENT_SHADER,u),n.push(u);var f=d.createProgram(),p;for(p in n)d.attachShader(f,n[p]);d.linkProgram(f);if(0==d.getProgramParameter(f,a.LINK_STATUS))throw n=
d.getProgramInfoLog(f),p="Shader linking failed: \n"+n+"\n--------\n",d.getError(),b.sendEvent("glsl",{glslType:"link_error",message:n}),Error(p);if(this.handle=f){b.sendEvent("glsl",{glslType:"success"});this.bind();d=this.gl;n=this.handle;f=d.getProgramParameter(n,d.ACTIVE_ATTRIBUTES);for(p=0;p<f;p++)if(h=d.getActiveAttrib(n,p))q={},q.name=h.name,q.size=h.size,q.glType=h.type,q.location=d.getAttribLocation(n,h.name),this.attributes[h.name]=q;f=d.getProgramParameter(n,d.ACTIVE_UNIFORMS);for(p=0;p<
f;p++)if(h=d.getActiveUniform(n,p))q={},q.name=h.name,q.size=h.size,q.glType=h.type,q.location=d.getUniformLocation(n,h.name),u=q.name,"[0]"==u.substring(u.length-3)&&(u=u.substring(0,u.length-3)),h.type==d.SAMPLER_2D||h.type==d.SAMPLER_CUBE?(q.cachedUnits=new Int32Array(q.size),q.textures=[],e.setUniform(d,q,q.cachedUnits),this.samplers[u]=q):this.uniforms[u]=q}},bind:function(){this.handle||XML3D.debug.logError("Trying to bind invalid GLProgram.");this.gl.useProgram(this.handle);for(var a in this.samplers){var c=
this.samplers[a];c.textures.length&&this.setSamplerFromTextures(c)}},unbind:function(){},isValid:function(){return!!this.handle},setUniformVariables:function(a,c,b){var e,d,h,p;if(a&&b.envBase)for(e=a.length,d=b.envBase,h=b.envOverride;e--;)p=a[e],this.setUniformVariable(p,h&&void 0!==h[p]?h[p]:d[p]);if(c&&b.sysBase)for(e=c.length,d=b.sysBase;e--;)p=c[e],this.setUniformVariable(p,d[p])},setUniformVariable:function(a,c){void 0!==c&&(this.uniforms[a]?e.setUniform(this.gl,this.uniforms[a],c):this.samplers[a]&&
this.setUniformSampler(this.samplers[a],c))},setSamplerFromTextures:function(a){for(var c=a.textures,b=a.cachedUnits,d=!1,h=0,n=c.length;h<n;h++){var p=c[h].unit;-1==p&&(p=c[h]._bind());p!=b[h]&&(b[h]=p,d=!0)}d&&(XML3D.debug.logDebug("Setting new texture units:",a.name,b),e.setUniform(this.gl,a,b))},setSamplerFromArray:function(a,c){for(var b=a.cachedUnits,d=!1,h=0,n=c.length;h<n;h++){var p=c[h];p!=b[h]&&(b[h]=p,d=!0)}d&&(e.setUniform(this.gl,a,b),XML3D.debug.logDebug("Setting global texture units:",
a.name,b,this.id))},setUniformSampler:function(a,c){XML3D.debug.assert(c&&a);XML3D.debug.assert(Array.isArray(c),"Program::setUniformSampler: Unexpected value.");XML3D.debug.assert(c.length,"Program::setUniformSampler: No entry in value.");void 0!=c[0].unit?(a.textures=c,this.setSamplerFromTextures(a)):this.setSamplerFromArray(a,c)}});m.exports=d},{"../constants.js":121,"../system/system-notifier.js":160,"./utils.js":119}],117:[function(d,m,l){d=function(a,c,b){this.context=a;this.width=c;this.height=
b};l=function(){};XML3D.extend(d.prototype,{getWidth:function(){return this.width},getHeight:function(){return this.height},getScale:function(){return 1},bind:function(){this.context.gl.viewport(0,0,this.width,this.height)},unbind:l,resize:l});var e=function(a,c){this.context=a;this.width=c.width||800;this.height=c.height||600;this.scale=c.scale||1;this.opt=this.fillOptions(c);this.handle=null;this.colorTarget={handle:null,isTexture:!1};this.depthTarget={handle:null,isTexture:!1};this.stencilTarget=
{handle:null,isTexture:!1};this.valid=!1};XML3D.extend(e.prototype,{getWidth:function(){return this.width},getHeight:function(){return this.height},getScale:function(){return this.scale},bind:function(){this.handle||this.createFrameBuffer(this.opt.colorFormat,this.opt.depthFormat,this.opt.stencilFormat);if(this.valid){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.handle);a.viewport(0,0,this.width,this.height)}},unbind:function(){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)},
resize:function(a,c){this.dispose();this.width=a;this.height=c;this.bind()},createFrameBuffer:function(a,c,b){var e=this.context.gl;this.handle=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,this.handle);a&&this.createColorTarget(a);c&&this.createDepthTarget(c);b&&this.createStencilTarget(b);this.checkStatus()},createColorTarget:function(a){var c=this.context.gl;if(this.opt.colorAsRenderbuffer){var b=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,b);c.renderbufferStorage(c.RENDERBUFFER,
a,this.width,this.height);c.bindRenderbuffer(c.RENDERBUFFER,null);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.RENDERBUFFER,b);this.colorTarget={handle:b,isTexture:!1}}else b=this.context.createTexture(),b.createTex2DFromData(a,this.width,this.height,c.RGBA,this.opt.colorType||c.UNSIGNED_BYTE,this.opt),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b.handle,0),this.colorTarget={handle:b,isTexture:!0}},createDepthTarget:function(a){var c=this.context.gl;this.opt.isDepth=
!0;if(this.opt.depthAsRenderbuffer){var b=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,b);c.renderbufferStorage(c.RENDERBUFFER,a,this.width,this.height);c.bindRenderbuffer(c.RENDERBUFFER,null);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,b);this.depthTarget={handle:b,isTexture:!1}}else b=this.context.createTexture(),b.createTex2DFromData(a,this.width,this.height,c.DEPTH_COMPONENT,c.FLOAT,this.opt),c.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.TEXTURE_2D,
b.handle,0),this.depthTarget={handle:b,isTexture:!0}},createStencilTarget:function(a){var c=this.context.gl;if(this.opt.stencilAsRenderbuffer){var b=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,b);c.renderbufferStorage(c.RENDERBUFFER,a,this.width,this.height);c.bindRenderbuffer(c.RENDERBUFFER,null);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.STENCIL_ATTACHMENT,c.RENDERBUFFER,b);this.stencilTarget={handle:b,isTexture:!1}}else b=this.context.createTexture(),b.createTex2DFromData(a,this.width,
this.height,c.STENCIL_COMPONENT,c.UNSIGNED_BYTE,this.opt),c.framebufferTexture2D(c.FRAMEBUFFER,c.STENCIL_ATTACHMENT,c.TEXTURE_2D,b.handle,0),this.stencilTarget={handle:b,isTexture:!0}},checkStatus:function(){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.handle);var c=a.checkFramebufferStatus(a.FRAMEBUFFER);switch(c){case a.FRAMEBUFFER_COMPLETE:break;case a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
break;case a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case a.FRAMEBUFFER_UNSUPPORTED:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:XML3D.debug.logError("Incomplete framebuffer: "+c)}a.bindFramebuffer(a.FRAMEBUFFER,null);return this.valid=c==a.FRAMEBUFFER_COMPLETE},fillOptions:function(a){var c=this.context.gl,c={wrapS:c.CLAMP_TO_EDGE,wrapT:c.CLAMP_TO_EDGE,minFilter:c.NEAREST,magFilter:c.NEAREST,
depthMode:c.LUMINANCE,depthCompareMode:c.COMPARE_R_TO_TEXTURE,depthCompareFunc:c.LEQUAL,colorsAsRenderbuffer:!1,depthAsRenderbuffer:!1,stencilAsRenderbuffer:!1,isDepth:!1},b;for(b in a)c[b]=a[b];return c},dispose:function(){if(this.handle){var a=this.context.gl;a.deleteFramebuffer(this.handle);null!==this.colorTarget&&(this.colorTarget.isTexture?this.colorTarget.handle.dispose():a.deleteRenderBuffer(this.colorTarget.handle));null!==this.depthTarget&&(this.depthTarget.isTexture?this.depthTarget.handle.dispose():
a.deleteRenderBuffer(this.depthTarget.handle));null!==this.stencilTarget&&(this.stencilTarget.isTexture?this.stencilTarget.handle.dispose():a.deleteRenderBuffer(this.stencilTarget.handle))}}});l=function(a,c,b){e.call(this,a,b);this.scaleToMaxDimension(c)};XML3D.createClass(l,e);XML3D.extend(l.prototype,{scaleToMaxDimension:function(a){var c=this.height-a,b=this.width-a;if(0<c||0<b)a=c>b?a/this.height:a/this.width,this.width=Math.floor(this.width*a),this.height=Math.floor(this.height*a),this.scale=
a}});var b=function(a,c){var b=a.gl;this.context=a;this.height=this.width=c.width||800;this.scale=c.scale||1;this.opt=this.fillOptions(c);this.stencilTarget=this.depthTarget=this.colorTarget=this.stex=this.dtex=this.ctex=this.handle=null;this.valid=!1;this.glSides=[b.TEXTURE_CUBE_MAP_POSITIVE_X,b.TEXTURE_CUBE_MAP_NEGATIVE_X,b.TEXTURE_CUBE_MAP_POSITIVE_Y,b.TEXTURE_CUBE_MAP_NEGATIVE_Y,b.TEXTURE_CUBE_MAP_POSITIVE_Z,b.TEXTURE_CUBE_MAP_NEGATIVE_Z];this.framebuffers=[]};XML3D.extend(b.prototype,{getWidth:function(){return this.width},
getHeight:function(){return this.height},getScale:function(){return this.scale},bind:function(a){0>=this.framebuffers.length&&this.createFrameBuffers(this.opt.colorFormat,this.opt.depthFormat,this.opt.stencilFormat);if(this.valid){var c=this.context.gl;c.bindFramebuffer(c.FRAMEBUFFER,this.framebuffers[a]);c.viewport(0,0,this.width,this.height)}},unbind:function(){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)},resize:function(a,c){this.dispose();this.width=a;this.height=c;this.bind()},
createFrameBuffers:function(a,c,b){var e=this.context.gl;a&&(this.ctex=this.context.createCubeMap(),this.ctex.createTex2DFromData(a,this.width,this.height,e.RGBA,this.opt.colorType||e.UNSIGNED_BYTE,this.opt),this.colorTarget={handle:this.ctex,isTexture:!0});c&&(this.opt.isDepth=!0,this.opt.depthAsRenderbuffer||(this.dtex=this.context.createCubeMap(),this.dtex.createTex2DFromData(c,this.width,this.height,e.DEPTH_COMPONENT,e.FLOAT,this.opt),this.depthTarget={handle:this.dtex,isTexture:!0}));b&&(this.stex=
this.context.createCubeMap(),this.stex.createTex2DFromData(b,this.width,this.height,e.STENCIL_COMPONENT,e.UNSIGNED_BYTE,this.opt),this.stencilTarget={handle:this.stex,isTexture:!0});for(var d=0;d<this.glSides.length;++d)this.framebuffers[d]=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffers[d]),a&&this.createColorTarget(a,d),c&&this.createDepthTarget(c,d),b&&this.createStencilTarget(b,d),this.checkStatus(d)},createColorTarget:function(a,c){var b=this.context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,
b.COLOR_ATTACHMENT0,this.glSides[c],this.ctex.handle,0)},createDepthTarget:function(a,c){var b=this.context.gl;this.opt.depthAsRenderbuffer?(this.dtex||(this.dtex=[]),this.dtex[c]=b.createRenderbuffer(),b.bindRenderbuffer(b.RENDERBUFFER,this.dtex[c]),b.renderbufferStorage(b.RENDERBUFFER,a,this.width,this.height),b.bindRenderbuffer(b.RENDERBUFFER,null),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,this.dtex[c]),this.depthTarget||(this.depthTarget=[]),this.depthTarget[c]=
{handle:this.dtex[c],isTexture:!1}):b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT0,this.glSides[c],this.dtex.handle,0)},createStencilTarget:function(a,c){var b=this.context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,this.glSides[c],this.stex.handle,0)},checkStatus:function(a){var c=this.context.gl;c.bindFramebuffer(c.FRAMEBUFFER,this.framebuffers[a]);a=c.checkFramebufferStatus(c.FRAMEBUFFER);switch(a){case c.FRAMEBUFFER_COMPLETE:break;case c.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");
break;case c.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case c.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case c.FRAMEBUFFER_UNSUPPORTED:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:XML3D.debug.logError("Incomplete framebuffer: "+a)}c.bindFramebuffer(c.FRAMEBUFFER,null);return this.valid=
a==c.FRAMEBUFFER_COMPLETE},fillOptions:function(a){var c=this.context.gl,c={wrapS:c.CLAMP_TO_EDGE,wrapT:c.CLAMP_TO_EDGE,minFilter:c.NEAREST,magFilter:c.NEAREST,depthMode:c.LUMINANCE,depthCompareMode:c.COMPARE_R_TO_TEXTURE,depthCompareFunc:c.LEQUAL,colorsAsRenderbuffer:!1,depthAsRenderbuffer:!1,stencilAsRenderbuffer:!1,isDepth:!1},b;for(b in a)c[b]=a[b];return c},dispose:function(){if(!(0>=this.framebuffers.length)){var a=this.context.gl,c;for(c in this.framebuffers)a.deleteFramebuffer(this.framebuffers[c]);
null!==this.colorTarget.handle&&this.colorTarget.handle.dispose();null!==this.depthTarget&&this.depthTarget.handle.dispose();null!==this.stencilTarget&&this.stencilTarget.handle.dispose();this.framebuffers=[]}}});m.exports={GLCanvasTarget:d,GLRenderTarget:e,GLScaledRenderTarget:l,GLCubeMapRenderTarget:b}},{}],118:[function(d,m,l){var e=d("./utils.js");l=d("../../../contrib/state-machine.js");var b=d("../../../xflow/interface/data.js").SamplerConfig,a=d("../../../xflow/interface/constants.js"),c=e.getUniqueCounter(),
h=d("../constants.js"),g=function(a){b.call(this);this.context=a;this.id=c();this.unit=-1;this.setDefaults();this.height=this.width=0;this.handle=null;this.textureType=a.gl.TEXTURE_2D;this.textureUnitCallback=this.lostTextureUnit.bind(this)};XML3D.createClass(g,b);g.State={NONE:"none",LOADING:"loading",READY:"ready",ERROR:"error"};(function(){var a=null;return function(c){if(!a){a=new g(c);c=new Uint8Array(768);for(var b=0;b<c.length;b++)c[b]=128;a.createTex2DFromData(h.RGB,16,16,h.RGB,h.UNSIGNED_BYTE,
{texels:c,wrapS:h.REPEAT,wrapT:h.REPEAT,minFilter:h.LINEAR,magFilter:h.LINEAR})}return a}})();var f=function(a){--a;for(var c=1;32>c;c<<=1)a|=a>>c;return a+1},k=function(c,b){switch(c){case a.TEXTURE_FORMAT.ALPHA:return b.ALPHA;case a.TEXTURE_FORMAT.RGB:return b.RGB;case a.TEXTURE_FORMAT.RGBA:return b.RGBA;case a.TEXTURE_FORMAT.LUMINANCE:return b.LUMINANCE;case a.TEXTURE_FORMAT.LUMINANCE_ALPHA:return b.LUMINANCE_ALPHA;default:throw Error("Unsupported Texture Format!");}},u=function(c,b){switch(c){case a.TEXTURE_TYPE.FLOAT:return b.FLOAT;
case a.TEXTURE_TYPE.UBYTE:return b.UNSIGNED_BYTE;case a.TEXTURE_TYPE.USHORT_4_4_4_4:return b.UNSIGNED_SHORT_4_4_4_4;case a.TEXTURE_TYPE.USHORT_5_5_5_1:return b.UNSIGNED_SHORT_5_5_5_1;case a.TEXTURE_TYPE.USHORT_5_6_5:return b.GL_UNSIGNED_SHORT_5_6_5;default:throw Error("Unsupported Texture Type!");}};XML3D.extend(g.prototype,{updateFromTextureEntry:function(a){if(a.isLoading())this.loads();else{this.set(a.getSamplerConfig());a=a.asGLTextureValue();if(!a)return this.failed();this.createOrUpdateTexture(a)}},
needsScale:function(a,c){return(this.generateMipMap||this.wrapS!=h.CLAMP_TO_EDGE||this.wrapT!=h.CLAMP_TO_EDGE)&&(0!=(a&a-1)||0!=(c&c-1))},_bind:function(){var a=this.context.gl,c=this.unit=this.context.textureManager.bind(this.id,{dispose:this.textureUnitCallback});-2==c?XML3D.debug.logError("All available texture units are full."):(a.activeTexture(h.TEXTURE0+c),a.bindTexture(this.textureType,this.handle));return c},unbind:function(a){},destroy:function(){var a=this.context.gl;this.context.textureManager.dispose(this.id);
a.deleteTexture(this.handle)},canBind:function(){return this.current==g.State.READY},createOrUpdateTexture:function(a){this.handle||(this.handle=this.context.gl.createTexture());this.updateTextureFromData(a)},updateTextureFromData:function(a){var c=this.context.gl;this._bind();c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,this.flipY);c.texParameteri(this.textureType,c.TEXTURE_WRAP_S,this.wrapS);c.texParameteri(this.textureType,c.TEXTURE_WRAP_T,this.wrapT);c.texParameteri(this.textureType,c.TEXTURE_MIN_FILTER,
this.minFilter);c.texParameteri(this.textureType,c.TEXTURE_MAG_FILTER,this.magFilter);var b=u(a.texelType,c),e=k(a.texelFormat,c),d=a.width;this.width=d;var g=a.height;this.height=g;if(this.generateMipMap&&this.needsScale(d,g)){if(b===c.FLOAT)throw Error("Should generate MipMaps but texture data is float and not power of two in size!");var h=document.createElement("canvas");h.width=f(d);h.height=f(g);var l=h.getContext("2d");if(a instanceof HTMLElement)l.drawImage(a,0,0,h.width,h.height);else{var w=
document.createElement("canvas");w.width=d;w.height=g;var m=w.getContext("2d"),F=m.createImageData(d,g);F.data.set(a.data);m.putImageData(F,0,0);l.drawImage(w,0,0,h.width,h.height)}a=h}a instanceof HTMLElement?c.texImage2D(c.TEXTURE_2D,0,e,e,b,a):a.data instanceof Uint8ClampedArray?c.texImage2D(c.TEXTURE_2D,0,e,d,g,0,e,b,new Uint8Array(a.data.buffer)):c.texImage2D(c.TEXTURE_2D,0,e,d,g,0,e,b,a.data);this.generateMipMap&&c.generateMipmap(this.textureType);this.created()},createTex2DFromData:function(a,
c,b,e,d,f){var g=this.context.gl;f=f||{};var h=f.texels;h||(h=d==g.FLOAT?new Float32Array(c*b*4):new Uint8Array(c*b*4));this.width=c;this.height=b;this.handle=g.createTexture();this._bind();g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,f.flipY);g.texParameteri(this.textureType,g.TEXTURE_WRAP_S,f.wrapS);g.texParameteri(this.textureType,g.TEXTURE_WRAP_T,f.wrapT);g.texParameteri(this.textureType,g.TEXTURE_MIN_FILTER,f.minFilter);g.texParameteri(this.textureType,g.TEXTURE_MAG_FILTER,f.magFilter);f.isDepth?g.texImage2D(g.TEXTURE_2D,
0,a,c,b,0,e,d,null):h instanceof Uint8ClampedArray?g.texImage2D(g.TEXTURE_2D,0,a,c,b,0,e,d,new Uint8Array(h.buffer)):g.texImage2D(g.TEXTURE_2D,0,a,c,b,0,e,d,h);f.generateMipmap&&g.generateMipmap(this.textureType);this.created()},lostTextureUnit:function(){this.unit=-1}});l.create({target:g.prototype,initial:g.State.NONE,events:[{name:"created",from:"*",to:g.State.READY},{name:"failed",from:"*",to:g.State.ERROR},{name:"loads",from:"*",to:g.State.LOADING}]});d=function(a){g.call(this,a,a.gl.TEXTURE_CUBE_MAP);
var c=a.gl;this.textureType=a.gl.TEXTURE_CUBE_MAP;this.glSides=[c.TEXTURE_CUBE_MAP_POSITIVE_X,c.TEXTURE_CUBE_MAP_NEGATIVE_X,c.TEXTURE_CUBE_MAP_POSITIVE_Y,c.TEXTURE_CUBE_MAP_NEGATIVE_Y,c.TEXTURE_CUBE_MAP_POSITIVE_Z,c.TEXTURE_CUBE_MAP_NEGATIVE_Z]};XML3D.createClass(d,g,{updateTextureFromData:function(a){debug.log("updateTextureFromData not implemented for CubeMapping!")},createTex2DFromData:function(a,c,b,e,d,f){var g=this.context.gl;f=f||{};var h=f.texels;h||(h=d==g.FLOAT?new Float32Array(c*b*4):new Uint8Array(c*
b*4));this.width=c;this.height=b;this.handle=g.createTexture();this._bind();g.texParameteri(this.textureType,g.TEXTURE_WRAP_S,f.wrapS);g.texParameteri(this.textureType,g.TEXTURE_WRAP_T,f.wrapT);g.texParameteri(this.textureType,g.TEXTURE_MIN_FILTER,f.minFilter);g.texParameteri(this.textureType,g.TEXTURE_MAG_FILTER,f.magFilter);for(var k=0;k<this.glSides.length;++k)f.isDepth?g.texImage2D(this.glSides[k],0,a,c,b,0,e,d,null):h instanceof Uint8ClampedArray?g.texImage2D(this.glSides[k],0,a,c,b,0,e,d,new Uint8Array(h.buffer)):
g.texImage2D(this.glSides[k],0,a,c,b,0,e,d,h);f.generateMipmap&&g.generateMipmap(this.textureType);this.created()}});d.State={NONE:"none",LOADING:"loading",READY:"ready",ERROR:"error"};l.create({target:d.prototype,initial:d.State.NONE,events:[{name:"created",from:"*",to:d.State.READY},{name:"failed",from:"*",to:d.State.ERROR},{name:"loads",from:"*",to:d.State.LOADING}]});m.exports={GLTexture:g,GLCubeMap:d}},{"../../../contrib/state-machine.js":52,"../../../xflow/interface/constants.js":189,"../../../xflow/interface/data.js":190,
"../constants.js":121,"./utils.js":119}],119:[function(d,m,l){m.exports={setUniform:function(e,b,a,c){switch(b.glType){case 35670:a&&void 0!==a.length?e.uniform1iv(b.location,Array.prototype.map.call(a,function(a){return a})):e.uniform1i(b.location,a||0);break;case 5124:case 35678:case 35680:a&&void 0!==a.length?e.uniform1iv(b.location,a):e.uniform1i(b.location,a||0);break;case 35671:case 35667:e.uniform2iv(b.location,a);break;case 35672:case 35668:e.uniform3iv(b.location,a);break;case 35673:case 35669:e.uniform4iv(b.location,
a);break;case 5126:null!=a.length?e.uniform1fv(b.location,a):e.uniform1f(b.location,a);break;case 35664:e.uniform2fv(b.location,a);break;case 35665:e.uniform3fv(b.location,a);break;case 35666:e.uniform4fv(b.location,a);break;case 35674:e.uniformMatrix2fv(b.location,c||!1,a);break;case 35675:e.uniformMatrix3fv(b.location,c||!1,a);break;case 35676:e.uniformMatrix4fv(b.location,c||!1,a);break;default:XML3D.debug.logError("Unknown uniform type "+b.glType)}},getUniqueCounter:function(){var e=0;return function(){return e++}},
checkError:function(e,b){var a=e.getError();if(a!==e.NO_ERROR){var c=""+a;switch(a){case 1280:c="1280 ( GL_INVALID_ENUM )";break;case 1281:c="1281 ( GL_INVALID_VALUE )";break;case 1282:c="1282 ( GL_INVALID_OPERATION )";break;case 1283:c="1283 ( GL_STACK_OVERFLOW )";break;case 1284:c="1284 ( GL_STACK_UNDERFLOW )";break;case 1285:c="1285 ( GL_OUT_OF_MEMORY )"}a="GL error "+c+" occured.";void 0!==b&&(a+=" "+b);XML3D.debug.trace(a)}},supported:function(){var e=document.createElement("canvas");try{return!(!window.WebGLRenderingContext||
!e.getContext("experimental-webgl"))}catch(b){return!1}}}},{}],120:[function(d,m,l){function e(a,c){b.call(this,a,c);this.renderInterface={};this.lastPickObj=null;this.lastKnownDimensions={width:0,height:0};this.initialize()}var b=d("../renderer/canvas-handler.js"),a=d("../../utils/options.js"),c=d("../../utils/misc.js");a.register("renderer-continuous",!1);XML3D.createClass(e,b);e.prototype.setRenderer=function(a){this.renderer=a};e.prototype.initialize=function(){this.configureCanvas();var c=this;
this.tick=function(){c.renderer&&(XML3D.updateXflowObserver(),XML3D.flushDOMChanges(),(c.canvasSizeChanged()||c.renderer.needsRedraw()||a.getValue("renderer-continuous"))&&c.draw(),window.requestAnimationFrame(c.tick,30))};var b=this._xml3dElement.getAttribute("contextmenu");b&&"false"!=b||this._canvas.addEventListener("contextmenu",function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation()},!1)};e.prototype.configureCanvas=function(){var a=this._xml3dElement,b=this._canvas,
e=a.parentNode;if(c.elementIs(e,"div")&&"_xml3d_hideDiv"===e.getAttribute("class"))e.parentNode.insertBefore(b,e);else{var d=e.ownerDocument.createElement("div");d.setAttribute("class","_xml3d_hideDiv");e.insertBefore(d,a);d.appendChild(a);e.insertBefore(b,d)}a=b.ownerDocument.defaultView.getComputedStyle(a);b.style.backgroundColor||(a=a.getPropertyValue("background-color"))&&"transparent"!=a&&(b.style.backgroundColor=a);b.width=b.clientWidth;b.height=b.clientHeight;this.lastKnownDimensions={width:b.width,
height:b.height};return b};e.prototype.getPickObjectByPoint=function(a,c){return this.renderer.getRenderObjectFromPickingBuffer(a,c)};e.prototype.getPickedObject=function(){return this.renderer.pickedObject?this.renderer.pickedObject.node:null};e.prototype.getWorldSpaceNormalByPoint=function(a,c){return this.renderer.getWorldSpaceNormalByPoint(a,c)};e.prototype.getWorldSpacePositionByPoint=function(a,c){return this.renderer.getWorldSpacePositionByPoint(a,c)};e.prototype.canvasSizeChanged=function(){var a=
this._canvas;return a.clientWidth!==this.lastKnownDimensions.width||a.clientHeight!==this.lastKnownDimensions.height?(this.lastKnownDimensions.width=a.width=a.clientWidth,this.lastKnownDimensions.height=a.height=a.clientHeight,this.renderer.handleResizeEvent(a.width,a.height),this.dispatchResizeEvent({width:a.width,height:a.height}),!0):!1};var h=window.performance||Date;e.prototype.draw=function(){XML3D.flushDOMChanges();try{var a=h.now(),c=this.renderer.renderToCanvas(),b=h.now();XML3D.xml3dFormatHandler.getFactory("scene",
this.id).getAdapter(this._xml3dElement).onFrameDrawn();this.dispatchFrameDrawnEvent(a,b,c)}catch(e){this.renderer.needsDraw=!1,XML3D.debug.logException(e)}};e.prototype.getMousePosition=function(a){var c=this._canvas.getBoundingClientRect();return{x:a.clientX-c.left,y:a.clientY-c.top}};e.prototype.destroy=function(){this.renderer.dispose();this.renderer=null};m.exports=e},{"../../utils/misc.js":184,"../../utils/options.js":185,"../renderer/canvas-handler.js":91}],121:[function(d,m,l){m.exports=WebGLRenderingContext.ONE?
WebGLRenderingContext:WebGLRenderingContext.prototype},{}],122:[function(d,m,l){var e=d("../base/program.js"),b=d("../xflow/utils.js");d=function(a){this.program=null;this.context=a;this.obsolete=!1;this.id="";this.uniformCollection={envBase:{},envOverride:null,sysBase:null};this.isTransparent=!1;this.source={vertex:"",fragment:""}};Object.defineProperties(d.prototype,{attributes:{writeable:!1,get:function(){return this.program?this.program.attributes:{}}},uniforms:{writeable:!1,get:function(){return this.program?
this.program.uniforms:{}}},samplers:{writeable:!1,get:function(){return this.program?this.program.samplers:{}}}});XML3D.createClass(d,null,{equals:function(a){return this.source.vertex===a.source.vertex&&this.source.fragment===a.source.fragment},hasTransparency:function(){return this.isTransparent},compile:function(){if(this.source.fragment&&this.source.vertex){var a=new e(this.context.gl,this.source);this.program=a;this.id=a.id}else XML3D.debug.logError("No source found for material",this)},bind:function(){this.program.bind()},
unbind:function(){this.program.unbind()},isValid:function(){return this.program.isValid()},updateUniformsFromComputeResult:function(a){a=a.getOutputMap();var c=this.uniformCollection.envBase={};this.setDefaultUniforms(this.uniformCollection.envBase);for(var e in a)c[e]=b.getGLUniformValueFromXflowDataEntry(a[e],this.context);e=Object.keys(c);this.setUniformVariables(e,null,this.uniformCollection);this.isTransparent=this.getTransparencyFromInputData(a)},setUniformVariables:function(a,c,b){this.program.setUniformVariables(a,
c,b)},setSystemUniformVariables:function(a,c){this.uniformCollection.sysBase=c;this.setUniformVariables(null,a,this.uniformCollection)},changeUniformVariableOverride:function(a,c){var b=a?Object.keys(a):[];c&&b.push.apply(b,Object.keys(c));this.uniformCollection.envOverride=c;this.setUniformVariables(b,null,this.uniformCollection)}});m.exports=d},{"../base/program.js":116,"../xflow/utils.js":161}],123:[function(d,m,l){d("../scene/glscene.js");var e=d("../scene/gllights.js"),b=d("../materials/events.js"),
a=d("events").EventEmitter,c=d("../../../xflow/interface/request.js").ComputeRequest,h=d("../../../xflow/interface/constants.js");d=function(c,b){a.call(this);this.context=c;this.shaderClosures=[];this.updateLightValues=this.dataChanged=!1;this.request=null;this.setMaxListeners(0)};XML3D.createClass(d,a,{setShaderInfo:null,updateRequest:function(a){this.request&&this.request.clear();this.request=new c(a,this.getRequestFields(),this.onShaderRequestChange.bind(this));this.setShaderRecompile()},onShaderInfoChanged:function(a){this.setShaderInfo(a);
this.setShaderRecompile();this.context.requestRedraw("Material model changed")},onShaderRequestChange:function(a,c){this.dataChanged=!0;c==h.RESULT_STATE.CHANGED_STRUCTURE&&this.setShaderRecompile();this.context.requestRedraw("Material data changed")},update:function(a,c){for(var b=this,e=this.shaderClosures.length;e--;)this.shaderClosures[e].obsolete&&this.shaderClosures.splice(e,1);if(this.shaderClosures.length){if(this.dataChanged){var d=this.getShaderDataResult();this.shaderClosures.forEach(function(a){b.updateClosureFromComputeResult(a,
d)});this.dataChanged=!1}this.updateLightValues&&this.shaderClosures.forEach(function(c){b.updateClosureFromLightParameters(c,a)})}},updateClosureFromComputeResult:function(a,c){c&&c.getOutputMap&&(a.bind(),a.updateUniformsFromComputeResult(c))},updateClosureFromLightParameters:function(a,c){a.bind();a.setSystemUniformVariables(e.ALL_PARAMETERS,c.systemUniforms)},updateSystemUniforms:function(a,c){this.shaderClosures.forEach(function(b){b.bind();b.setSystemUniformVariables(a,c.systemUniforms)})},
createShaderClosure:function(){throw Error("AbstractComposer::createShaderClosure needs to be overridden");},createObjectDataRequest:function(a,c){throw Error("AbstractComposer::createObjectDataRequest needs to be overridden");},distributeObjectShaderData:function(a,c,b){throw Error("AbstractComposer::distributeObjectShaderData needs to be overridden");},getShaderClosure:function(a,c){var b=this.createShaderClosure();try{b.createSources(a,this.getShaderDataResult(),c)}catch(e){throw Error("Shader: "+
e.message);}for(var d=0;d<this.shaderClosures.length;d++)if(this.shaderClosures[d].equals(b))return this.shaderClosures[d].obsolete=!1,this.shaderClosures[d];this.initializeShaderClosure(b,a);return b},initializeShaderClosure:function(a,c){a.compile();c.emit(b.MATERIAL_INITIALIZED);this.updateClosureFromComputeResult(a,this.getShaderDataResult());this.updateClosureFromLightParameters(a,c);this.shaderClosures.push(a)},setShaderRecompile:function(){for(var a=0;a<this.shaderClosures.length;++a)this.shaderClosures[a].obsolete=
!0;this.emit(b.MATERIAL_STRUCTURE_CHANGED);this.updateLightValues=this.dataChanged=!0},getShaderDataResult:function(){return this.request?this.request.getResult():null}});l=function(a){this.context=a};XML3D.createClass(l,d,{update:function(){},getShaderClosure:function(a,c){return this.context.programFactory.getFallbackProgram()},getShaderAttributes:function(){return{color:null,normal:null}},getRequestFields:function(){return["diffuseColor","useVertexColor"]},createObjectDataRequest:function(a,b){return new c(a,
["position","color","normal","diffuseColor","useVertexColor"],b)},distributeObjectShaderData:function(a,c,b){a=a.getResult().getOutputMap();var e=this.getRequestFields(),d;for(d in a)-1!=e.indexOf(d)?b(d,a[d]):c(d,a[d])}});m.exports={AbstractShaderComposer:d,DefaultComposer:l}},{"../../../xflow/interface/constants.js":189,"../../../xflow/interface/request.js":192,"../materials/events.js":124,"../scene/gllights.js":156,"../scene/glscene.js":157,events:12}],124:[function(d,m,l){m.exports={MATERIAL_STRUCTURE_CHANGED:"material_structure_changed",
MATERIAL_INITIALIZED:"material_initialized"}},{}],125:[function(d,m,l){function e(a,c){var e=h(a);["point","directional","spot"].forEach(function(a){var b=a+"LightOn";e["MAX_"+a.toUpperCase()+"LIGHTS"].staticValue=c[b]&&c[b].length});for(var d in c){var f=e[d];if(f&&f.staticSize){var g=c[d].length;if(g){var k=b(f);f.staticSize=g/k}else delete e[d]}}return e}function b(a){if("array"==a.type&&(a=a.elements,"object"==a.type))switch(a.kind){case "texture":case "float":break;case "float2":return 2;case "float3":return 3;
case "float4":return 4;case "matrix4":return 16;default:throw"Unknown array element kind:"+a.kind;}return 1}var a=d("./../abstractshaderclosure.js");d("./jsshadercomposer.js");var c=d("../../system/system-notifier.js"),h=d("./jssystemconfiguration.js"),g=d("../../../../xflow/interface/constants.js"),f=d("../../../../utils/options.js"),k={},u=function(a,c){var b={};switch(a){case g.DATA_TYPE.BOOL:b.type=Shade.TYPES.BOOLEAN;break;case g.DATA_TYPE.INT:b.type=Shade.TYPES.INT;break;case g.DATA_TYPE.FLOAT:b.type=
Shade.TYPES.NUMBER;break;case g.DATA_TYPE.FLOAT2:b.type=Shade.TYPES.OBJECT;b.kind=Shade.OBJECT_KINDS.FLOAT2;break;case g.DATA_TYPE.FLOAT3:b.type=Shade.TYPES.OBJECT;b.kind=Shade.OBJECT_KINDS.FLOAT3;break;case g.DATA_TYPE.FLOAT4:b.type=Shade.TYPES.OBJECT;b.kind=Shade.OBJECT_KINDS.FLOAT4;break;case g.DATA_TYPE.FLOAT3X3:b.type=Shade.TYPES.OBJECT;b.kind=Shade.OBJECT_KINDS.MATRIX3;break;case g.DATA_TYPE.FLOAT4X4:b.type=Shade.TYPES.OBJECT;b.kind=Shade.OBJECT_KINDS.MATRIX4;break;case g.DATA_TYPE.TEXTURE:b.type=
Shade.TYPES.OBJECT;b.kind=Shade.OBJECT_KINDS.TEXTURE;break;default:throw Error("Unknown Xflow DataType: "+a);}b.source=c;return b};d=function(c,b,e){a.call(this,c);this.sourceTemplate=b;this.extractedParams=e;this.uniformSetter=function(){};this.uniformConverter=[]};XML3D.createClass(d,a,{createSources:function(a,b,d){var g=d.getResult(),h=e(this.context,a.systemUniforms),l={};b=b&&b.getOutputMap();for(var m=g&&g.outputNames,y=0;y<this.extractedParams.length;++y){var w=this.extractedParams[y];m&&
-1!=m.indexOf(w)?l[w]=u(g.getOutputType(w),g.isOutputUniform(w)?Shade.SOURCES.UNIFORM:Shade.SOURCES.VERTEX):b&&b[w]&&(l[w]=u(b[w].type,Shade.SOURCES.UNIFORM))}h={"this":{type:"object",kind:"any",info:h},"global.shade":[{extra:{type:"object",kind:"any",global:!0,info:l}}]};XML3D.debug.logDebug("CONTEXT:",h);b={propagateConstants:!0,validate:!0,sanitize:!0,transformSpaces:f.getValue("shadejs-transformSpaces"),extractUniformExpressions:f.getValue("shadejs-extractUniformExpressions")};m={useStatic:!0,
uniformExpressions:b.uniformExpressions};y=a.deferred?"xml3d-glsl-deferred":"xml3d-glsl-forward";l=y+";"+JSON.stringify(b)+";"+JSON.stringify(l)+";"+this.sourceTemplate;if(!(w=k[l]))try{var z=new Shade.WorkingSet;z.parse(this.sourceTemplate,{loc:!0});z.analyze(h,y,b);var F=z.getProcessingData("spaceInfo"),D=z.compileFragmentShader(m),w={source:D.source,uniformSetter:D.uniformSetter,spaceInfo:F};w.hasTransparentShaderClosure=z.getProcessingData("isTransparent");this.uniformSetter=D.uniformSetter;this.source=
{fragment:D.source,vertex:this.createVertexShader(d,g,F)};a.deferred&&(w.signatures=z.getProcessingData("colorClosureSignatures"));f.getValue("shadejs-cache")&&(k[l]=w)}catch(B){throw c.sendEvent("shadejs",{shadejsType:"error",event:B,code:this.sourceTemplate}),a="Shade.js Compile Error:\n"+B.message+"\n------------\nShader Source:\n------------\n"+XML3D.debug.formatSourceCode(this.sourceTemplate),Error(a);}this.source={fragment:w.source,vertex:this.createVertexShader(d,g,w.spaceInfo)};this.hasTransparentShaderClosure=
w.hasTransparentShaderClosure;this.uniformSetter=w.uniformSetter;a.deferred&&a.colorClosureSignatures.push.apply(a.colorClosureSignatures,w.signatures);XML3D.debug.logDebug(this.source.vertex);XML3D.debug.logDebug(this.source.fragment);c.sendEvent("shadejs",{shadejsType:"success",vertexShader:this.source.vertex,fragmentShader:this.source.fragment});return!0},createVertexShader:function(a,c,b){var e=a.getConfig();c=c.outputNames;for(var d=0;d<c.length;++d){var f=e,h=c[d],k=b;if(k&&k[h])for(var u=k[h].length;u--;){var l=
k[h][u],m=("_env_"+l.name).replace(/_+/g,"_"),D=null;switch(l.space){case Shade.SPACE_VECTOR_TYPES.OBJECT:break;case Shade.SPACE_VECTOR_TYPES.VIEW_POINT:f.addInputParameter(g.DATA_TYPE.FLOAT4X4,"modelViewMatrix",!0);D=m+" = ( modelViewMatrix * vec4(#I{"+h+"}, 1.0) ).xyz;";break;case Shade.SPACE_VECTOR_TYPES.VIEW_NORMAL:f.addInputParameter(g.DATA_TYPE.FLOAT3X3,"modelViewMatrixN",!0);D=m+" = normalize( modelViewMatrixN * #I{"+h+"} );";break;case Shade.SPACE_VECTOR_TYPES.WORLD_POINT:f.addInputParameter(g.DATA_TYPE.FLOAT4X4,
"modelMatrix",!0);D=m+" = ( modelMatrix * vec4(#I{"+h+"}, 1.0) ).xyz;";break;case Shade.SPACE_VECTOR_TYPES.WORLD_NORMAL:f.addInputParameter(g.DATA_TYPE.FLOAT3X3,"modelMatrixN",!0);D=m+" = normalize( modelMatrixN * #I{"+h+"} );";break;default:throw Error("Can't handle Space Type: "+l.space);}f.channelAttribute(h,m,D)}else k=("_env_"+h).replace(/_+/g,"_"),f.channelAttribute(h,k,null)}e.addInputParameter(g.DATA_TYPE.FLOAT4X4,"modelViewProjectionMatrix",!0);e.addCodeFragment("gl_Position = modelViewProjectionMatrix * vec4(#I{position}, 1.0);");
return a.getVertexShader().getGLSLCode()},setUniformVariables:function(a,c,b){this.uniformSetter(a,c,b,this.program.setUniformVariable.bind(this.program))},getTransparencyFromInputData:function(a){return this.hasTransparentShaderClosure},setDefaultUniforms:function(){}});m.exports=d},{"../../../../utils/options.js":185,"../../../../xflow/interface/constants.js":189,"../../system/system-notifier.js":160,"./../abstractshaderclosure.js":122,"./jsshadercomposer.js":126,"./jssystemconfiguration.js":127}],
126:[function(d,m,l){var e=d("./../abstractshadercomposer.js").AbstractShaderComposer,b=d("./jsshaderclosure.js"),a=d("../../../../xflow/processing/vs-connect.js").VSConfig,c=d("../../../../xflow/interface/request.js").VertexShaderRequest,h=d("../../../../xflow/interface/constants.js");d=function(a,c){e.call(this,a,c);if(!window.Shade)throw Error("shade.js library not found");this.context=a;this.sourceTemplate=c.model.script;this.extractedParams=[];this.request=null;this.setShaderInfo(c)};d.convertSysName=
function(a){return a};XML3D.createClass(d,e,{setShaderInfo:function(a){try{var c=Shade.parse(this.sourceTemplate,{loc:!0});this.extractedParams=Shade.extractParameters(c,{implementation:"xml3d-glsl-forward"}).shaderParameters}catch(b){this.extractedParams=[]}-1==this.extractedParams.indexOf("position")&&this.extractedParams.push("position");this.extractedParams.length&&this.updateRequest(a.dataNode)},getRequestFields:function(){return this.extractedParams},getShaderAttributes:function(){return{color:null,
normal:null,texcoord:null}},createShaderClosure:function(){return new b(this.context,this.sourceTemplate,this.extractedParams)},createObjectDataRequest:function(b,e){var d=new a,u=this.extractedParams.slice();d.addAttribute(h.DATA_TYPE.FLOAT3,"position",!0);for(var q=0;q<u.length;++q){var n=u[q];if("position"!=n){var p=b.getOutputChannelInfo(n);p&&d.addAttribute(p.type,n,!0)}}return new c(b,d,e)},distributeObjectShaderData:function(a,c,b){a=a.getVertexShader();var e=a.inputNames,d,h,p;for(d=0;d<e.length;++d)h=
e[d],p=a.getInputData(h),a.isInputUniform(h)?b(h,p):c(h,p);c=a.outputNames;for(d=0;d<c.length;++d)h=c[d],a.isOutputFragmentUniform(h)&&b(a.getOutputSourceName(h),a.getUniformOutputData(h))}});m.exports=d},{"../../../../xflow/interface/constants.js":189,"../../../../xflow/interface/request.js":192,"../../../../xflow/processing/vs-connect.js":239,"./../abstractshadercomposer.js":123,"./jsshaderclosure.js":125}],127:[function(d,m,l){var e=d("../../base/context.js"),b=null,a={coords:{type:"object",kind:"float3",
source:"uniform"},cameraPosition:{type:"object",kind:"float3",source:"uniform"},viewMatrix:{type:"object",kind:"matrix4",source:"uniform"},viewInverseMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelViewMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelViewProjectionMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelMatrixN:{type:"object",kind:"matrix3",source:"uniform"},modelViewMatrixN:{type:"object",kind:"matrix3",
source:"uniform"},MAX_POINTLIGHTS:{type:"int",source:"constant",staticValue:5},pointLightOn:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},pointLightAttenuation:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},pointLightIntensity:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},pointLightPosition:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},pointLightCastShadow:{type:"array",
elements:{type:"boolean"},staticSize:5,source:"uniform"},pointLightShadowBias:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},pointLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},pointLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},pointLightProjection:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},pointLightNearFar:{type:"array",elements:{type:"object",
kind:"float2"},staticSize:5,source:"uniform"},MAX_DIRECTIONALLIGHTS:{type:"int",source:"constant",staticValue:5},directionalLightOn:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},directionalLightIntensity:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},directionalLightDirection:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},directionalLightCastShadow:{type:"array",elements:{type:"boolean"},staticSize:5,
source:"uniform"},directionalLightShadowBias:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},directionalLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},directionalLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},MAX_SPOTLIGHTS:{type:"int",source:"constant",staticValue:5},spotLightOn:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},spotLightAttenuation:{type:"array",
elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightIntensity:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightPosition:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightDirection:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightCosCutoffAngle:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},spotLightCosSoftCutoffAngle:{type:"array",
elements:{type:"number"},staticSize:5,source:"uniform"},spotLightCastShadow:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},spotLightShadowBias:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},spotLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},spotLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},ssaoMap:{type:"object",kind:"texture",source:"uniform"},environment:{type:"object",
kind:"texture",source:"uniform"}};m.exports=function(c){b||(c.getExtensionByName(e.EXTENSIONS.STANDARD_DERIVATES)&&(a.fwidth={type:Shade.TYPES.FUNCTION},a.dx={type:Shade.TYPES.FUNCTION},a.dy={type:Shade.TYPES.FUNCTION}),b=a);return b}},{"../../base/context.js":113}],128:[function(d,m,l){var e=d("./js/jsshadercomposer.js"),b=d("./urn/urnshadercomposer.js"),a=d("./abstractshadercomposer.js").DefaultComposer;d=function(c){this.context=c;this.composers={};this.defaultComposer=new a(c);this.lightValuesDirty=
!0};XML3D.extend(d.prototype,{createComposerFromMaterialConfiguration:function(a){if(!a)return this.defaultComposer;var d=this.composers[a.id];if(!d){try{var g=a.model.type;switch(g){case "urn":d=new b(this.context,a);break;case "text/javascript":case "application/javascript":case "text/shade-javascript":d=new e(this.context,a);break;default:XML3D.debug.logError("Can not create shader of type:",g,a.model)}}catch(f){XML3D.debug.logError("No shader could be created for '"+a.name+"':",f.message),d=this.defaultComposer}d&&
(this.composers[a.id]=d,this.context.getStatistics().materials++);return d||this.defaultComposer}return d},getTemplateById:function(a){return this.composers[a]},update:function(a){for(var b in this.composers)this.composers[b].update(a,{updateLightValues:this.lightValuesDirty});this.lightValuesDirty=!1},setLightStructureDirty:function(){this.setShaderRecompile()},setShaderRecompile:function(){for(var a in this.composers)this.composers[a].setShaderRecompile()},updateSystemUniforms:function(a,b){for(var e in this.composers)this.composers[e].updateSystemUniforms(a,
b)},setLightValueChanged:function(){for(var a in this.composers)this.composers[a].updateLightValues=!0}});m.exports=d},{"./abstractshadercomposer.js":123,"./js/jsshadercomposer.js":126,"./urn/urnshadercomposer.js":137}],129:[function(d,m,l){function e(a,c,b){b=new h.GLRenderTarget(c,b);return new g({context:c,setGLState:function(){},resetGLState:function(){}},b,a)}function b(a,c,b){b=new h.GLCubeMapRenderTarget(c,b);return new f({context:c,setGLState:function(){},resetGLState:function(){}},b,a)}function a(a){var c=
{};["spot","point","directional"].forEach(function(b){var e=a.filter(function(a){return a.light.model.id==b});c[b+"LightShadowMap"]=e.map(function(a){return a.slot})});return c}var c=d("../../renderer/scene/constants.js").EVENT_TYPE,h=d("../base/rendertarget"),g=d("../render-passes/light-pass"),f=d("../render-passes/pointlight-pass");d=function(a,b){this.context=a;b.on(c.LIGHT_STRUCTURE_CHANGED,this.onLightStructureChanged.bind(this));b.on(c.LIGHT_VALUE_CHANGED,this.onLightValueChanged.bind(this));
b.on(c.SCENE_SHAPE_CHANGED,this.onSceneShapeChanged.bind(this));this.shadowMapInfos=[];this.dirty=!0};XML3D.extend(d.prototype,{onLightStructureChanged:function(a,c){var d=this.shadowMapInfos;if(c)a:for(var f=0;f<d.length;f++){if(d[f].light===a){d.splice(index,1);break a}}else if(a.model.getParameter("castShadow")[0]){var f=a.scene.context,g=2*Math.max(f.canvasTarget.width,f.canvasTarget.height),g={width:g,height:g,colorFormat:f.gl.RGBA,depthFormat:f.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0},
g="point"==a.model.id?b(a,f,g):e(a,f,g);g.init(f);g.output.bind();f=f.textureManager.getEntry(g.output.colorTarget.handle.id);f.fixed=!0;g.output.unbind();d.push({light:a,pass:g,slot:f.slot});this.requestRendering("light added")}},onLightValueChanged:function(){this.requestRendering("light value changed")},onSceneShapeChanged:function(){this.requestRendering("scene shape changed")},requestRendering:function(){this.dirty=!0},updateForRendering:function(){if(this.dirty){for(var a=this.shadowMapInfos,
c=0;c<a.length;c++)a[c].pass.renderScene();this.dirty=!1}},fillGlobalParameters:function(c){var b=a(this.shadowMapInfos);XML3D.extend(c,b)}});m.exports=d},{"../../renderer/scene/constants.js":99,"../base/rendertarget":117,"../render-passes/light-pass":143,"../render-passes/pointlight-pass":147}],130:[function(d,m,l){XML3D.materials.register("diffuse",{vertex:"attribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec3 color;\r\nattribute vec2 texcoord;\r\n\r\nuniform mat4 modelViewProjectionMatrix;\r\nuniform mat4 modelViewMatrix;\r\nuniform mat3 modelViewMatrixN;\r\nuniform vec3 eyePosition;\r\n\r\nvarying vec3 fragNormal;\r\nvarying vec3 fragVertexPosition;\r\nvarying vec3 fragEyeVector;\r\nvarying vec2 fragTexCoord;\r\nvarying vec3 fragVertexColor;\r\n\r\nvoid main(void) {\r\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\r\n    fragNormal = normalize(modelViewMatrixN * normal);\r\n    fragVertexPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;\r\n    fragEyeVector = normalize(fragVertexPosition);\r\n    fragTexCoord = texcoord;\r\n    fragVertexColor = color;\r\n}\r\n",
fragment:"uniform float ambientIntensity;\r\nuniform vec3 diffuseColor;\r\nuniform vec3 emissiveColor;\r\nuniform float opacity;\r\nuniform mat4 viewMatrix;\r\nuniform bool useVertexColor;\r\n#if HAS_EMISSIVETEXTURE\r\nuniform sampler2D emissiveTexture;\r\n#endif\r\n#if HAS_DIFFUSETEXTURE\r\nuniform sampler2D diffuseTexture;\r\n#endif\r\nvarying vec3 fragNormal;\r\nvarying vec3 fragVertexPosition;\r\nvarying vec3 fragEyeVector;\r\nvarying vec2 fragTexCoord;\r\nvarying vec3 fragVertexColor;\r\n#if MAX_POINTLIGHTS > 0\r\nuniform vec3 pointLightAttenuation[MAX_POINTLIGHTS];\r\nuniform vec3 pointLightPosition[MAX_POINTLIGHTS];\r\nuniform vec3 pointLightIntensity[MAX_POINTLIGHTS];\r\nuniform bool pointLightOn[MAX_POINTLIGHTS];\r\n#endif\r\n#if MAX_DIRECTIONALLIGHTS > 0\r\nuniform vec3 directionalLightDirection[MAX_DIRECTIONALLIGHTS];\r\nuniform vec3 directionalLightIntensity[MAX_DIRECTIONALLIGHTS];\r\nuniform bool directionalLightOn[MAX_DIRECTIONALLIGHTS];\r\n#endif\r\n#if MAX_SPOTLIGHTS > 0\r\nuniform vec3 spotLightAttenuation[MAX_SPOTLIGHTS];\r\nuniform vec3 spotLightPosition[MAX_SPOTLIGHTS];\r\nuniform vec3 spotLightIntensity[MAX_SPOTLIGHTS];\r\nuniform bool spotLightOn[MAX_SPOTLIGHTS];\r\nuniform vec3 spotLightDirection[MAX_SPOTLIGHTS];\r\nuniform float spotLightCosCutoffAngle[MAX_SPOTLIGHTS];\r\nuniform float spotLightCosSoftCutoffAngle[MAX_SPOTLIGHTS];\r\nuniform float spotLightSoftness[MAX_SPOTLIGHTS];\r\n#endif\r\nvoid main(void) {\r\n  float alpha =  max(0.0, opacity);\r\n  vec3 objDiffuse = diffuseColor;\r\n  if(useVertexColor)\r\n    objDiffuse *= fragVertexColor;\r\n  #if HAS_DIFFUSETEXTURE\r\n    vec4 texDiffuse = texture2D(diffuseTexture, fragTexCoord);\r\n    alpha *= texDiffuse.a;\r\n    objDiffuse *= texDiffuse.rgb;\r\n  #endif\r\n  if (alpha < 0.05) discard;\r\n  #if HAS_EMISSIVETEXTURE\r\n    vec3 color = emissiveColor * texture2D(emissiveTexture, fragTexCoord).rgb + (ambientIntensity * objDiffuse);\r\n  #else\r\n    vec3 color = emissiveColor + (ambientIntensity * objDiffuse);\r\n  #endif\r\n  #if MAX_POINTLIGHTS > 0\r\n    for (int i=0; i<MAX_POINTLIGHTS; i++) {\r\n      if (!pointLightOn[i])\r\n         continue;\r\n      vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\r\n      vec3 L = lPosition.xyz - fragVertexPosition;\r\n      float dist = length(L);\r\n      L = normalize(L);\r\n      float atten = 1.0 / (pointLightAttenuation[i].x + pointLightAttenuation[i].y * dist + pointLightAttenuation[i].z * dist * dist);\r\n      vec3 Idiff = pointLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\r\n      color = color + atten*Idiff;\r\n    }\r\n  #endif\r\n#if MAX_DIRECTIONALLIGHTS > 0\r\n  for (int i=0; i<MAX_DIRECTIONALLIGHTS; i++) {\r\n      if (!directionalLightOn[i])\r\n         continue;\r\n    vec4 lDirection = viewMatrix * vec4(directionalLightDirection[i], 0.0);\r\n    vec3 L =  normalize(-lDirection.xyz);\r\n    vec3 Idiff = directionalLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\r\n    color = color + Idiff;\r\n  }\r\n#endif\r\n#if MAX_SPOTLIGHTS > 0\r\n  for (int i=0; i<MAX_SPOTLIGHTS; i++) {\r\n      if (!spotLightOn[i])\r\n         continue;\r\n    vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\r\n    vec3 L = lPosition.xyz - fragVertexPosition;\r\n    float dist = length(L);\r\n    L = normalize(L);\r\n    float atten = 1.0 / (spotLightAttenuation[i].x + spotLightAttenuation[i].y * dist + spotLightAttenuation[i].z * dist * dist);\r\n    vec3 Idiff = spotLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\r\n    vec4 lDirection = viewMatrix * vec4(-spotLightDirection[i], 0.0);\r\n    vec3 D = normalize(lDirection.xyz);\r\n    float angle = dot(L, D);\r\n    if(angle > spotLightCosCutoffAngle[i]) {\r\n       float softness = 1.0;\r\n       if (angle < spotLightCosSoftCutoffAngle[i])\r\n           softness = (angle - spotLightCosCutoffAngle[i]) /  (spotLightCosSoftCutoffAngle[i] -  spotLightCosCutoffAngle[i]);\r\n       color += atten * softness * Idiff;\r\n    }\r\n  }\r\n#endif\r\n  gl_FragColor = vec4(color, alpha);\r\n}\r\n",
addDirectives:function(e,b,a){["point","directional","spot"].forEach(function(a){var d=b.getModelCount(a);e.push("MAX_"+a.toUpperCase()+"LIGHTS "+d)});e.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in a?"1":"0"));e.push("HAS_EMISSIVETEXTURE "+("emissiveTexture"in a?"1":"0"))},hasTransparency:function(e){return e.opacity&&1>e.opacity.getValue()[0]},uniforms:{diffuseColor:[1,1,1],emissiveColor:[0,0,0],opacity:1,ambientIntensity:0,useVertexColor:!1},samplers:{diffuseTexture:null,emissiveTexture:null},
attributes:{normal:{required:!0},texcoord:null,color:null}})},{}],131:[function(d,m,l){XML3D.materials.register("matte",{vertex:"attribute vec3 position;\nattribute vec3 color;\nvarying vec3 fragVertexColor;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n   fragVertexColor = color;\n   gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"uniform vec3 diffuseColor;\nuniform bool useVertexColor;\nvarying vec3 fragVertexColor;\nvoid main(void) {\n    vec3 color = diffuseColor;\n    if (useVertexColor)\n       color *=  fragVertexColor;\n    gl_FragColor = vec4(color, 1.0);\n}",
uniforms:{diffuseColor:[1,1,1],useVertexColor:!1},attributes:{color:null,normal:null}});XML3D.materials.register("flat",XML3D.materials.getScript("matte"))},{}],132:[function(d,m,l){XML3D.materials.register("phong",{vertex:"attribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec3 color;\r\nattribute vec2 texcoord;\r\n\r\nuniform mat4 modelMatrix;\r\nuniform mat4 modelViewProjectionMatrix;\r\nuniform mat4 modelViewMatrix;\r\nuniform mat3 modelViewMatrixN;\r\nuniform vec3 eyePosition;\r\n\r\nvarying vec3 fragNormal;\r\nvarying vec3 fragVertexPosition;\r\nvarying vec3 fragEyeVector;\r\nvarying vec2 fragTexCoord;\r\nvarying vec3 fragVertexColor;\r\n\r\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\r\nvarying vec3 fragWorldPosition; //needed by any of the light types\r\n#endif\r\n\r\nvoid main(void) {\r\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\r\n    fragNormal = normalize(modelViewMatrixN * normal);\r\n    fragVertexPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;\r\n    fragEyeVector = normalize(fragVertexPosition);\r\n    fragTexCoord = texcoord;\r\n    fragVertexColor = color;\r\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\r\n    fragWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;\r\n#endif\r\n}\r\n",
fragment:"uniform float ambientIntensity;\r\nuniform vec3 diffuseColor;\r\nuniform vec3 emissiveColor;\r\nuniform float shininess;\r\nuniform vec3 specularColor;\r\nuniform float opacity;\r\nuniform mat4 viewMatrix;\r\nuniform bool useVertexColor;\r\nuniform vec3 coords;\r\n#if HAS_EMISSIVETEXTURE\r\nuniform sampler2D emissiveTexture;\r\n#endif\r\n#if HAS_DIFFUSETEXTURE\r\nuniform sampler2D diffuseTexture;\r\n#endif\r\n#if HAS_SPECULARTEXTURE\r\nuniform sampler2D specularTexture;\r\n#endif\r\n\r\nvarying vec3 fragNormal;\r\nvarying vec3 fragVertexPosition;\r\nvarying vec3 fragEyeVector;\r\nvarying vec2 fragTexCoord;\r\nvarying vec3 fragVertexColor;\r\n\r\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\r\n    varying vec3 fragWorldPosition;  //if there is Shadow we need world position and unpacking function\r\n    float unpackDepth( const in vec4 rgba_depth ) {\r\n      const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\r\n      float depth = dot( rgba_depth, bit_shift );\r\n      return depth;\r\n    }\r\n#endif\r\n\r\n#if MAX_POINTLIGHTS > 0\r\nuniform vec3 pointLightAttenuation[MAX_POINTLIGHTS];\r\nuniform vec3 pointLightPosition[MAX_POINTLIGHTS];\r\nuniform vec3 pointLightIntensity[MAX_POINTLIGHTS];\r\nuniform bool pointLightOn[MAX_POINTLIGHTS];\r\nuniform bool pointLightCastShadow[MAX_POINTLIGHTS];\r\n#if HAS_POINTLIGHT_SHADOWMAPS\r\nuniform samplerCube pointLightShadowMap[MAX_POINTLIGHTS];\r\nuniform float pointLightShadowBias[MAX_POINTLIGHTS];\r\nuniform vec2 pointLightNearFar[MAX_POINTLIGHTS];\r\nfloat vecToDepth(vec3 vec, float n, float f){\r\nvec3 absVec = abs(vec);\r\nfloat maxComp = max(absVec.x, max(absVec.y, absVec.z));\r\nfloat res = (f+n)/(f-n)-(2.0*f*n)/(f-n)/maxComp;\r\nreturn res*0.5+0.5;\r\n}\r\n#endif\r\n#endif\r\n#if MAX_SPOTLIGHTS > 0\r\nuniform vec3 spotLightAttenuation[MAX_SPOTLIGHTS];\r\nuniform vec3 spotLightPosition[MAX_SPOTLIGHTS];\r\nuniform vec3 spotLightIntensity[MAX_SPOTLIGHTS];\r\nuniform bool spotLightOn[MAX_SPOTLIGHTS];\r\nuniform vec3 spotLightDirection[MAX_SPOTLIGHTS];\r\nuniform float spotLightCosCutoffAngle[MAX_SPOTLIGHTS];\r\nuniform float spotLightCosSoftCutoffAngle[MAX_SPOTLIGHTS];\r\nuniform float spotLightSoftness[MAX_SPOTLIGHTS];\r\nuniform bool spotLightCastShadow[MAX_SPOTLIGHTS];\r\n#if HAS_SPOTLIGHT_SHADOWMAPS\r\nuniform mat4 spotLightMatrix[ MAX_SPOTLIGHTS ];//used for shadowmapcoord calculation\r\nuniform sampler2D spotLightShadowMap[MAX_SPOTLIGHTS];\r\nuniform float spotLightShadowBias[MAX_SPOTLIGHTS];\r\n#endif\r\n#endif\r\n#if MAX_DIRECTIONALLIGHTS > 0\r\nuniform vec3 directionalLightDirection[MAX_DIRECTIONALLIGHTS];\r\nuniform vec3 directionalLightIntensity[MAX_DIRECTIONALLIGHTS];\r\nuniform bool directionalLightOn[MAX_DIRECTIONALLIGHTS];\r\nuniform bool directionalLightCastShadow[MAX_DIRECTIONALLIGHTS];\r\n#if HAS_DIRECTIONALLIGHT_SHADOWMAPS\r\nuniform mat4 directionalLightMatrix[MAX_DIRECTIONALLIGHTS];\r\nuniform sampler2D directionalLightShadowMap[MAX_DIRECTIONALLIGHTS];\r\nuniform float directionalLightShadowBias[MAX_DIRECTIONALLIGHTS];\r\n#endif\r\n#endif\r\nuniform sampler2D ssaoMap;\r\nvoid main(void) {\r\n#if MAX_POINTLIGHTS > 0 && HAS_POINTLIGHT_SHADOWMAPS\r\n    vec3 pointLightShadowMapDirection[MAX_POINTLIGHTS];\r\n    for(int i = 0; i < MAX_POINTLIGHTS; i++) {\r\n       pointLightShadowMapDirection[i] = fragWorldPosition - pointLightPosition[i];\r\n    }\r\n#endif\r\n#if MAX_SPOTLIGHTS > 0 && HAS_SPOTLIGHT_SHADOWMAPS\r\n    vec4 spotLightShadowMapCoord[MAX_SPOTLIGHTS];\r\n    for(int i = 0; i < MAX_SPOTLIGHTS; i++) {\r\n      spotLightShadowMapCoord[i] = spotLightMatrix[i] * vec4(fragWorldPosition, 1.0);\r\n    }\r\n#endif\r\n#if MAX_DIRECTIONALLIGHTS > 0 && HAS_DIRECTIONALLIGHT_SHADOWMAPS\r\n    vec4 directionalLightShadowMapCoord[MAX_DIRECTIONALLIGHTS];\r\n    for(int i = 0; i < MAX_DIRECTIONALLIGHTS; i++) {\r\n      directionalLightShadowMapCoord[i] = directionalLightMatrix[i] * vec4(fragWorldPosition, 1.0);\r\n    }\r\n#endif\r\n  float alpha =  max(0.0, opacity);\r\n  vec3 objDiffuse = diffuseColor;\r\n  if(useVertexColor)\r\n    objDiffuse *= fragVertexColor;\r\n  #if HAS_DIFFUSETEXTURE\r\n    vec4 texDiffuse = texture2D(diffuseTexture, fragTexCoord);\r\n    alpha *= texDiffuse.a;\r\n    objDiffuse *= texDiffuse.rgb;\r\n  #endif\r\n  if (alpha < 0.05) discard;\r\n  #if HAS_EMISSIVETEXTURE\r\n    vec3 color = emissiveColor * texture2D(emissiveTexture, fragTexCoord).rgb + (ambientIntensity * objDiffuse);\r\n  #else\r\n    vec3 color = emissiveColor + (ambientIntensity * objDiffuse);\r\n  #endif\r\n  vec3 objSpecular = specularColor;\r\n  #if HAS_SPECULARTEXTURE\r\n    objSpecular = objSpecular * texture2D(specularTexture, fragTexCoord).rgb;\r\n  #endif\r\n  #if HAS_SSAOMAP\r\n\t float ssao = 1.0 - texture2D(ssaoMap, gl_FragCoord.xy / coords.xy).r;\r\n  #endif\r\n  float shadowInfluence = 0.0; //used for sampling shadow\r\n#if MAX_POINTLIGHTS > 0\r\n  for (int i = 0; i < MAX_POINTLIGHTS; i++) {\r\n    shadowInfluence = 1.0;\r\n    if(pointLightOn[i]){\r\n   #if HAS_POINTLIGHT_SHADOWMAPS\r\n       if(pointLightCastShadow[i]){\r\n           shadowInfluence = 0.0;\r\n           float lsDepth = vecToDepth(pointLightShadowMapDirection[i], pointLightNearFar[i].x, pointLightNearFar[i].y );\r\n\t\t    float depth = unpackDepth( textureCube(pointLightShadowMap[i], pointLightShadowMapDirection[i])) +  pointLightShadowBias[i];\r\n           if(lsDepth < depth)\r\n               shadowInfluence = 1.0;\r\n       }\r\n       if(shadowInfluence > 0.0){\r\n   #endif\r\n       vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\r\n       vec3 L = lPosition.xyz - fragVertexPosition;\r\n       float dist = length(L);\r\n       L = normalize(L);\r\n       vec3 R = normalize(reflect(L,fragNormal));\r\n       float atten = 1.0 / (pointLightAttenuation[i].x + pointLightAttenuation[i].y * dist + pointLightAttenuation[i].z * dist * dist);\r\n       vec3 Idiff = pointLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\r\n   #if HAS_SSAOMAP\r\n       Idiff *= ssao;\r\n   #endif\r\n       vec3 Ispec = pointLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\r\n       color = color + (atten*shadowInfluence*(Idiff + Ispec));\r\n   #if HAS_POINTLIGHT_SHADOWMAPS\r\n       }  //pointlight visible\r\n   #endif\r\n     } //pointLight on\r\n  } //pointLight loop\r\n#endif\r\n#if MAX_SPOTLIGHTS > 0\r\n  for (int i=0; i<MAX_SPOTLIGHTS; i++) {\r\n    shadowInfluence = 1.0;\r\n    if(spotLightOn[i]) {\r\n  #if HAS_SPOTLIGHT_SHADOWMAPS\r\n       if(spotLightCastShadow[i]){\r\n           shadowInfluence = 0.0;\r\n           vec4 lspos = spotLightShadowMapCoord[i];\r\n\t\t\tvec3 perspectiveDivPos = lspos.xyz / lspos.w * 0.5 + 0.5;\r\n\t\t\tfloat lsDepth = perspectiveDivPos.z;\r\n\t\t\tvec2 lightuv = perspectiveDivPos.xy;\r\n\t\t\tfloat depth = unpackDepth(texture2D(spotLightShadowMap[i], lightuv)) + spotLightShadowBias[i];\r\n           if(lsDepth < depth)\r\n               shadowInfluence = 1.0;\r\n       }\r\n       if(shadowInfluence > 0.0){\r\n  #endif\r\n       vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\r\n       vec3 L = lPosition.xyz - fragVertexPosition;\r\n       float dist = length(L);\r\n       L = normalize(L);\r\n       vec3 R = normalize(reflect(L,fragNormal));\r\n       float atten = 1.0 / (spotLightAttenuation[i].x + spotLightAttenuation[i].y * dist + spotLightAttenuation[i].z * dist * dist);\r\n       vec3 Idiff = spotLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\r\n   #if HAS_SSAOMAP\r\n\t    Idiff *= ssao;\r\n   #endif\r\n       vec3 Ispec = spotLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\r\n       vec4 lDirection = viewMatrix * vec4(-spotLightDirection[i], 0.0);\r\n       vec3 D = normalize(lDirection.xyz);\r\n       float angle = dot(L, D);\r\n       if(angle > spotLightCosCutoffAngle[i]) {\r\n           float softness = 1.0;\r\n           if (angle < spotLightCosSoftCutoffAngle[i])\r\n               softness = (angle - spotLightCosCutoffAngle[i]) /  (spotLightCosSoftCutoffAngle[i] -  spotLightCosCutoffAngle[i]);\r\n           color += atten*softness*shadowInfluence*(Idiff + Ispec);\r\n       }\r\n   #if HAS_SPOTLIGHT_SHADOWMAPS\r\n       } //light visible if shadow enabled\r\n   #endif\r\n   }  // spotlight on\r\n  } // light loop\r\n#endif\r\n#if MAX_DIRECTIONALLIGHTS > 0\r\n  for (int i=0; i<MAX_DIRECTIONALLIGHTS; i++) {\r\n   shadowInfluence = 1.0;\r\n   if(directionalLightOn[i]){\r\n   #if HAS_DIRECTIONALLIGHT_SHADOWMAPS\r\n       if(directionalLightCastShadow[i]){\r\n           shadowInfluence = 0.0;\r\n           vec4 lspos = directionalLightShadowMapCoord[i];\r\n           vec3 orthogonalDivPos = lspos.xyz / lspos.w *0.5 + 0.5;\r\n           float lsDepth = orthogonalDivPos.z;\r\n           vec2 lightuv = orthogonalDivPos.xy;\r\n               float depth = unpackDepth(texture2D(directionalLightShadowMap[i], lightuv))+directionalLightShadowBias[i];\r\n               if(lsDepth < depth) shadowInfluence = 1.0;\r\n       }\r\n       if(shadowInfluence > 0.0){\r\n   #endif\r\n       vec4 lDirection = viewMatrix * vec4(directionalLightDirection[i], 0.0);\r\n       vec3 L =  normalize(-lDirection.xyz);\r\n       vec3 R = normalize(reflect(L,fragNormal));\r\n       vec3 Idiff = directionalLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\r\n   #if HAS_SSAOMAP\r\n       Idiff *= ssao;\r\n   #endif\r\n       vec3 Ispec = directionalLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\r\n       color = color + shadowInfluence*((Idiff + Ispec));\r\n   #if HAS_DIRECTIONALLIGHT_SHADOWMAPS\r\n       } //light visible\r\n   #endif\r\n   } //dirLight on\r\n  } // dirLight loop\r\n#endif\r\n  gl_FragColor = vec4(color, alpha);\r\n}\r\n",
addDirectives:function(e,b,a){["point","directional","spot"].forEach(function(a){var d=b.getModelCount(a),g=!1;d&&(g=Array.prototype.some.call(b.getModelEntry(a).parameters.castShadow,function(a){return a}));e.push("MAX_"+a.toUpperCase()+"LIGHTS "+d);e.push("HAS_"+a.toUpperCase()+"LIGHT_SHADOWMAPS "+(g?1:0))});e.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in a?"1":"0"));e.push("HAS_SPECULARTEXTURE "+("specularTexture"in a?"1":"0"));e.push("HAS_EMISSIVETEXTURE "+("emissiveTexture"in a?"1":"0"));e.push("HAS_SSAOMAP "+
(XML3D.options.getValue("renderer-ssao")?"1":"0"))},hasTransparency:function(e){return e.opacity&&1>e.opacity.getValue()[0]},uniforms:{diffuseColor:[1,1,1],emissiveColor:[0,0,0],specularColor:[0,0,0],opacity:1,shininess:.2,ambientIntensity:0,useVertexColor:!1},samplers:{diffuseTexture:null,emissiveTexture:null,specularTexture:null,directionalLightShadowMap:null,spotLightShadowMap:null,pointLightShadowMap:null,ssaoMap:null},attributes:{normal:{required:!0},texcoord:null,color:null}})},{}],133:[function(d,
m,l){XML3D.materials.register("point",{vertex:"attribute vec3 position;\nattribute vec3 color;\nattribute vec2 texcoord;\nvarying vec3 fragNormal;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 modelViewMatrixN;\nuniform vec3 coords;\nuniform float pointSize;\nvoid main(void) {\n    vec3 pos = position;\n    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n    fragTexCoord = texcoord;\n    fragVertexColor = color;\n    vec4 pos2 = modelViewMatrix * vec4(pos, 1.0);\n    pos2.x += pointSize;\n    gl_PointSize = distance( gl_Position.xy, (projectionMatrix * pos2).xy ) * coords.x / gl_Position.w;\n}",
fragment:"uniform vec3 diffuseColor;\nuniform float opacity;\nuniform mat4 viewMatrix;\nuniform bool useVertexColor;\nuniform vec2 texCoordOffset;\nuniform vec2 texCoordSize;\n#if HAS_DIFFUSETEXTURE\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec3 fragNormal;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\nvoid main(void) {\n  float alpha =  max(0.0, opacity);\n  vec3 objDiffuse = diffuseColor;\n  if(useVertexColor)\n    objDiffuse *= fragVertexColor;\n  #if HAS_DIFFUSETEXTURE\n    vec2 texCoord = fragTexCoord + texCoordOffset + gl_PointCoord*texCoordSize;\n    vec4 texDiffuse = texture2D(diffuseTexture, texCoord);\n    alpha *= texDiffuse.a;\n    objDiffuse *= texDiffuse.rgb;\n  #endif\n  if (alpha < 0.05) discard;\n  gl_FragColor = vec4(objDiffuse, alpha);\n}",
addDirectives:function(e,b,a){e.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in a?"1":"0"))},hasTransparency:function(e){return e.opacity&&1>e.opacity.getValue()[0]},uniforms:{diffuseColor:[1,1,1],texCoordOffset:[0,0],texCoordSize:[1,1],opacity:1,useVertexColor:!1,pointSize:1},samplers:{diffuseTexture:null},attributes:{texcoord:null,color:null}})},{}],134:[function(d,m,l){var e={};m.exports={register:function(b,a){e[b]=a;a.name=b},getScript:function(b){return e[b]}}},{}],135:[function(d,m,l){d=function(){this.uniforms=
{};this.samplers={};this.attributes={};this.vertex=this.fragment=this.name=""};d.prototype.addDirectives=function(){};d.prototype.hasTransparency=function(){return!1};m.exports=d},{}],136:[function(d,m,l){var e=d("./../abstractshaderclosure.js"),b=d("../../system/system-notifier.js");d=function(a,c){e.call(this,a);this.descriptor=c};XML3D.createClass(d,e);XML3D.extend(d.prototype,{setDefaultUniforms:function(a){XML3D.extend(a,this.descriptor.uniforms)},createSources:function(a,c,e){var d=e&&e.getResult();
e=[];var f={};c&&XML3D.extend(f,c.getOutputMap());d&&XML3D.extend(f,d.getOutputMap());for(var k in this.descriptor.attributes)if((c=this.descriptor.attributes[k])&&c.required&&!f[k])throw Error("Mesh is missing '"+k+"' attribute.");this.descriptor.addDirectives(e,a.lights||{},f);this.source={fragment:this.addDirectivesToSource(e,this.descriptor.fragment),vertex:this.addDirectivesToSource(e,this.descriptor.vertex)};b.sendEvent("urnshader",{urnshaderType:"code",vertexShader:this.source.vertex,fragmentShader:this.source.fragment});
return!0},addDirectivesToSource:function(a,c){var b="";a.forEach(function(a){b="#"===a[0]?b+(a+"\n"):b+("#define "+a+"\n")});return b+"\n"+c},getTransparencyFromInputData:function(a){return this.descriptor.hasTransparency(a)}});m.exports=d},{"../../system/system-notifier.js":160,"./../abstractshaderclosure.js":122}],137:[function(d,m,l){var e=d("../abstractshadercomposer.js").AbstractShaderComposer,b=d("./urnshaderclosure.js"),a=d("./shader-descriptor.js"),c=d("../../../../xflow/interface/request.js").ComputeRequest,
h=d("../../shader/shader-utils.js").addFragmentShaderHeader;d("./diffuse.js");d("./phong.js");d("./matte.js");d("./point.js");d("./utility.js");d=function(a,c){e.call(this,a,c);this.descriptor=null;this.setMaterialConfiguration(c)};XML3D.createClass(d,e,{setMaterialConfiguration:function(a){this.setShaderScript(a.model.urn);this.descriptor&&(a.dataNode&&this.updateRequest(a.dataNode),this.descriptor.fragment=h(this.descriptor.fragment))},setShaderScript:function(c){if(c)if("urn"!=c.scheme)XML3D.debug.logError("Material model reference should start with an URN: ",
this.adapter.node);else{var b;b=c.path;b=b.substring(b.lastIndexOf(":")+1);b=XML3D.materials.getScript(b);if(!b)throw Error("Unknown URN: "+c);this.descriptor=new a;XML3D.extend(this.descriptor,b)}else XML3D.debug.logError("Material has no script attached: ",this.adapter.node)},getRequestFields:function(){return Object.keys(this.descriptor.uniforms).concat(Object.keys(this.descriptor.samplers))},getShaderAttributes:function(){return this.descriptor.attributes},createShaderClosure:function(){return new b(this.context,
this.descriptor)},createObjectDataRequest:function(a,b){var e=["position"];e.push.apply(e,Object.keys(this.descriptor.attributes));e.push.apply(e,Object.keys(this.descriptor.uniforms));e.push.apply(e,Object.keys(this.descriptor.samplers));return new c(a,e,b)},distributeObjectShaderData:function(a,c,b){a=a.getResult().getOutputMap();for(var e in a)"position"==e||void 0!==this.descriptor.attributes[e]?c(e,a[e]):void 0===this.descriptor.uniforms[e]&&void 0===this.descriptor.samplers[e]||b(e,a[e])}});
m.exports=d},{"../../../../xflow/interface/request.js":192,"../../shader/shader-utils.js":159,"../abstractshadercomposer.js":123,"./diffuse.js":130,"./matte.js":131,"./phong.js":132,"./point.js":133,"./shader-descriptor.js":135,"./urnshaderclosure.js":136,"./utility.js":138}],138:[function(d,m,l){XML3D.materials.register("pickobjectid",{vertex:"attribute vec3 position;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",
fragment:"uniform vec3 id;\nvoid main(void) {\n    gl_FragColor = vec4(id, 0.0);\n}",uniforms:{}});XML3D.materials.register("pickedposition",{vertex:"attribute vec3 position;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform vec3 bbox[2];\nvarying vec3 worldCoord;\nvoid main(void) {\n    worldCoord = (modelMatrix * vec4(position, 1.0)).xyz;\n    vec3 diff = bbox[1] - bbox[0];\n    worldCoord = worldCoord - bbox[0];\n    worldCoord = worldCoord / diff;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",
fragment:"varying vec3 worldCoord;\nvoid main(void) {\n    gl_FragColor = vec4(worldCoord, 1.0);\n}",uniforms:{}});XML3D.materials.register("pickedNormals",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat3 modelViewMatrixN;\nvarying vec3 fragNormal;\nvoid main(void) {\n    fragNormal = normalize(modelViewMatrixN * normal);\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 fragNormal;\nvoid main(void) {\n    gl_FragColor = vec4((fragNormal+1.0)/2.0 * (254.0 / 255.0), 1.0);\n}",
uniforms:{}});XML3D.materials.register("light-depth",{vertex:"attribute vec3 position;\nvarying vec4 worldPosition;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n   worldPosition = modelMatrix * vec4(position, 1.0);\n   gl_Position   = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec4 worldPosition;\nuniform mat4 viewMatrix;\nvec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main(void) {\n    gl_FragColor = pack_depth( gl_FragCoord.z );\n}",
uniforms:{}});XML3D.materials.register("render-normal",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat3 modelMatrixN;\nvarying vec3 fragNormal;\nvoid main(void) {\n    fragNormal = modelMatrixN * normal;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 fragNormal;\nvoid main(void) {\n   gl_FragColor = vec4((normalize(fragNormal) + 1.0) / 2.0, 1.0);\n}",uniforms:{}});XML3D.materials.register("render-position",
{vertex:"attribute vec3 position;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nvarying vec3 worldCoord;\nvoid main(void) {\n    worldCoord = (modelMatrix * vec4(position, 1.0)).xyz;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 worldCoord;\nvoid main(void) {\n    gl_FragColor = vec4(worldCoord, 1.0);\n}",uniforms:{}});XML3D.materials.register("boxblur",{vertex:"attribute vec3 position;\nvoid main(void) {\n   gl_Position = vec4(position, 1.0);\n}",
fragment:"uniform sampler2D sInTexture;\nuniform vec2 canvasSize;\nuniform vec2 blurOffset;\nconst float blurSize = 1.0/512.0;\nvoid main(void) {\n   vec2 texcoord = (gl_FragCoord.xy / canvasSize.xy);\n   vec4 sum = vec4(0.0);\n   float blurSizeY = blurOffset.y / canvasSize.y;\n   float blurSizeX = blurOffset.x / canvasSize.x;\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - 1.5*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - 2.0*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + 2.0*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + 1.5*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x - 1.5*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x - 2.0*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x - blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + 2.0*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + 1.5*blurSizeX, texcoord.y));\n   gl_FragColor = sum / 12.0;\n}",
uniforms:{canvasSize:[512,512],blurOffset:[1,1]},samplers:{sInTexture:null}});XML3D.materials.register("ssao",{vertex:"attribute vec2 position;\nvoid main(void) {\n    gl_Position = vec4(position, 0.0, 1.0);\n}",fragment:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 canvasSize;\nuniform sampler2D sPositionTex;\nuniform sampler2D sNormalTex;\nuniform sampler2D sRandomNormals;\nuniform vec2 uRandomTexSize;\nuniform float uSampleRadius;\nuniform float uScale;\nuniform float uBias;\nuniform float uIntensity;\nuniform vec2 uConstVectors[4];\nuniform mat4 viewMatrix;\nvec3 getPosition(vec2 uv) {\nreturn texture2D(sPositionTex, uv).xyz;\n}\nfloat calcAmbientOcclusion(vec2 screenUV, vec2 uvOffset, vec3 origin, vec3 cnorm) {\n   vec3 diff = getPosition(screenUV + uvOffset) - origin;\n   vec3 v = normalize(diff);\n   float dist = length(diff) * uScale;\n   return max(0.0, dot(cnorm, v) - uBias) * (1.0/(1.0 + dist)) * uIntensity;\n}\nvoid main(void) {\n   vec2 screenUV = gl_FragCoord.xy / canvasSize.xy;\n   vec2 rand = normalize(texture2D(sRandomNormals, gl_FragCoord.xy / uRandomTexSize).xy * 2.0 - 1.0 );\n   vec3 norm = normalize(texture2D(sNormalTex, screenUV).xyz * 2.0 - 1.0 );\n   vec3 origin = getPosition(screenUV);\n   float radius = uSampleRadius / (viewMatrix * vec4(origin, 1.0)).z;\n   float ao = 0.0;\n   const int iterations = 4;\n   for (int i = 0; i < iterations; ++i) {\n       vec2 coord1 = reflect(uConstVectors[i], rand) * radius;\n       vec2 coord2 = vec2(coord1.x*0.707 - coord1.y*0.707, coord1.x*0.707 + coord1.y*0.707);\n       ao += calcAmbientOcclusion(screenUV, coord1*0.25, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord2*0.5, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord1*0.75, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord2, origin, norm);\n   }\n   ao /= (float(iterations) * 4.0);\n   gl_FragColor = vec4(ao, ao, ao, 1.0);\n}",
uniforms:{canvasSize:[512,512],uConstVectors:[1,0,-1,0,0,1,0,-1],uRandomTexSize:[64,64],uSampleRadius:.9,uScale:.9,uBias:.2,uIntensity:1},samplers:{sPositionTex:null,sNormalTex:null,sRandomNormals:null},attributes:{}})},{}],139:[function(d,m,l){function e(a,c){var b=c.gl;a.glStateMap={depthMask:{"default":[!0],set:function(a){b.depthMask.apply(b,a)}},depthTest:{"default":[!0],set:function(a){a[0]?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST)}},depthFunc:{"default":[b.LESS],set:function(a){b.depthFunc.apply(b,
a)}},blendEquationSeparate:{"default":[b.FUNC_ADD,b.FUNC_ADD],set:function(a){1==a.length?b.blendEquation(a[0]):b.blendEquationSeparate.apply(b,a)}},blendFuncSeparate:{"default":[b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA],set:function(a){2==a.length?b.blendFunc(a[0],a[1]):4==a.length&&b.blendFuncSeparate.apply(b,a)}},blend:{"default":[!1],set:function(a){a[0]?b.enable(b.BLEND):b.disable(b.BLEND)}},cullFace:{"default":[!0],set:function(a){a[0]?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE)}},cullFaceMode:{"default":[b.BACK],
set:function(a){b.cullFace.apply(b,a)}},colorMask:{"default":[!0,!0,!0,!0],set:function(a){1==a.length?b.colorMask(a[0],a[0],a[0],a[0]):b.colorMask.apply(b,a)}},scissorTest:{"default":[!1],set:function(a){a[0]?b.enable(b.SCISSOR_TEST):b.disable(b.SCISSOR_TEST)}},scissor:{"default":[0,0,10,10],set:function(a){b.scissor.apply(b,a)}}}}d("./constants.js");var b=d("./base/rendertarget.js"),a=d("./base/fullscreenquad.js"),c=d("./render-trees/forward.js"),h=d("./render-passes/forward.js"),g="depthMask depthTest depthFunc blendEquationSeparate blendFuncSeparate blend cullFace cullFaceMode colorMask scissorTest scissor".split(" ");
d=function(a,c){this.context=a;this.scene=c;this.shaders={};this.renderTree=null;e(this,a)};XML3D.extend(d.prototype,{getRenderTree:function(){return this.renderTree=this.renderTree||new c(this.context)},setRenderTree:function(a){this.renderTree=a;this.context.requestRedraw("Pipeline changed")},createRenderTarget:function(a){return new b.GLRenderTarget(this.context,a)},createScaledRenderTarget:function(a,c){return new b.GLScaledRenderTarget(this.context,a,c)},getShaderProgram:function(a){this.shaders[a]&&
this.shaders[a].isValid()||(this.shaders[a]=this.context.programFactory.getProgramByName(a));return this.shaders[a]},createFullscreenQuad:function(){return new a(this.context)},createSceneRenderPass:function(a){return new h(this,a||this.context.canvasTarget)},setGLState:function(a){for(var c in a)this.glStateMap[c].set(a[c])},resetGLState:function(a){for(var c in a)this.glStateMap[c].set(this.glStateMap[c]["default"])},getConfigurableGLStates:function(){return g}});m.exports={GLRenderInterface:d,
ConfigurableGLStates:g}},{"./base/fullscreenquad.js":114,"./base/rendertarget.js":117,"./constants.js":121,"./render-passes/forward.js":142,"./render-trees/forward.js":152}],140:[function(d,m,l){d=function(e,b,a){this.renderInterface=e;this.output=b;a=a||{};this.inputs=a.inputs||{};this.id=a.id||"";this.prePasses=[];this.postPasses=[];this.processed=!1};XML3D.extend(d.prototype,{addPrePass:function(e){-1===this.prePasses.indexOf(e)&&(this.prePasses.push(e),e.postPasses.push(this))},removePrePass:function(e){var b=
this.prePasses.indexOf(e);-1!==b&&(this.prePasses.splice(b,1),e.postPasses.splice(e.postPasses.indexOf(this),1))},clearPrePasses:function(){for(var e=this.prePasses.length;e--;)this.removePrePass(this.prePasses[e])},setProcessed:function(e){if(this.processed&&!e)for(var b=this.postPasses.length;b--;)this.postPasses[b].setProcessed(!1);this.processed=e},renderTree:function(e){if(!this.processed){this.processed=!0;for(var b=this.prePasses.length;b--;)this.prePasses[b].renderTree(e);this.render(e)}},
readPixelDataFromBuffer:function(){var e=new Uint8Array(8);return function(b,a,c){var d=this.renderInterface.context.gl,g=c.getScale();b*=g;a*=g;c.bind();try{return d.readPixels(b,a,1,1,d.RGBA,d.UNSIGNED_BYTE,e),c.unbind(),e}catch(f){return XML3D.debug.logException(f),c.unbind(),null}}}()});m.exports=d},{}],141:[function(d,m,l){var e=d("./base.js"),b=d("../base/fullscreenquad.js");d=function(a,c,d){e.call(this,a,c,d);this._program=this.renderInterface.context.programFactory.getProgramByName("boxblur");
this._screenQuad=new b(this.renderInterface.context);this._uniformsDirty=!0};XML3D.createClass(d,e);XML3D.extend(d.prototype,{render:function(){return function(){var a=this.renderInterface.context.gl,c=this.output;c.bind();a.clear(a.COLOR_BUFFER_BIT);a.disable(a.DEPTH_TEST);this._program.bind();this._setNonVolatileShaderUniforms();this._screenQuad.draw(this._program);this._program.unbind();c.unbind()}}(),_setNonVolatileShaderUniforms:function(){var a={},c=["canvasSize","sInTexture","blurOffset"];
return function(){if(this._uniformsDirty){var b=this._program,e=this.output;a.canvasSize=[e.width,e.height];a.sInTexture=[this.inputs.buffer.colorTarget.handle];a.blurOffset=[1,1];b.setSystemUniformVariables(c,a)}}}()});m.exports=d},{"../base/fullscreenquad.js":114,"./base.js":140}],142:[function(d,m,l){var e=d("./scene-pass.js"),b=d("../../renderer/tools/objectsorter.js"),a=d("gl-matrix").mat4;d=function(a,d,g){e.call(this,a,d,g);this.sorter=new b;this.lastRenderStats={}};XML3D.createClass(d,e);
XML3D.extend(d.prototype,{render:function(){var c=a.create(),b=a.create(),e=a.create(),d="viewMatrix viewInverseMatrix projectionMatrix cameraPosition coords ssaoMap width".split(" ");return function(a){var u=this.renderInterface.context.gl,q={objects:0,primitives:0},n=this.output,p=a.systemUniforms,r=n.getWidth(),t=n.getHeight(),r=r/t;n.bind();this.setGLStates();a.updateReadyObjectsFromActiveView(r);a.getActiveView().getWorldToViewMatrix(c);a.getActiveView().getViewToWorldMatrix(b);a.getActiveView().getProjectionMatrix(e,
r);r=this.sorter.sortObjects(a.ready,c);p.viewMatrix=c;p.viewInverseMatrix=b;p.projectionMatrix=e;p.cameraPosition=a.getActiveView().getWorldSpacePosition();p.coords=[n.width,n.height,1];this.inputs.ssaoMap&&(p.ssaoMap=[this.inputs.ssaoMap.colorTarget.handle]);for(var l in r.zLayers){t=r.zLayers[l];u.clear(u.DEPTH_BUFFER_BIT);for(var m in r.opaque[t])this.renderObjectsToActiveBuffer(r.opaque[t][m],a,n,p,d,{transparent:!1,stats:q});if(r.transparent[t].length)for(var y=0;y<r.transparent[t].length;y++)this.renderObjectsToActiveBuffer([r.transparent[t][y]],
a,n,p,d,{transparent:!0,stats:q})}a.lights.changed=!1;n.unbind();this.lastRenderStats.count=q}}(),getRenderStats:function(){return this.lastRenderStats}});m.exports=d},{"../../renderer/tools/objectsorter.js":111,"./scene-pass.js":148,"gl-matrix":1}],143:[function(d,m,l){var e=d("./scene-pass.js"),b=d("../../renderer/tools/objectsorter.js"),a=d("gl-matrix").mat4;d=function(a,b,d,f){e.call(this,a,b,f);this.light=d;this.program=null};XML3D.createClass(d,e,{init:function(a){this.sorter=new b;this.program=
a.programFactory.getProgramByName("light-depth")},renderScene:function(){this.render(this.light.scene)},render:function(){var c=a.create(),b=a.create(),e=["viewMatrix","projectionMatrix"];return function(a){var d=this.renderInterface.context.gl,u=this.output,q=u.getWidth(),n=u.getHeight(),p=q/n,r=this.light.getFrustum(p),q=this.program;u.bind();d.clear(d.DEPTH_BUFFER_BIT|d.COLOR_BUFFER_BIT);d.enable(d.DEPTH_TEST);n={objects:0,primitives:0};this.light.model.getLightViewMatrix(c);r.getProjectionMatrix(b,
p);a.updateReadyObjectsFromMatrices(c,b);p=this.sorter.sortObjects(a.ready);r={};r.viewMatrix=c;r.projectionMatrix=b;for(var t in p.zLayers){var l=p.zLayers[t];d.clear(d.DEPTH_BUFFER_BIT);for(var m in p.opaque[l])this.renderObjectsToActiveBuffer(p.opaque[l][m],a,u,r,e,{transparent:!1,stats:n,program:q})}u.unbind();return{count:n}}}()});m.exports=d},{"../../renderer/tools/objectsorter.js":111,"./scene-pass.js":148,"gl-matrix":1}],144:[function(d,m,l){var e=d("./base.js"),b=d("gl-matrix").vec3,a=d("gl-matrix").mat4,
c=d("gl-matrix").mat3;d=function(a,c,b){e.call(this,a,c,b)};XML3D.createClass(d,e,{render:function(){var b=a.create(),e=a.create(),d=c.create(),k={envBase:{},envOverride:null,sysBase:{}},u=["modelViewProjectionMatrix","modelViewMatrixN"];return function(a,n,p){var r=this.renderInterface.context.gl,t=this.output;t.bind();r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT);r.enable(r.DEPTH_TEST);r.disable(r.CULL_FACE);r.disable(r.BLEND);n&&p&&(a.updateModelViewMatrix(n),a.updateModelViewProjectionMatrix(p));
a.getModelViewProjectionMatrix(b);a.getWorldMatrix(e);XML3D.math.mat3.normalFromMat4(d,e)||c.identity(d);n=this.renderInterface.context.programFactory.getPickingNormalProgram();n.bind();k.sysBase.modelViewProjectionMatrix=b;k.sysBase.modelViewMatrixN=d;n.setUniformVariables(null,u,k);a.mesh.draw(n);n.unbind();t.unbind()}}(),readNormalFromPickingBuffer:function(){var a=b.create(),c=b.fromValues(1,1,1);return function(e,d){var u=this.readPixelDataFromBuffer(e,d,this.output);if(!u)return null;a[0]=u[0]/
254;a[1]=u[1]/254;a[2]=u[2]/254;b.scale(a,a,2);return b.subtract(b.create(),a,c)}}()});m.exports=d},{"./base.js":140,"gl-matrix":1}],145:[function(d,m,l){var e=d("./base.js"),b=d("gl-matrix").mat4,a=d("../../renderer/tools/objectsorter.js");d=function(c,b,d){e.call(this,c,b,d);this.sorter=new a;this.objCount=0};XML3D.createClass(d,e);XML3D.extend(d.prototype,{render:function(a,b,e){var d=this.renderInterface.context.gl,k=this.output;k.bind();a=this.sorter.sortObjects(a,b);this.objCount=0;d.enable(d.DEPTH_TEST);
d.disable(d.CULL_FACE);d.disable(d.BLEND);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);var u=this.renderInterface.context.programFactory.getPickingObjectIdProgram();u.bind();for(var q=0,n=a.zLayers.length;q<n;q++){var p=a.zLayers[q];d.clear(d.DEPTH_BUFFER_BIT);if(a.opaque[p])for(var r in a.opaque[p])this.renderObjects(a.opaque[p][r],u,b,e);a.transparent[p]&&this.renderObjects(a.transparent[p],u,b,e)}u.unbind();k.unbind()},renderObjects:function(){var a=b.create(),e={envBase:{},envOverride:null,
sysBase:{}},d=["id","modelViewProjectionMatrix"];return function(b,k,u,q){for(var n=0;n<b.length;n++){var p=b[n],r=p.mesh;if(p.visible){u&&q&&(p.updateModelViewMatrix(u),p.updateModelViewProjectionMatrix(q));p.getModelViewProjectionMatrix(a);var t=++this.objCount;p.pickId=t;var p=t&255,t=t>>8,l=t&255,t=t>>8;e.sysBase.id=[(t&255)/255,l/255,p/255];e.sysBase.modelViewProjectionMatrix=a;k.setUniformVariables(null,d,e);r.draw(k)}}}}(),getRenderObjectFromPickingBuffer:function(a,b,e){b=this.readPixelDataFromBuffer(a,
b,this.output);if(!b)return null;a=null;b=65536*b[0]+256*b[1]+b[2];if(0<b)for(var d=0;d<e.length;d++)if(e[d].inFrustum&&e[d].pickId===b){a=e[d];break}return a}});m.exports=d},{"../../renderer/tools/objectsorter.js":111,"./base.js":140,"gl-matrix":1}],146:[function(d,m,l){var e=d("./base.js"),b=d("gl-matrix").mat4,a=d("gl-matrix").vec3;d=function(a,b,d){e.call(this,a,b,d);this.objectBoundingBox=new XML3D.Box};XML3D.createClass(d,e,{render:function(){var a=b.create(),e=b.create(),d={envBase:{},envOverride:null,
sysBase:{}},f=["bbox","modelMatrix","modelViewProjectionMatrix"];return function(b,u,q){var n=this.renderInterface.context.gl,p=this.output;p.bind();n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT);n.enable(n.DEPTH_TEST);n.disable(n.CULL_FACE);n.disable(n.BLEND);u&&q&&(b.updateModelViewMatrix(u),b.updateModelViewProjectionMatrix(q));b.getWorldMatrix(a);b.getObjectSpaceBoundingBox(this.objectBoundingBox);this.objectBoundingBox.transformAxisAligned(a);u=this.renderInterface.context.programFactory.getPickingPositionProgram();
u.bind();b.getModelViewProjectionMatrix(e);d.sysBase.bbox=this.objectBoundingBox.data;d.sysBase.modelMatrix=a;d.sysBase.modelViewProjectionMatrix=e;u.setUniformVariables(null,f,d);b.mesh.draw(u);u.unbind();p.unbind()}}(),readPositionFromPickingBuffer:function(){var c=a.create();return function(b,e){var d=this.readPixelDataFromBuffer(b,e,this.output);return d?(c[0]=d[0]/255,c[1]=d[1]/255,c[2]=d[2]/255,d=this.objectBoundingBox.size(),a.mul(c,c,d.data),a.add(a.create(),c,this.objectBoundingBox.min.data)):
null}}()});m.exports=d},{"./base.js":140,"gl-matrix":1}],147:[function(d,m,l){var e=d("./scene-pass.js"),b=d("../../renderer/tools/objectsorter.js"),a=d("gl-matrix").mat4;d=function(a,b,d,f){e.call(this,a,b,f);this.light=d;this.program=null};XML3D.createClass(d,e,{init:function(a){this.sorter=new b;this.program=a.programFactory.getProgramByName("light-depth")},renderScene:function(){this.render(this.light.scene)},render:function(){var c=a.create(),b=a.create(),e=["viewMatrix","projectionMatrix"];
return function(a){for(var d=this.renderInterface.context.gl,u=this.output,q=u.getWidth(),n=u.getHeight(),q=q/n,n=this.light.getFrustum(q),p=this.program,r=0;r<u.glSides.length;r++){var t=new XML3D.Mat4;0==r?(t.m11=0,t.m12=0,t.m13=-1,t.m21=0,t.m22=-1,t.m23=0,t.m31=-1,t.m32=0,t.m33=0):1==r?(t.m11=0,t.m12=0,t.m13=1,t.m21=0,t.m22=-1,t.m23=0,t.m31=1,t.m32=0,t.m33=0):2==r?(t.m11=1,t.m12=0,t.m13=0,t.m21=0,t.m22=0,t.m23=-1,t.m31=0,t.m32=1,t.m33=0):3==r?(t.m11=1,t.m12=0,t.m13=0,t.m21=0,t.m22=0,t.m23=1,t.m31=
0,t.m32=-1,t.m33=0):4==r?(t.m11=1,t.m12=0,t.m13=0,t.m21=0,t.m22=-1,t.m23=0,t.m31=0,t.m32=0,t.m33=-1):5==r&&(t.m11=-1,t.m12=0,t.m13=0,t.m21=0,t.m22=-1,t.m23=0,t.m31=0,t.m32=0,t.m32=1);u.bind(r);d.clear(d.DEPTH_BUFFER_BIT|d.COLOR_BUFFER_BIT);d.enable(d.DEPTH_TEST);var l={objects:0,primitives:0};this.light.model.getLightViewMatrix(c);XML3D.math.mat4.mul(c,t.data,c);n.getProjectionMatrix(b,q);a.updateReadyObjectsFromMatrices(c,b);var t=this.sorter.sortObjects(a.ready),m={};m.viewMatrix=c;m.projectionMatrix=
b;for(var y in t.zLayers){var w=t.zLayers[y];d.clear(d.DEPTH_BUFFER_BIT);for(var z in t.opaque[w])this.renderObjectsToActiveBuffer(t.opaque[w][z],a,u,m,e,{transparent:!1,stats:l,program:p})}u.unbind()}return{count:l}}}()});m.exports=d},{"../../renderer/tools/objectsorter.js":111,"./scene-pass.js":148,"gl-matrix":1}],148:[function(d,m,l){function e(a){return"cw"==a.toLowerCase()?function(a){a.frontFace(a.CW)}:function(a){a.frontFace(a.CCW)}}function b(a){switch(a.toLowerCase()){case "back":return function(a){a.enable(a.CULL_FACE);
a.cullFace(a.BACK)};case "front":return function(a){a.enable(a.CULL_FACE);a.cullFace(a.FRONT)};case "both":return function(a){a.enable(a.CULL_FACE);a.cullFace(a.FRONT_AND_BACK)};default:return function(a){a.disable(a.CULL_FACE)}}}var a=d("./base.js"),c=d("../../../utils/options.js"),h=d("gl-matrix").mat4,g=d("gl-matrix").mat3;c.register("renderer-faceculling","none");c.register("renderer-frontface","ccw");d=function(d,g,h){a.call(this,d,g,h);this.setFaceCulling=b(c.getValue("renderer-faceculling"));
this.setFrontFace=e(c.getValue("renderer-frontface"));var q=this;c.addObserver("renderer-faceculling",function(a,c){q.setFaceCulling=b(c)});c.addObserver("renderer-frontface",function(a,c){q.setFrontFace=e(c)})};XML3D.createClass(d,a,{setGLStates:function(){var a=this.renderInterface.context.gl;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);this.setFaceCulling(a);this.setFrontFace(a);a.enable(a.DEPTH_TEST)},renderObjectsToActiveBuffer:function(){var a=h.create(),c=g.create(),
b=h.create(),e=h.create(),d=g.create(),p=["modelMatrix","modelMatrixN","modelViewMatrix","modelViewProjectionMatrix","modelViewMatrixN"];return function(g,h,l,m,y,w){l=h=0;var z=w.stats||{},F=!0===w.transparent||!1,D=this.renderInterface.context.gl;w=w.program||g[0].getProgram();if(0==g.length)return z;F&&(D.enable(D.BLEND),D.blendFuncSeparate(D.SRC_ALPHA,D.ONE_MINUS_SRC_ALPHA,D.ONE,D.ONE_MINUS_SRC_ALPHA));w.bind();w.setSystemUniformVariables(y,m);y=null;for(var B=0,A=g.length;B<A;B++){var C=g[B];
if(C.visible){this.renderInterface.setGLState(C._actualMaterial.states);var H=C.mesh;XML3D.debug.assert(H,"We need a mesh at this point.");C.getWorldMatrix(a);m.modelMatrix=a;C.getModelMatrixN(c);m.modelMatrixN=c;C.getModelViewMatrix(b);m.modelViewMatrix=b;C.getModelViewProjectionMatrix(e);m.modelViewProjectionMatrix=e;C.getModelViewMatrixN(d);m.modelViewMatrixN=d;w.setSystemUniformVariables(p,m);w.changeUniformVariableOverride(y,H.uniformOverride);y=H.uniformOverride;l+=H.draw(w);h++;this.renderInterface.resetGLState(C._actualMaterial.states)}}F&&
D.disable(D.BLEND);w.changeUniformVariableOverride(y,null);w.unbind();z.objects+=h;z.primitives+=l;return z}}()});m.exports=d},{"../../../utils/options.js":185,"./base.js":140,"gl-matrix":1}],149:[function(d,m,l){var e=d("./base.js"),b=d("./vertexattribute-pass.js"),a=d("../base/rendertarget.js").GLRenderTarget,c=d("../base/fullscreenquad.js"),h=d("../../../utils/options.js");d={"renderer-ssao-scale":{defaultValue:1},"renderer-ssao-intensity":{defaultValue:5},"renderer-ssao-bias":{defaultValue:.2},
"renderer-ssao-radius":{defaultValue:1}};for(var g in d)h.register(g,d[g].defaultValue);g=function(a,b,d){e.call(this,a,b,d);a=this.renderInterface.context;this._program=a.programFactory.getProgramByName("ssao");this.randomVectorTexture=this.createRandomVectorTexture(a);this.loadRandomVectorImage();this._screenQuad=new c(a);this._uniformsDirty=!0};XML3D.createClass(g,e);XML3D.extend(g.prototype,{createRandomVectorTexture:function(a){var c=a.gl;a=a.createTexture();a.createTex2DFromData(c.RGBA,64,64,
c.RGBA,c.UNSIGNED_BYTE,{wrapS:c.REPEAT,wrapT:c.REPEAT,minFilter:c.LINEAR,magFilter:c.LINEAR});a.isTexture=!0;return a},loadRandomVectorImage:function(){var a=new Image;a.src="data:image/png;base64,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";
var c=this.renderInterface.context.gl,b=this.randomVectorTexture.handle;a.onload=function(){c.bindTexture(c.TEXTURE_2D,b);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a)}},createVertexAttributePass:function(c){var e=this.renderInterface.context,e=new a(e,{width:e.canvasTarget.width,height:e.canvasTarget.height,colorFormat:e.gl.RGBA,colorType:e.gl.FLOAT,depthFormat:e.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new b(this.renderInterface,e,{programName:c})},
render:function(){var a=XML3D.math.mat4.create(),c=["viewMatrix"];return function(b){var e=this.renderInterface.context.gl,d=this.output;d.bind();e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.disable(e.DEPTH_TEST);this._program.bind();this._setNonVolatileShaderUniforms();e={};b.getActiveView().getWorldToViewMatrix(a);e.viewMatrix=a;this._program.setSystemUniformVariables(c,e);this._screenQuad.draw(this._program);this._program.unbind();d.unbind()}}(),_setNonVolatileShaderUniforms:function(){var a=
"canvasSize sPositionTex sNormalTex sRandomNormals uRandomTexSize uScale uBias uIntensity uSampleRadius uConstVectors".split(" ");return function(){if(this._uniformsDirty){var c={},b=this._program;b.bind();var e=this.output;c.canvasSize=[e.width,e.height];c.sPositionTex=[this.inputs.positionBuffer.colorTarget.handle];c.sNormalTex=[this.inputs.normalBuffer.colorTarget.handle];c.sRandomNormals=[this.randomVectorTexture];c.uRandomTexSize=[64,64];c.uScale=h.getValue("renderer-ssao-scale");c.uBias=h.getValue("renderer-ssao-bias");
c.uIntensity=h.getValue("renderer-ssao-intensity");c.uSampleRadius=h.getValue("renderer-ssao-radius");c.uConstVectors=[1,0,-1,0,0,1,0,-1];b.setSystemUniformVariables(a,c);b.unbind()}}}()});m.exports=g},{"../../../utils/options.js":185,"../base/fullscreenquad.js":114,"../base/rendertarget.js":117,"./base.js":140,"./vertexattribute-pass.js":150}],150:[function(d,m,l){var e=d("./scene-pass.js");d=function(b,a,c){e.call(this,b,a,c);this._program=this.renderInterface.context.programFactory.getProgramByName(c.programName)};
XML3D.createClass(d,e);XML3D.extend(d.prototype,{render:function(b){var a=this.renderInterface.context.gl,c=this.output,e=c.getWidth(),d=c.getHeight(),e=e/d;c.bind();a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.enable(a.DEPTH_TEST);b.updateReadyObjectsFromActiveView(e);this.renderObjectsToActiveBuffer(b.ready,b,c,b.systemUniforms,[],{transparent:!1,program:this._program});c.unbind()}});m.exports=d},{"./scene-pass.js":148}],151:[function(d,m,l){d=function(e){this.mainRenderPass=null;this.renderInterface=
e};XML3D.extend(d.prototype,{render:function(e){this.mainRenderPass.renderTree(e)},getRenderStats:function(){return{}}});m.exports=d},{}],152:[function(d,m,l){var e=d("./base.js"),b=d("../base/rendertarget.js").GLRenderTarget,a=d("../render-passes/forward.js"),c=d("../render-passes/boxblur.js"),h=d("../render-passes/vertexattribute-pass.js"),g=d("../render-passes/ssao-pass.js");d("../../renderer/scene/constants.js");d=function(a,c,b){e.call(this,a);this._enableSSAO=c;this.mainPass=null;this.target=
b||a.context.canvasTarget;this.createMainPass()};XML3D.createClass(d,e);XML3D.extend(d.prototype,{createMainPass:function(){if(this._enableSSAO){var c=this.createVertexAttributePass("render-position"),b=this.createVertexAttributePass("render-normal"),e=this.createSSAOPass(c.output,b.output);e.addPrePass(c);e.addPrePass(b);var d=this.createBlurPass(e.output);d.addPrePass(e);this._blurPass=d;this._ssaoPass=e;this._positionPass=c;this._normalPass=b;this.mainPass=new a(this.renderInterface,this.target,
{inputs:{ssaoMap:d.output}});this.mainPass.addPrePass(d)}else this.mainPass=new a(this.renderInterface,this.target);this.mainRenderPass=this.mainPass},createVertexAttributePass:function(a){var c=this.renderInterface.context,c=new b(c,{width:c.canvasTarget.width,height:c.canvasTarget.height,colorFormat:c.gl.RGBA,colorType:c.gl.FLOAT,depthFormat:c.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new h(this.renderInterface,c,{programName:a})},createSSAOPass:function(a,c){var e=
this.renderInterface.context,e=new b(e,{width:e.canvasTarget.width,height:e.canvasTarget.height,colorFormat:e.gl.RGBA,depthFormat:e.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new g(this.renderInterface,e,{inputs:{positionBuffer:a,normalBuffer:c}})},createBlurPass:function(a){var e=this.renderInterface.context,e=new b(e,{width:a.width,height:a.height,colorFormat:e.gl.RGBA,depthFormat:e.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new c(this.renderInterface,
e,{inputs:{buffer:a}})},render:function(a){this._enableSSAO&&(this._positionPass.setProcessed(!1),this._normalPass.setProcessed(!1),this._ssaoPass.setProcessed(!1),this._blurPass.setProcessed(!1));this.mainRenderPass.setProcessed(!1);e.prototype.render.call(this,a)},getRenderStats:function(){return this.mainPass.getRenderStats()}});m.exports=d},{"../../renderer/scene/constants.js":99,"../base/rendertarget.js":117,"../render-passes/boxblur.js":141,"../render-passes/forward.js":142,"../render-passes/ssao-pass.js":149,
"../render-passes/vertexattribute-pass.js":150,"./base.js":151}],153:[function(d,m,l){var e=d("./base/context.js"),b=d("./scene/glscene.js"),a=d("./base/rendertarget.js").GLScaledRenderTarget,c=d("../renderer/tools/datachangelistener.js"),h=d("./render-interface.js").GLRenderInterface,g=d("./render-passes/pick-object.js"),f=d("./render-passes/pick-position.js"),k=d("./render-passes/pick-normal.js"),u=d("./render-trees/forward.js"),q=d("../../contrib/glu.js"),n=d("../../utils/options.js"),p=d("gl-matrix").vec3,
r=d("gl-matrix").quat,t=d("gl-matrix").mat4;d={"renderer-ssao":{defaultValue:!1,recompileOnChange:!0}};for(var v in d)n.register(v,d[v].defaultValue);var x=function(a,c){return a.height-c-1};v=function(a,d){this._canvasHandler=d;var f=this._canvasHandler.getCanvas();this.context=new e(f,this._canvasHandler.id);this.scene=new b(this.context);var g=XML3D.xml3dFormatHandler.getFactory("scene",this._canvasHandler.id);g.setScene(this.scene);g.setRenderer(this);g.getAdapter(a).traverse(function(){});this.pickedObject=
null;this.needsPickingDraw=this.needsDraw=!0;this.context.requestRedraw=this.requestRedraw.bind(this);this.rayCamera=this.scene.createRenderView();this.initGL();this.changeListener=new c(this);this.renderInterface=this.createRenderInterface();this.handleResizeEvent(f.clientWidth,f.clientHeight);n.addObserver(this.onFlagsChange.bind(this))};v.prototype.generateRay=function(){};XML3D.extend(v.prototype,{initGL:function(){var a=this.context.gl;a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(0);
a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.frontFace(a.CCW);a.cullFace(a.BACK);a.disable(a.CULL_FACE);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.disable(a.BLEND);a.viewport(0,0,this.width,this.height);a.pixelStorei(a.PACK_ALIGNMENT,1);a.pixelStorei(a.UNPACK_ALIGNMENT,1);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL)},handleResizeEvent:function(a,
c){if(0>=a||0>=c)XML3D.debug.logWarning("xml3d element has invalid width or height! Ensure you're not using 'display: none' and that width and height are greater than 0."),a=800,c=600;this.width=a;this.height=c;this.context.handleResizeEvent(a,c);this.createDefaultTree();this.scene.handleResizeEvent(a,c);this.needsDraw=this.needsPickingDraw=!0},createDefaultTree:function(){var c=new u(this.renderInterface,n.getValue("renderer-ssao"));this.renderInterface.setRenderTree(c);c=new a(this.context,512,
{width:this.context.canvasTarget.width,height:this.context.canvasTarget.height,colorFormat:this.context.gl.RGBA,depthFormat:this.context.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});this.pickObjectPass=new g(this.renderInterface,c);this.pickPositionPass=new f(this.renderInterface,c);this.pickNormalPass=new k(this.renderInterface,c)},createRenderInterface:function(){return new h(this.context,this.scene)},requestRedraw:function(a){XML3D.debug.logDebug("Request redraw because:",a);
this.needsPickingDraw=this.needsDraw=!0},getWorldSpaceNormalByPoint:function(a,c,b){b=b||this.pickedObject;if(!b)return null;c=x(this._canvasHandler.getCanvas(),c);this.pickNormalPass.render(b);this.needsPickingDraw=!0;return this.pickNormalPass.readNormalFromPickingBuffer(a,c)},getWorldSpacePositionByPoint:function(a,c,b){b=b||this.pickedObject;if(!b)return null;c=x(this._canvasHandler.getCanvas(),c);this.pickPositionPass.render(b);this.needsPickingDraw=!0;return this.pickPositionPass.readPositionFromPickingBuffer(a,
c)},getRenderObjectByRay:function(a,c,b){a=this.scene.findRayIntersections(a);this.pickObjectPass.render(a,c,b);c=Math.floor(this.pickObjectPass.output.getWidth()/2/this.pickObjectPass.output.getScale());b=Math.floor(this.pickObjectPass.output.getHeight()/2/this.pickObjectPass.output.getScale());return this.pickObjectPass.getRenderObjectFromPickingBuffer(c,b,a)},getWorldSpaceNormalByRay:function(a,c,b,e){if(!c)return null;this.pickNormalPass.render(c,b,e);a=Math.floor(this.pickNormalPass.output.getWidth()/
2/this.pickNormalPass.output.getScale());c=Math.floor(this.pickNormalPass.output.getHeight()/2/this.pickNormalPass.output.getScale());return this.pickNormalPass.readNormalFromPickingBuffer(a,c)},getWorldSpacePositionByRay:function(a,c,b,e){if(!c)return null;this.pickPositionPass.render(c,b,e);a=Math.floor(this.pickPositionPass.output.getWidth()/2/this.pickPositionPass.output.getScale());c=Math.floor(this.pickPositionPass.output.getHeight()/2/this.pickPositionPass.output.getScale());return this.pickPositionPass.readPositionFromPickingBuffer(a,
c)},calculateMatricesForRay:function(a,c,b){t.multiply(c,t.fromTranslation(c,a.origin.data),this.calculateOrientationForRayDirection(a));this.rayCamera.setLocalMatrix(c);this.rayCamera.getWorldToViewMatrix(c);a=this.pickObjectPass.output.getWidth()/this.pickObjectPass.output.getHeight();this.rayCamera.getProjectionMatrix(b,a)},calculateOrientationForRayDirection:function(){var a=p.create(),c=p.create(),b=p.create(),e=p.create(),d=r.create(),f=t.create();return function(g){p.set(e,0,1,0);p.cross(a,
g.direction.data,e);p.length(a)||p.set(a,1,0,0);p.cross(c,a,g.direction.data);p.negate(b,g.direction.data);XML3D.math.quat.setFromBasis(d,a,c,b);t.fromRotationTranslation(f,d,[0,0,0]);return f}}(),needsRedraw:function(){return this.needsDraw},renderToCanvas:function(){this.prepareRendering();this.renderInterface.getRenderTree().render(this.scene);var a=this.renderInterface.getRenderTree().getRenderStats();this.needsDraw=!1;XML3D.debug.logDebug("Rendered to Canvas");return a},getRenderObjectFromPickingBuffer:function(a,
c){c=x(this._canvasHandler.getCanvas(),c);var b=t.create();this.needsPickingDraw&&(this.needsPickingDraw=!1,this.prepareRendering(),this.scene.updateReadyObjectsFromActiveView(this.pickObjectPass.output.getWidth()/this.pickObjectPass.output.getHeight()),this.scene.getActiveView().getWorldToViewMatrix(b),this.pickObjectPass.render(this.scene.ready,b),XML3D.debug.logDebug("Rendered Picking Buffer"));return this.pickedObject=this.pickObjectPass.getRenderObjectFromPickingBuffer(a,c,this.scene.ready)},
prepareRendering:function(){this.scene.update()},generateRay:function(){var a=t.create(),c=t.create();return function(b,e){var d=x(this._canvasHandler.getCanvas(),e),f=new Float32Array(4);f[0]=0;f[1]=0;f[2]=this.width;f[3]=this.height;var g=this.scene.getActiveView();g.getWorldToViewMatrix(a);g.getProjectionMatrix(c,f[2]/f[3]);var g=new XML3D.Ray,h=new Float32Array(3),k=new Float32Array(3);if(!1===q.unProject(b,d,0,a,c,f,h)||!1===q.unProject(b,d,1,a,c,f,k))return g;t.invert(a,a);g.origin=p.fromValues(a[12],
a[13],a[14]);g.direction=p.fromValues(k[0]-h[0],k[1]-h[1],k[2]-h[2]);return g}}(),dispose:function(){this.scene.clear()},getRenderInterface:function(){return this.renderInterface},onFlagsChange:function(a){"renderer-ssao"==a&&(this.scene.shaderFactory.setShaderRecompile(),this.createDefaultTree());this.requestRedraw("global option changed")}});m.exports=v},{"../../contrib/glu.js":50,"../../utils/options.js":185,"../renderer/tools/datachangelistener.js":109,"./base/context.js":113,"./base/rendertarget.js":117,
"./render-interface.js":139,"./render-passes/pick-normal.js":144,"./render-passes/pick-object.js":145,"./render-passes/pick-position.js":146,"./render-trees/forward.js":152,"./scene/glscene.js":157,"gl-matrix":1}],154:[function(d,m,l){var e=d("../xflow/xflow-mesh.js");d=function(){};XML3D.extend(d.prototype,{createDrawable:function(b,a){XML3D.debug.logDebug("DrawableFactory::createDrawable",b);try{var c=new e(a,b.configuration,{boundingBoxChanged:b.setObjectSpaceBoundingBox.bind(b)});b.mesh=c.getMesh();
return c}catch(d){return XML3D.debug.logError(d,b.node),null}}});m.exports=d},{"../xflow/xflow-mesh.js":162}],155:[function(d,m,l){function e(c,b,e){e={};b=b.getResult();for(var d=b.outputNames,h=0;h<d.length;h++){var n=d[h],n=n.substr(3,n.length),p=b.getOutputData(d[h]).getValue();1==p.length&&(p=p[0].split(" "));var r;a:{r=p;for(var t=[],l=0;l<r.length;l++){var m=r[l];if(void 0!==a[m])t.push(a[m]);else if("string"==typeof m)if(a[m.toUpperCase()])t.push(a[m.toUpperCase()]);else if("true"==m.toLowerCase())t.push(!0);
else if("false"==m.toLowerCase())t.push(!1);else if(isNaN(+m)){r=null;break a}else t.push(+m);else{r=null;break a}}r=t}r?e[n]=r:XML3D.debug.logError("The arguments '"+p+"' for 'gl-"+n+"' in material '#"+c.name+"' are not valid.")}c.states=e}var b=d("../../../xflow/interface/request.js").ComputeRequest,a=d("../../webgl/constants.js"),c=d("../../renderer/scene/configuration.js");d=d("../render-interface.js").ConfigurableGLStates;var h=[];for(l=0;l<d.length;l++)h.push("gl-"+d[l]);m.exports=function(a,
d,k){c.call(this,a,d,k);this.states={};a=new b(this.dataNode,h,e.bind(window,this));e(this,a)}},{"../../../xflow/interface/request.js":192,"../../renderer/scene/configuration.js":98,"../../webgl/constants.js":121,"../render-interface.js":139}],156:[function(d,m,l){d="pointLightPosition pointLightAttenuation pointLightIntensity pointLightOn pointLightCastShadow pointLightMatrix pointLightShadowBias pointLightNearFar pointLightShadowMap".split(" ").concat("directionalLightDirection directionalLightIntensity directionalLightOn directionalLightCastShadow directionalLightMatrix directionalLightShadowBias directionalLightShadowMap".split(" ")).concat("spotLightAttenuation spotLightPosition spotLightIntensity spotLightDirection spotLightOn spotLightSoftness spotLightCosCutoffAngle spotLightCosSoftCutoffAngle spotLightCastShadow spotLightMatrix spotLightShadowBias spotLightShadowMap".split(" "));
m.exports={ALL_PARAMETERS:d}},{}],157:[function(d,m,l){function e(a,c){var b=a.indexOf(c);return-1!=b?(a.splice(b,1),!0):!1}var b=d("./../../renderer/scene/scene.js"),a=d("./drawable-factory.js"),c=d("./../../renderer/scene/constants.js"),h=d("./../../renderer/tools/frustum.js").FrustumTest,g=d("../materials/shadercomposerfactory.js"),f=d("../../../utils/options.js"),k=d("../materials/shadowmap-service"),u=d("gl-matrix").mat4,q=d("./glconfiguration.js"),n={"shadejs-extractUniformExpressions":{defaultValue:!1,
recompileOnChange:!0},"shadejs-transformSpaces":{defaultValue:!0,recompileOnChange:!0},"renderer-frustum-culling":{defaultValue:!0,recompileOnChange:!1},"shadejs-cache":{defaultValue:!0,recompileOnChange:!1}},p;for(p in n)f.register(p,n[p].defaultValue);d=function(c){b.call(this);this.context=c;this.shaderFactory=new g(c);this.drawableFactory=new a;this.shadowMapService=new k(c,this);this.ready=[];this.queue=[];this.lightsNeedUpdate=!0;this.systemUniforms={};this.deferred=window.XML3D_DEFERRED||!1;
this.colorClosureSignatures=[];this.doFrustumCulling=!!f.getValue("renderer-frustum-culling");this.addListeners()};XML3D.createClass(d,b);XML3D.extend(d.prototype,{remove:function(a){e(this.queue,a);e(this.ready,a)},clear:function(){this.ready=[];this.queue=[];this.activeView.remove()},moveFromQueueToReady:function(a){e(this.queue,a)&&this.ready.push(a)},moveFromReadyToQueue:function(a){e(this.ready,a)&&this.queue.push(a)},update:function(){this.lightsNeedUpdate&&(this.lightsNeedUpdate=!1,this.updateLightParameters(),
this.lights.lightValueChanged());this.updateObjectsForRendering();this.shadowMapService.updateForRendering();this.updateShaders()},updateLightParameters:function(){var a=this.systemUniforms;this.lights.fillGlobalParameters(a);this.shadowMapService.fillGlobalParameters(a);var c=a.spotLightCutoffAngle,b=a.spotLightSoftness;if(c){for(var e=[],d=[],f=0;f<c.length;f++)d[f]=Math.cos(c[f]),e[f]=Math.cos(c[f]*(1-b[f]));a.spotLightCosCutoffAngle=d;a.spotLightCosSoftCutoffAngle=e}},updateSystemUniforms:function(a){this.shaderFactory.updateSystemUniforms(a,
this)},updateShaders:function(){this.shaderFactory.update(this)},updateObjectsForRendering:function(){this.forEach(function(a){a.updateForRendering()})},forEach:function(a,c){this.queue.slice().forEach(a,c);this.ready.slice().forEach(a,c)},updateReadyObjectsFromActiveView:function(){var a=u.create(),c=u.create(),b=u.create(),e=new XML3D.Box,d=new h;return function(f){var g=this.getActiveView(),h=this.ready,k,n,p;g.getWorldToViewMatrix(a);k=0;for(n=h.length;k<n;k++)p=h[k],p.updateModelViewMatrix(a),
p.updateModelMatrixN(),p.updateModelViewMatrixN();this.updateBoundingBox();g.getProjectionMatrix(b,f);g.getViewToWorldMatrix(c);k=g.getFrustum();(f=this.doFrustumCulling&&k)&&d.set(k,c);k=0;for(n=h.length;k<n;k++)p=h[k],p.updateModelViewProjectionMatrix(b),p.getWorldSpaceBoundingBox(e),p.inFrustum=f?d.isBoxVisible(e):!0}}(),updateReadyObjectsFromMatrices:function(a,c){for(var b=this.ready,e=0,d=b.length;e<d;e++){var f=b[e];f.updateModelViewMatrix(a);f.updateModelMatrixN();f.updateModelViewProjectionMatrix(c)}},
addListeners:function(){this.on(c.EVENT_TYPE.SCENE_STRUCTURE_CHANGED,function(a,c){c?this.removeChildEvent(a):this.addChildEvent(a)});this.on(c.EVENT_TYPE.VIEW_CHANGED,function(){this.context.requestRedraw("Active view changed.")});this.on(c.EVENT_TYPE.LIGHT_STRUCTURE_CHANGED,function(){this.lightsNeedUpdate=!0;this.shaderFactory.setLightStructureDirty();this.context.requestRedraw("Light structure changed.")});this.on(c.EVENT_TYPE.LIGHT_VALUE_CHANGED,function(a){this.lightsNeedUpdate=!0;this.shaderFactory.setLightValueChanged();
this.lights.lightValueChanged(a);this.context.requestRedraw("Light value changed.")});this.on(c.EVENT_TYPE.SCENE_SHAPE_CHANGED,function(){this.lightsNeedUpdate=!0});f.addObserver(this.onFlagsChange.bind(this))},addChildEvent:function(a){a.type==c.NODE_TYPE.OBJECT&&(this.queue.push(a),this.context.requestRedraw("Object was added to scene."))},removeChildEvent:function(a){a.type==c.NODE_TYPE.OBJECT&&(this.remove(a),a.dispose(),this.context.requestRedraw("Object was removed from scene."))},createDrawable:function(a){return this.drawableFactory.createDrawable(a,
this.context)},requestRedraw:function(a){return this.context.requestRedraw(a)},onFlagsChange:function(a,c){n[a]&&n[a].recompileOnChange&&this.shaderFactory.setShaderRecompile();"renderer-frustum-culling"==a&&(this.doFrustumCulling=!!c)},createMaterialConfiguration:function(a,c,b){return new q(a,c,b)}});m.exports=d},{"../../../utils/options.js":185,"../materials/shadercomposerfactory.js":128,"../materials/shadowmap-service":129,"./../../renderer/scene/constants.js":99,"./../../renderer/scene/scene.js":108,
"./../../renderer/tools/frustum.js":110,"./drawable-factory.js":154,"./glconfiguration.js":155,"gl-matrix":1}],158:[function(d,m,l){var e=d("./shader-utils.js"),b=d("../materials/urn/shader-descriptor.js"),a=d("../materials/urn/urnshaderclosure.js");d=function(a){this.context=a;this.programs={fallback:null,picking:{id:null,normal:null,position:null}}};XML3D.extend(d.prototype,{getProgramByName:function(c){var d=XML3D.materials.getScript(c);if(!d||!d.vertex)return XML3D.debug.logError("Unknown shader: ",
c),null;c=new b;XML3D.extend(c,d);c.fragment=e.addFragmentShaderHeader(c.fragment);d=new a(this.context,c);d.createSources({},null,null);d.compile();return d},getFallbackProgram:function(){if(!this.programs.fallback){var c=new b;XML3D.extend(c,XML3D.materials.getScript("matte"));c.fragment=e.addFragmentShaderHeader(c.fragment);c=new a(this.context,c);c.uniformCollection.envBase.diffuseColor=[1,0,0];c.createSources({},null,null);c.compile();this.programs.fallback=c;this.programs.fallback.bind();this.programs.fallback.setUniformVariables(["diffuseColor"],
null,{envBase:{diffuseColor:[1,0,0]}});this.programs.fallback.unbind()}return this.programs.fallback},getPickingObjectIdProgram:function(){var a=this.programs.picking;a.id||(a.id=this.getProgramByName("pickobjectid"));return a.id},getPickingPositionProgram:function(){var a=this.programs.picking;a.position||(a.position=this.getProgramByName("pickedposition"));return a.position},getPickingNormalProgram:function(){var a=this.programs.picking;a.normal||(a.normal=this.getProgramByName("pickedNormals"));
return a.normal}});m.exports=d},{"../materials/urn/shader-descriptor.js":135,"../materials/urn/urnshaderclosure.js":136,"./shader-utils.js":159}],159:[function(d,m,l){m.exports={addFragmentShaderHeader:function(e){return"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif // GL_FRAGMENT_PRECISION_HIGH\n\n"+e}}},{}],160:[function(d,m,l){m.exports={node:null,setNode:function(e){this.node=e},sendEvent:function(e,b){if(this.node){var a=document.createEvent("CustomEvent");
b.systemtype=e;a.initCustomEvent("xml3dsystem",!0,!0,b);this.node.dispatchEvent(a)}}}},{}],161:[function(d,m,l){var e=d("../../../xflow/interface/constants.js"),b=d("../constants.js");m.exports={getGLUniformValueFromXflowDataEntry:function(a,c){var b;if(!a)return null;if(a.type==e.DATA_TYPE.TEXTURE){b=c.getXflowEntryWebGlData(a);var d=b.texture||c.createTexture();b.changed&&d.updateFromTextureEntry(a);b.texture=d;b.changed=0;b=[d]}else if(a.type==e.DATA_TYPE.BOOL){b=a.getValue();for(var d=[b.length],
f=0;f<b.length;f++)d[f]=b[f];b=d}else b=a.getValue();return b},getGLBufferFromXflowDataEntry:function(a,c,d){var g=c.getXflowEntryWebGlData(a),f=g.buffer,k=c.gl;if(g.changed&&d){for(var u=a.getValue(),q=1E8,n=0,p=u.length;p--;)q=Math.min(q,u[p]),n=Math.max(n,u[p]);g.maxIndex=n;g.minIndex=q}switch(g.changed){case e.DATA_ENTRY_STATE.CHANGED_VALUE:if(d){a=a.getValue();switch(f.glType){case k.UNSIGNED_BYTE:a=new Uint8Array(a);break;case k.UNSIGNED_SHORT:a=new Uint16Array(a);break;case k.UNSIGNED_INT:break;
default:return XML3D.debug.logError("Unknown GL type for element buffer: ",f.glType),null}k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,f);k.bufferSubData(k.ELEMENT_ARRAY_BUFFER,0,a)}else k.bindBuffer(k.ARRAY_BUFFER,f),k.bufferSubData(k.ARRAY_BUFFER,0,a.getValue());break;case e.DATA_ENTRY_STATE.CHANGED_NEW:case e.DATA_ENTRY_STATE.CHANGED_SIZE:case e.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:d?(f=a.getValue(),q=g.maxIndex,k=c.gl,d=f,u=k.UNSIGNED_INT,256>q?(u=k.UNSIGNED_BYTE,d=new Uint8Array(f)):65536>q?(u=k.UNSIGNED_SHORT,
d=new Uint16Array(f)):c.extensions.OES_element_index_uint||(XML3D.debug.logError("Trying to use index data with indices larger than 65535, but this is not supported on your platform. Indexing errors will occur."),u=k.UNSIGNED_SHORT,d=new Uint16Array(f)),c=k.createBuffer(),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,c),k.bufferData(k.ELEMENT_ARRAY_BUFFER,d,k.STATIC_DRAW),c.bytesPerElement=d.BYTES_PER_ELEMENT,c.length=f.length,c.glType=u,f=c):(f=a.getValue(),c=c.gl,k=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,
k),c.bufferData(c.ARRAY_BUFFER,f,c.STATIC_DRAW),k.length=f.length,k.glType=f instanceof Int8Array?b.BYTE:f instanceof Uint8Array?b.UNSIGNED_BYTE:f instanceof Int16Array?b.SHORT:f instanceof Uint16Array?b.UNSIGNED_SHORT:f instanceof Int32Array?b.INT:f instanceof Uint32Array?b.UNSIGNED_INT:b.FLOAT,f=k),f.tupleSize=a.getTupleSize(),g.buffer=f}g.changed=0;return f},calculateBoundingBox:function(a,c){var b=new XML3D.Box,e;if(!a||3>a.length)return b;var d=b.data;if(c)for(e=3*c[0],d[0]=a[e],d[1]=a[e+1],
d[2]=a[e+2],d[3]=a[e],d[4]=a[e+1],d[5]=a[e+2],e=1;e<c.length;e++){var k=3*c[e],u=a[k],q=a[k+1],k=a[k+2];u<d[0]&&(d[0]=u);q<d[1]&&(d[1]=q);k<d[2]&&(d[2]=k);u>d[3]&&(d[3]=u);q>d[4]&&(d[4]=q);k>d[5]&&(d[5]=k)}else for(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[0],d[4]=a[1],d[5]=a[2],e=3;e<a.length;e+=3)a[e]<d[0]&&(d[0]=a[e]),a[e+1]<d[1]&&(d[1]=a[e+1]),a[e+2]<d[2]&&(d[2]=a[e+2]),a[e]>d[3]&&(d[3]=a[e]),a[e+1]>d[4]&&(d[4]=a[e+1]),a[e+2]>d[5]&&(d[5]=a[e+2]);return b}}},{"../../../xflow/interface/constants.js":189,
"../constants.js":121}],162:[function(d,m,l){var e=d("../../renderer/scene/drawableclosure.js"),b=d("../base/mesh.js"),a=d("./utils.js"),c=d("../../renderer/scene/constants.js").EVENT_TYPE,h=d("../materials/events.js"),g=d("../../../xflow/interface/constants.js"),f=d("../../../xflow/interface/request.js").ComputeRequest,k=d("assert"),u=d("../constants.js"),q=e.READY_STATE,n={attributeData:{position:g.DATA_TYPE.FLOAT3},typeData:{index:g.DATA_TYPE.INT,solid:g.DATA_TYPE.BOOL,vertexCount:g.DATA_TYPE.INT,
type:g.DATA_TYPE.STRING},bboxFix:{boundingBox:g.DATA_TYPE.FLOAT3},bboxCompute:{position:g.DATA_TYPE.FLOAT3}};d=function(a,c,d){e.call(this,a,e.TYPES.MESH);k(c.data);k(c.type);d=d||{};this.mesh=new b(a);this.dataNode=c.data;this.primitiveType=c.type;this.typeRequest=this.shaderClosure=this.shaderComposer=null;this.typeDataValid=!0;this.objectShaderRequest=null;this.changeState=1;this.boundingBoxChanged=d.boundingBoxChanged||function(){};this.initialize()};XML3D.createClass(d,e,{initialize:function(){this.typeDataChanged(this.typeRequest,
g.RESULT_STATE.CHANGED_STRUCTURE);this.shaderChanged()},setShaderComposer:function(a){this.bindedShaderChanged||(this.bindedShaderChanged=this.shaderChanged.bind(this));this.shaderComposer&&this.shaderComposer.removeListener(h.MATERIAL_STRUCTURE_CHANGED,this.bindedShaderChanged);if(this.shaderComposer=a)this.shaderComposer.on(h.MATERIAL_STRUCTURE_CHANGED,this.bindedShaderChanged);this.changeState|=32},update:function(a){if(0!==this.changeState){XML3D.debug.logDebug("Update mesh closure",this.changeState);
var b=!!this.shaderClosure&&this.typeDataValid,e=null,d=!1;try{this.changeState&33&&this.mesh.clear(),this.changeState&3&&this.updateTypeData(),d=!0,this.changeState&35&&this.updateIndexBuffer(),this.changeState&33?(this.updateObjectShaderRequest(),this.updateShaderClosure(a),this.updateObjectShaderData()):this.changeState&5&&this.updateObjectShaderData(),this.dataNode.isSubtreeLoading()&&(this.shaderClosure=null,this.typeDataValid=!1)}catch(f){e=f,d?this.shaderClosure=null:this.typeDataValid=!1}a=
!!this.shaderClosure&&this.typeDataValid;b!=a&&this.emit(c.DRAWABLE_STATE_CHANGED,a?q.COMPLETE:q.INCOMPLETE,b?q.COMPLETE:q.INCOMPLETE);this.changeState=0;if(e)throw e;}},calculateBoundingBox:function(){var c=new XML3D.Box;return function(){var b=this.typeRequest.getResult(),e=b.getOutputData("boundingBox");e?this.boundingBoxChanged(a.calculateBoundingBox(e.getValue(),null)):(e=b.getOutputData("position"))?(b=b.getOutputData("index"),this.boundingBoxChanged(a.calculateBoundingBox(e.getValue(),b?b.getValue():
null))):this.boundingBoxChanged(c)}}(),typeDataChanged:function(a,b){this.changeState|=b==g.RESULT_STATE.CHANGED_STRUCTURE?1:2;this.emit(c.SCENE_SHAPE_CHANGED);this.context.requestRedraw("Mesh Type Data Change");XML3D.debug.logDebug("XflowMesh: Type data changed",a,b,this.changeState)},getMesh:function(){return this.mesh},updateObjectShaderRequest:function(){this.objectShaderRequest&&this.objectShaderRequest.clear();this.objectShaderRequest=null;this.dataNode.isSubtreeLoading()||(this.objectShaderRequest=
this.shaderComposer.createObjectDataRequest(this.dataNode,this.shaderInputDataChanged.bind(this)))},updateShaderClosure:function(a){this.shaderClosure=null;if(!this.dataNode.isSubtreeLoading()&&!this.dataNode.getOutputChannelInfo("position"))throw Error("Mesh does not have 'position' attribute.");this.dataNode.isSubtreeLoading()||this.objectShaderRequest.getResult().loading||(this.shaderClosure=this.shaderComposer.getShaderClosure(a,this.objectShaderRequest))},updateIndexBuffer:function(){var a=this.typeRequest.getResult().getOutputData("index");
a&&a.getValue()&&this.handleBuffer("index",a,!0)},updateObjectShaderData:function(){if(this.shaderClosure&&(this.bindedHandleBuffer||(this.bindedHandleBuffer=this.handleBuffer.bind(this)),this.bindedHandleUniform||(this.bindedHandleUniform=this.handleUniform.bind(this)),this.shaderComposer.distributeObjectShaderData(this.objectShaderRequest,this.bindedHandleBuffer,this.bindedHandleUniform),!this.mesh.isReadyToRender()))throw Error("Mesh has empty vertex attributes.");},updateTypeData:function(){if(this.typeDataValid||
this.changeState&1){this.typeDataValid=!1;this.updateTypeRequest();this.calculateBoundingBox();var a=this.typeRequest.getResult(),c=a.getOutputData("vertexCount");this.mesh.setVertexCount(c&&c.getValue()?c.getValue():null);c=this.primitiveType;"derived"==c&&(c=(c=a.getOutputData("type"))?c.getValue()[0]:null);a=p(c);if(void 0==a){if("derived"==this.primitiveType){if(this.dataNode.isSubtreeLoading())return;if(null==c)throw Error("Could not derive primitive type");}throw Error("Unknown primitive type: "+
c);}this.mesh.setPrimitiveType(a);this.typeDataValid=!0}},handleBuffer:function(c,b,e){e=e||!1;var d=this.mesh;if("position"==c&&!b)throw Error("'position' attribute of mesh is empty.");if(b)if(b.type==g.DATA_TYPE.TEXTURE)XML3D.debug.logError("Texture as mesh parameter is not yet supported");else{var f=a.getGLBufferFromXflowDataEntry(b,this.context,"index"==c);e?this.updateIndexRange(b):this.mesh.checkBufferCompatible(c,b);d.setBuffer(c,f)}else this.mesh.removeBuffer(c)},updateIndexRange:function(a){a=
this.context.getXflowEntryWebGlData(a);this.mesh.setIndexRange(a.minIndex,a.maxIndex)},handleUniform:function(b,e){var d=a.getGLUniformValueFromXflowDataEntry(e,this.context);"opacity"===b&&this.emit(c.OPACITY_STATE_CHANGED,this.mesh.getUniformOverride(b),d);this.mesh.setUniformOverride(b,d)},updateTypeRequest:function(){var a=this.getTypeRequestNames(n);this.typeRequest&&this.typeRequest.filter==a||(this.typeRequest&&this.typeRequest.clear(),this.typeRequest=new f(this.dataNode,a,this.typeDataChanged.bind(this)))},
getTypeRequestNames:function(a){var c=[];c.push.apply(c,Object.keys(a.typeData));c.push.apply(c,Object.keys(a.bboxFix));this.checkXflowTypes(this.dataNode,a.bboxFix)||(this.checkXflowTypes(this.dataNode,a.bboxCompute)||(this.typeDataValid=!1),c.push.apply(c,Object.keys(a.bboxCompute)));return c},checkXflowTypes:function(a,c){for(var b in c){var e=a.getOutputChannelInfo(b);if(!e||e.type!=c[b])return!1}return!0},shaderInputDataChanged:function(a,b){this.changeState|=b!=g.RESULT_STATE.CHANGED_DATA_VALUE?
1:4;this.emit(c.SCENE_SHAPE_CHANGED);this.context.requestRedraw("Mesh Attribute Data Changed");XML3D.debug.logDebug("XflowMesh: Attribute data changed",a,b,this.changeState)},shaderChanged:function(){this.changeState|=32},getProgram:function(){return this.shaderClosure},destroy:function(){this.mesh&&this.mesh.clear();this.objectShaderRequest&&this.objectShaderRequest.clear();this.typeRequest&&this.typeRequest.clear();this.setShaderComposer(null);delete this.dataNode}});var p=function(a){a&&a.toLowerCase&&
(a=a.toLowerCase());switch(a){case "triangles":return u.TRIANGLES;case "tristrips":return u.TRIANGLE_STRIP;case "points":return u.POINTS;case "lines":return u.LINES;case "linestrips":return u.LINE_STRIP}};m.exports=d},{"../../../xflow/interface/constants.js":189,"../../../xflow/interface/request.js":192,"../../renderer/scene/constants.js":99,"../../renderer/scene/drawableclosure.js":100,"../base/mesh.js":115,"../constants.js":121,"../materials/events.js":124,"./utils.js":161,assert:11}],163:[function(d,
m,l){function e(a,c,b,e,d){(c=e.getAdapter(d,c,b))&&a.setAdapter(c,g.STATUS.READY)}function b(b,e){var d=e.handler.getFragmentData(e.document,b.fragment);d?a(b,e.handler,d):c(b)}function a(a,c,b){var d=a.toString(),f;for(f in p[d])for(var g in p[d][f]){var h=p[d][f][g];h.hasAdapter()||(e(h,f,+g,c,b),a.isLocal()||q.resolvePendingResource(a,g))}}function c(a){var c=a.toString(),b;for(b in p[c])for(var e in p[c][b])p[c][b][e].setAdapter(null,g.STATUS.NOT_FOUND),q.resolvePendingResource(a,e)}function h(a){c(a);
var b=a.toStringWithoutFragment(),e=n(b);if(e)for(b=e.fragments,e.fragments=[],e=0;e<b.length;++e)a.fragment=b[e],c(a)}var g=d("../base/adapterhandle.js"),f=d("../utils/uri.js").URI,k=d("../utils/uri.js").URIResolver,u=d("../utils/options.js"),q=d("./counter.js"),n=d("./fetcher.js").getDocumentCache;u.register("resource-crossorigin-attribute","anonymous");var p={};d={notifyNodeIdChange:function(c,b,e){var d=new f;if(b){var h=r(c);h.host&&(d.path=h.host.nodeName+h.host.componentId);d.fragment=b;b=
d.toString();for(var k in p[b])for(var n in p[b][k])h=p[b][k][n],h.hasAdapter()&&h.setAdapter(null,g.STATUS.NOT_FOUND);delete p[b]}e&&(d.fragment=e,a(d,XML3D.xml3dFormatHandler,c))},notifyNodeAdapterChange:function(a,c,b,e){b=b||0;a="#"+a.id;p[a]&&p[a][c]&&p[a][c][b]&&p[a][c][b].notifyListeners(e)},getAdapter:function(a,c,b){return XML3D.xml3dFormatHandler.getAdapter(a,c,b)},getAdapterHandle:function(a,c,b,e){if(!c)return null;e=e||0;var d,f;c.isLocal()?(d=r(a),f=d.host?d.host.nodeName+d.host.componentId+
c.toString():c.toString()):(d=a.ownerDocument,f=(c=XML3D.resource.getAbsoluteURI(d._documentURL||d.URL,c))&&c.toString());p[f]||(p[f]={});p[f][b]||(p[f][b]={});var g=p[f][b][e];return g?g:t(d,c,f,b,e,a)}};var r=function(a){for(var c=a;c=c.parentNode;)if(-1!==c.nodeName.indexOf("#document"))return c;return a.ownerDocument},t=function(a,c,d,r,u,l){var t=c.toString(),m=new g(t);p[d][r][u]=m;if(c.isLocal())(a=k.resolveLocal(c,a))?e(m,r,u,XML3D.xml3dFormatHandler,a):(XML3D.debug.logError("Could not find the element referenced by '"+
t,l),m.setAdapter(null,g.STATUS.NOT_FOUND));else{q.addPendingResource(c,u);var A=c.toStringWithoutFragment(),C=n(A);C&&C.document?b(c,C):XML3D.resource.getDocument(A,{priority:"scene"===r?1:0}).then(function(a){if(a){C=n(A);C.fragments.push(c.fragment);a=n(A.toString());var e=a.fragments;a.fragments=[];for(var d=new f(A),g=0;g<e.length;++g)d.fragment=e[g],b(d,a)}else XML3D.debug.logError("Could not find the element referenced by '"+t,l),h(c)})["catch"](function(a){XML3D.debug.logError(a,l);h(c)})}return m};
d.getImage=function(a,c,b){q.addPendingResource(a,0);var e=new Image;a.hasSameOrigin(document.location.href)||(e.crossOrigin=u.getValue("resource-crossorigin-attribute"));e.onload=function(b){c(b,e);q.resolvePendingResource(a,0)};e.onerror=function(c){e.crossOrigin&&XML3D.debug.logIssue("May have attempted to use a cross-origin texture without proper cross-origin handling.",164);b(c,e);q.resolvePendingResource(a,0)};e.src=a.toString();return e};d.getVideo=function(a,c,b,e,d){function f(a){return function(c){a(c,
g)}}q.addPendingResource(a,0);var g=document.createElement("video");a.hasSameOrigin(document.location.href)||(g.crossOrigin=u.getValue("resource-crossorigin-attribute"));var h=function(c){g.crossOrigin&&"error"===c.type&&XML3D.debug.logIssue("May have attempted to use a cross-origin texture without proper cross-origin handling.",164);q.resolvePendingResource(a,0);g.removeEventListener("canplay",h,!0);g.removeEventListener("error",h,!0)};g.autoplay=c;g.loop=b;e&&(g.muted=e,g.volume=0);for(var k in d)g.addEventListener(k,
f(d[k]),!0);g.addEventListener("canplay",h,!0);g.addEventListener("error",h,!0);g.src=a.toString();return g};m.exports=d},{"../base/adapterhandle.js":49,"../utils/options.js":185,"../utils/uri.js":186,"./counter.js":164,"./fetcher.js":165}],164:[function(d,m,l){var e={},b={addPendingResource:function(a,c){b.getOrCreatePendingResources(c).entries.push(a.toString())},resolvePendingResource:function(a,c){var d=a.toString(),g=e[c];g&&(Array.erase(g.entries,d),0==g.entries.length&&b.notifyLoadCompleteListeners(g))},
getOrCreatePendingResources:function(a){var c=e[a];c||(c={entries:[],listeners:[]},e[a]=c);return c},notifyLoadCompleteListeners:function(a){a=a.listeners;for(var c=a.length;c--;)a[c](this)},isLoadComplete:function(a){return!e[a]||0==e[a].entries.length},addLoadCompleteListener:function(a,c){var e=b.getOrCreatePendingResources(a);-1==e.listeners.indexOf(c)&&e.listeners.push(c)},removeLoadCompleteListener:function(a,c){var b=e[a];if(b){var d=b.listeners.indexOf(c);-1!=d&&b.listeners.splice(d,1)}}};
m.exports=b},{}],165:[function(d,m,l){function e(a,c){return new Promise(function(b,e){var d={opt:c,uri:a,resolve:b,reject:e};u.length||window.requestAnimationFrame(v);u.push(d);0<d.opt.priority&&u.sort(t)})}function b(a,c,b){(function D(e){if(e>=a.length)throw new TypeError("No FormatHandler could be found for the document "+c.url);var d=a[e];d.getFormatData(c.clone()).then(function(a){b(d,a)})["catch"](function(a){D(++e)})})(0)}function a(a){this.name="RequestAbortedException";this.message="Request was aborted by an onRequest listener: "+
a;this.url=a;this.stack=Error().stack}function c(a){this.name="ResponseBodyUsedException";this.message="The body of the Response was read prematurely.";this.response=a;this.stack=Error().stack}function h(a){this.name="RequestFailedException";this.message="The request failed with status code "+a.status;this.response=a;this.stack=Error().stack}d("whatwg-fetch");var g=d("../utils/uri.js").URI,f=[],k=[],u=[],q=0,n=new Map,p={registerFormatHandler:function(a){a&&k.push(a)},fetch:function(c,b){b=x(b);for(var d=
new g(c),h=0;h<f.length;h++)f[h](d,b);return b.abort?Promise.reject(new a(d)):e(d,b)}},r=function(){var a=u.shift();q++;fetch(a.uri.toString(),a.opt).then(function(c){q--;a.resolve(c)})["catch"](function(c){XML3D.debug.logError("Could not retrieve document at '"+a.uri.toString()+"'. Reason: "+c);q--;a.reject(c)})};p.getDocument=function(c,b){b=x(b);for(var d=new g(c),k=0;k<f.length;k++)f[k](d,b);b.abort&&Promise.reject(new a(d));var r;if(b.allowCaching){if(r=n.get(c))return r.pending?Promise.race([r.pending]):
Promise.resolve(r.document);r={fragments:[]};n.set(c,r)}d=e(c,b).then(function(a){if(!a.ok)throw new h(a);a.originalURL=c;var b={fragments:[]};n.set(c,b);b.pending=p.parseResponse(a);return b.pending}).then(function(a){a._documentURL=c;var b=n.get(c);b.document=a;delete b.pending;return a})["catch"](function(a){n.has(c)&&delete n.get(c).pending;throw a;});r&&(r.pending=d);return d};p.parseResponse=function(a){return new Promise(function(e,d){var f=k.filter(function(c){return c.isFormatSupported(a)});
a.bodyUsed&&(XML3D.debug.logError("FormatHandlers should not access the response body in the isFormatSupported function without first cloning the response object!"),d(new c(a)));1==f.length?f[0].getFormatData(a).then(function(c){n.get(a.originalURL).handler=f[0];e(c)}):b(f,a,function(c,b){n.get(a.originalURL).handler=c;e(b)})})};p.onRequest=function(a){f.push(a)};var t=function(a,c){return c.opt.priority-a.opt.priority},v=function(){for(;0<u.length;)r();u.length&&window.requestAnimationFrame(v)},
x=function(a){a=a||{};a.headers=a.headers||{};a.priority=a.priority||0;a.abort=a.abort||!1;a.allowCaching=void 0!==a.allowCaching?a.allowCaching:!0;return a};p.onRequest(function(a,c){a.toString().match(/(file:)\/+([A-z]:\/)/)&&(XML3D.debug.logIssue("Encountered a filesystem request: '"+a+"'. A local server is needed to use XML3D.",162),c.abort=!0)});p.getAbsoluteURI=function(a,c){if(!c)return null;"string"==typeof c&&(c=new g(c));a==document.URL&&c.isLocal()||(c=c.getAbsoluteURI(a));return c};p.getDocumentCache=
function(a){return n.get(a)};a.prototype=Object.create(Error.prototype);a.prototype.constructor=a;c.prototype=Object.create(Error.prototype);c.prototype.constructor=c;h.prototype=Object.create(Error.prototype);h.prototype.constructor=h;m.exports=p},{"../utils/uri.js":186,"whatwg-fetch":46}],166:[function(d,m,l){d=function(){};d.prototype.isFormatSupported=function(e){return!1};d.prototype.getFormatData=function(e){return Promise.resolve(e)};d.prototype.getFragmentData=function(e,b){return b?null:
e};d.prototype.getAdapter=function(e,b,a){return null};m.exports=d},{}],167:[function(d,m,l){l={};XML3D.extend(l,d("./coordinator.js"));XML3D.extend(l,d("./fetcher.js"));l.FormatHandler=d("./formathandler.js");m.exports=l},{"./coordinator.js":163,"./fetcher.js":165,"./formathandler.js":166}],168:[function(d,m,l){var e=d("../data/adapter/factory.js"),b=d("../renderer/renderer/adapter/factory.js"),a=d("../interface/elements.js").config;d=function(){XML3D.resource.FormatHandler.call(this);this.renderAdapterFactories=
{};this.dataAdapterFactory=new e};XML3D.createClass(d,XML3D.resource.FormatHandler);d.prototype.isFormatSupported=function(a){if(a.headers.has("Content-Type"))return a.headers.get("Content-Type").match(/\/xml|\/html/);if(a.url.match(/\.xml|\.html/))return!0};d.prototype.getFormatData=function(c){return c.text().then(function(c){c=(new DOMParser).parseFromString(c,"text/xml");for(var b=c.querySelectorAll("xml3d"),e=0;e<b.length;++e)a.element(b[e]);return c})};d.prototype.getFragmentData=function(a,
b){return a.querySelector("*[id='"+b+"']")};d.prototype.getAdapter=function(a,e,d){if("scene"===e){if(void 0===d)throw Error("A canvas ID corresponding to an XML3D element must be provided when creating an adapter with the 'scene' aspect");this.renderAdapterFactories[d]||(this.renderAdapterFactories[d]=new b(d));return this.renderAdapterFactories[d].getAdapter(a)}if("data"===e)return this.dataAdapterFactory.getAdapter(a);throw Error("Encountered an unknown aspect '"+e+"'");};d.prototype.getFactory=
function(a,e){if("scene"===a)return this.renderAdapterFactories[e]||(this.renderAdapterFactories[e]=new b(e)),this.renderAdapterFactories[e]};l=new d;XML3D.resource.registerFormatHandler(l);XML3D.xml3dFormatHandler=l;m.exports={XML3DFormatHandler:d}},{"../data/adapter/factory.js":58,"../interface/elements.js":72,"../renderer/renderer/adapter/factory.js":80}],169:[function(d,m,l){var e=d("gl-matrix").vec4,b=d("./vec3.js"),a=d("./quat.js"),c=function(a,b,d,k){if(this instanceof c)this.data=e.create(),
void 0!==k?(this.data[0]=a,this.data[1]=b,this.data[2]=d,this.data[3]=k):a?this.data.set(a.data?a.data:a):this.data[2]=1;else return new c(a,b,d,k)};Object.defineProperty(c.prototype,"axis",{set:function(a){this.data[0]=a.data?a.data[0]:a[0];this.data[1]=a.data?a.data[1]:a[1];this.data[2]=a.data?a.data[2]:a[2]},get:function(){return b.wrap(this.data)}});Object.defineProperty(c.prototype,"angle",{set:function(a){this.data[3]=a},get:function(){return this.data[3]}});c.prototype.clone=function(){return new c(this)};
c.fromQuat=function(a){var b=new c;b.data.set(XML3D.math.vec4.fromQuat(a.data?a.data:a));return b};c.prototype.toDOMString=function(){return e.toDOMString(this.data)};c.fromDOMString=function(a){var b=new c;b.data.set(e.fromDOMString(a));return b};c.prototype.toQuat=function(){var c=new a;quat.setAxisAngle(c.data,this.data,this.data[3]);return c};c.wrap=function(a){var b=c();b.data=a.data?a.data:a;return b};m.exports=c},{"./quat.js":175,"./vec3.js":178,"gl-matrix":1}],170:[function(d,m,l){var e=d("./vec3.js"),
b=d("gl-matrix").vec3,a=function(c){if(this instanceof a)this.data=new Float32Array(6),c?this.data.set(c.data?c.data:c):this.setEmpty();else return new a(c)};Object.defineProperty(a.prototype,"min",{set:function(a){a=a.data?a.data:a;this.data[0]=a[0];this.data[1]=a[1];this.data[2]=a[2]},get:function(){return e.wrap(this.data.subarray(0,3))}});Object.defineProperty(a.prototype,"max",{set:function(a){a=a.data?a.data:a;this.data[3]=a[0];this.data[4]=a[1];this.data[5]=a[2]},get:function(){return e.wrap(this.data.subarray(3,
6))}});a.prototype.clone=function(){return new a(this)};a.prototype.copy=function(a){this.copyMin(a);this.copyMax(a);return this};a.prototype.copyMin=function(a){b.copy(this.data,a.data?a.data:a);return this};a.prototype.copyMax=function(a){b.copy(this.data.subarray(3,6),a.data?a.data.subarray(3,6):a.subarray(3,6));return this};a.prototype.extend=function(a){a=a.data?a.data:a;for(var b=0;3>b;b++)this.data[b]=Math.min(a[b],this.data[b]),this.data[b+3]=Math.max(a[b+3],this.data[b+3]);return this};a.prototype.setEmpty=
function(){this.data[0]=Number.MAX_VALUE;this.data[1]=Number.MAX_VALUE;this.data[2]=Number.MAX_VALUE;this.data[3]=-Number.MAX_VALUE;this.data[4]=-Number.MAX_VALUE;this.data[5]=-Number.MAX_VALUE;return this};a.prototype.isEmpty=function(){return this.data[0]>this.data[3]||this.data[1]>this.data[4]||this.data[2]>this.data[5]};a.prototype.center=function(a){a=a||new e;a.x=.5*(this.data[0]+this.data[3]);a.y=.5*(this.data[1]+this.data[4]);a.z=.5*(this.data[2]+this.data[5]);return a};a.prototype.size=function(a){a=
a||new e;a.x=Math.max(this.data[3]-this.data[0],0);a.y=Math.max(this.data[4]-this.data[1],0);a.z=Math.max(this.data[5]-this.data[2],0);return a};a.prototype.extent=function(){return this.size().scale(.5)};a.prototype.transformAxisAligned=function(a){if(this.isEmpty())return this;var b=new Float32Array(6);a=a.data?a.data:a;if(0==a[3]&&0==a[7]&&0==a[11]&&1==a[15]){for(var e=0;3>e;e++){b[e]=b[e+3]=a[12+e];for(var d=0;3>d;d++){var k,u;k=a[4*d+e]*this.data[d];u=a[4*d+e]*this.data[d+3];k<u?(b[e]+=k,b[e+
3]+=u):(b[e]+=u,b[e+3]+=k)}}this.data.set(b);return this}throw Error("Matrix is not affine");};a.prototype.transform=function(a){if(this.isEmpty())return this;b.transformMat4(this.min.data,this.min.data,a.data?a.data:a);b.transformMat4(this.max.data,this.max.data,a.data?a.data:a);return this};a.prototype.longestSide=function(){if(this.isEmpty())return 0;var a=Math.abs(this.data[3]-this.data[0]),b=Math.abs(this.data[4]-this.data[1]),e=Math.abs(this.data[5]-this.data[2]);return Math.max(a,Math.max(b,
e))};a.prototype.intersects=function(a,b){if(this.isEmpty())return void 0!==b&&void 0!==b.dist&&(b.dist=Infinity),!1;var e=a.origin,d=a.direction,k=1/d.x,u=1/d.y,q=1/d.z,d=(this.data[0]-e.x)*k,k=(this.data[3]-e.x)*k,n=(this.data[1]-e.y)*u,u=(this.data[4]-e.y)*u,p=(this.data[2]-e.z)*q,q=(this.data[5]-e.z)*q,e=Math.max(Math.max(Math.min(d,k),Math.min(n,u)),Math.min(p,q)),d=Math.min(Math.min(Math.max(d,k),Math.max(n,u)),Math.max(p,q));if(void 0===b||void 0===b.dist)return 0<d&&e<=d;if(0>d||e>d)return b.dist=
Infinity,!1;b.dist=e;return!0};a.prototype.contains=function(a){a=a.data?a.data:a;return this.data[0]<=a[0]&&a[0]<=this.data[3]&&this.data[1]<=a[1]&&a[1]<=this.data[4]&&this.data[2]<=a[2]&&a[2]<=this.data[5]};a.prototype.toString=function(){return"XML3D.Box("+this.data[0]+", "+this.data[1]+", "+this.data[2]+", "+this.data[3]+", "+this.data[4]+", "+this.data[5]+")"};a.prototype.toDOMString=function(){return this.data[0]+" "+this.data[1]+" "+this.data[2]+" "+this.data[3]+" "+this.data[4]+" "+this.data[5]};
a.EMPTY_BOX=new a;m.exports=a},{"./vec3.js":178,"gl-matrix":1}],171:[function(d,m,l){function e(a){switch(a){case b.DATA_TYPE.FLOAT:return g.FLOAT;case b.DATA_TYPE.FLOAT2:return g.FLOAT2;case b.DATA_TYPE.FLOAT3:return g.FLOAT3;case b.DATA_TYPE.FLOAT4:return g.FLOAT4;case b.DATA_TYPE.FLOAT4X4:return g.FLOAT4X4;case b.DATA_TYPE.INT:return g.INT;case b.DATA_TYPE.INT4:return g.INT4;case b.DATA_TYPE.BOOL:return g.BOOL;case b.DATA_TYPE.TEXTURE:return g.TEXTURE;case b.DATA_TYPE.BYTE:return g.BYTE;case b.DATA_TYPE.UBYTE:return g.UBYTE;
default:throw Error("WHAT IS THIS I DON'T EVEN...");}}var b=d("../xflow/interface/constants.js"),a=d("../resource"),c=[];d=function(a){this.callback=a;this.observed=[]};d.prototype.observe=function(b,e){if(!b)throw Error("The node to observe is null.");if(!b._configured)throw Error("Note to observe is not   (yet). Make sure to pass an XML3D node and to execute this function after XML3D has been configured e.g. inside a DOMContentLoaded listener.");var d=a.getAdapter(b,"data");if(!d)throw Error("Can't observe node. XML3DataObserver can only observe data containers such as <data>, <mesh> or <shader>");
0==this.observed.length&&c.push(this);var g={node:b,changed:!1,request:null},h=e&&e.names;"String"===Object.prototype.toString.call(h).slice(8,-1)&&(h=[h]);g.request=d.getComputeRequest(h,function(a,b){g.changed=!0});g.request.getResult();this.observed.push(g)};d.prototype.disconnect=function(){for(var a=0;a<this.observed.length;++a)this.observed[a].request.clear();this.observed=[];for(a=c.length;a--;)c[a]==this&&c.splice(a,1)};XML3D.updateXflowObserver=function(){for(var a=0;a<c.length;++a){for(var b=
c[a],e=[],d=0;d<b.observed.length;++d){var n=b.observed[d];if(n.changed){n.changed=!1;var p=n.request.getResult(),p=new g(p);e.push(new h(n.node,p))}}0<e.length&&b.callback&&b.callback(e,b)}};var h=function(a,b){this.target=a;this.result=b},g=function(a){this._entries={};for(var b=0;b<a.outputNames.length;++b){var c=a.outputNames[b],d=a.getOutputData(c),g=d&&d.getValue();null!==g&&(d=e(d.type),this._entries[c]={type:d,value:g})}};g.prototype.getValue=function(a){return this._entries[a]?this._entries[a].value:
null};g.prototype.getType=function(a){return this._entries[a]?this._entries[a].type:null};g.prototype.getNames=function(){var a=[],b;for(b in this._entries)a.push(b);return a};g.FLOAT=0;g.FLOAT2=1;g.FLOAT3=2;g.FLOAT4=3;g.FLOAT4X4=4;g.INT=10;g.INT4=11;g.BOOL=20;g.TEXTURE=30;g.BYTE=40;g.UBYTE=50;l=function(a,b,c,d,g,h){this.type=e(a);this.origin=b;this.originalName=c;this.seqLength=d;this.seqMinKey=g;this.seqMaxKey=h};l.ORIGIN_CHILD=1;l.ORIGIN_COMPUTE=2;l.ORIGIN_PROTO=3;m.exports={XML3DDataChannelInfo:l,
XML3DDataResult:g,XML3DDataObserver:d}},{"../resource":167,"../xflow/interface/constants.js":189}],172:[function(d,m,l){var e=d("gl-matrix").mat2,b=function(a){if(this instanceof b)this.data=e.create(),a&&this.data.set(a.data?a.data:a);else return new b(a)};Object.defineProperty(b.prototype,"m11",{set:function(a){this.data[0]=a},get:function(){return this.data[0]}});Object.defineProperty(b.prototype,"m12",{set:function(a){this.data[1]=a},get:function(){return this.data[1]}});Object.defineProperty(b.prototype,
"m21",{set:function(a){this.data[2]=a},get:function(){return this.data[2]}});Object.defineProperty(b.prototype,"m22",{set:function(a){this.data[3]=a},get:function(){return this.data[3]}});b.prototype.adjoint=function(){var a=new b;e.adjoint(a.data,this.data);return a};b.prototype.clone=function(){return new b(this)};b.prototype.determinant=function(){return e.determinant(this.data)};b.prototype.invert=function(){var a=new b;e.invert(a.data,this.data);return a};b.prototype.mul=b.prototype.multiply=
function(a){var c=new b;e.multiply(c.data,this.data,a.data?a.data:a);return c};b.prototype.rotate=function(a){var c=new b;e.rotate(c.data,this.data,a);return c};b.prototype.scale=function(a){var c=new b;e.scale(c.data,this.data,a.data?a.data:a);return c};b.prototype.transpose=function(){var a=new b;e.transpose(a.data,this.data);return a};b.wrap=function(a){var c=b();c.data=a.data?a.data:a;return c};m.exports=b},{"gl-matrix":1}],173:[function(d,m,l){var e=d("gl-matrix").mat3,b=function(a){if(this instanceof
b)this.data=e.create(),a&&this.data.set(a.data?a.data:a);else return new b(a)};Object.defineProperty(b.prototype,"m11",{set:function(a){this.data[0]=a},get:function(){return this.data[0]}});Object.defineProperty(b.prototype,"m12",{set:function(a){this.data[1]=a},get:function(){return this.data[1]}});Object.defineProperty(b.prototype,"m13",{set:function(a){this.data[2]=a},get:function(){return this.data[2]}});Object.defineProperty(b.prototype,"m21",{set:function(a){this.data[3]=a},get:function(){return this.data[3]}});
Object.defineProperty(b.prototype,"m22",{set:function(a){this.data[4]=a},get:function(){return this.data[4]}});Object.defineProperty(b.prototype,"m23",{set:function(a){this.data[5]=a},get:function(){return this.data[5]}});Object.defineProperty(b.prototype,"m31",{set:function(a){this.data[6]=a},get:function(){return this.data[6]}});Object.defineProperty(b.prototype,"m32",{set:function(a){this.data[7]=a},get:function(){return this.data[7]}});Object.defineProperty(b.prototype,"m33",{set:function(a){this.data[8]=
a},get:function(){return this.data[8]}});b.prototype.adjoint=function(){var a=new b;e.adjoint(a.data,this.data);return a};b.prototype.clone=function(){return new b(this)};b.prototype.determinant=function(){return e.determinant(this.data)};b.fromMat4=function(a){var c=new b;e.fromMat4(c.data,a.data?a.data:a);return c};b.fromQuat=function(a){var c=new b;e.fromQuat(c.data,a.data?a.data:a);return c};b.prototype.invert=function(){var a=new b;e.invert(a.data,this.data);return a};b.prototype.mul=b.prototype.multiply=
function(a){var c=new b;e.multiply(c.data,this.data,a.data?a.data:a);return c};b.normalFromMat4=function(a){var c=new b;e.normalFromMat4(c.data,a.data?a.data:a);return c};b.prototype.rotate=function(a){var c=new b;e.rotate(c.data,this.data,a);return c};b.prototype.scale=function(a){var c=new b;e.scale(c.data,this.data,a.data?a.data:a);return c};b.prototype.transpose=function(){var a=new b;e.transpose(a.data,this.data);return a};b.prototype.translate=function(a){var c=new b;e.translate(c.data,this.data,
a.data?a.data:a);return c};b.wrap=function(a){var c=b();c.data=a.data?a.data:a;return c};m.exports=b},{"gl-matrix":1}],174:[function(d,m,l){var e=d("gl-matrix").mat4,b=function(a){if(this instanceof b)this.data=e.create(),a&&this.data.set(a.data?a.data:a);else return new b(a)};Object.defineProperty(b.prototype,"m11",{set:function(a){this.data[0]=a},get:function(){return this.data[0]}});Object.defineProperty(b.prototype,"m12",{set:function(a){this.data[1]=a},get:function(){return this.data[1]}});Object.defineProperty(b.prototype,
"m13",{set:function(a){this.data[2]=a},get:function(){return this.data[2]}});Object.defineProperty(b.prototype,"m14",{set:function(a){this.data[3]=a},get:function(){return this.data[3]}});Object.defineProperty(b.prototype,"m21",{set:function(a){this.data[4]=a},get:function(){return this.data[4]}});Object.defineProperty(b.prototype,"m22",{set:function(a){this.data[5]=a},get:function(){return this.data[5]}});Object.defineProperty(b.prototype,"m23",{set:function(a){this.data[6]=a},get:function(){return this.data[6]}});
Object.defineProperty(b.prototype,"m24",{set:function(a){this.data[7]=a},get:function(){return this.data[7]}});Object.defineProperty(b.prototype,"m31",{set:function(a){this.data[8]=a},get:function(){return this.data[8]}});Object.defineProperty(b.prototype,"m32",{set:function(a){this.data[9]=a},get:function(){return this.data[9]}});Object.defineProperty(b.prototype,"m33",{set:function(a){this.data[10]=a},get:function(){return this.data[10]}});Object.defineProperty(b.prototype,"m34",{set:function(a){this.data[11]=
a},get:function(){return this.data[11]}});Object.defineProperty(b.prototype,"m41",{set:function(a){this.data[12]=a},get:function(){return this.data[12]}});Object.defineProperty(b.prototype,"m42",{set:function(a){this.data[13]=a},get:function(){return this.data[13]}});Object.defineProperty(b.prototype,"m43",{set:function(a){this.data[14]=a},get:function(){return this.data[14]}});Object.defineProperty(b.prototype,"m44",{set:function(a){this.data[15]=a},get:function(){return this.data[15]}});b.prototype.adjoint=
function(){var a=new b;e.adjoint(a.data,this.data);return a};b.prototype.clone=function(){return new b(this)};b.prototype.determinant=function(){return e.determinant(this.data)};b.frustum=function(a,c,d,g,f,k){var u=new b;e.frustum(u.data,a,c,d,g,f,k);return u};b.prototype.invert=function(){var a=new b;e.invert(a.data,this.data);return a};b.lookAt=function(a,c,d){var g=new b;e.lookAt(g.data,a.data?a.data:a,c.data?c.data:c,d.data?d.data:d);return g};b.prototype.mul=b.prototype.multiply=function(a){var c=
new b;e.multiply(c.data,this.data,a.data?a.data:a);return c};b.ortho=function(a,c,d,g,f,k){var u=new b;e.ortho(u.data,a,c,d,g,f,k);return u};b.perspective=function(a,c,d,g){var f=new b;e.perspective(f.data,a,c,d,g);return f};b.prototype.rotate=function(a,c){var d=new b;e.rotate(d.data,this.data,a,c.data?c.data:c);return d};b.prototype.rotateX=function(a){var c=new b;e.rotateX(c.data,this.data,a);return c};b.prototype.rotateY=function(a){var c=new b;e.rotateY(c.data,this.data,a);return c};b.prototype.rotateZ=
function(a){var c=new b;e.rotateZ(c.data,this.data,a);return c};b.prototype.scale=function(a){var c=new b;e.scale(c.data,this.data,a.data?a.data:a);return c};b.fromQuat=function(a){var c=new b;e.fromQuat(c.data,a.data?a.data:a);return c};b.fromRotationTranslation=function(a,c){var d=new b;e.fromRotationTranslation(d.data,a.data?a.data:a,c.data?c.data:c);return d};b.prototype.transpose=function(){var a=new b;e.transpose(a.data,this.data);return a};b.prototype.translate=function(a){var c=new b;e.translate(c.data,
this.data,a.data?a.data:a);return c};b.wrap=function(a){var c=b();c.data=a.data?a.data:a;return c};m.exports=b},{"gl-matrix":1}],175:[function(d,m,l){var e=d("gl-matrix").quat,b=function(a,c,d,g){if(this instanceof b)this.data=e.create(),void 0!==g?(this.x=a,this.y=c,this.z=d,this.w=g):a?this.data.set(a.data?a.data:a):this.w=1;else return new b(a,c,d,g)};Object.defineProperty(b.prototype,"x",{set:function(a){this.data[0]=a},get:function(){return this.data[0]}});Object.defineProperty(b.prototype,"y",
{set:function(a){this.data[1]=a},get:function(){return this.data[1]}});Object.defineProperty(b.prototype,"z",{set:function(a){this.data[2]=a},get:function(){return this.data[2]}});Object.defineProperty(b.prototype,"w",{set:function(a){this.data[3]=a},get:function(){return this.data[3]}});b.prototype.add=function(a){var c=new b;e.add(c.data,this.data,a.data?a.data:a);return c};b.prototype.calculateW=function(){var a=new b;e.calculateW(a.data,this.data);return a};b.prototype.clone=function(){return new b(this)};
b.prototype.conjugate=function(){var a=new b;e.conjugate(a.data,this.data);return a};b.prototype.dot=function(a){return e.dot(this.data,a.data?a.data:a)};b.prototype.invert=function(){var a=new b;e.invert(a.data,this.data);return a};b.prototype.len=b.prototype.length=function(){return e.length(this.data)};b.prototype.lerp=function(a,c){var d=new b;e.lerp(d.data,this.data,a.data?a.data:a,c);return d};b.prototype.mul=b.prototype.multiply=function(a){var c=new b;e.mul(c.data,this.data,a.data?a.data:
a);return c};b.prototype.normalize=function(){var a=new b;e.normalize(a.data,this.data);return a};b.prototype.rotateX=function(a){var c=new b;e.rotateX(c.data,this.data,a);return c};b.prototype.rotateY=function(a){var c=new b;e.rotateY(c.data,this.data,a);return c};b.prototype.rotateZ=function(a){var c=new b;e.rotateZ(c.data,this.data,a);return c};b.prototype.scale=function(a){var c=new b;e.scale(c.data,this.data,a);return c};b.fromAxisAngle=function(a,c){var d=new b;void 0===c?e.setAxisAngle(d.data,
a.data?a.data:a,a.data?a.data[3]:a[3]):e.setAxisAngle(d.data,a.data?a.data:a,c);e.normalize(d.data,d.data);return d};b.fromBasis=function(a,c,d){var g=new b;XML3D.math.quat.setFromBasis(g.data,a.data?a.data:a,c.data?c.data:c,d.data?d.data:d);e.normalize(g.data,g.data);return g};b.fromMat3=function(a){var c=new b;e.fromMat3(c.data,a.data?a.data:a);e.normalize(c.data,c.data);return c};b.fromRotationTo=function(a,c){var d=new b;e.rotationTo(d.data,a.data?a.data:a,c.data?c.data:c);e.normalize(d.data,
d.data);return d};b.prototype.slerp=function(a,c){var d=new b;e.slerp(d.data,this.data,a.data?a.data:a,c);return d};b.prototype.toDOMString=function(){return e.toDOMString(this.data)};b.fromDOMString=function(a){var c=new b;c.data.set(e.fromDOMString(a));return c};b.wrap=function(a){var c=b();c.data=a.data?a.data:a;return c};m.exports=b},{"gl-matrix":1}],176:[function(d,m,l){var e=d("./vec3.js"),b=d("gl-matrix").vec3,a=function(b){if(this instanceof a)this.data=new Float32Array(6),this.data[5]=-1,
b&&this.data.set(b.data?b.data:b);else return new a(b)};Object.defineProperty(a.prototype,"origin",{set:function(a){a=a.data?a.data:a;this.data[0]=a[0];this.data[1]=a[1];this.data[2]=a[2]},get:function(){return e.wrap(this.data.subarray(0,3))}});Object.defineProperty(a.prototype,"direction",{set:function(a){a=a.data?a.data:a;b.normalize(a,a);this.data[3]=a[0];this.data[4]=a[1];this.data[5]=a[2]},get:function(){return e.wrap(this.data.subarray(3,6))}});a.prototype.setFromOriginDirection=function(a,
b){this.origin=a;this.direction=b;return this};a.prototype.clone=function(){return(new a).copy(this)};a.prototype.copy=function(a){this.copyOrigin(a);this.copyDirection(a);return this};a.prototype.copyOrigin=function(a){b.copy(this.data,a.data?a.data:a);return this};a.prototype.copyDirection=function(a){b.copy(this.data.subarray(3,6),a.data?a.data.subarray(3,6):a.subarray(3,6));return this};a.prototype.intersects=function(a,b){return a.intersects(this,b)};a.prototype.toString=function(){return"XML3D.Ray(origin: "+
this.data[0]+", "+this.data[1]+", "+this.data[2]+", direction: "+this.data[3]+", "+this.data[4]+", "+this.data[5]+")"};m.exports=a},{"./vec3.js":178,"gl-matrix":1}],177:[function(d,m,l){var e=d("gl-matrix").vec2,b=function(a,c){if(this instanceof b)this.data=e.create(),void 0!==c?(this.x=a,this.y=c):a&&this.data.set(a.data?a.data:a);else return new b(a,c)};Object.defineProperty(b.prototype,"x",{set:function(a){this.data[0]=a},get:function(){return this.data[0]}});Object.defineProperty(b.prototype,
"y",{set:function(a){this.data[1]=a},get:function(){return this.data[1]}});b.prototype.add=function(a){var c=new b;e.add(c.data,this.data,a.data?a.data:a);return c};b.prototype.clone=function(){return new b(this)};b.prototype.dist=b.prototype.distance=function(a){return e.dist(this.data,a.data?a.data:a)};b.prototype.divide=function(a){var c=new b;e.divide(c.data,this.data,a.data?a.data:a);return c};b.prototype.dot=function(a){return e.dot(this.data,a.data?a.data:a)};b.prototype.len=b.prototype.length=
function(){return e.length(this.data)};b.prototype.lerp=function(a,c){var d=new b;e.lerp(d.data,this.data,a.data?a.data:a,c);return d};b.prototype.max=function(a){var c=new b;e.max(c.data,this.data,a.data?a.data:a);return c};b.prototype.min=function(a){var c=new b;e.max(c.data,this.data,a.data?a.data:a);return c};b.prototype.mul=b.prototype.multiply=function(a){var c=new b,d=a.data?a.data:a;switch(d.length){case 2:e.mul(c.data,this.data,d);break;case 4:e.transformMat2(c.data,this.data,d);break;case 9:e.transformMat3(c.data,
this.data,d);break;case 16:e.transformMat4(c.data,this.data,d);break;default:console.error("Invalid input to Vec2.multiply "+a)}return c};b.prototype.negate=function(){var a=new b;e.negate(a.data,this.data);return a};b.prototype.normalize=function(){var a=new b;e.normalize(a.data,this.data);return a};b.random=function(a){var c=new b;e.random(c.data,a);return c};b.prototype.scale=function(a){var c=new b;e.scale(c.data,this.data,a);return c};b.prototype.sub=b.prototype.subtract=function(a){var c=new b;
e.sub(c.data,this.data,a.data?a.data:a);return c};b.prototype.toDOMString=function(){return e.toDOMString(this.data)};b.fromDOMString=function(a){var c=new b;c.data.set(e.fromDOMString(a));return c};b.wrap=function(a){var c=b();c.data=a.data?a.data:a;return c};m.exports=b},{"gl-matrix":1}],178:[function(d,m,l){var e=d("gl-matrix").vec3,b=function(a,c,d){if(this instanceof b)this.data=e.create(),void 0!==d?(this.x=a,this.y=c,this.z=d):a&&this.data.set(a.data?a.data:a);else return new b(a,c,d)};Object.defineProperty(b.prototype,
"x",{set:function(a){this.data[0]=a},get:function(){return this.data[0]}});Object.defineProperty(b.prototype,"y",{set:function(a){this.data[1]=a},get:function(){return this.data[1]}});Object.defineProperty(b.prototype,"z",{set:function(a){this.data[2]=a},get:function(){return this.data[2]}});b.prototype.add=function(a){var c=new b;e.add(c.data,this.data,a.data?a.data:a);return c};b.prototype.clone=function(){return new b(this)};b.prototype.cross=function(a){var c=new b;e.cross(c.data,this.data,a.data?
a.data:a);return c};b.prototype.dist=b.prototype.distance=function(a){return e.dist(this.data,a.data?a.data:a)};b.prototype.divide=function(a){var c=new b;e.divide(c.data,this.data,a.data?a.data:a);return c};b.prototype.dot=function(a){return e.dot(this.data,a.data?a.data:a)};b.prototype.len=b.prototype.length=function(){return e.length(this.data)};b.prototype.lerp=function(a,c){var d=new b;e.lerp(d.data,this.data,a.data?a.data:a,c);return d};b.prototype.max=function(a){var c=new b;e.max(c.data,this.data,
a.data?a.data:a);return c};b.prototype.min=function(a){var c=new b;e.max(c.data,this.data,a.data?a.data:a);return c};b.prototype.mul=b.prototype.multiply=function(a){var c=new b,d=a.data?a.data:a;switch(d.length){case 3:e.mul(c.data,this.data,d);break;case 4:e.transformQuat(c.data,this.data,d);break;case 9:e.transformMat3(c.data,this.data,d);break;case 16:e.transformMat4(c.data,this.data,d);break;default:console.error("Invalid input to Vec3.multiply "+a)}return c};b.prototype.negate=function(){var a=
new b;e.negate(a.data,this.data);return a};b.prototype.normalize=function(){var a=new b;e.normalize(a.data,this.data);return a};b.prototype.random=function(a){var c=new b;e.random(c.data,a);return c};b.prototype.reciprocal=function(){var a=new b;XML3D.math.vec3.reciprocal(a.data,this.data);return a};b.prototype.scale=function(a){var c=new b;e.scale(c.data,this.data,a);return c};b.prototype.sub=b.prototype.subtract=function(a){var c=new b;e.sub(c.data,this.data,a.data?a.data:a);return c};b.prototype.transformDirection=
function(a){var c=new b;XML3D.math.vec3.transformDirection(c.data,this.data,a.data?a.data:a);return c};b.prototype.toDOMString=function(){return e.toDOMString(this.data)};b.fromDOMString=function(a){var c=new b;c.data.set(e.fromDOMString(a));return c};b.wrap=function(a){var c=b();c.data=a.data?a.data:a;return c};m.exports=b},{"gl-matrix":1}],179:[function(d,m,l){var e=d("gl-matrix").vec4;d("./vec3.js");var b=function(a,c,d,g){if(this instanceof b)this.data=e.create(),void 0!==g?(this.x=a,this.y=c,
this.z=d,this.w=g):a&&this.data.set(a.data?a.data:a);else return new b(a,c,d,g)};Object.defineProperty(b.prototype,"x",{set:function(a){this.data[0]=a},get:function(){return this.data[0]}});Object.defineProperty(b.prototype,"y",{set:function(a){this.data[1]=a},get:function(){return this.data[1]}});Object.defineProperty(b.prototype,"z",{set:function(a){this.data[2]=a},get:function(){return this.data[2]}});Object.defineProperty(b.prototype,"w",{set:function(a){this.data[3]=a},get:function(){return this.data[3]}});
b.prototype.add=function(a){var c=new b;e.add(c.data,this.data,a.data?a.data:a);return c};b.prototype.clone=function(){return new b(this)};b.prototype.dist=b.prototype.distance=function(a){return e.dist(this.data,a.data?a.data:a)};b.prototype.divide=function(a){var c=new b;e.divide(c.data,this.data,a.data?a.data:a);return c};b.prototype.dot=function(a){return e.dot(this.data,a.data?a.data:a)};b.prototype.len=b.prototype.length=function(){return e.length(this.data)};b.prototype.lerp=function(a,c){var d=
new b;e.lerp(d.data,this.data,a.data?a.data:a,c);return d};b.prototype.max=function(a){var c=new b;e.max(c.data,this.data,a.data?a.data:a);return c};b.prototype.min=function(a){var c=new b;e.max(c.data,this.data,a.data?a.data:a);return c};b.prototype.mul=b.prototype.multiply=function(a){var c=new b,d=a.data?a.data:a;switch(d.length){case 4:e.mul(c.data,this.data,d);break;case 16:e.transformMat4(c.data,this.data,d);break;default:console.error("Invalid input to Vec4.multiply "+a)}return c};b.prototype.negate=
function(){var a=new b;e.negate(a.data,this.data);return a};b.prototype.normalize=function(){var a=new b;e.normalize(a.data,this.data);return a};b.prototype.random=function(a){var c=new b;e.random(c.data,a);return c};b.prototype.scale=function(a){var c=new b;e.scale(c.data,this.data,a);return c};b.prototype.sub=b.prototype.subtract=function(a){var c=new b;e.sub(c.data,this.data,a.data?a.data:a);return c};b.prototype.transformQuat=function(a){var c=new b;e.transformQuat(c.data,this.data,a.data?a.data:
a);return c};b.prototype.toDOMString=function(){return e.toDOMString(this.data)};b.fromDOMString=function(a){var c=new b;c.data.set(e.fromDOMString(a));return c};b.wrap=function(a){var c=b();c.data=a.data?a.data:a;return c};m.exports=b},{"./vec3.js":178,"gl-matrix":1}],180:[function(d,m,l){Array.forEach||(Array.forEach=function(e,b,a){for(var c=e.length,d=0;d<c;d++)d in e&&b.call(a,e[d],d,e)});Array.map||(Array.map=function(e,b,a){for(var c=e.length,d=[],g=0;g<c;g++)g in e&&(d[g]=b.call(a,e[g],g,
e));return d});Array.filter||(Array.filter=function(e,b,a){for(var c=e.length,d=[],g=0;g<c;g++)if(g in e){var f=e[g];b.call(a,f,g,e)&&d.push(f)}return d});Array.erase||(Array.erase=function(e,b){for(var a=!1,c=-1;-1!=(c=e.indexOf(b));)e.splice(c,1),a=!0;return a});Array.set||(Array.set=function(e,b,a){for(var c=0;c<a.length;c++)e[b+c]=a[c]});Array.isArray||(Array.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)})},{}],181:[function(d,m,l){var e=d("./cssMatrix.js"),b={TRANSFORM_PROPERTY:null,
init:function(){"transform"in document.body.style?b.TRANSFORM_PROPERTY="transform":"WebkitTransform"in document.body.style?b.TRANSFORM_PROPERTY="-webkit-transform":"MozTransform"in document.body.style?b.TRANSFORM_PROPERTY="-moz-transform":XML3D.debug.logWarning("No supported transform css property found")},getInlinePropertyValue:function(a,b){var c=a.getAttribute("style");return c&&(c=(new RegExp(b+"s*:([^;]+)","i")).exec(c))?c[1].trim():null},getPropertyValue:function(a,b){var c=this.getInlinePropertyValue(a,
b);return c?c:window.getComputedStyle(a).getPropertyValue(b)},getCSSMatrix:function(a){if(!b.TRANSFORM_PROPERTY||!e)return null;var c=null;"transform"!=b.TRANSFORM_PROPERTY&&(c=b.getInlinePropertyValue(a,"transform"));c||(c=b.getPropertyValue(a,b.TRANSFORM_PROPERTY));if(!c||"none"==c)return null;a=null;try{a=new e(c)}catch(d){XML3D.debug.logError("Error parsing transform property: "+c)}return a},getLargestTransitionDurationMS:function(a){for(var b=a.split(", "),c=0,e=0;e<b.length;e++){var d=b[e].substr(0,
b[e].length-1),d=+d;isNaN(d)&&(XML3D.debug.logError("Encountered an invalid duration for a CSS transition: "+a),d=1E3);c=Math.max(d,c)}return 1E3*c}},a=[];b.addTransitionCallback=function(b,c){a.push({func:b,endTime:Date.now()+c})};var c=function(){for(var b=Date.now(),e=0;e<a.length;e++){var d=a[e];d.func();d.endTime<b&&(a.splice(d,1),e--)}window.requestAnimationFrame(c)};window.requestAnimationFrame(c);b.convertCssToMat4=function(a,b){var c=b||new XML3D.Mat4;c.m11=a.m11;c.m12=a.m12;c.m13=a.m13;
c.m14=a.m14;c.m21=a.m21;c.m22=a.m22;c.m23=a.m23;c.m24=a.m24;c.m31=a.m31;c.m32=a.m32;c.m33=a.m33;c.m34=a.m34;c.m41=a.m41;c.m42=a.m42;c.m43=a.m43;c.m44=a.m44;return c};b.matrixStringToMat4=function(a){if(a.match("matrix3d"))return b.matrix3dStringToMat4(a);var c=a.replace("matrix(","").replace(")","").split(", ");a=new XML3D.Mat3;for(var e=0,d=0;9>d;d++)if(0!=(d+1)%3){var u=+c[e];if(isNaN(u))return new XML3D.Mat4;a.data[d]=u;e++}c=new XML3D.Mat4;c.m11=a.m11;c.m12=a.m12;c.m21=a.m21;c.m22=a.m22;c.m41=
a.m31;c.m42=a.m32;return c};b.matrix3dStringToMat4=function(a){var b=new XML3D.Mat4;a=a.replace("matrix3d(","").replace(")","").split(", ");for(var c=0;16>c;c++){var e=+a[c];if(isNaN(e))return new XML3D.Mat4;b.data[c]=e}return b};b.XML3DStyleElement=function(){var a=document.createElement("style");a.textContent="xml3d * { display: inherit; }float,float2,float3,float4,float4x4,int,int4,bool,texture,string,compute { display: none; } mesh,model,group { position: relative; }";return a};b.getComputedStyle=
function(a){var c={transform:"",display:"",transitionDuration:"0s",getPropertyValue:function(a){return this[a]}};if(!a.hasAttribute("style"))return c;var d=b.getPropertyValue(a,"transform");d&&"none"!==d&&(c.transform=e.toMatrixString(d));c.display=b.getPropertyValue(a,"display")||"";return c};(function(){var a=b.XML3DStyleElement();document.head.appendChild(a)})();m.exports=b},{"./cssMatrix.js":182}],182:[function(d,m,l){var e=function(b){this.m11=this.m22=this.m33=this.m44=1;this.m12=this.m13=this.m14=
this.m21=this.m23=this.m24=this.m31=this.m32=this.m34=this.m41=this.m42=this.m43=0;"string"==typeof b&&this.setMatrixValue(b)};e.displayName="FirminCSSMatrix";e.degreesToRadians=function(b){return b*Math.PI/180};e.determinant2x2=function(b,a,c,e){return b*e-a*c};e.determinant3x3=function(b,a,c,d,g,f,k,u,q){var n=e.determinant2x2;return b*n(g,f,u,q)-d*n(a,c,u,q)+k*n(a,c,g,f)};e.determinant4x4=function(b){var a=e.determinant3x3,c=b.m21,d=b.m31,g=b.m41,f=b.m12,k=b.m22,u=b.m32,q=b.m42,n=b.m13,p=b.m23,
r=b.m33,l=b.m43,m=b.m14,x=b.m24,y=b.m34,w=b.m44;return b.m11*a(k,p,x,u,r,y,q,l,w)-c*a(f,n,m,u,r,y,q,l,w)+d*a(f,n,m,k,p,x,q,l,w)-g*a(f,n,m,k,p,x,u,r,y)};e.toMatrixString=function(b){var a=/(\w+)\(([^\)]+)\)/i,c=b.match(/(\w+)\([^\)]+\)/ig),d=c&&c.every(function(a){return/^matrix/.test(a)});if(!c||d)return b;var g=function(a){return a.value},f={matrix:function(a,b){var c=new e(b.unparsed);return a.multiply(c)},matrix3d:function(a,b){var c=new e(b.unparsed);return a.multiply(c)},perspective:function(a,
b){var c=new e;c.m34-=1/b.value[0].value;return a.multiply(c)},rotate:function(a,b){return a.rotate.apply(a,b.value.map(g))},rotate3d:function(a,b){return a.rotateAxisAngle.apply(a,b.value.map(g))},rotateX:function(a,b){return a.rotate.apply(a,[b.value[0].value,0,0])},rotateY:function(a,b){return a.rotate.apply(a,[0,b.value[0].value,0])},rotateZ:function(a,b){return a.rotate.apply(a,[0,0,b.value[0].value])},scale:function(a,b){return a.scale.apply(a,b.value.map(g))},scale3d:function(a,b){return a.scale.apply(a,
b.value.map(g))},scaleX:function(a,b){return a.scale.apply(a,b.value.map(g))},scaleY:function(a,b){return a.scale.apply(a,[0,b.value[0].value,0])},scaleZ:function(a,b){return a.scale.apply(a,[0,0,b.value[0].value])},skew:function(a,b){var c=new e("skewX("+b.value[0].unparsed+")"),c="matrix(1.00000, "+(new e("skewY("+b.value[1].unparsed+")")).b+", "+c.c+", 1.000000, 0.000000, 0.000000)",c=new e(c);return a.multiply(c)},skewX:function(a,b){return a.skewX.apply(a,[b.value[0].value])},skewY:function(a,
b){return a.skewY.apply(a,[b.value[0].value])},translate:function(a,b){return a.translate.apply(a,b.value.map(g))},translate3d:function(a,b){return a.translate.apply(a,b.value.map(g))},translateX:function(a,b){return a.translate.apply(a,[b.value[0].value,0,0])},translateY:function(a,b){return a.translate.apply(a,[0,b.value[0].value,0])},translateZ:function(a,b){return a.translate.apply(a,[0,0,b.value[0].value])}};b=c.map(function(b){var c=b.match(a).slice(1);return{key:c[0],value:c[1].split(/, ?/).map(function(a){var b=
a.match(/([-\+]?[0-9]+[\.0-9]*)(deg|rad|grad|px|%)*/)||[];return{value:parseFloat(b[1]),units:b[2],unparsed:a}}),unparsed:b}});c=new e;return b.reduce(function(a,b){b.value=b.value.map(function(a){"rad"==a.units?(a.value*=180/Math.PI,a.units="deg"):"grad"==a.units&&(a.value/=400/360,a.units="deg");return a});return(0,f[b.key])(a,b)||a},c).toString()};[["m11","a"],["m12","b"],["m21","c"],["m22","d"],["m41","e"],["m42","f"]].forEach(function(b){var a=b[0];Object.defineProperty(e.prototype,b[1],{set:function(b){this[a]=
b},get:function(){return this[a]},enumerable:!0,configurable:!0})});e.prototype.isAffine=function(){return 0===this.m13&&0===this.m14&&0===this.m23&&0===this.m24&&0===this.m31&&0===this.m32&&1===this.m33&&0===this.m34&&0===this.m43&&1===this.m44};e.prototype.multiply=function(b){if(!b)return null;var a=new e;a.m11=b.m11*this.m11+b.m12*this.m21+b.m13*this.m31+b.m14*this.m41;a.m12=b.m11*this.m12+b.m12*this.m22+b.m13*this.m32+b.m14*this.m42;a.m13=b.m11*this.m13+b.m12*this.m23+b.m13*this.m33+b.m14*this.m43;
a.m14=b.m11*this.m14+b.m12*this.m24+b.m13*this.m34+b.m14*this.m44;a.m21=b.m21*this.m11+b.m22*this.m21+b.m23*this.m31+b.m24*this.m41;a.m22=b.m21*this.m12+b.m22*this.m22+b.m23*this.m32+b.m24*this.m42;a.m23=b.m21*this.m13+b.m22*this.m23+b.m23*this.m33+b.m24*this.m43;a.m24=b.m21*this.m14+b.m22*this.m24+b.m23*this.m34+b.m24*this.m44;a.m31=b.m31*this.m11+b.m32*this.m21+b.m33*this.m31+b.m34*this.m41;a.m32=b.m31*this.m12+b.m32*this.m22+b.m33*this.m32+b.m34*this.m42;a.m33=b.m31*this.m13+b.m32*this.m23+b.m33*
this.m33+b.m34*this.m43;a.m34=b.m31*this.m14+b.m32*this.m24+b.m33*this.m34+b.m34*this.m44;a.m41=b.m41*this.m11+b.m42*this.m21+b.m43*this.m31+b.m44*this.m41;a.m42=b.m41*this.m12+b.m42*this.m22+b.m43*this.m32+b.m44*this.m42;a.m43=b.m41*this.m13+b.m42*this.m23+b.m43*this.m33+b.m44*this.m43;a.m44=b.m41*this.m14+b.m42*this.m24+b.m43*this.m34+b.m44*this.m44;return a};e.prototype.isIdentityOrTranslation=function(){return 1===this.m11&&0===this.m12&&0===this.m13&&0===this.m14&&0===this.m21&&1===this.m22&&
0===this.m23&&0===this.m24&&0===this.m31&&0===this.m31&&1===this.m33&&0===this.m34&&1===this.m44};e.prototype.adjoint=function(){var b=new e,a=e.determinant3x3,c=this.m11,d=this.m12,g=this.m13,f=this.m14,k=this.m21,l=this.m22,q=this.m23,n=this.m24,p=this.m31,r=this.m32,t=this.m33,m=this.m34,x=this.m41,y=this.m42,w=this.m43,z=this.m44;b.m11=a(l,r,y,q,t,w,n,m,z);b.m21=-a(k,p,x,q,t,w,n,m,z);b.m31=a(k,p,x,l,r,y,n,m,z);b.m41=-a(k,p,x,l,r,y,q,t,w);b.m12=-a(d,r,y,g,t,w,f,m,z);b.m22=a(c,p,x,g,t,w,f,m,z);
b.m32=-a(c,p,x,d,r,y,f,m,z);b.m42=a(c,p,x,d,r,y,g,t,w);b.m13=a(d,l,y,g,q,w,f,n,z);b.m23=-a(c,k,x,g,q,w,f,n,z);b.m33=a(c,k,x,d,l,y,f,n,z);b.m43=-a(c,k,x,d,l,y,g,q,w);b.m14=-a(d,l,r,g,q,t,f,n,m);b.m24=a(c,k,p,g,q,t,f,n,m);b.m34=-a(c,k,p,d,l,r,f,n,m);b.m44=a(c,k,p,d,l,r,g,q,t);return b};e.prototype.inverse=function(){var b,a,c,d;if(this.isIdentityOrTranslation()){b=new e;if(0!==this.m41||0!==this.m42||0!==this.m43)b.m41=-this.m41,b.m42=-this.m42,b.m43=-this.m43;return b}a=this.adjoint();b=e.determinant4x4(this);
if(1E-8>Math.abs(b))return null;for(c=1;5>c;c++)for(d=1;5>d;d++)a["m"+c+d]/=b;return a};e.prototype.rotate=function(b,a,c){var d=e.degreesToRadians;if("number"!=typeof b||isNaN(b))b=0;"number"==typeof a&&!isNaN(a)||"number"==typeof c&&!isNaN(c)||(c=b,a=b=0);if("number"!=typeof a||isNaN(a))a=0;if("number"!=typeof c||isNaN(c))c=0;b=d(b);a=d(a);c=d(c);var d=new e,g=new e,f=new e,k;c/=2;k=Math.sin(c);c=Math.cos(c);f.m11=f.m22=1-2*k*k;f.m12=f.m21=2*k*c;f.m21*=-1;a/=2;k=Math.sin(a);c=Math.cos(a);g.m11=
g.m33=1-2*k*k;g.m13=g.m31=2*k*c;g.m13*=-1;b/=2;k=Math.sin(b);c=Math.cos(b);d.m22=d.m33=1-2*k*k;d.m23=d.m32=2*k*c;d.m32*=-1;return this.toString()===(new e).toString()?f.multiply(g).multiply(d):this.multiply(d).multiply(g).multiply(f)};e.prototype.rotateAxisAngle=function(b,a,c,d){if("number"!=typeof b||isNaN(b))b=0;if("number"!=typeof a||isNaN(a))a=0;if("number"!=typeof c||isNaN(c))c=0;if("number"!=typeof d||isNaN(d))d=0;0===b&&0===a&&0===c&&(c=1);var g=new e,f=Math.sqrt(b*b+a*a+c*c),k,l,q;d=(e.degreesToRadians(d)||
0)/2;k=Math.cos(d);l=Math.sin(d);d=l*l;0===f?(a=b=0,c=1):1!==f&&(b/=f,a/=f,c/=f);1===b&&0===a&&0===c?(g.m22=g.m33=1-2*d,g.m23=g.m32=2*k*l,g.m32*=-1):0===b&&1===a&&0===c?(g.m11=g.m33=1-2*d,g.m13=g.m31=2*k*l,g.m13*=-1):0===b&&0===a&&1===c?(g.m11=g.m22=1-2*d,g.m12=g.m21=2*k*l,g.m21*=-1):(f=l*k,k=b*b,l=a*a,q=c*c,g.m11=1-2*(l+q)*d,g.m12=2*(b*a*d+c*f),g.m13=2*(b*c*d-a*f),g.m21=2*(a*b*d-c*f),g.m22=1-2*(q+k)*d,g.m23=2*(a*c*d+b*f),g.m31=2*(c*b*d+a*f),g.m32=2*(c*a*d-b*f),g.m33=1-2*(k+l)*d);return this.multiply(g)};
e.prototype.scale=function(b,a,c){var d=new e;if("number"!=typeof b||isNaN(b))b=1;if("number"!=typeof a||isNaN(a))a=b;if("number"!=typeof c||isNaN(c))c=1;d.m11=b;d.m22=a;d.m33=c;return this.multiply(d)};e.prototype.skewX=function(b){b=e.degreesToRadians(b);var a=new e;a.c=Math.tan(b);return this.multiply(a)};e.prototype.skewY=function(b){b=e.degreesToRadians(b);var a=new e;a.b=Math.tan(b);return this.multiply(a)};e.prototype.translate=function(b,a,c){var d=new e;if("number"!=typeof b||isNaN(b))b=
0;if("number"!=typeof a||isNaN(a))a=0;if("number"!=typeof c||isNaN(c))c=0;d.m41=b;d.m42=a;d.m43=c;return this.multiply(d)};e.prototype.setMatrixValue=function(b){b=e.toMatrixString(b.trim());var a=b.match(/^matrix(3d)?\(\s*(.+)\s*\)$/),c,d,g,f,k;if(a)if(c=!!a[1],a=a[2].split(/\s*,\s*/),d=a.length,g=Array(d),c&&16!==d||!c&&6!==d)XML3D.debug.logError("Invalid CSS Matrix: ",b);else{try{for(f=0;f<d;f++)k=a[f],g[f]=parseFloat(k)}catch(l){XML3D.debug.logError("Invalid CSS Matrix: ",b);return}for(f=0;f<
d;f++)this[c?"m"+(Math.floor(f/4)+1)+(f%4+1):String.fromCharCode(f+97)]=g[f]}};e.prototype.toString=function(){var b=this,a,c;this.isAffine()?(c="matrix(",a="abcdef".split("")):(c="matrix3d(",a="m11 m12 m13 m14 m21 m22 m23 m24 m31 m32 m33 m34 m41 m42 m43 m44".split(" "));return c+a.map(function(a){return b[a].toFixed(6)}).join(", ")+")"};m.exports=e},{}],183:[function(d,m,l){var e=d("../contrib/stacktrace-0.4.js"),b=d("./options.js"),a=d("assert");(function(c){b.register("loglevel","warning");c.exports=
{ALL:0,DEBUG:1,INFO:2,WARNING:3,ISSUE:4,ERROR:5,EXCEPTION:6,params:{},isSetup:!1,loglevel:5,loglevels:{all:0,debug:1,info:2,warning:3,issue:4,error:5,exception:6},setup:function(){var a=XML3D.debug;a.isSetup||(a.isSetup=!0,a.loglevel=a.loglevels[b.getValue("loglevel")]||3,b.addObserver(function(b,c){"loglevel"==b&&(a.loglevel=a.loglevels[c]||3)}));return!0},_setLogLevel:function(){},doLog:function(b,c){if(!(XML3D.debug.params.xml3d_nolog||b<XML3D.debug.loglevel)&&(c=Array.prototype.slice.call(c),
window.console))switch(b){case XML3D.debug.INFO:window.console.info.apply(window.console,c);break;case XML3D.debug.WARNING:window.console.warn.apply(window.console,c);break;case XML3D.debug.ERROR:window.console.error.apply(window.console,c);break;case XML3D.debug.EXCEPTION:window.console.error(e({e:c[0],guess:!0}).join("\n"));break;case XML3D.debug.DEBUG:window.console.debug.apply(window.console,c);break;case XML3D.debug.ISSUE:a(void 0!==c[1],"Github issue number must be specified."),window.console.error.apply(window.console,
[c[0]+"\nMore information can be found at https://github.com/xml3d/xml3d.js/issues/"+c[1]].concat(c.slice(2,c.length)))}},logDebug:function(){XML3D.debug.doLog(XML3D.debug.DEBUG,arguments)},logInfo:function(){XML3D.debug.doLog(XML3D.debug.INFO,arguments)},logWarning:function(){XML3D.debug.doLog(XML3D.debug.WARNING,arguments)},logError:function(){XML3D.debug.doLog(XML3D.debug.ERROR,arguments)},logIssue:function(){XML3D.debug.doLog(XML3D.debug.ISSUE,arguments)},logException:function(){XML3D.debug.doLog(XML3D.debug.EXCEPTION,
arguments)},assert:a,trace:function(a,b){b=void 0!==b?b:XML3D.debug.ERROR;if(window.console.trace)a&&XML3D.debug.doLog(b,[a]),window.console.trace();else{var c=e();a&&c.splice(0,0,a);XML3D.debug.doLog(b,c)}},getNumberWithPadding:function(a,b){for(var c=""+a;c.length<b;)c=" "+c;return c},formatSourceCode:function(a){var b="";a=a.split("\n");for(var c=0;c<a.length;++c)b+=this.getNumberWithPadding(c+1,3)+"  "+a[c]+"\n";return b}}})(m)},{"../contrib/stacktrace-0.4.js":51,"./options.js":185,assert:11}],
184:[function(d,m,l){(function(e){e.callAdapterFunc=function(a,b){var e=[];if(!a||void 0===a._configured)return e;var d=a._configured.adapters,k;for(k in d)for(var l in b){var q=d[k],n=q[l];n&&e.push(n.apply(q,b[l]))}return e};e.sendAdapterEvent=function(a,b){if(!a||void 0===a._configured)return!1;var e=a._configured.adapters,d;for(d in e)for(var k in b){var l=e[d][k];l&&l.apply(e[d],b[k])}return!0};e.dispatchCustomEvent=function(a,b,e,d,k){var l=document.createEvent("CustomEvent");l.initCustomEvent(b,
e,d,k);return a.dispatchEvent(l)};e.dispatchEvent=function(a,b){var e=null;if(document.createEvent)return e=document.createEvent("Events"),e.initEvent(b,!0,!0),a.dispatchEvent(e);if(document.createEventObject)return e=document.createEventObject(),a.fireEvent("on"+b,e)};var b,a;e.toImageData=function(c){if(c instanceof ImageData)return c;if(!c.data)throw Error("no data property");if(!c.width)throw Error("no width property");if(!c.height)throw Error("no height property");a||(b=document.createElement("canvas"),
a=b.getContext("2d"));for(var e=a.createImageData(c.width,c.height),d=0;d<c.data.length;++d){var f=c.data[d];255<f&&(f=255);0>f&&(f=0);e.data[d]=f}return e};e.elementIs=function(a,b){return a&&a.tagName.toLowerCase()===b};e.encodeZIndex=function(a,b){if("auto"===a||""===a||"0"===a)if(b)a="0";else return"";a="0000000000"+a;return a=a.slice(a.length-10)}})(m.exports)},{}],185:[function(d,m,l){(function(e){var b=function(){this._options={};this._listeners={"*":[]}};b.prototype={register:function(a,b){if(this._options.hasOwnProperty(a))throw Error("Option already registered '"+
a+"'");this._options[a]={currentValue:b,defaultValue:b}},resetValue:function(a){if(!this._options.hasOwnProperty(a))throw Error("Invalid configuration key '"+a+"'");this._options[a].currentValue=this._options[a].defaultValue;this.notifyObservers(a,this._options[a].currentValue)},setValue:function(a,b){if(!this._options.hasOwnProperty(a))throw Error("Invalid configuration key '"+a+"'");this._options[a].currentValue=b;this.notifyObservers(a,b)},getValue:function(a){if(!this._options.hasOwnProperty(a))throw Error("Invalid configuration key '"+
a+"'");return this._options[a].currentValue},getKeys:function(){return Object.keys(this._options)},notifyObservers:function(a,b){this._listeners.hasOwnProperty(a)&&this._listeners[a].forEach(function(e){e(a,b)});this._listeners["*"].forEach(function(e){e(a,b)})},addObserver:function(a,b){"function"==typeof a&&(b=a,a="*");if(!this._options.hasOwnProperty(a)&&"*"!==a)throw Error("Can't register to unknown option '"+a+"'");this._listeners.hasOwnProperty(a)||(this._listeners[a]=[]);this._listeners[a].push(b)},
removeObserver:function(a){for(var b in this._listeners){var e=this._listeners[b],d=e.indexOf(a);-1!=d&&e.splice(d,1)}}};b=new b;b.setOptionsFromQuery=function(){window.location.search.substr(1).split("&").forEach(function(a){a=a.split("=");try{var b=a[0].toLowerCase();if(0===b.indexOf("xml3d-")){var e=decodeURIComponent(a[1]);try{e=JSON.parse(e)}catch(d){}XML3D.options.setValue(b.substr(6),e)}}catch(f){XML3D.debug&&XML3D.debug.logError(f)}})};e.exports=b})(m)},{}],186:[function(d,m,l){(function(e){var b=
function(a){a=a||"";if(0==a.indexOf("blob:")){var b=/^(?:([^:\/?\#]+):)?([^\#]*)(?:\#(.*))?/;a=a.match(b);this.valid=null!=a;this.scheme=a[1]||null;this.query=this.path=this.authority=null;this.opaqueString=a[2]||null;this.fragment=a[3]||null}else b=/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/,a=a.match(b),this.valid=null!=a,this.scheme=a[1]||null,this.authority=a[2]||null,this.path=a[3]||null,this.query=a[4]||null,this.opaqueString=null,this.fragment=a[5]||null};b.prototype.isLocal=
function(){return"blob"!=this.scheme&&!this.authority&&!this.path};b.prototype.isAbsolute=function(){return null!=this.scheme};b.prototype.getAbsoluteURI=function(a){if(!this.valid||this.isAbsolute())return this;a=new b(a);this.path?(0==this.path.indexOf("/")?a.path=this.path:a.path=a.path.substr(0,a.path.lastIndexOf("/")+1)+this.path,a.query=this.query):this.query&&(a.query=this.query);a.fragment=this.fragment;return a};b.prototype.hasSameOrigin=function(a){"string"==typeof a&&(a=new b(a));return"blob"==
this.scheme||"data"==this.scheme?!0:this.scheme==a.scheme&&this.authority==a.authority};b.prototype.toString=function(){var a="";if("blob"==this.scheme)return a="blob:"+this.opaqueString,this.fragment&&(a+="#"+this.fragment),a;this.scheme&&(a+=this.scheme+":");this.authority&&(a+="//"+this.authority);this.path&&(a+=this.path);this.query&&(a+="?"+this.query);this.fragment&&(a+="#"+this.fragment);return a};b.prototype.toStringWithoutFragment=function(){var a="";if("blob"==this.scheme)return a="blob:"+
this.opaqueString;this.scheme&&(a+=this.scheme+":");this.authority&&(a+="//"+this.authority);this.path&&(a+=this.path);this.query&&(a+="?"+this.query);return a};var a=function(){};a.resolveLocal=function(a,e){"string"==typeof a&&(a=new b(a));e=e||window.document;return"urn"==a.scheme||"blob"==a.scheme?null:!a.path&&a.fragment?e.getElementById(a.fragment):null};a.resolve=function(b,e){XML3D.debug.logWarning("You are using deprecated XML3D.URIResolver.resolve. Use XML3D.URIResolver.resolveLocal instead.");
return a.resolveLocal(b,e)};e.URI=b;e.URIResolver=a})(m.exports)},{}],187:[function(d,m,l){(function(e,b){function a(a){return!isNaN(parseFloat(a))&&isFinite(a)}function c(b){var c;if(a(b)){for(c in A)if(A[c]===b)return c;XML3D.debug.logDebug("Got unknown OpenCL Error Code:",b)}return"UNKNOWN_ERROR"}function d(a){var b=null;return a.name&&"string"===typeof a.name&&A[a.name]?A[a.name]:a.message&&"string"===typeof a.message&&(b=a.message.match(/-?\d+/g),b instanceof Array)?parseInt(b[b.length-1],10):
!1}function g(a,b){a&&"string"!==typeof a&&(XML3D.debug.logDebug("WebCL API: WebCLError: Error name not type of String"),a="");b&&"string"!==typeof b&&(XML3D.debug.logDebug("WebCL API: WebCLError: Error message not type of String"),b="");this.name=a||"WebCLError";this.message=b||"Generic WebCL error.";this.stack=Error().stack}function f(){return D=window.webcl&&webcl.getPlatforms}function k(){var a;B=!0;try{a=webcl.getPlatforms()}catch(b){B=!1}a&&0!==a.length||(B=!1);return B}function l(){return f()&&
k()}function q(){0===w.length&&(w=webcl.getPlatforms());return w}function n(a,b){var e=[];if(!b)return XML3D.debug.logError("WebCL API: getPlatformDevicesByType(): platform was not defined."),!1;a=a||"CPU";try{"CPU"===a?e=b.getDevices(webcl.DEVICE_TYPE_CPU):"GPU"===a?e=b.getDevices(webcl.DEVICE_TYPE_GPU):"ALL"===a&&(e=b.getDevices(webcl.DEVICE_TYPE_ALL))}catch(f){e=d(f);if(!e)throw f;if(e!==A.DEVICE_NOT_FOUND)throw new g(c(e),"Could not get devices.");return!1}return e}function p(a){var b=[],c,e;
q();for(e=w.length;e--;)(c=n(a,w[e]))&&c.forEach(function(a){b.push(a)});return 0===b.length?!1:b}function r(a){try{var b=webcl.createContext(a)}catch(e){a=d(e);if(!a)throw e;throw new g(c(a),"Failed to create a WebCL context.");}return b}function t(a,b){var e;b=b||F;if(!a)return XML3D.debug.logError("WebCL API: createProgram(): codeStr was not defined."),!1;if(!b)return XML3D.debug.logError("WebCL API: createProgram(): clCtx was not defined."),!1;try{e=b.createProgram(a)}catch(f){e=d(f);if(!e)throw f;
throw new g(c(e),"Failed to create a WebCL program.");}return e}function m(a,b){b=b||z;if(!a)return XML3D.debug.logError("WebCL API: buildProgram(): program was not defined."),!1;try{a.build(b,"")}catch(e){var f=d(e);if(!f)throw e;throw new g(c(f),a.getBuildInfo(b[0],WebCL.PROGRAM_BUILD_LOG));}return a}function x(a,b){var e;if(!a)return XML3D.debug.logError("WebCL API: createKernel(): program was not defined."),!1;if(!b)return XML3D.debug.logError("WebCL API: createKernel(): name was not defined."),
!1;try{e=a.createKernel(b)}catch(f){e=d(f);if(!e)throw f;throw new g(c(e),"Failed to create a WebCL kernel.");}return e}function y(a,b){var e;b=b||F;if(!b)return XML3D.debug.logError("WebCL API: createCommandQueue: clCtx was not defined"),!1;try{e=b.createCommandQueue(a||z[0],0)}catch(f){if(!d(f))throw f;throw new g(c(d(f)),"Could not create CommandQueue.");}return e}var w=[],z=[],F=null,D=!1,B=!1,A={SUCCESS:0,DEVICE_NOT_FOUND:-1,DEVICE_NOT_AVAILABLE:-2,COMPILER_NOT_AVAILABLE:-3,MEM_OBJECT_ALLOCATION_FAILURE:-4,
OUT_OF_RESOURCES:-5,OUT_OF_HOST_MEMORY:-6,PROFILING_INFO_NOT_AVAILABLE:-7,MEM_COPY_OVERLAP:-8,IMAGE_FORMAT_MISMATCH:-9,IMAGE_FORMAT_NOT_SUPPORTED:-10,BUILD_PROGRAM_FAILURE:-11,MAP_FAILURE:-12,INVALID_VALUE:-30,INVALID_DEVICE_TYPE:-31,INVALID_PLATFORM:-32,INVALID_DEVICE:-33,INVALID_CONTEXT:-34,INVALID_QUEUE_PROPERTIES:-35,INVALID_COMMAND_QUEUE:-36,INVALID_HOST_PTR:-37,INVALID_MEM_OBJECT:-38,INVALID_IMAGE_FORMAT_DESCRIPTOR:-39,INVALID_IMAGE_SIZE:-40,INVALID_SAMPLER:-41,INVALID_BINARY:-42,INVALID_BUILD_OPTIONS:-43,
INVALID_PROGRAM:-44,INVALID_PROGRAM_EXECUTABLE:-45,INVALID_KERNEL_NAME:-46,INVALID_KERNEL_DEFINITION:-47,INVALID_KERNEL:-48,INVALID_ARG_INDEX:-49,INVALID_ARG_VALUE:-50,INVALID_ARG_SIZE:-51,INVALID_KERNEL_ARGS:-52,INVALID_WORK_DIMENSION:-53,INVALID_WORK_GROUP_SIZE:-54,INVALID_WORK_ITEM_SIZE:-55,INVALID_GLOBAL_OFFSET:-56,INVALID_EVENT_WAIT_LIST:-57,INVALID_EVENT:-58,INVALID_OPERATION:-59,INVALID_GL_OBJECT:-60,INVALID_BUFFER_SIZE:-61,INVALID_MIP_LEVEL:-62,INVALID_GLOBAL_WORK_SIZE:-63};Object.freeze(A);
g.prototype=Object.create(Error.prototype);g.prototype.constructor=g;var C=function(a,b){var e={};return{register:function(c,d){if(e.hasOwnProperty(c))return XML3D.debug.logWarning("WebCL API: kernels.register(): Kernel with a same name is already defined."),!1;if("string"!==typeof c)return XML3D.debug.logError("WebCL API: kernels.register(): Kernel name was not defined or was not type of String."),!1;if("string"!==typeof d)return XML3D.debug.logError("WebCL API: kernels.register(): Kernel code was not defined or was not type of String."),
!1;var f,g;f=t(d,a);m(f,b);f&&(g=x(f,c));return g?(e[c]=g,!0):!1},unRegister:function(a){if(e.hasOwnProperty(a)){try{e[a].release()}catch(b){a=d(b);if(!a)throw b;throw new g(c(a),"Could not release kernel resources.");}delete e[a];return!0}return!1},getKernel:function(a){return"string"!==typeof a?!1:e.hasOwnProperty(a)?e[a]:!1},setArgs:function(){var a=Array.prototype.slice.call(arguments),b,e;if(2>a.length)return XML3D.debug.logWarning("WebCL API: setArgs(): No kernel arguments were defined."),!1;
b=a[0];a=a.slice(1);if(!b)return XML3D.debug.logWarning("WebCL API: setArgs(): WebCL kernel was not defined."),!1;e=b.getInfo(webcl.KERNEL_NUM_ARGS);if(a.length>e)XML3D.debug.logWarning("WebCL: setArgs: Input args amount > kernel program args amount! Ignoring extra arguments.");else if(a.length<e)return XML3D.debug.logError("WebCL: setArgs: Not enough arguments were given to WebCL kernel."),!1;XML3D.debug.logDebug("Args for kernel:",b.getInfo(webcl.KERNEL_FUNCTION_NAME));try{for(;e--;)XML3D.debug.logDebug("Arg:",
e,a[e]),b.setArg(e,a[e])}catch(f){b=d(f);if(!b)throw f;throw new g(c(b),"Could not set kernel arguments.");}return!0}}};e.webcl={init:function(a){if(!f())return XML3D.debug.logWarning("WebCL API: Unfortunately your system does not support WebCL. WebCL namespace is not available."),!1;if(!k())return XML3D.debug.logWarning("WebCL API: Unfortunately your system does not support WebCL. OpenCL drivers are not working properly."),!1;q();z=p(a||"CPU");F=r(z);return!0},createContext:r,createProgram:t,buildProgram:m,
createKernel:x,createCommandQueue:y,createBuffer:function(b,e,f){f=f||F;if(!b)return XML3D.debug.logError("WebCL API: createBuffer(): Buffer size was not defined."),!1;if(!a(b)||0>b)return XML3D.debug.logError("WebCL API: createBuffer(): Buffer size must be a positive number."),!1;if(!e)return XML3D.debug.logError("WebCL API: createBuffer(): Buffer type was not defined."),!1;if(!f)return XML3D.debug.logError("WebCL API: createBuffer(): clCtx was not defined."),!1;try{if("r"===e)return f.createBuffer(webcl.MEM_READ_ONLY,
b);if("w"===e)return f.createBuffer(webcl.MEM_WRITE_ONLY,b);if("rw"===e)return f.createBuffer(webcl.MEM_READ_WRITE,b);XML3D.debug.logError("WebCL API: createBuffer(): Unknown buffer type:",e);return!1}catch(k){b=d(k);if(!b)throw k;throw new g(c(b),"Could not create a WebCL buffer.");}},getDefaultContext:function(){return F},getPlatforms:q,getDevicesByType:p,getContextDevices:function(a){var b=[];if(!a)return XML3D.debug.logError("WebCL API: getContextDevices(): clCtx was not defined."),!1;try{b=a.getInfo(webcl.CONTEXT_DEVICES)}catch(e){if(a=
d(e))throw new g(c(a),"Could not get devices.");throw e;}return 0===b.length?!1:b},getDevicePlatform:function(a){var b;if(!a)return XML3D.debug.logError("WebCL API: getDevicePlatform(): device was not defined."),!1;try{b=a.getInfo(webcl.DEVICE_PLATFORM)}catch(e){a=d(e);if(!a)throw e;throw new g(c(a),"Could not get the platform of the device.");}return b},kernels:new C,KernelManager:C,hasWebCLNamespace:f,hasOpenCLDrivers:k,isAvailable:l,WebCLError:g,getCLErrorName:c};(function(a){if(!l())return!1;
var b=q();if(!b||0>=b.length)return!1;try{var c=p("GPU")||p("CPU");if(!c)return!1;var e=r(c),d=y(c[0],e);a.cl={API:webcl,kernelManager:new C(e,c),platforms:b,devices:c,ctx:e,cmdQueue:d};XML3D.debug.logDebug("Successfully initialized WebCL platform.");return!0}catch(f){return!1}})(e.webcl);window.XML3D.webcl=e.webcl})(m.exports)},{}],188:[function(d,m,l){var e=d("assert"),b=[],a=[],c=[];m.exports={registerErrorCallback:function(a){b.push(a)},notifyError:function(a,c){if(0<b.length){var e;for(e=0;e<
b.length;++e)b[e](a,c)}},createClass:function(a,b,c){c=c||{};if(b){var e=function(){};e.prototype=b.prototype;a.prototype=new e;a.prototype.constructor=a;a.superclass=b.prototype}for(var d in c)a.prototype[d]=c[d];return a},extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},_queueResultCallback:function(b,d){e(void 0!==d);var f;-1==(f=a.indexOf(b))&&(f=a.length,a.push(b));var k=c[f];if(!k||k<d)c[f]=d},_flushResultCallbacks:function(){if(a.length){var b;for(b=0;b<a.length;++b)a[b]._onPostponedResultChanged(c[b]);
a=[];c=[]}}}},{assert:11}],189:[function(d,m,l){var e={EPSILON:1E-6,DATA_TYPE:{UNKNOWN:0,FLOAT:1,FLOAT2:2,FLOAT3:3,FLOAT4:4,FLOAT3X3:5,FLOAT4X4:10,INT:20,INT4:21,BOOL:30,TEXTURE:40,STRING:45,BYTE:50,UBYTE:60,fromString:function(b){if(b&&b.toUpperCase)return this[b.toUpperCase()]}}};e.DATA_TYPE_MAP={"float":e.DATA_TYPE.FLOAT,float2:e.DATA_TYPE.FLOAT2,float3:e.DATA_TYPE.FLOAT3,float4:e.DATA_TYPE.FLOAT4,float3x3:e.DATA_TYPE.FLOAT3X3,float4x4:e.DATA_TYPE.FLOAT4X4,"int":e.DATA_TYPE.INT,int4:e.DATA_TYPE.INT4,
bool:e.DATA_TYPE.BOOL,texture:e.DATA_TYPE.TEXTURE,string:e.DATA_TYPE.STRING,"byte":e.DATA_TYPE.BYTE,ubyte:e.DATA_TYPE.UBYTE};e.TEXTURE_TYPE={UNKNOWN:0,FLOAT:1,UBYTE:60,USHORT_5_6_5:70,USHORT_4_4_4_4:71,USHORT_5_5_5_1:72};e.TEXTURE_FORMAT={UNKNOWN:0,ALPHA:100,RGB:101,RGBA:102,LUMINANCE:103,LUMINANCE_ALPHA:104};e.DATA_TYPE_TUPLE_SIZE={};e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT]=1;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT2]=2;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT3]=3;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT4]=
4;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT3X3]=9;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.FLOAT4X4]=16;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.INT]=1;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.INT4]=4;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.BOOL]=1;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.TEXTURE]=1;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.STRING]=1;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.BYTE]=1;e.DATA_TYPE_TUPLE_SIZE[e.DATA_TYPE.UBYTE]=1;e.TYPED_ARRAY_MAP={};e.TYPED_ARRAY_MAP[e.DATA_TYPE.FLOAT]=Float32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.FLOAT2]=
Float32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.FLOAT3]=Float32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.FLOAT4]=Float32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.FLOAT4X4]=Float32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.INT]=Int32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.INT4]=Int32Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.BOOL]=Int8Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.BYTE]=Int8Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.UBYTE]=Uint8Array;e.TYPED_ARRAY_MAP[e.DATA_TYPE.STRING]=Array;e.TYPED_ARRAY_MAP[e.TEXTURE_TYPE.USHORT_4_4_4_4]=Uint16Array;
e.TYPED_ARRAY_MAP[e.TEXTURE_TYPE.USHORT_5_6_5]=Uint16Array;e.TYPED_ARRAY_MAP[e.TEXTURE_TYPE.USHORT_5_5_5_1]=Uint16Array;e.TEXTURE_FORMAT_TUPLE_SIZE={};e.TEXTURE_FORMAT_TUPLE_SIZE[e.TEXTURE_FORMAT.ALPHA]=1;e.TEXTURE_FORMAT_TUPLE_SIZE[e.TEXTURE_FORMAT.RGB]=3;e.TEXTURE_FORMAT_TUPLE_SIZE[e.TEXTURE_FORMAT.RGBA]=4;e.TEXTURE_FORMAT_TUPLE_SIZE[e.TEXTURE_FORMAT.LUMINANCE]=1;e.TEXTURE_FORMAT_TUPLE_SIZE[e.TEXTURE_FORMAT.LUMINANCE_ALPHA]=2;e.getTypeName=function(b){for(var a in e.DATA_TYPE_MAP)if(e.DATA_TYPE_MAP[a]===
b)return a};e.TEX_FILTER_TYPE={NEAREST:9728,LINEAR:9729,MIPMAP_NEAREST:9984,MIPMAP_LINEAR:9985};e.TEX_WRAP_TYPE={CLAMP:33071,REPEAT:10497};e.TEX_TYPE={TEXTURE_2D:3553};e.SHADER_CONSTANT_KEY={WORLD_TRANSFORM:1,VIEW_TRANSFORM:2,SCREEN_TRANSFORM:3,WORLD_TRANSFORM_NORMAL:4,VIEW_TRANSFORM_NORMAL:5,SCREEN_TRANSFORM_NORMAL:6,OBJECT_ID:7};e.VS_ATTRIB_TRANSFORM={NONE:0,VIEW_POINT:1,WORLD_POINT:2,VIEW_NORMAL:3,WORLD_NORMAL:4};e.DATA_FILTER_TYPE={NONE:0,RENAME:1,KEEP:2,REMOVE:3};e.DATA_ENTRY_STATE={CHANGED_VALUE:1,
CHANGED_NEW:2,LOAD_START:3,LOAD_END:4,CHANGED_SIZE:5,CHANGED_REMOVED:6,CHANGED_SIZE_TYPE:7};e.RESULT_TYPE={COMPUTE:0,VS:1};e.RESULT_STATE={NONE:0,CHANGED_DATA_VALUE:1,CHANGED_DATA_SIZE:2,CHANGED_STRUCTURE:3,IMAGE_LOAD_START:4,IMAGE_LOAD_END:5,REMOVED:6};e.SEQUENCE={NO_ACCESS:0,PREV_BUFFER:1,NEXT_BUFFER:2,LINEAR_WEIGHT:3};e.ITERATION_TYPE={NULL:0,ONE:1,MANY:2};e.EXTRACT={NO_EXTRAC:0,TEX_WIDTH:1,TEX_HEIGHT:2};e.ORIGIN={CHILD:1,COMPUTE:2,PROTO:3};e.PLATFORM={JAVASCRIPT:0,GLSL:1,CL:2,ASYNC:3};e.PROCESS_STATE=
{MODIFIED:0,LOADING:1,INVALID:3,UNPROCESSED:4,PROCESSED:5};m.exports=e},{}],190:[function(d,m,l){function e(a,b,e,d){"object"===typeof a?(a.nodeName&&("video"===a.nodeName.toLowerCase()&&"undefined"===typeof a.complete&&Object.defineProperties(a,{width:{get:function(){return this.videoWidth}},height:{get:function(){return this.videoHeight}},complete:{get:function(){return!(0==this.readyState||0>=this.videoWidth||0>=this.videoHeight)}}}),a.texelFormat=c.TEXTURE_FORMAT.RGBA,a.texelType=c.TEXTURE_TYPE.UBYTE),
this._source=a):(e=e||c.TEXTURE_FORMAT.RGBA,d=d||c.TEXTURE_TYPE.UBYTE,this._source={width:a,height:b,texelFormat:e,texelType:d,data:new c.TYPED_ARRAY_MAP[d](a*b*c.TEXTURE_FORMAT_TUPLE_SIZE[e])})}function b(a,b){var c;for(c=0;c<q._listeners.length;++c)q._listeners[c](a,b);for(c=0;c<a._listeners.length;++c)a._listeners[c](a,b)}var a=d("../base.js"),c=d("./constants.js"),h=d("lodash.assign");d("../../utils/array.js");var g={minFilter:c.TEX_FILTER_TYPE.LINEAR,magFilter:c.TEX_FILTER_TYPE.LINEAR,wrapS:c.TEX_WRAP_TYPE.CLAMP,
wrapT:c.TEX_WRAP_TYPE.CLAMP,textureType:c.TEX_TYPE.TEXTURE_2D,flipY:!0,anisotropy:1,generateMipMap:0},f=function(){this.setDefaults()};f.prototype.setDefaults=function(){h(this,g)};f.prototype.set=function(a){h(this,a)};var k=function(a){this._type=a;this._listeners=[];this.userData={}};Object.defineProperty(k.prototype,"type",{set:function(){throw Error("type is read-only");},get:function(){return this._type}});k.prototype.addListener=function(a){this._listeners.push(a)};k.prototype.removeListener=
function(a){Array.erase(this._listeners,a)};k.prototype._notifyChanged=function(){b(this,c.DATA_ENTRY_STATE.CHANGED_VALUE)};d=function(a,e){k.call(this,a);this._value=e;b(this,c.DATA_ENTRY_STATE.CHANGED_NEW)};a.createClass(d,k);d.prototype.setValue=function(b){this._setValue(b);a._flushResultCallbacks()};d.prototype._setValue=function(a){var e=this._value?this._value.length:0,d=a?a.length:0,f=this.getTupleSize(),e=(e>=2*f?2:e>=f?1:0)!=(d>=2*f?2:d>=f?1:0)?c.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:e!=d?
c.DATA_ENTRY_STATE.CHANGED_SIZE:c.DATA_ENTRY_STATE.CHANGED_VALUE;this._value=a;b(this,e)};d.prototype.getValue=function(){return this._value};d.prototype.getLength=function(){return this._value?this._value.length:0};d.prototype.getTupleSize=function(){return c.DATA_TYPE_TUPLE_SIZE[this._type]};d.prototype.getIterateCount=function(){return this.getLength()/this.getTupleSize()};d.prototype.isEmpty=function(){return!this._value||!this.getLength()};Object.defineProperties(e.prototype,{imageData:{get:function(){if(this._source instanceof
HTMLElement){var a=document.createElement("canvas");a.width=this._source.width;a.height=this._source.height;a=a.getContext("2d");a.drawImage(this._source,0,0);a=a.getImageData(0,0,this._source.width,this._source.height);a.texelFormat=this._source.texelFormat;a.texelType=this._source.texelType;this._source=a}return this._source}},glTextureData:{get:function(){return this._source}},complete:{get:function(){return"undefined"===typeof this._source.complete?!0:this._source.complete}},width:{get:function(){return this._source?
this._source.width:-1}},height:{get:function(){return this._source?this._source.height:-1}},texelFormat:{get:function(){return this._source?this._source.texelFormat:c.TEXTURE_FORMAT.UNKNOWN}},texelType:{get:function(){return this._source?this._source.texelType:c.TEXTURE_TYPE.UNKNOWN}}});l=function(a){k.call(this,c.DATA_TYPE.TEXTURE);this._samplerConfig=new f;this._loading=!1;this.setImage(a);b(this,c.DATA_ENTRY_STATE.CHANGED_NEW)};a.createClass(l,k);Object.defineProperties(l.prototype,{width:{get:function(){return this._source?
this._source.width:-1}},height:{get:function(){return this._source?this._source.height:-1}},texelFormat:{get:function(){return this._source?this._source.texelFormat:c.TEXTURE_FORMAT.UNKNOWN}},texelType:{get:function(){return this._source?this._source.texelType:c.TEXTURE_TYPE.UNKNOWN}}});l.prototype.isLoading=function(){return this._source?!this._source.complete:!1};l.prototype._createImage=function(a,b,c,d,g){this._source&&this.width==a&&this.height==b&&this.format==c&&this.type==d?this._notifyChanged():
(a=new e(a,b,c,d),g||(g=new f,g.setDefaults()),this._samplerConfig.set(g),this._setImage(a));return this._source};l.prototype.setImage=function(b,c){this._setImage(b,c);a._flushResultCallbacks()};l.prototype._setImage=function(a,b){a?a instanceof e?this._setSource(a,b):this._setSource(new e(a),b):this._setSource(null,b)};l.prototype._setSource=function(a,e){var d=this.isLoading();this._source=a;var f=this.isLoading();!e||f||d?f?(this._loading=!0,b(this,c.DATA_ENTRY_STATE.LOAD_START)):this._loading?
(this._loading=!1,b(this,c.DATA_ENTRY_STATE.LOAD_END)):b(this,c.DATA_ENTRY_STATE.CHANGED_VALUE):(b(this,c.DATA_ENTRY_STATE.LOAD_START),b(this,c.DATA_ENTRY_STATE.LOAD_END))};l.prototype.asGLTextureValue=function(){return this._source&&this._source.glTextureData};l.prototype.getValue=function(){return!this._source||this.isLoading()?null:this._source.imageData};l.prototype.getSamplerConfig=function(){return this._samplerConfig};l.prototype.getLength=function(){return 1};l.prototype.isEmpty=function(){return!1};
l.prototype.getIterateCount=function(){return 1};var u=function(a){k.call(this,c.DATA_TYPE.TEXTURE);this._samplerConfig=new f;this._imageData=null;this._texelFormat=c.TEXTURE_FORMAT.RGBA;this._texelType=c.TEXTURE_TYPE.UBYTE;this._updateImageData(a);b(this,c.DATA_ENTRY_STATE.CHANGED_NEW)};a.createClass(u,k);Object.defineProperties(u.prototype,{width:{get:function(){return this._imageData?this._imageData.width:-1}},height:{get:function(){return this._imageData?this._imageData.height:-1}},texelFormat:{get:function(){return this._texelFormat}},
texelType:{get:function(){return this._texelType}}});u.prototype.isLoading=function(){return!this._imageData};u.prototype._updateImageData=function(a){this._texelFormat=c.TEXTURE_FORMAT.RGBA;this._texelType=c.TEXTURE_TYPE.UBYTE;this._imageData=a};u.prototype._createImage=function(a,b,e,d,g){if(!this._imageData||this.getWidth()!=a||this.getHeight()!=b||this._format!=e||this._type!=d){if(!a||!b)throw Error("Width or height is not specified");this._texelFormat=e;this._texelType=d;g||(g=new f,g.setDefaults());
this._samplerConfig.set(g);e={width:a,height:b,data:null};e.data=d==c.TEXTURE_TYPE.FLOAT?new Float32Array(a*b*4):Uint8Array==Uint8ClampedArray?new Int16Array(a*b*4):new Uint8ClampedArray(a*b*4);this._imageData=e}this._notifyChanged()};u.prototype.setImageData=function(e){this._updateImageData(e);b(this,c.DATA_ENTRY_STATE.CHANGED_VALUE);a._flushResultCallbacks()};u.prototype.getWidth=function(){return this._imageData&&this._imageData.width||0};u.prototype.getHeight=function(){return this._imageData&&
this._imageData.height||0};u.prototype.getValue=function(){return this._imageData};u.prototype.getSamplerConfig=function(){return this._samplerConfig};u.prototype.getLength=function(){return 1};u.prototype.isEmpty=function(){return!1};u.prototype.getIterateCount=function(){return 1};var q={_listeners:[],addListener:function(a){this._listeners.push(a)},removeListener:function(a){Array.erase(this._listeners,a)}};m.exports={DataEntry:k,BufferEntry:d,TextureEntry:l,ImageDataTextureEntry:u,SamplerConfig:f,
DataChangeNotifier:q}},{"../../utils/array.js":180,"../base.js":188,"./constants.js":189,"lodash.assign":17}],191:[function(d,m,l){function e(a){if(a._substitutionNodes){for(var b in a._substitutionNodes)a._substitutionNodes[b].clear();a._substitutionNodes={};for(var c in a._children)e(a._children[c])}}function b(a,c){if(a._filterMapping&&!a._filterMapping.isEmpty())return a;if(!a._computeOperator){if(a._sourceNode&&0==a._children.length)return b(a._sourceNode);if(1==a._children.length&&a._children[0]instanceof
r)return b(a._children[0])}var e=a._channelNode.getChildDataIndex(c);return-1!=e&&void 0!=e?a._sourceNode?b(a._sourceNode):b(a._children[e]):a}function a(b){var c=b._loading?b._loadLevel:Infinity,e;for(e=0;c&&e<b._children.length;++e){var d=b._children[e];d instanceof r?c=Math.min(c,Math.max(d._loadLevel,d._progressLevel)):d._data&&d._data.isLoading&&d._data.isLoading()&&(c=Math.min(c,1))}c&&b._sourceNode&&(c=Math.min(c,Math.max(b._sourceNode._loadLevel,b._sourceNode._progressLevel)));c&&b._dataflowNode&&
(c=Math.min(c,Math.max(b._dataflowNode._loadLevel,b._dataflowNode._progressLevel)));e=b._progressLevel;b._progressLevel=c;if(e!=b._progressLevel)for(b._callLoadListeners(b._progressLevel,e),e=0;e<b._parents.length;++e)a(b._parents[e])}function c(a,b){for(var c=0;c<a._parents.length;++c)a._parents[c].notify(b,a)}function h(a,b,c){a[b]&&a[b]._removeOwner(a);a[b]=c;a[b]&&a[b]._addOwner(a)}function g(a,b,c){var e=a[b];e&&Array.erase(e._parents,a);(a[b]=c)&&c._parents.push(a)}var f=d("./constants.js"),
k=d("./../processing/mapping.js");d("../../utils/array.js");var u=d("../base.js"),q=d("../processing/channel-node.js").ChannelNode,n=d("../utils/utils.js");d=function(){this._parents=[]};l=function(){this._parents=[];this._name="";this._key=0;this._paramName=this._data=null;this._paramGlobal=!1;this._dataListener=this.onDataChange.bind(this)};u.createClass(l,d);l.prototype.onDataChange=function(a,b){var e;switch(b){case f.DATA_ENTRY_STATE.CHANGED_VALUE:e=f.RESULT_STATE.CHANGED_DATA_VALUE;break;case f.DATA_ENTRY_STATE.LOAD_START:e=
f.RESULT_STATE.IMAGE_LOAD_START;break;case f.DATA_ENTRY_STATE.LOAD_END:e=f.RESULT_STATE.IMAGE_LOAD_END;break;case f.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:e=f.RESULT_STATE.CHANGED_STRUCTURE;break;case f.DATA_ENTRY_STATE.CHANGED_SIZE:e=f.RESULT_STATE.CHANGED_DATA_SIZE;break;default:e=f.RESULT_STATE.CHANGED_DATA_SIZE}c(this,e)};Object.defineProperty(l.prototype,"name",{set:function(a){this._name=a;c(this,f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()},get:function(){return this._name}});Object.defineProperty(l.prototype,
"key",{set:function(a){this._key=a;c(this,f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()},get:function(){return this._key}});Object.defineProperty(l.prototype,"paramName",{set:function(a){this._paramName=a;c(this,f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()},get:function(){return this._paramName}});Object.defineProperty(l.prototype,"paramGlobal",{set:function(a){this._paramGlobal=a;c(this,f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()},get:function(){return this._paramGlobal}});
Object.defineProperty(l.prototype,"data",{set:function(a){var b=!1;this._data&&(b=this._data._loading,this._data.removeListener(this._dataListener));(this._data=a)&&this._data.addListener(this._dataListener);b!=this._data._loading&&c(this,this._data._loading?f.RESULT_STATE.IMAGE_LOAD_START:f.RESULT_STATE.IMAGE_LOAD_END);u._flushResultCallbacks()},get:function(){return this._data}});l.prototype._getParamNames=function(){return this._paramGlobal?null:this._paramName};l.prototype._getGlobalParamNames=
function(){return this._paramGlobal?this._paramName:null};var p=0,r=function(a){this._parents=[];this._loading=!1;this._loadLevel=0;this._progressLevel=Infinity;this.id=++p;this._isProtoNode=a;this._children=[];this._userData=this._sourceNode=null;this._filterType=f.DATA_FILTER_TYPE.NONE;this._filterMapping=null;this._computeOperator="";this._computeUsesDataflow=!1;this._dataflowNode=this._computeOutputMapping=this._computeInputMapping=null;this._channelNode=new q(this);this._substitutionNodes={};
this._platform=this._globalParamNames=this._paramNames=null;this._listeners=[];this._loadListeners=[]};u.createClass(r,d);Object.defineProperty(r.prototype,"sourceNode",{set:function(b){g(this,"_sourceNode",b);a(this);this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()},get:function(){return this._sourceNode}});Object.defineProperty(r.prototype,"dataflowNode",{set:function(b){if(b&&!this._computeUsesDataflow)throw Error("Cannot set dataflowNode when compute doesn't use dataflow.");
g(this,"_dataflowNode",b);a(this);this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()},get:function(){return this._dataflowNode}});Object.defineProperty(r.prototype,"userData",{set:function(a){this._userData=a},get:function(){return this._userData}});r.prototype.setLoading=function(b){if(this._loading!=b){this._loading=b;this._channelNode.setStructureOutOfSync();this._channelNode.loading=b;for(var c in this._substitutionNodes){var e=this._substitutionNodes[c];e.setStructureOutOfSync();
e.loading=b}a(this);u._flushResultCallbacks()}};r.prototype.isSubtreeLoading=function(){return 0==this._progressLevel};r.prototype.getProgressLevel=function(){return this._progressLevel};Object.defineProperty(r.prototype,"filterType",{set:function(a){this._filterType=a;this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()},get:function(){return this._filterType}});Object.defineProperty(r.prototype,"filterMapping",{set:function(a){h(this,"_filterMapping",a);this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);
u._flushResultCallbacks()},get:function(){return this._filterMapping}});Object.defineProperty(r.prototype,"computeOperator",{set:function(a){this._computeOperator=a;this._computeUsesDataflow=!1;this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()},get:function(){return this._computeUsesDataflow?null:this._computeOperator}});Object.defineProperty(r.prototype,"computeDataflowUrl",{set:function(a){this._computeOperator=a;this._computeUsesDataflow=!0;this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);
u._flushResultCallbacks()},get:function(){return this._computeUsesDataflow?this._computeOperator:null}});Object.defineProperty(r.prototype,"computeInputMapping",{set:function(a){h(this,"_computeInputMapping",a);this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()},get:function(){return this._computeInputMapping}});Object.defineProperty(r.prototype,"computeOutputMapping",{set:function(a){h(this,"_computeOutputMapping",a);this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()},
get:function(){return this._computeOutputMapping}});r.prototype.isProtoNode=function(){return this._isProtoNode};r.prototype.appendChild=function(b){this._children.push(b);b._parents.push(this);a(this);this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()};r.prototype.removeChild=function(b){Array.erase(this._children,b);Array.erase(b._parents,this);a(this);this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()};r.prototype.insertBefore=function(b,c){var e=this._children.indexOf(c);
-1==e?this._children.push(b):this._children.splice(e,0,b);b._parents.push(this);a(this);this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()};r.prototype.clear=function(){for(var b=0;b<this._children.length;++b)Array.erase(this._children[b]._parents,this);this._children=[];this._dataflowNode&&this._dataflowNode.removeParent(this);this._dataflowNode=null;this._channelNode.decreaseRef();e(this);a(this);this.notify(f.RESULT_STATE.REMOVED);this._listeners=[];delete this._userData;delete this._dataflowNode;
u._flushResultCallbacks()};r.prototype.removeParent=function(b){Array.erase(this._parents,b);a(this);this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()};r.prototype.detachFromParents=function(){for(var a=0;a<this._parents.length;++a){var b=this._parents[a];b._sourceNode==this?b.sourceNode=null:b._dataflowNode==this?b.dataflowNode=null:b.removeChild(this)}this._children=[]};r.prototype.setPlatform=function(a){"string"===typeof a?"cl"===a?this._platform=f.PLATFORM.CL:"gl"===a?this._platform=
f.PLATFORM.GLSL:"js"===a&&(this._platform=f.PLATFORM.JAVASCRIPT):!isNaN(parseFloat(a))&&isFinite(a)?this._platform=a:this._platform=null;this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()};var t=/^([A-Za-z\s]*)\(([^()]+)\)$/;r.prototype.setFilter=function(a){a=a||"";var b=f.DATA_FILTER_TYPE.RENAME,c=null;if(a){var e=a.trim().match(t);if(e){a=e[1].trim();switch(a){case "keep":b=f.DATA_FILTER_TYPE.KEEP;break;case "remove":b=f.DATA_FILTER_TYPE.REMOVE;break;case "rename":b=f.DATA_FILTER_TYPE.RENAME;
break;default:u.notifyError("Unknown filter type:"+a,this)}c=k.Mapping.parse(e[2],this)}else u.notifyError("Could not parse filter '"+a+"'",this)}c||(c=new k.OrderMapping);h(this,"_filterMapping",c);this._filterType=b;this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()};var v=/^(([^=]+)\=)?([^'(]+('[^']+')?[^'(]+)(\(([^()]*)?\))?$/,x=/^\(([^()]*)\)$/,y=/^dataflow\['([^']+)'\]$/;r.prototype.setCompute=function(a){a=a||"";var b="",c=null,e=null,d=a.trim().match(v);if(d){a=d[2]?d[2].trim():
"";var b=d[3].trim(),g=d[6]?d[6].trim():"";if(d=a.match(x))a=d[1];g&&(c=k.Mapping.parse(g,this));a&&(e=k.Mapping.parse(a,this));(d=b.match(y))?(this._computeUsesDataflow=!0,b=d[1]):this._computeUsesDataflow=!1;this._dataflowNode=null}else a&&u.notifyError("Error parsing Compute value '"+a+"'",this);h(this,"_computeInputMapping",c);h(this,"_computeOutputMapping",e);this._computeOperator=b;this.notify(f.RESULT_STATE.CHANGED_STRUCTURE);u._flushResultCallbacks()};r.prototype.notify=function(b,d){switch(b){case f.RESULT_STATE.REMOVED:c(this,
f.RESULT_STATE.CHANGED_STRUCTURE);break;case f.RESULT_STATE.CHANGED_STRUCTURE:this._globalParamNames=this._paramNames=null;this._channelNode.setStructureOutOfSync();e(this);c(this,b);break;case f.RESULT_STATE.IMAGE_LOAD_START:case f.RESULT_STATE.IMAGE_LOAD_END:a(this);d&&this._channelNode.notifyDataChange(d,b);break;case f.RESULT_STATE.CHANGED_DATA_VALUE:case f.RESULT_STATE.CHANGED_DATA_SIZE:d&&this._channelNode.notifyDataChange(d,b)}for(var g=0;g<this._listeners.length;++g)this._listeners[g](b)};
r.prototype.addListener=function(a){this._listeners.push(a)};r.prototype.removeListener=function(a){Array.erase(this._listeners,a)};r.prototype.addLoadListener=function(a){this._loadListeners.push(a)};r.prototype.removeLoadListener=function(a){Array.erase(this._loadListeners,a)};r.prototype._callLoadListeners=function(a,b){for(var c=this._loadListeners.length,e=0;e<c;++e)this._loadListeners[e](this,a,b)};r.prototype.getOutputNames=function(){return b(this)._channelNode.getOutputNames()};r.prototype.getOutputChannelInfo=
function(a){return b(this)._channelNode.getOutputChannelInfo(a)};r.prototype.getParamNames=function(){return this._getParamNames()};r.prototype._getResult=function(a,c){return b(this,c)._channelNode.getResult(a,c)};r.prototype._getForwardNode=function(a){return b(this,a)};r.prototype._getParamNames=function(){if(!this._paramNames)if(this._paramNames=[],this._sourceNode)n.nameset.add(this._paramNames,this._sourceNode._getParamNames());else for(var a=0;a<this._children.length;++a)n.nameset.add(this._paramNames,
this._children[a]._getParamNames());return this._paramNames};r.prototype._getGlobalParamNames=function(){if(!this._globalParamNames)if(this._globalParamNames=[],this._dataflowNode&&n.nameset.add(this._globalParamNames,this._dataflowNode._getGlobalParamNames()),this._sourceNode)n.nameset.add(this._globalParamNames,this._sourceNode._getGlobalParamNames());else for(var a=0;a<this._children.length;++a)n.nameset.add(this._globalParamNames,this._children[a]._getGlobalParamNames());return this._globalParamNames};
r.prototype._getOrCreateChannelNode=function(a){if(a){var b=a.getKey(this);this._substitutionNodes[b]?this._substitutionNodes[b].increaseRef():this._substitutionNodes[b]=new q(this,a);return this._substitutionNodes[b]}return this._channelNode};r.prototype._removeSubstitutionNode=function(a){a=a.substitution.getKey(this);this._substitutionNodes[a]&&this._substitutionNodes[a].decreaseRef()&&delete this._substitutionNodes[a]};m.exports={InputNode:l,DataNode:r,getComputeDataflowUrl:function(a){return(a=
(a||"").trim().match(v))&&(a=a[3].trim().match(y))?a[1]:null}}},{"../../utils/array.js":180,"../base.js":188,"../processing/channel-node.js":232,"../utils/utils.js":240,"./../processing/mapping.js":236,"./constants.js":189}],192:[function(d,m,l){function e(a,b){a._result&&a._result._removeRequest(a);(a._result=b)&&b._addRequest(a);return b}function b(a,b,c){a=a._getForwardNode(c);c=a.id+"|"+b.getKey();var e;(e=u[c])?f[e.id]++:(e=new h(!1),e.appendChild(a),e.computeOperator=b.getOperator(),e.computeInputMapping=
null,e.computeOutputMapping=null,u[c]=e,f[e.id]=1,k[e.id]=c);return e}var a=d("../base.js"),c=d("./constants.js"),h=d("./graph.js").DataNode,g=function(a,b,c){this._dataNode=a;this._filter=b?b.slice().sort():null;this._listener=c;this._result=null;this._dataNodeListener=this._onDataNodeChange.bind(this);this._dataNode.addListener(this._dataNodeListener)};Object.defineProperty(g.prototype,"dataNode",{set:function(){throw Error("dataNode is readonly");},get:function(){return this._dataNode}});Object.defineProperty(g.prototype,
"filter",{set:function(){throw Error("filter is read-only");},get:function(){return this._filter}});g.prototype.clear=function(){this._listener=null;this._result&&this._result._removeRequest(this);this._dataNode.removeListener(this._dataNodeListener)};g.prototype._onPostponedResultChanged=function(a){this._listener&&this._listener(this,a)};g.prototype._onDataNodeChange=function(b){a._queueResultCallback(this,b)};d=function(a,b,c){g.call(this,a,b,c)};a.createClass(d,g);d.prototype.getResult=function(){return e(this,
this._dataNode._getResult(c.RESULT_TYPE.COMPUTE,this._filter))};d.prototype._onResultChanged=function(a){this._onDataNodeChange(a)};var f={},k={},u={};l=function(a,c,e){var d=c.getFilter();if(0==d.length)throw Error("vsConfig requires at least one attribute entry.");g.call(this,a,d,e);this._vsConfig=c;this._vsConnectNode=b(a,c)};a.createClass(l,g);l.prototype.getConfig=function(){return this._vsConfig};l.prototype.getResult=function(){return e(this,this._vsConnectNode._getResult(c.RESULT_TYPE.VS,
this._filter))};l.prototype._onDataNodeChange=function(a){if(a==c.RESULT_STATE.CHANGED_STRUCTURE){var e=b(this._dataNode,this._vsConfig,this._filter);if(e!=this._vsConnectNode){var d=this._vsConnectNode;f[d.id]--;f[d.id]||(u[k[d.id]]=null,d.clear());this._vsConnectNode=e}}g.prototype._onDataNodeChange.call(this,a)};l.prototype.getVertexShader=function(){this.getResult();this._vertexShader||(this._vertexShader=this._result.getVertexShader(this._vsConfig));return this._vertexShader};l.prototype._onResultChanged=
function(a){this._onDataNodeChange(a)};m.exports={ComputeRequest:d,VertexShaderRequest:l}},{"../base.js":188,"./constants.js":189,"./graph.js":191}],193:[function(d,m,l){function e(a,b,c,e,d,f){this.program=a;this.cl=a.cl;this.name=b;this.type=e||null;this.isInput=!!f;this.hasMemObject=this.needsMemObject=!1;this.clFunctionParam=this.arg=this.memObjectSize=this.byteSize=null;this.xflowType=c;this.helperMap=null;this.helpers=[];this.entryValue=d||null;this.val=null;this.prepareParam();this.initHelperParams();
this.initKernelArg();this.updateValue(this.entryValue)}function b(a,b,c,d,f,g){var h=f?f.getValue():null;f=b?c.kernelParamMap.inputs:c.kernelParamMap.outputs;f[g]?f[g].updateValue(h):(f[g]=new e(c,a.name,a.type,null,h,b),d.push(f[g].clFunctionParam),f[g].helpers.forEach(function(a){d.push(a.clFunctionParam)}))}function a(a){var b=a.cl,e=b.kernelManager,d=b.cmdQueue,f={inputs:[],outputs:[]},h=c(a.kernelParamMap,f),k=g(a.kernelParamMap.inputs[0]),l=a.kernelProgram;return function(){var a,b,c,g,n=f.inputs,
q=f.outputs;if(!l)return!1;g=h.map(function(a){return a.arg});e.setArgs.apply(null,[l].concat(g));try{b=n.length;for(a=0;a<b;a++)c=n[a],d.enqueueWriteBuffer(c.arg,!1,0,c.memObjectSize,c.val,[]);d.enqueueNDRangeKernel(l,k[1].length,[],k[1],k[0]);b=q.length;for(a=0;a<b;a++)c=q[a],d.enqueueReadBuffer(c.arg,!1,0,c.memObjectSize,c.val,[]);d.finish()}catch(u){return!1}return!0}}function c(a,b){var c=a.inputs,e=[];a.outputs.forEach(function(a){h(a,e,b.outputs)});c.forEach(function(a){h(a,e,b.inputs)});return e}
function h(a,b,c){b.push(a);a.hasMemObject&&(c.push(a),a.helpers.forEach(function(a){b.push(a)}))}function g(a){var b;b=a.entryValue;if(a.xflowType===f.DATA_TYPE.TEXTURE)a=[16,4],b=[Math.ceil(b.width/a[0])*a[0],Math.ceil(b.height/a[1])*a[1]];else{var c=1;switch(a.xflowType){case f.DATA_TYPE.INT4:case f.DATA_TYPE.FLOAT4:c=4;break;case f.DATA_TYPE.FLOAT3:c=3;break;case f.DATA_TYPE.FLOAT4X4:c=16}a=[16];b=[Math.ceil(b.length/(a[0]*c))*a[0]]}return[a,b]}var f=d("../interface/constants.js");d=function(a){if(this.cl=
XML3D.webcl.cl)this.list=a,this.entry=a.entries[0],this.operator=this.entry.operator,this.kernelParamMap={inputs:[],outputs:[]},this.kernelFunctionParams=[],this.mainProgram=this.kernelProgram=this.kernelCode=null};var k={type:"uint",params:["width","height"]},u={type:"uint",params:["length"]};e.prototype={prepareParam:function(){var a,b=f.DATA_TYPE,c=[],e="",d="";if(!this.type){switch(this.xflowType){case b.TEXTURE:a=k;this.type="uchar4*";e="__global";this.needsMemObject=!0;break;case b.INT:this.type=
"int";break;case b.INT4:a=u;this.type="int4*";e="__global";this.needsMemObject=!0;break;case b.FLOAT:this.type="float";break;case b.FLOAT2:a=u;this.type="float2*";e="__global";this.needsMemObject=!0;break;case b.FLOAT3:a=u;this.type="float*";e="__global";this.needsMemObject=!0;break;case b.FLOAT4:a=u;this.type="float4*";e="__global";this.needsMemObject=!0;break;case b.FLOAT4X4:a=u;this.type="float16*";e="__global";this.needsMemObject=!0;break;default:return}this.helperMap=a}e&&c.push(e);this.isInput&&
(d="const");d&&c.push(d);c.push(this.type);c.push(this.name);this.clFunctionParam=c.join(" ")},initHelperParams:function(){var a,b=this,c=this.helperMap;c&&this.isInput&&c.params.forEach(function(d){var g=b.name+"_"+d;if("width"===d)a=b.entryValue.width;else if("height"===d)a=b.entryValue.height;else if("length"===d)switch(a=b.entryValue.length,b.xflowType){case f.DATA_TYPE.FLOAT2:a/=2;break;case f.DATA_TYPE.FLOAT3:a/=3;break;case f.DATA_TYPE.FLOAT4:case f.DATA_TYPE.INT4:a/=4;break;case f.DATA_TYPE.FLOAT4X4:a/=
16}b.helpers.push(new e(b.program,g,null,c.type,new Uint32Array([a])))})},initKernelArg:function(){this.needsMemObject?this.allocateMemObject():this.arg=this.entryValue},allocateMemObject:function(){var a=this.cl.API,b=this.cl.ctx,c=this.type,e=parseInt(c.substring(c.length-2,c.length-1),10),c=this.isInput?"r":"w",d=this.entryValue;this.hasMemObject&&this.arg.release();this.byteSize=isNaN(e)?1:e;if(this.xflowType===f.DATA_TYPE.TEXTURE)e*=d.width*d.height,this.byteSize=4;else switch(this.xflowType){case f.DATA_TYPE.INT4:e=
d.length*Int32Array.BYTES_PER_ELEMENT;break;case f.DATA_TYPE.FLOAT2:case f.DATA_TYPE.FLOAT3:case f.DATA_TYPE.FLOAT4:case f.DATA_TYPE.FLOAT4x4:e=d.length*Float32Array.BYTES_PER_ELEMENT;break;default:e=4*d.length}a=a.createBuffer(e,c,b);this.memObjectSize=e;this.arg=a;this.hasMemObject=!0;this.needsMemObject=!1},updateValue:function(a){this.hasMemObject?(this.val=void 0===a.data?a:a.data,this.entryValue=a,this.checkEntrySize()):this.arg=this.entryValue=a},updateHelpers:function(){var a=this;this.helpers.forEach(function(b){var c=
b.name;-1!==c.indexOf("width")?b.updateValue(new Uint32Array([a.entryValue.width])):-1!==c.indexOf("height")?b.updateValue(new Uint32Array([a.entryValue.height])):-1!==c.indexOf("length")&&(c=a.entryValue.length,a.xflowType===f.DATA_TYPE.FLOAT4||a.xflowType===f.DATA_TYPE.INT4?c/=4:a.xflowType===f.DATA_TYPE.FLOAT4X4&&(c/=16),b.updateValue(new Uint32Array([c])))})},checkEntrySize:function(){var a=this.entryValue;this.memObjectSize!==(this.xflowType===f.DATA_TYPE.TEXTURE?a.width*a.height*this.byteSize:
this.xflowType===f.DATA_TYPE.FLOAT2||this.xflowType===f.DATA_TYPE.FLOAT3||this.xflowType===f.DATA_TYPE.FLOAT4||this.xflowType===f.DATA_TYPE.FLOAT4X4?a.length*Float32Array.BYTES_PER_ELEMENT:this.xflowType===f.DATA_TYPE.INT4?a.length*Int32Array.BYTES_PER_ELEMENT:a.length*this.byteSize)&&(this.allocateMemObject(),this.updateHelpers(),this.program.mainProgram=null)}};d.prototype.run=function(c){var e=this.list,d,f,g=c.operatorData[0],h=e.entries[0],k=h.operator.mapping;g.iterFlag={};for(f=0;f<k.length;++f)d=
h.isTransferInput(f)||e.isInputIterate(h.getDirectInputIndex(f)),g.iterFlag[f]=d;g.iterateCount=e.getIterateCount(c);if(this.operator.evaluate&&this.operator.evaluate instanceof Array){e=this.entry;d=this.kernelFunctionParams;k=this.operator.outputs;for(h=d.length=0;h<k.length;++h)f=k[h],g=c.outputs[e.getOutputIndex(h)].dataEntry,b(f,!!f.source,this,d,g,h);k=e.operator.mapping;for(h=0;h<k.length;++h)f=k[h],g=c.getDataEntry(e.getDirectInputIndex(h)),b(f,!!f.source,this,d,g,h);if(null===this.kernelCode)a:if(c=
this.cl.kernelManager,d=this.operator.evaluate,e=this.kernelName=this.operator.name.split("xflow.")[1],d){f=[];f.push("__kernel void");f.push(e+"(");f.push(this.kernelFunctionParams.join(", "));f.push(")");(f=f.join(" "))?(f+="{\n",g=[],h=this.kernelParamMap.inputs[0],"uchar4*"===h.type?(g.push("int x = get_global_id(0);"),g.push("int y = get_global_id(1);"),g.push("if (x >= "+h.name+"_width || y >= "+h.name+"_height) return;"),g.push("int "+h.name+"_i = y * "+h.name+"_width + x;")):(g.push("int "+
h.name+"_i = get_global_id(0);"),g.push("if ("+h.name+"_i >= "+h.name+"_length) return;")),(g=g.join("\n"))?(f=f+g+d.join("\n"),d=f+="\n}"):d=!1):d=!1;d=this.kernelCode=d;try{c.register(e,d)}catch(l){break a}this.kernelProgram=c.getKernel(this.kernelName)}null===this.mainProgram&&(this.mainProgram=a(this));this.mainProgram()}};m.exports=d},{"../interface/constants.js":189}],194:[function(d,m,l){Xflow.registerOperator("xflow.add",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value1"},
{type:"float3",source:"value2"}],evaluate:function(e,b,a,c){throw Error("Not used!");},evaluate_core:function(e,b,a){e[0]=b[0]+a[0];e[1]=b[1]+a[1];e[2]=b[2]+a[2]}})},{}],195:[function(d,m,l){Xflow.registerOperator("xflow.bufferSelect",{outputs:[{type:"float3",name:"result",noAlloc:!0}],params:[{type:"float3",source:"trueOption",array:!0},{type:"float3",source:"falseOption",array:!0},{type:"bool",source:"value",array:!0}],evaluate:function(e,b,a,c){e.assign=c[0]?a:b;return!0}})},{}],196:[function(d,
m,l){Xflow.registerOperator("xflow.clampImage",{outputs:[{type:"texture",name:"result",sizeof:"image",formatType:"ImageData"}],params:[{type:"texture",source:"image"},{type:"float",source:"min"},{type:"float",source:"max"}],evaluate:function(e,b,a,c){var d=b.data;e=e.data;a=a[0];c=c[0];b=b.data.length;for(var g=0;g<b;g++){var f=d[g];f<a&&(f=a);f>c&&(f=c);e[g]=f}return!0}})},{}],197:[function(d,m,l){(function(){function e(b,a,c,e){var d=Math.round(Math.sqrt(c.length)),f=Math.floor(d/2),k=b.data,l=
b.width;b=b.height;var q=a.data;e=e?1:0;for(var n=0;n<b;n++)for(var p=0;p<l;p++){for(var r=n,t=p,m=4*(n*l+p),x=0,y=0,w=0,z=0,F=0;F<d;F++)for(var D=0;D<d;D++){var B=r+F-f,A=t+D-f;0<=B&&B<b&&0<=A&&A<l&&(B=4*(B*l+A),A=c[F*d+D],x+=k[B]*A,y+=k[B+1]*A,w+=k[B+2]*A,z+=k[B+3]*A)}q[m]=x;q[m+1]=y;q[m+2]=w;q[m+3]=z+e*(255-z)}return a}Xflow.registerOperator("xflow.convoluteImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",source:"kernel"}],evaluate:function(b,
a,c){e(a,b,c,!0);return!0}});Xflow.registerOperator("xflow.convoluteImageToFloat",{outputs:[{type:"texture",name:"result",sizeof:"image",formatType:"float32"}],params:[{type:"texture",source:"image"},{type:"float",source:"kernel"}],evaluate:function(b,a,c){e(a,b,c,!0);return!0}})})()},{}],198:[function(d,m,l){Xflow.registerOperator("xflow.createIGIndex",{outputs:[{type:"float2",name:"texcoord",customAlloc:!0}],params:[{type:"int",source:"vertexCount",optional:!1},{type:"texture",source:"positionTex",
optional:!1}],alloc:function(e,b,a){e.texcoord=a.width*a.height},evaluate:function(e,b,a,c){b=.5/a.width;c=.5/a.height;for(var d=0,g=0,f=a.height;g<f;g++)for(var k=0,l=a.width;k<l;k++)e[d++]=k/l+b,e[d++]=1-(g/f+c);return!0}})},{}],199:[function(d,m,l){(function(){var e=XML3D.math.mat4.create(),b=XML3D.math.vec3.create(),a=XML3D.math.quat.create(),c=XML3D.math.mat4,d=XML3D.math.quat;Xflow.registerOperator("xflow.createTransform",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float3",source:"translation",
optional:!0},{type:"float4",source:"rotation",optional:!0},{type:"float3",source:"scale",optional:!0},{type:"float3",source:"center",optional:!0},{type:"float4",source:"scaleOrientation",optional:!0}],evaluate:function(g,f,k,l,q,n,p){for(var r=0;r<p.iterateCount;r++){var t=g.subarray(16*r);c.identity(t);f&&c.translate(t,t,p.iterFlag[0]?f.subarray(3*r):f);q&&c.translate(t,t,p.iterFlag[3]?q.subarray(3*r):q);k&&(c.fromQuat(e,p.iterFlag[1]?k.subarray(4*r):k),c.multiply(t,t,e));l&&(n&&(d.copy(a,p.iterFlag[4]?
n.subarray(4*r):n),c.fromQuat(e,a),c.multiply(t,t,e)),c.scale(t,t,p.iterFlag[2]?l.subarray(3*r):l),n&&(d.invert(a,a),c.fromQuat(e,a),c.multiply(t,t,e)));q&&c.translate(t,t,XML3D.math.vec3.negate(b,p.iterFlag[3]?q.subarray(3*r):q))}return!0}})})()},{}],200:[function(d,m,l){(function(){var e=XML3D.math.mat4.create(),b=XML3D.math.vec3.create(),a=XML3D.math.quat.create(),c=XML3D.math.mat4;Xflow.registerOperator("xflow.createTransformInv",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float3",
source:"translation",optional:!0},{type:"float4",source:"rotation",optional:!0},{type:"float3",source:"scale",optional:!0},{type:"float3",source:"center",optional:!0},{type:"float4",source:"scaleOrientation",optional:!0}],evaluate:function(d,g,f,k,l,q,n){for(var p=0;p<n.iterateCount;p++){var r=d.subarray(16*p);c.identity(r);l&&c.translate(r,r,n.iterFlag[3]?l.subarray(3*p):l);q&&(c.fromRotationTranslation(e,n.iterFlag[4]?q.subarray(4*p):q,[0,0,0]),c.multiply(r,r,e));k&&c.scale(r,r,XML3D.math.vec3.reciprocal(b,
n.iterFlag[2]?k.subarray(3*p):k));q&&(XML3D.math.quat.copy(a,n.iterFlag[4]?q.subarray(4*p):q),c.fromRotationTranslation(e,XML3D.math.quat.invert(a,a),[0,0,0]),c.multiply(r,r,e));f&&(XML3D.math.quat.copy(a,n.iterFlag[1]?f.subarray(4*p):f),c.fromRotationTranslation(e,XML3D.math.quat.invert(a,a),[0,0,0]),c.multiply(r,r,e));l&&c.translate(r,r,XML3D.math.vec3.negate(b,n.iterFlag[3]?l.subarray(3*p):l));g&&c.translate(r,r,XML3D.math.vec3.negate(b,n.iterFlag[0]?g.subarray(3*p):g))}}})})()},{}],201:[function(d,
m,l){(function(){var e=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[-1,-1,-1],[1,-1,-1],[-1,-1,1],[1,-1,1],[1,-1,-1],[1,1,-1],[1,-1,1],[1,1,1],[-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],b=[[0,0,-1],[0,0,-1],[0,0,-1],[0,0,-1],[-1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0],[1,0,0],[1,0,0],[1,0,0],[1,0,0],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],a=[[0,1,2,1,2,3],[4,5,6,5,6,7],[8,9,10,9,
10,11],[12,13,14,13,14,15],[16,17,18,17,18,19],[20,21,22,21,22,23]];Xflow.registerOperator("xflow.debug.createSkinCubes",{outputs:[{type:"int",name:"index",customAlloc:!0},{type:"float3",name:"position",customAlloc:!0},{type:"float3",name:"normal",customAlloc:!0},{type:"int4",name:"boneIndices",customAlloc:!0},{type:"float4",name:"boneWeights",customAlloc:!0}],params:[{type:"float4x4",source:"bindTransforms",array:!0},{type:"float",source:"size",array:!0,optional:!0}],alloc:function(a,b){var e=b.length/
16;a.position=24*e;a.normal=24*e;a.boneIndices=24*e;a.boneWeights=24*e;a.index=36*e},evaluate:function(c,d,g,f,k,l,q){var n=l.length/16;q=(q&&q[0]||1)/2;for(var p=XML3D.math.vec3.create(),r=XML3D.math.vec3.create(),t=0;t<n;++t)for(var m=0;6>m;++m){for(var x=0;4>x;x++){var y=4*m+x,w=24*t+y;XML3D.math.vec3.copy(p,e[y]);XML3D.math.vec3.scale(p,p,q);XML3D.math.mat4.multiplyOffsetVec3(l,16*t,p,0);XML3D.math.vec3.copy(r,b[y]);XML3D.math.mat4.multiplyOffsetDirection(l,16*t,r,0);d[3*w+0]=p[0];d[3*w+1]=p[1];
d[3*w+2]=p[2];g[3*w+0]=r[0];g[3*w+1]=r[1];g[3*w+2]=r[2];f[4*w+0]=t;f[4*w+1]=f[4*w+2]=f[4*w+3]=0;k[4*w+0]=1;k[4*w+1]=k[4*w+2]=k[4*w+3]=0}y=36*t+6*m;for(x=0;6>x;++x)c[y+x]=24*t+a[m][x]}}})})()},{}],202:[function(d,m,l){Xflow.registerOperator("xflow.div",{outputs:[{type:"float",name:"result"}],params:[{type:"float",source:"value1"},{type:"float",source:"value2"}],evaluate:function(e,b,a,c){e[0]=b[0]/a[0]}})},{}],203:[function(d,m,l){Xflow.registerOperator("xflow.flipNormal",{outputs:[{type:"float3",
name:"result"}],params:[{type:"float3",source:"value"}],evaluate:function(e,b,a){for(var c=0;c<3*a.iterateCount;c++)e[c]=-b[c]}})},{}],204:[function(d,m,l){Xflow.registerOperator("xflow.flipVerticalImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(e,b){for(var a=b.width,c=b.height,d=e.data,g=b.data,f=0;f<c;++f)for(var k=0;k<a;++k){var l=f*a,q=4*(l+k),l=4*(l+(a-1-k));d[l]=g[q];d[l+1]=g[q+1];d[l+2]=g[q+2];d[l+3]=g[q+3]}return!0}})},
{}],205:[function(d,m,l){Xflow.registerOperator("xflow.forwardKinematics",{outputs:[{type:"float4x4",name:"result",customAlloc:!0}],params:[{type:"int",source:"parent",array:!0},{type:"float4x4",source:"xform",array:!0}],alloc:function(e,b,a){b=Math.min(b.length,a.length/16);e.result=b},evaluate:function(e,b,a,c){c=e.length/16;for(var d=[],g=0;g<c;){if(!d[g]){var f=b[g];if(0<=f)if(d[f])XML3D.math.mat4.multiplyOffset(e,16*g,a,16*g,e,16*f);else{for(;0<=b[f]&&!d[b[f]];)f=b[f];if(0<=b[f])XML3D.math.mat4.multiplyOffset(e,
16*f,a,16*f,e,16*b[f]);else for(var k=0;16>k;k++)e[16*f+k]=a[16*f+k];d[f]=!0;continue}else for(k=0;16>k;k++)e[16*g+k]=a[16*g+k];d[g]=!0}g++}}})},{}],206:[function(d,m,l){Xflow.registerOperator("xflow.forwardKinematicsInv",{outputs:[{type:"float4x4",name:"result",customAlloc:!0}],params:[{type:"int",source:"parent",array:!0},{type:"float4x4",source:"xform",array:!0}],alloc:function(e,b,a){b=Math.min(b.length,a.length/16);e.result=b},evaluate:function(e,b,a,c){c=a.length/16;for(var d=[],g=0;g<c;){if(!d[g]){var f=
b[g];if(0<=f)if(d[f])XML3D.math.mat4.multiplyOffset(e,16*g,e,16*f,a,16*g);else{for(;0<=b[f]&&!d[b[f]];)f=b[f];if(0<=b[f])XML3D.math.mat4.multiplyOffset(e,16*f,e,16*b[f],a,16*f);else for(var k=0;16>k;k++)e[16*f+k]=a[16*f+k];d[f]=!0;continue}else for(k=0;16>k;k++)e[16*g+k]=a[16*g+k];d[g]=!0}g++}}})},{}],207:[function(d,m,l){Xflow.registerOperator("xflow.funMirrorImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",source:"time"}],evaluate:function(e,
b,a){var c=e.width,d=e.height;a=a[0];b=b.data;e=e.data;for(var g=0;g<d;++g)for(var f=0;f<c;++f){var k=f/c,l=g/d,k=2*k-1,q=2*l-1,l=Math.sqrt(k*k+q*q),q=Math.atan2(q,k),l=Math.pow(l,1/1.8)*a,k=l*Math.cos(q),q=l*Math.sin(q),k=k/2+.5,l=q/2+.5,k=Math.round(k*c),k=4*(Math.round(l*d)*c+k),l=b[k],q=b[k+1],n=b[k+2],p=b[k+3],k=4*(g*c+f);e[k]=l;e[k+1]=q;e[k+2]=n;e[k+3]=p}return!0}})},{}],208:[function(d,m,l){function e(b,a,c,e){for(var d=0;d<c.length;++d)for(var f=c[d]*e,k=e;k--;)b[d*e+k]=a[f+k]}Xflow.registerOperator("xflow.get",
{outputs:[{type:"float",name:"result"}],params:[{type:"float",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,d){e(b,a,c,1)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"float2",name:"result"}],params:[{type:"float2",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,d){e(b,a,c,2)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value",array:!0},{type:"int",source:"index"}],
evaluate:function(b,a,c,d){e(b,a,c,4)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"float4",name:"result"}],params:[{type:"float4",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,d){e(b,a,c,4)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float4x4",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,d){e(b,a,c,16)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"int",name:"result"}],
params:[{type:"int",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,d){e(b,a,c,1)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"bool",name:"result"}],params:[{type:"bool",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,d){e(b,a,c,1)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"byte",name:"result"}],params:[{type:"byte",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,d){e(b,a,c,1)}});Xflow.registerOperator("xflow.get",
{outputs:[{type:"ubyte",name:"result"}],params:[{type:"ubyte",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,d){e(b,a,c,1)}})},{}],209:[function(d,m,l){Xflow.registerOperator("xflow.grayscaleImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(e,b){for(var a=b.data,c=e.data,d=0;d<a.length;d+=4){var g=a[d+3];c[d]=c[d+1]=c[d+2]=.2126*a[d]+.7152*a[d+1]+.0722*a[d+2];c[d+3]=g}return!0}})},{}],210:[function(d,
m,l){d("./add.js");d("./bufferSelect.js");d("./clampImage.js");d("./convoluteImage.js");d("./createIGIndex.js");d("./createTransform.js");d("./createTransformInv.js");d("./debug.js");d("./flipNormal.js");d("./flipVerticalImage.js");d("./forwardKinematics.js");d("./forwardKinematicsInv.js");d("./funMirrorImage.js");d("./get.js");d("./grayscaleImage.js");d("./lerp3seq.js");d("./magnitudeImage.js");d("./morph3.js");d("./mul4x4.js");d("./noiseImage.js");d("./normalize3.js");d("./popartImage.js");d("./rgbePNGtoFloat.js");
d("./selectBool.js");d("./selectTransform.js");d("./sepiaImage.js");d("./skinDirection.js");d("./skinPosition.js");d("./slerpseq.js");d("./sobelImage.js");d("./sub3.js");d("./div.js")},{"./add.js":194,"./bufferSelect.js":195,"./clampImage.js":196,"./convoluteImage.js":197,"./createIGIndex.js":198,"./createTransform.js":199,"./createTransformInv.js":200,"./debug.js":201,"./div.js":202,"./flipNormal.js":203,"./flipVerticalImage.js":204,"./forwardKinematics.js":205,"./forwardKinematicsInv.js":206,"./funMirrorImage.js":207,
"./get.js":208,"./grayscaleImage.js":209,"./lerp3seq.js":211,"./magnitudeImage.js":212,"./morph3.js":213,"./mul4x4.js":214,"./noiseImage.js":215,"./normalize3.js":216,"./popartImage.js":217,"./rgbePNGtoFloat.js":218,"./selectBool.js":219,"./selectTransform.js":220,"./sepiaImage.js":221,"./skinDirection.js":222,"./skinPosition.js":223,"./slerpseq.js":224,"./sobelImage.js":225,"./sub3.js":226}],211:[function(d,m,l){var e=d("../../utils/utils").binarySearch;d=d("../../interface/constants.js");Xflow.registerOperator("xflow.lerpSeq",
{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:d.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:d.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:d.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate_core:function(b,a,c,e){var d=1-e[0];b[0]=d*a[0]+e[0]*c[0];b[1]=d*a[1]+e[0]*c[1];b[2]=d*a[2]+e[0]*c[2]}});Xflow.registerOperator("xflow.lerpSeqAsync",
{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:d.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:d.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:d.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate_async:function(b,a,c,e,d,f){for(var k=d.iterateCount,l,q,n;k--;){l=3*(d.iterFlag[0]?k:0);q=3*(d.iterFlag[1]?k:0);n=d.iterFlag[2]?
k:0;var p=1-e[n];b[3*k]=p*a[l]+e[n]*c[q];b[3*k+1]=p*a[l+1]+e[n]*c[q+1];b[3*k+2]=p*a[l+2]+e[n]*c[q+2]}window.setTimeout(f,200)}});Xflow.registerOperator("xflow.lerpKeys",{outputs:[{type:"float3",name:"result"}],params:[{type:"float",source:"keys",array:!0},{type:"float3",source:"values",array:!0},{type:"float",source:"key"}],alloc:function(b,a,c,e){b.result=3},evaluate:function(b,a,c,d){var g=Math.min(a.length,Math.floor(c.length/3)),f=e(a,d[0],g);0>f||f==g-1?(f=Math.max(0,f),b[0]=c[3*f],b[1]=c[3*
f+1],b[2]=c[3*f+2]):(a=(d[0]-a[f])/(a[f+1]-a[f]),d=1-a,b[0]=d*c[3*f]+a*c[3*f+3],b[1]=d*c[3*f+1]+a*c[3*f+4],b[2]=d*c[3*f+2]+a*c[3*f+5])}})},{"../../interface/constants.js":189,"../../utils/utils":240}],212:[function(d,m,l){Xflow.registerOperator("xflow.magnitudeImage",{outputs:[{type:"texture",name:"result",sizeof:"image1"}],params:[{type:"texture",source:"image1"},{type:"texture",source:"image2"}],evaluate:function(e,b,a){b=b.data;a=a.data;e=e.data;for(var c=b.length,d=0;d<c;d+=1){var g=b[d],f=a[d];
e[d]=Math.sqrt(g*g+f*f)}return!0}})},{}],213:[function(d,m,l){Xflow.registerOperator("xflow.morph",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value"},{type:"float3",source:"valueAdd"},{type:"float",source:"weight"}],evaluate:function(e,b,a,c,d){for(var g=0;g<d.iterateCount;g++){var f=c[d.iterFlag[2]?g:0];e[3*g]=b[d.iterFlag[0]?3*g:0]+f*a[d.iterFlag[1]?3*g:0];e[3*g+1]=b[d.iterFlag[0]?3*g+1:1]+f*a[d.iterFlag[1]?3*g+1:1];e[3*g+2]=b[d.iterFlag[0]?3*g+2:2]+f*a[d.iterFlag[1]?
3*g+2:2]}return!0},evaluate_core:function(e,b,a,c){e[0]=b[0]+c[0]*a[0];e[1]=b[1]+c[0]*a[1];e[2]=b[2]+c[0]*a[2]}})},{}],214:[function(d,m,l){Xflow.registerOperator("xflow.mul",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float4x4",source:"value1"},{type:"float4x4",source:"value2"}],evaluate:function(e,b,a,c){for(var d=0;d<c.iterateCount;d++)XML3D.math.mat4.multiplyOffset(e,16*d,b,c.iterFlag[0]?16*d:0,a,c.iterFlag[1]?16*d:0)}})},{}],215:[function(d,m,l){Xflow.registerOperator("xflow.noiseImage",
{outputs:[{type:"texture",name:"image",customAlloc:!0}],params:[{type:"int",source:"width"},{type:"int",source:"height"},{type:"float2",source:"scale"},{type:"float",source:"minFreq"},{type:"float",source:"maxFreq"}],alloc:function(e,b,a,c,d,g){c=new Xflow.SamplerConfig;c.setDefaults();e.image={imageFormat:{width:b[0],height:a[0]},samplerConfig:c}},evaluate:function(e,b,a,c,d,g){b=b[0];a=a[0];d=d[0];g=g[0];e=e.data;for(var f=this.noise=this.noise||new SimplexNoise,k=0!=d&&0!=g&&d<g,l=0;l<a;++l)for(var q=
l/a*c[1],n=1/b,p=0;p<b;++p){var r=p*n*c[0],t;if(k){t=g;for(var m=q,x=0,y=d;y<t;y*=2)x+=Math.abs(f.noise(r*y,m*y))/y;t=x}else t=f.noise(r,q);r=4*(p*b+l);e[r]=Math.floor(255*t);e[r+1]=Math.floor(255*t);e[r+2]=Math.floor(255*t);e[r+3]=255}return!0}})},{}],216:[function(d,m,l){Xflow.registerOperator("xflow.normalize",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value"}],evaluate:function(e,b,a){for(var c=0;c<a.iterateCount;c++){var d=3*c,g=b[d],f=b[d+1],k=b[d+2],l=1/Math.sqrt(g*
g+f*f+k*k);e[d]=g*l;e[d+1]=f*l;e[d+2]=k*l}}})},{}],217:[function(d,m,l){Xflow.registerOperator("xflow.popartImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",source:"time"}],evaluate:function(e,b,a){b=b.data;e=e.data;for(a=0;a<b.length;a+=4){var c=b[a]/255*.3+b[a+1]/255*.59+b[a+2]/255*.11,c=.3>c?0:.6>c?.5:1;.5==c?(e[a]=204,e[a+1]=0):1==c?(e[a]=229.5,e[a+1]=229.5):(e[a]=0,e[a+1]=0);e[a+2]=0;e[a+3]=b[a+3]}return!0}})},{}],218:[function(d,
m,l){var e=d("../../interface/data.js").SamplerConfig,b=d("../../interface/constants.js");Xflow.registerOperator("xflow.rgbePNGtoFloat",{outputs:[{type:"texture",name:"result",customAlloc:!0}],params:[{type:"texture",source:"image"}],alloc:function(a,c){var d=new e;d.setDefaults();d.minFilter=b.TEX_FILTER_TYPE.NEAREST;d.magFilter=b.TEX_FILTER_TYPE.NEAREST;a.result={imageFormat:{width:c.width,height:c.height,texelType:b.TEXTURE_TYPE.FLOAT,texelFormat:b.TEXTURE_FORMAT.RGB},samplerConfig:d}},evaluate:function(a,
b){for(var e=0;e<b.data.length;e+=4){var d=b.data.subarray(e,e+4),f=0,k=d[3];0<k&&(f=Math.pow(2,k-136));k=new Float32Array(3);k[0]=d[0]*f;k[1]=d[1]*f;k[2]=d[2]*f;a.data.set(k,e/4*3)}return!0}})},{"../../interface/constants.js":189,"../../interface/data.js":190}],219:[function(d,m,l){Xflow.registerOperator("xflow.selectBool",{outputs:[{type:"bool",name:"result",customAlloc:!0}],params:[{type:"int",source:"index"},{type:"bool",source:"value"}],alloc:function(e,b,a){e.result=1},evaluate:function(e,b,
a){b=b[0];e[0]=b<a.length?a[b]:!1}})},{}],220:[function(d,m,l){Xflow.registerOperator("xflow.selectTransform",{outputs:[{type:"float4x4",name:"result",customAlloc:!0}],params:[{type:"int",source:"index"},{type:"float4x4",source:"transform"}],alloc:function(e,b,a){e.result=1},evaluate:function(e,b,a){b=16*b[0];b<a.length&&b+15<a.length?(e[0]=a[b+0],e[1]=a[b+1],e[2]=a[b+2],e[3]=a[b+3],e[4]=a[b+4],e[5]=a[b+5],e[6]=a[b+6],e[7]=a[b+7],e[8]=a[b+8],e[9]=a[b+9],e[10]=a[b+10],e[11]=a[b+11],e[12]=a[b+12],e[13]=
a[b+13],e[14]=a[b+14],e[15]=a[b+15]):(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1)}})},{}],221:[function(d,m,l){Xflow.registerOperator("xflow.sepiaImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(e,b){for(var a=b.data,c=e.data,d=0,g=0,f=0,k=0;k<a.length;k+=4)d=.393*a[k]+.769*a[k+1]+.189*a[k+2],g=.349*a[k]+.686*a[k+1]+.168*a[k+2],f=.272*a[k]+.534*a[k+1]+
.131*a[k+2],255<d&&(d=255),255<g&&(g=255),255<f&&(f=255),0>d&&(d=0),0>g&&(g=0),0>f&&(f=0),c[k]=d,c[k+1]=g,c[k+2]=f,c[k+3]=255;return!0}})},{}],222:[function(d,m,l){Xflow.registerOperator("xflow.skinDirection",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"dir"},{type:"int4",source:"boneIdx"},{type:"float4",source:"boneWeight"},{type:"float4x4",source:"boneXform",array:!0}],evaluate:function(e,b,a,c,d,g){for(var f=XML3D.math.vec3,k=XML3D.math.mat4,l=f.create(),q=f.create(),
n=0;n<g.iterateCount;++n){for(var p=3*n,r=l[0]=l[1]=l[2]=0;4>r;r++){var t=c[g.iterFlag[2]?4*n+r:r];t&&(k.multiplyOffsetDirection(d,16*a[g.iterFlag[1]?4*n+r:r],b,p,q),f.scale(q,q,t),f.add(l,l,q))}f.normalize(l,l);e[p]=l[0];e[p+1]=l[1];e[p+2]=l[2]}}})},{}],223:[function(d,m,l){Xflow.registerOperator("xflow.skinPosition",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"pos"},{type:"int4",source:"boneIdx"},{type:"float4",source:"boneWeight"},{type:"float4x4",source:"boneXform",
array:!0}],evaluate:function(e,b,a,c,d,g){for(var f=XML3D.math.vec3,k=XML3D.math.mat4,l=f.create(),q=f.create(),n=0;n<g.iterateCount;++n){for(var p=3*n,r=l[0]=l[1]=l[2]=0;4>r;r++){var t=c[g.iterFlag[2]?4*n+r:r];t&&(k.multiplyOffsetVec3(d,16*a[g.iterFlag[1]?4*n+r:r],b,p,q),f.scale(q,q,t),f.add(l,l,q))}e[p]=l[0];e[p+1]=l[1];e[p+2]=l[2]}}})},{}],224:[function(d,m,l){var e=d("../../utils/utils").binarySearch;d=d("../../interface/constants.js");Xflow.registerOperator("xflow.slerpSeq",{outputs:[{type:"float4",
name:"result"}],params:[{type:"float4",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:d.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:d.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:d.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate:function(b,a,c,e,d){for(var f=0;f<d.iterateCount;++f)XML3D.math.quat.slerpOffset(a,d.iterFlag[0]?4*f:0,c,d.iterFlag[1]?4*f:0,e[0],b,4*f,!0)}});Xflow.registerOperator("xflow.slerpKeys",
{outputs:[{type:"float4",name:"result"}],params:[{type:"float",source:"keys",array:!0},{type:"float4",source:"values",array:!0},{type:"float",source:"key"}],alloc:function(b,a,c,e){b.result=4},evaluate:function(b,a,c,d){var g=Math.min(a.length,Math.floor(c.length/4)),f=e(a,d[0],g);0>f||f==g-1?(f=Math.max(0,f),b[0]=c[4*f],b[1]=c[4*f+1],b[2]=c[4*f+2],b[3]=c[4*f+3]):XML3D.math.quat.slerpOffset(c,4*f,c,4*(f+1),(d[0]-a[f])/(a[f+1]-a[f]),b,0,!0)}})},{"../../interface/constants.js":189,"../../utils/utils":240}],
225:[function(d,m,l){function e(a,b,e,d){var k=new Float32Array(4);switch(arguments.length){case 0:k[0]=0;k[1]=0;k[2]=0;k[3]=0;break;case 1:k[0]=a;k[1]=a;k[2]=a;k[3]=a;break;case 2:k[0]=a;k[1]=b;k[2]=0;k[3]=0;break;case 3:k[0]=a;k[1]=b;k[2]=e;k[3]=0;break;default:k[0]=a,k[1]=b,k[2]=e,k[3]=d}return k}function b(a,b){return Math.sqrt(a*a+b*b)}function a(a,b,e,d){e=4*(d*b.width+e);b=b.data;a[0]=b[e]/255;a[1]=b[e+1]/255;a[2]=b[e+2]/255;a[3]=b[e+3]/255;return a}(function(){Xflow.Filters={};var a=null,
b=null;Xflow.Filters.createImageData=function(e,d){a||(a=document.createElement("canvas"));b||(b=a.getContext("2d"));return b.createImageData(e,d)};Xflow.Filters.createImageDataFloat32=function(a,b){return{width:a,height:b,data:new Float32Array(a*b*4)}};Xflow.Filters.grayscale=function(a,b,c){c=a.data;b=b.data;for(var e=0;e<c.length;e+=4){var d=c[e+3];b[e]=b[e+1]=b[e+2]=.2126*c[e]+.7152*c[e+1]+.0722*c[e+2];b[e+3]=d}return a};Xflow.Filters.convolute=function(a,b,c,e){var d=Math.round(Math.sqrt(c.length)),
h=Math.floor(d/2),l=a.data,r=a.width;a=a.height;var t=b.data;e=e?1:0;for(var m=0;m<a;m++)for(var x=0;x<r;x++){for(var y=m,w=x,z=4*(m*r+x),F=0,D=0,B=0,A=0,C=0;C<d;C++)for(var H=0;H<d;H++){var E=y+C-h,G=w+H-h;0<=E&&E<a&&0<=G&&G<r&&(E=4*(E*r+G),G=c[C*d+H],F+=l[E]*G,D+=l[E+1]*G,B+=l[E+2]*G,A+=l[E+3]*G)}t[z]=F;t[z+1]=D;t[z+2]=B;t[z+3]=A+e*(255-A)}return b}})();Xflow.registerOperator("xflow.sobelImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(c,
d){for(var g=d.width,f=d.height,k=e(0),l=e(0),q=e(),q=e(),n=e(),p=e(),r=e(),m=e(),v=e(),x=e(),y=e(),w=e(),z=e(),F=0;F<f;++F)for(var D=0;D<g;++D)if(1<=D&&D<g-1&&1<=F&&F<f-1){a(q,d,D-1,F-1);a(n,d,D,F-1);a(p,d,D+1,F-1);a(r,d,D-1,F);a(m,d,D,F);a(v,d,D+1,F);a(x,d,D-1,F+1);a(y,d,D,F+1);a(w,d,D+1,F+1);k[0]=q[0]+2*n[0]+p[0]-x[0]-2*y[0]-w[0];k[1]=q[1]+2*n[1]+p[1]-x[1]-2*y[1]-w[1];k[2]=q[2]+2*n[2]+p[2]-x[2]-2*y[2]-w[2];l[0]=q[0]-p[0]+2*r[0]-2*v[0]+x[0]-w[0];l[1]=q[1]-p[1]+2*r[1]-2*v[1]+x[1]-w[1];l[2]=q[2]-
p[2]+2*r[2]-2*v[2]+x[2]-w[2];var B=z,A=k,C=l;B[0]=b(A[0],C[0]);B[1]=b(A[1],C[1]);B[2]=b(A[2],C[2]);B[3]=b(A[3],C[3]);z[0]/=2;z[1]/=2;z[2]/=2;z[3]=1;B=z;A=4*(F*c.width+D);C=c.data;C[A]=255*B[0];C[A+1]=255*B[1];C[A+2]=255*B[2];C[A+3]=255*B[3]}return!0}})},{}],226:[function(d,m,l){Xflow.registerOperator("xflow.sub",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value1"},{type:"float3",source:"value2"}],evaluate:function(e,b,a,c){throw"Not used!";},evaluate_core:function(e,b,
a){e[0]=b[0]-a[0];e[1]=b[1]-a[1];e[2]=b[2]-a[2]}})},{}],227:[function(d,m,l){d=function(e){this.index=0;this.operator=e;this.inputInfo=[];this.outputInfo=[]};d.prototype.isTransferInput=function(e){return void 0!==this.inputInfo[e].operatorIndex};d.prototype.getTransferInputOperatorIndex=function(e){return this.inputInfo[e].operatorIndex};d.prototype.getTransferInputOutputIndex=function(e){return this.inputInfo[e].outputIndex};d.prototype.getTransferInputId=function(e){e=this.inputInfo[e];return e.operatorIndex+
"_"+e.outputIndex};d.prototype.getTransferOutputId=function(e){return this.index+"_"+e};d.prototype.getInputMappingName=function(e){return this.inputInfo[e].mappedName};d.prototype.getDirectInputIndex=function(e){return this.inputInfo[e].inputIndex};d.prototype.getOutputIndex=function(e){return this.outputInfo[e].finalOut||this.outputInfo[e].lost||0};d.prototype.isFinalOutput=function(e){return this.outputInfo[e]&&void 0!==this.outputInfo[e].finalOut};d.prototype.isTransferOutput=function(e){return this.outputInfo[e]&&
this.outputInfo[e].transfer};d.prototype.isLostOutput=function(e){return this.outputInfo[e]&&void 0!==this.outputInfo[e].lost};d.prototype.setTransferInput=function(e,b,a){this.inputInfo[e]={operatorIndex:b,outputIndex:a}};d.prototype.setDirectInput=function(e,b,a){this.inputInfo[e]={inputIndex:b,mappedName:a}};d.prototype.setFinalOutput=function(e,b){this.outputInfo[e]={finalOut:b}};d.prototype.setTransferOutput=function(e){this.outputInfo[e]={transfer:!0}};d.prototype.setLostOutput=function(e,b){this.outputInfo[e]=
{lost:b}};d.prototype.getKey=function(){for(var e=this.operator.name+"*O",b=0;b<this.outputInfo.length;++b)var a=this.outputInfo[b],e=e+("*"+(a.transfer?"_":a.finalOut||a.lost+"?"));e+=NaN;for(b=0;b<this.inputInfo.length;++b)a=this.inputInfo[b],e+="*"+(a.inputIndex?a.inputInfo:a.operatorIndex+">"+a.outputIndex);return e};m.exports=d},{}],228:[function(d,m,l){var e=d("../interface/constants.js");d("../base.js");d=function(a){this.platform=a;this.entries=[];this.inputInfo={}};d.prototype.addEntry=function(a){a.index=
this.entries.length;this.entries.push(a)};d.prototype.getKey=function(){for(var a=[],b=0;b<this.entries.length;++b)a.push(this.entries[b].getKey());a=this.platform+">"+a.join("!")+"|";for(b in this.inputInfo)a+=b+">"+(this.inputInfo[b].iterate||0)+"x"+(this.inputInfo[b].size||0);return a};d.prototype.setInputIterateType=function(a,b){this.inputInfo[a]||(this.inputInfo[a]={});this.inputInfo[a].iterate=b};d.prototype.setInputSize=function(a,b){this.inputInfo[a]||(this.inputInfo[a]={});this.inputInfo[a].size=
b};d.prototype.isInputIterate=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==e.ITERATION_TYPE.MANY};d.prototype.isInputUniform=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==e.ITERATION_TYPE.ONE};d.prototype.isInputNull=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==e.ITERATION_TYPE.NULL};d.prototype.getInputIterateType=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate};d.prototype.getInputSize=function(a){return this.inputInfo[a]&&
this.inputInfo[a].size||0};d.prototype.getIterateCount=function(a){for(var b=-1,e=0;e<a.inputs.length;++e)if(this.isInputIterate(e)){var d=a.getDataEntry(e);d&&d.getIterateCount&&(d=d.getIterateCount(),b=0>b?d:Math.min(d,b))}return 0>b?1:b};var b={};d.prototype.allocateOutput=function(a,c){for(var d=0;d<this.entries.length;++d){var g=this.entries[d],f=g.operator,k=a.operatorData[d],l=this.getIterateCount(a);if(f.alloc){for(var q=[b],n=q,p=g,r=a,m=p.operator.mapping,v=0;v<m.length;++v){var x=r.getDataEntry(p.getDirectInputIndex(v));
n.push(x?x.getValue():null)}q.push(l);f.alloc.apply(k,q)}for(k=0;k<f.outputs.length;++k)if(n=f.outputs[k],q=a.outputs[g.getOutputIndex(k)],q=c?q.asyncDataEntry:q.dataEntry,!n.noAlloc)if(q.type==e.DATA_TYPE.TEXTURE)if(n.customAlloc)n=b[n.name],p=n.imageFormat.width,r=n.imageFormat.height,m=n.imageFormat.texelType,v=n.imageFormat.texelFormat,n=n.samplerConfig,q._createImage(p,r,v,m,n);else if(n.sizeof){x=null;for(p=0;p<f.mapping.length;++p)if(f.mapping[p].source==n.sizeof){x=a.getDataEntry(g.getDirectInputIndex(p));
break}if(x)p=Math.max(x.width,1),r=Math.max(x.height,1),v=n.texelFormat||x.texelFormat,m=n.texelType||x.texelType,n=n.samplerConfig||x.getSamplerConfig(),q._createImage(p,r,v,m,n);else throw Error("Unknown texture input parameter '"+n.sizeof+"' in operator '"+f.name+"'");}else throw Error("Cannot create texture. Use customAlloc or sizeof parameter attribute");else if(n=(n.customAlloc?b[n.name]:l)*q.getTupleSize(),q._value&&q._value.length==n)q._notifyChanged();else switch(q.type){case e.DATA_TYPE.FLOAT:case e.DATA_TYPE.FLOAT2:case e.DATA_TYPE.FLOAT3:case e.DATA_TYPE.FLOAT4:case e.DATA_TYPE.FLOAT4X4:q._setValue(new Float32Array(n));
break;case e.DATA_TYPE.INT:case e.DATA_TYPE.INT4:case e.DATA_TYPE.BOOL:q._setValue(new Int32Array(n));break;case e.DATA_TYPE.STRING:q._setValue(Array(n));break;default:XML3D.debug.logWarning("Could not allocate output buffer of TYPE: "+q.type)}}};m.exports=d},{"../base.js":188,"../interface/constants.js":189}],229:[function(d,m,l){function e(a,e){for(var d={},f=0;f<a.outputs.length;++f)void 0===a.outputs[f].type&&XML3D.debug.logError("Xflow operator '"+e+"' is missing required attribute 'type' for output parameter "+
f),a.outputs[f].type=b.DATA_TYPE_MAP[a.outputs[f].type];for(f=0;f<a.params.length;++f)void 0===a.params[f].source&&XML3D.debug.logError("Xflow operator '"+e+"' is missing required attribute 'source' for input parameter "+f),void 0===a.params[f].type&&XML3D.debug.logError("Xflow operator '"+e+"' is missing required attribute 'type' for input parameter "+f),a.params[f].type=b.DATA_TYPE_MAP[a.params[f].type],d[a.params[f].source]=f;a.mapping||(a.mapping=a.params);for(f=0;f<a.mapping.length;++f){var k=
a.mapping[f],l=d[k.source];k.paramIdx=l;l=a.params[l].type;k.sequence&&(k.keyParamIdx=d[k.keySource]);k.sequence==b.SEQUENCE.LINEAR_WEIGHT&&(l=b.DATA_TYPE.FLOAT);k.internalType=l;k.name=k.name||k.source}a.platform=a.platform||b.PLATFORM.JAVASCRIPT}d("../base.js");var b=d("../interface/constants.js"),a={};m.exports={registerOperator:function(c,d){var g,f;e(d,c);a[c]||(a[c]={});f=d.platform||b.PLATFORM.JAVASCRIPT;g=a[c];c?d?(d.name=c,g[f]||(g[f]=[]),g[f].push(d)):XML3D.logWarning("Xflow.registerOperator: Operator data undefined."):
XML3D.logWarning("Xflow.registerOperator: Operator name undefined.")},initAnonymousOperator:function(a,b){e(b);b.name=a;return b},isOperatorAsync:function(a){return!!a.evaluate_async},getOperators:function(c,e){e=e||b.PLATFORM.JAVASCRIPT;return c&&!a[c]||!a[c][e]||0==a[c][e].length?null:a[c][e]}}},{"../base.js":188,"../interface/constants.js":189}],230:[function(d,m,l){function e(a,b,c,e){var d=h(a,b,!0);d.push(c);d.push(function(){g(a,b,d,!0);e()});a.operator.evaluate_async.apply(c,d)}function b(b,
e){var d="function (",f=a(b.evaluate_core),d=d+(f.args.join(",")+",__xflowMax) {\n"),d=d+"    var __xflowI = __xflowMax\n    while(__xflowI--){\n",g=f.body,g=c(g,f.args,b,e);return eval("("+(d+(g+"\n  }\n}"))+")")}function a(a){var b={},c=a.toString().match(r);if(!c)return f.notifyError("Xflow Internal: Could not parse function: "+a),null;b.args=c[2].split(",");for(var e in b.args)b.args[e]=b.args[e].trim();b.body=c[3];return b}function c(a,b,c,e){for(var d="",f=0,g=a.indexOf("[",f);-1!=g;){var h=
a.substr(f).match(t)[1],l=b.indexOf(h),h=!1,p=0;-1!=l&&(l<c.outputs.length?(h=!0,p=k.DATA_TYPE_TUPLE_SIZE[[c.outputs[l].type]]):(l-=c.outputs.length,h=e.iterFlag[l],p=k.DATA_TYPE_TUPLE_SIZE[c.mapping[l].internalType]));d+=a.substring(f,g)+"[";h&&(d+=p+"*__xflowI + ");f=g+1;g=a.indexOf("[",f)}return d+=a.substring(f)}function h(a,b,c){for(var e=[],d=a.operator.outputs,f=0;f<d.length;++f)if(d[f].noAlloc)e.push({assign:null});else{var g=b.outputs[a.getOutputIndex(f)],g=c?g.asyncDataEntry:g.dataEntry;
e.push(g?g.getValue():null)}c=a.operator.mapping;for(d=0;d<c.length;++d)f=b.getDataEntry(a.getDirectInputIndex(d)),e.push(f?f.getValue():null);return e}function g(a,b,c,e){for(var d=a.operator.outputs,f=0;f<d.length;++f){var g=b.outputs[a.getOutputIndex(f)];if(d[f].noAlloc){var h=e?g.asyncDataEntry:g.dataEntry;h.type==k.DATA_TYPE.TEXTURE?h._setImage(c[f].assign):h._setValue(c[f].assign)}e&&g.swapAsync()}}var f=d("../base.js"),k=d("../interface/constants.js"),u=d("./vs-program.js"),q=d("./cl-program.js");
d=function(){this.inputs=[];this.outputs=[];this.operatorData=[]};d.prototype.getChannel=function(a){return this.inputs[a].channel};d.prototype.getDataEntry=function(a){a=this.inputs[a];var b=a.channel;if(!b)return null;var c=0;a.sequenceKeySourceChannel&&(c=(c=a.sequenceKeySourceChannel.getDataEntry())&&c._value?c._value[0]:0);return b.getDataEntry(a.sequenceAccessType,c)};l=function(){this.channel=null;this.arrayAccess=!1;this.sequenceAccessType=k.SEQUENCE.NO_ACCESS;this.sequenceKeySourceChannel=
null};l.prototype.getKey=function(){return(this.channel?this.channel.id:"NULL")+";"+this.arrayAccess+";"+this.sequenceAccessType+";"+(this.sequenceKeySourceChannel?this.sequenceKeySourceChannel.id:"")};var n={},p=function(a){this.list=a;this.entry=a.entries[0];this.operator=this.entry.operator;this._inlineLoop=null};p.prototype.run=function(a,c){var d=this.list,f=a.operatorData[0],k=d.entries[0],l=k.operator.mapping;f.iterFlag={};for(var p=0;p<l.length;++p){var r=k.isTransferInput(p)||d.isInputIterate(k.getDirectInputIndex(p));
f.iterFlag[p]=r}f.iterateCount=d.getIterateCount(a);f.customData||(f.customData={});c?e(this.entry,a,f,c):this.operator.evaluate_core?(d=h(this.entry,a),d.push(f.iterateCount),this._inlineLoop||(this._inlineLoop=b(this.operator,f)),this._inlineLoop.apply(f,d)):(d=this.entry,k=h(d,a),k.push(f),d.operator.evaluate.apply(f,k),g(d,a,k,!1))};var r=/function\s*([^(]*)\(([^)]*)\)\s*\{([\s\S]*)\}/,t=/([a-zA-Z_$][\w$]*)(\[)/;m.exports={createProgram:function(a){var b;if(0===a.entries.length)return null;b=
a.entries[0].operator;var c=a.getKey();n[c]||(a.platform===k.PLATFORM.GLSL?n[c]=new u(a):b.platform===k.PLATFORM.CL?n[c]=new q(a):b.platform===k.PLATFORM.JAVASCRIPT&&1===a.entries.length?n[c]=new p(a):f.notifyError("Could not create program from operatorList"));return n[c]},ProgramData:d,ProgramInputConnection:l}},{"../base.js":188,"../interface/constants.js":189,"./cl-program.js":193,"./vs-program.js":231}],231:[function(d,m,l){function e(a,c,e,d,g){for(var h,l=c.operator;-1!=(h=a.indexOf("#I{"));){var m=
a.indexOf("}",h),v;a:{v=a.substring(h+3,m);for(var x=0;x<l.mapping.length;++x)if(l.mapping[x].name==v){v=x;break a}throw Error("Invalid input name '"+v+"' inside of code fragment");}v=c.isTransferInput(v)?e[c.getTransferInputId(v)]:d[c.getDirectInputIndex(v)];a=a.substring(0,h)+v+a.substring(m+1)}for(;-1!=(h=a.indexOf("#O{"));){m=a.indexOf("}",h);a:{d=a.substring(h+3,m);for(v=0;v<l.outputs.length;++v)if(l.outputs[v].name==d){d=v;break a}d=void 0}v=e[c.getTransferOutputId(d)];a=a.substring(0,h)+v+
a.substring(m+1)}for(c=[];-1!=(h=a.indexOf("#L{"));)m=a.indexOf("}",h),e=a.substring(h+3,m),c[e]||(c[e]=b(e,g)),v=c[e],a=a.substring(0,h)+v+a.substring(m+1);for(;-1!=(h=a.indexOf("#G{"));)m=a.indexOf("}",h),v=a.substring(h+3,m),a=a.substring(0,h)+v+a.substring(m+1);return a}function b(a,b){for(var c=a,e=1;-1!=b.indexOf(c);)c=a+"_"+ ++e;h.nameset.add(b,c);return c}function a(a){switch(a){case c.DATA_TYPE.BOOL:return"bool";case c.DATA_TYPE.BYTE:return"uint";case c.DATA_TYPE.FLOAT:return"float";case c.DATA_TYPE.FLOAT2:return"vec2";
case c.DATA_TYPE.FLOAT3:return"vec3";case c.DATA_TYPE.FLOAT4:return"vec4";case c.DATA_TYPE.FLOAT3X3:return"mat3";case c.DATA_TYPE.FLOAT4X4:return"mat4";case c.DATA_TYPE.INT:return"int";case c.DATA_TYPE.INT4:return"ivec4"}throw Error("Type not supported for GLSL "+c.getTypeName(a));}d("../base.js");var c=d("../interface/constants.js"),h=d("../utils/utils.js"),g=d("../processing/vs-connect.js").VertexShader;d=function(a){this.list=a;this._outputInfo={};a=this.list;for(var b=a.entries,b=b[b.length-1],
e=b.operator,d=0;d<e.params.length;++d){var g=e.params[d],h=g.source,l=d,m=b.getDirectInputIndex(l);this._outputInfo[h]={type:g.type};b.isTransferInput(l)||a.isInputIterate(m)?this._outputInfo[h].iteration=c.ITERATION_TYPE.MANY:a.isInputUniform(m)?this._outputInfo[h].iteration=c.ITERATION_TYPE.ONE:this._outputInfo[h].iteration=c.ITERATION_TYPE.NULL}};d.prototype.getOutputNames=function(){return Object.keys(this._outputInfo)};d.prototype.getOutputType=function(a){return this._outputInfo[a].type};d.prototype.isOutputUniform=
function(a){return this._outputInfo[a].iteration==c.ITERATION_TYPE.ONE};d.prototype.isOutputNull=function(a){return this._outputInfo[a].iteration==c.ITERATION_TYPE.NULL};d.prototype.createVertexShader=function(d,k){var l=new g(d),m=this.list,n=m.entries,p=[],r={},t={},v=n[n.length-1],x=[],y=v.operator;if(!k)throw Error("Could not find vsConfig! Attempt to create vertex shader programm without VS operator?");h.nameset.add(p,k.getBlockedNames());var w;w="// OUTPUT\n";for(var z in k._addOutput){var F=
k._addOutput[z];w+="varying "+a(F.type)+" "+z+";\n";h.nameset.add(p,z)}var D=0;for(z in k._attributes){for(var F=k._attributes[z],B=v.getDirectInputIndex(D),A=0;A<F.channeling.length;++A){var C=F.channeling[A],H={type:F.type,iteration:0,index:0,sourceName:z},E=C.outputName;C.code||v.isTransferInput(D)||m.isInputIterate(B)?(x[D]=!0,H.iteration=c.ITERATION_TYPE.MANY,w+="varying "+a(y.outputs[D].type)+" "+E+";\n",h.nameset.add(p,E),t[v.getTransferOutputId(A)]=E):m.isInputUniform(B)?(H.iteration=c.ITERATION_TYPE.ONE,
H.index=B):H.iteration=c.ITERATION_TYPE.NULL;h.nameset.add(l._outputNames,E);l._outputInfo[E]=H}D++}w+="\n// INPUT\n";for(z in k._addInput)F=k._addInput[z],w+=(F.uniform?"uniform ":"attribute ")+a(F.type)+" "+z+";\n",h.nameset.add(p,z);for(A=0;A<n.length;++A)for(F=n[A],C=F.operator,E=0;E<C.mapping.length;++E)!(A<n.length-1||x[E])||F.isTransferInput(E)||r[F.getDirectInputIndex(E)]||(y=C.mapping[E],z=b(y.name,p),D=F.getDirectInputIndex(E),B=!m.isInputIterate(D),l._inputInfo[z]={index:D,uniform:B},h.nameset.add(l._inputNames,
z),r[D]=z,w+=(B?"uniform ":"attribute ")+a(y.internalType)+" "+z,y.array&&(w+="["+m.getInputSize(D)+"]"),w+=";\n");w+="\n// CODE\n";w+="void main(void){\n";for(A=0;A<n.length;++A){F=n[A];C=F.operator;for(E=0;E<C.outputs.length;++E)F.isFinalOutput(E)||(z=b(C.outputs[E].name,p),t[F.getTransferOutputId(E)]=z,w+="\t"+a(C.outputs[E].type)+" "+z+";\n");m=e(C.evaluate_glsl,F,t,r,p);w+=m+"\n"}n=0;m="";for(z in k._attributes){F=k._attributes[z];for(A=0;A<F.channeling.length;++A)C=F.channeling[A],E=C.outputName,
l._outputInfo[E].iteration==c.ITERATION_TYPE.MANY&&(m=C.code?m+("\t"+C.code+"\n"):m+("\t"+E+" = #I{"+z+"};\n"));n++}for(A=0;A<k._codeFragments.length;++A)m+="\t"+k._codeFragments[A]+"\n";w+=e(m,v,t,r,p)+"\n";w+="}\n";l._glslCode=w;return l};m.exports=d},{"../base.js":188,"../interface/constants.js":189,"../processing/vs-connect.js":239,"../utils/utils.js":240}],232:[function(d,m,l){function e(a,b,e,d){var f,g;d&&(f=[],g=[]);for(var k=0;k<a.params.length;++k){var h=a.params[k],l=h.source,n=b?b.getScriptInputName(k,
l):l,m;d&&(m="For "+(k+1)+". argument '"+l+"': ",f.push(c.getTypeName(h.type)+" "+l+(h.optional?" [optional]":"")));if(n){l=e.getChannel(n);if(!l&&!h.optional)if(d)g.push(m+"DataEntry '"+n+"' does not exist");else return!1;if(l&&l.getType()!=h.type)if(d)g.push(m+"DataEntry '"+n+"' has wrong type '"+c.getTypeName(l.getType())+"'");else return!1}}d&&d.push(a.name+"("+f.join(", ")+")\n\t * "+g.join("\n\t * "));return!0}function b(a,b,c,e){var d=c.getChannel(e);a.addChannel(b,d,c.getChildDataIndex(e))}
var a=d("../base.js"),c=d("../interface/constants.js");l=d("./channel.js");var h=d("./process-node.js").RequestNode,g=d("./process-node.js").ProcessNode,f=d("./data-slot.js"),k=d("../operator/operator.js"),u=l.ChannelMap;d=function(a,b){this.owner=a;this.platform=c.PLATFORM.JAVASCRIPT;this.substitution=b;this.loading=!1;this.inputSlots={};this.inputChannels=new u;this.computedChannels=new u;this.outputChannels=new u;this.processNode=this.dataflowChannelNode=this.operator=null;this.requestNodes={};
this.useCount=1;this.outOfSync=!0};d.prototype.synchronize=function(){if(this.outOfSync){var d;d=this.owner;this.owner._computeOperator&&(this.platform=d=null!==d._platform?d._platform:c.PLATFORM.JAVASCRIPT);d=this.owner;this.loading=d.isSubtreeLoading();this.substitution&&d._channelNode.synchronize();if(d._sourceNode){var h=d._sourceNode._getOrCreateChannelNode(this.substitution);h&&h.synchronize()}else for(var l=0;l<d._children.length;++l)d._children[l]._getOrCreateChannelNode&&(h=d._children[l]._getOrCreateChannelNode(this.substitution))&&
h.synchronize();d=this.owner;if(d._sourceNode)(d=d._sourceNode._getOrCreateChannelNode(this.substitution))&&this.inputChannels.merge(d.outputChannels,0);else{d=d._children;for(h=0;h<d.length;++h)d[h]._getOrCreateChannelNode&&(l=d[h]._getOrCreateChannelNode(this.substitution))&&this.inputChannels.merge(l.outputChannels,h);for(h=0;h<d.length;++h)if(!d[h]._getOrCreateChannelNode){var l=d[h],m=l._name+";"+l._key;if(this.substitution)l._paramName&&this.substitution.hasChannel(l._paramName)?this.inputChannels.addChannel(l._name,
this.substitution.getChannel(l._paramName)):this.inputChannels.addDataEntry(l._name,this.owner._channelNode.inputSlots[m]);else{var u=new f(l._data,l._key);this.inputSlots[m]=u;this.inputChannels.addDataEntry(l._name,u)}}}h=this.owner;this.computedChannels.merge(this.inputChannels);d=this.dataflowChannelNode;if(h._computeUsesDataflow&&h._dataflowNode){this.operator=null;var y=this.owner,h=new n(y._dataflowNode,this);this.dataflowChannelNode=y._dataflowNode._getOrCreateChannelNode(h);y=this.owner;
if(this.dataflowChannelNode)for(h=this.dataflowChannelNode,h.synchronize(),l=h.outputChannels.getNames(),m=0;m<l.length;++m){var w=u=l[m];y._computeOutputMapping&&(w=y._computeOutputMapping.getScriptOutputName(m,u));w&&this.computedChannels.addChannel(w,h.outputChannels.getChannel(u))}}else if(!h._computeUsesDataflow&&h._computeOperator){this.dataflowChannelNode=null;l=this.owner;if(this.loading)this.operator=null;else if("string"==typeof l._computeOperator){h=l._computeOperator;m=null;if(h){a:{h=
l._computeOperator;l=l._computeInputMapping;m=this.inputChannels;(u=k.getOperators(h,this.platform)||k.getOperators(h,c.PLATFORM.JAVASCRIPT))||a.notifyError("No operator with name '"+h+"' found",this.owner);for(w=u.length;w--;)if(e(u[w],l,m)){m=u[w];break a}q.length=0;for(w=u.length;w--;)e(u[w],l,m,q);h="No operator '"+h+"' with matching type signature found:\n\n"+q.join("\n");a.notifyError(h,this.owner);m=null}m&&(this.platform=m.platform)}this.operator=m}else this.operator=l._computeOperator;h=
this.owner;if(this.operator)for(y in l=this.processNode=new g(this),m=0,l.outputDataSlots)u=y,h._computeOutputMapping&&(u=h._computeOutputMapping.getScriptOutputName(m,y)),u&&this.computedChannels.addOutputDataSlot(u,l.outputDataSlots[y],l),m++}d&&d!=this.dataflowChannelNode&&d.owner&&d.owner._removeSubstitutionNode(d);y=this.owner;y._filterMapping?y._filterMapping.applyFilterOnChannelMap(this.outputChannels,this.computedChannels,y._filterType,b):this.outputChannels.merge(this.computedChannels);this.outOfSync=
!1}};d.prototype.clear=function(){this.useCount=0;this.inputChannels.clear();this.outputChannels.clear();delete this.owner;for(var a=Object.keys(this.requestNodes),b=0;b<a.length;b++)this.requestNodes[a[b]].clear();this.requestNodes={}};d.prototype.increaseRef=function(){this.useCount++};d.prototype.decreaseRef=function(){this.useCount--;return 0==this.useCount?(this.clear(),!0):!1};d.prototype.getOutputNames=function(){this.synchronize();return this.outputChannels.getNames()};d.prototype.getChildDataIndex=
function(a){this.synchronize();return this.outputChannels.getChildDataIndexForFilter(a)};d.prototype.setStructureOutOfSync=function(){if(!this.outOfSync){this.outOfSync=!0;this.inputChannels.clear();this.computedChannels.clear();this.outputChannels.clear();this.processNode&&this.processNode.clear();for(var a in this.requestNodes)this.requestNodes[a].setStructureOutOfSync();this.dataflowChannelNode&&this.dataflowChannelNode.setStructureOutOfSync()}};d.prototype.notifyDataChange=function(a,b){var c=
a._name+";"+a._key;this.inputSlots[c]&&this.inputSlots[c].setDataEntry(a._data,b)};d.prototype.getResult=function(a,b){this.synchronize();var c=b?b.join(";"):"[null]";this.requestNodes[c]||(this.requestNodes[c]=new h(this,b));return this.requestNodes[c].getResult(a)};d.prototype.getOutputChannelInfo=function(a){this.synchronize();var b=this.outputChannels.getChannel(a);if(!b)return null;var e={type:b.getType(),seqLength:b.getSequenceLength(),seqMinKey:b.getSequenceMinKey(),seqMaxKey:b.getSequenceMaxKey(),
origin:0,originalName:""};a=this.owner._filterMapping?this.owner._filterMapping.getRenameSrcName(a):a;b=b.getDataEntry();if(this.dataflowChannelNode){var d=this.inputChannels.getChannel(a);if(!d||b!=d.getDataEntry())return e.origin=c.ORIGIN.PROTO,e.originalName=a,e}if(this.operator&&(d=this.inputChannels.getChannel(a),!d||b!=d.getDataEntry()))return e.origin=c.ORIGIN.COMPUTE,e.originalName=this.owner._computeOutputMapping.getScriptOutputNameInv(a,this.operator.outputs),e;e.origin=c.ORIGIN.CHILD;e.originalName=
a;return e};var q=[],n=function(a,b){this.map={};for(var c=b.owner,e=a._getGlobalParamNames(),d=0;d<e.length;++d)this.map[e[d]]=b.inputChannels.getChannel(e[d]);e=a._getParamNames();for(d=0;d<e.length;++d){var f=e[d],g=f;c._computeInputMapping&&(g=c._computeInputMapping.getScriptInputName(d,f));this.map[f]=b.inputChannels.getChannel(g)}};n.prototype.hasChannel=function(a){return!!this.map[a]};n.prototype.getChannel=function(a){return this.map[a]};n.prototype.getKey=function(a){for(var b="",c=a._getGlobalParamNames(),
e=0;e<c.length;++e)var d=this.map[c[e]],b=b+((d&&d.id||"-")+"!");a=a._getParamNames();for(e=0;e<a.length;++e)d=this.map[a[e]],b+=(d&&d.id||"-")+".";return b};m.exports={ChannelNode:d,Substitution:n}},{"../base.js":188,"../interface/constants.js":189,"../operator/operator.js":229,"./channel.js":233,"./data-slot.js":234,"./process-node.js":237}],233:[function(d,m,l){function e(a,b){a.map[b]||(a.map[b]={channel:null,childDataIndex:void 0})}function b(b,c,d,f){e(b,c);var h=b.map[c].channel;if(!h||!h.willMergeWithDataSlot(d))return d=
new g(b,d),b.map[c].channel=d,b.map[c].childDataIndex=f,d;h=a(b,h);h.addDataSlot(d);b.map[c].channel=h;b.map[c].childDataIndex=-1;return h}function a(a,b){if(b.map!=a){var c=new g(a);c.addChannelEntries(b);c.creatorProcessNode=b.creatorProcessNode;return c}return b}d("../base.js");var c=d("../interface/constants.js"),h=d("../interface/data.js").BufferEntry;d=function(){this.map={}};d.prototype.getNames=function(){return Object.keys(this.map)};d.prototype.getChannel=function(a){return this.map[a]?
this.map[a].channel:null};d.prototype.getChildDataIndex=function(a){return this.map[a]?this.map[a].childDataIndex:void 0};d.prototype.getChildDataIndexForFilter=function(a){var b;a=a||this.getNames();for(var c=0;c<a.length;++c){var e=this.getChildDataIndex(a[c]);void 0!=e&&(b=void 0!=b&&b!=e?-1:e)}return b};d.prototype.merge=function(a,b){for(var c in a.map){var e=void 0==b?a.getChildDataIndex(c):b;this.addChannel(c,a.getChannel(c),e)}};d.prototype.addChannel=function(b,c,d){if(c){void 0==d&&(d=-1);
e(this,b);var f=this.map[b].channel;f&&f.willMergeWithChannel(c)?(f=a(this,f),f.addChannelEntries(c),this.map[b].channel=f,this.map[b].childDataIndex=-1):(this.map[b].channel=c,this.map[b].childDataIndex=d)}};d.prototype.addDataEntry=function(a,c){b(this,a,c,-1)};d.prototype.addOutputDataSlot=function(a,c,e){b(this,a,c,-1).creatorProcessNode=e};d.prototype.clear=function(){for(var a in this.map){var b=this.map[a];b&&b.map==this&&b.clear()}this.map={}};var g=function(a,b){this.entries=[];this.map=
a;this.id=++f;this.listeners=[];this.creatorProcessNode=null;b&&this.addDataSlot(b)};g.prototype.addDataSlot=function(a){a.addChannel(this);for(var b=0;b<this.entries.length;++b){var e=this.entries[b];if(e.key>=a.key-c.EPSILON){Math.abs(e.key-a.key)<=c.EPSILON?(e.removeChannel(this),this.entries.splice(b,1,a)):this.entries.splice(b,0,a);break}}this.entries.push(a)};g.prototype.getSequenceLength=function(){return this.entries.length};g.prototype.getSequenceMinKey=function(){return this.entries[0].key};
g.prototype.getSequenceMaxKey=function(){return this.entries[this.entries.length-1].key};g.prototype.getType=function(){return 0==this.entries.length?c.DATA_TYPE.UNKNOWN:this.entries[0].dataEntry._type};g.prototype.addChannelEntries=function(a){for(var b=0;b<a.entries.length;++b)this.addDataSlot(a.entries[b]);a.creatorProcessNode&&(this.creatorProcessNode=a.creatorProcessNode)};g.prototype.getDataEntry=function(a,b){if(0==this.entries.length)return null;if(!a)return this.entries[0].dataEntry;for(var e=
0,d=this.entries.length;e<d&&this.entries[e].key<b;)++e;if(a==c.SEQUENCE.PREV_BUFFER)return this.entries[e?e-1:0].dataEntry;if(a==c.SEQUENCE.NEXT_BUFFER)return this.entries[e<d?e:d-1].dataEntry;if(a==c.SEQUENCE.LINEAR_WEIGHT){var f=this.entries[e?e-1:0].key,e=this.entries[e<d?e:d-1].key,d=new Float32Array(1);d[0]=e==f?0:(b-f)/(e-f);return new h(c.DATA_TYPE.FLOAT,d)}return null};g.prototype.willMergeWithChannel=function(a){if(this.entries.length!=a.entries.length)return!0;if(this.getType()!=a.getType())return!1;
for(var b=0;b<this.entries.length;b++)if(Math.abs(this.entries[b].key-a.entries[b].key)>c.EPSILON)return!0;return!1};g.prototype.willMergeWithDataSlot=function(a){return 1<this.entries.length?!0:this.getType()!=a.dataEntry._type?!1:Math.abs(this.entries[0].key-a.key)>c.EPSILON};g.prototype.notifyOnChange=function(a){for(var b=0;b<this.listeners.length;b++)this.listeners[b].onXflowChannelChange(this,a)};g.prototype.addListener=function(a){this.listeners.push(a)};g.prototype.removeListener=function(a){a=
this.listeners.indexOf(a);-1!=a&&this.listeners.splice(a,1)};g.prototype.clear=function(){for(var a=0;a<this.entries.length;++a)this.entries[a].removeChannel(this)};var f=0;m.exports={Channel:g,ChannelMap:d}},{"../base.js":188,"../interface/constants.js":189,"../interface/data.js":190}],234:[function(d,m,l){d("../base.js");var e=d("../interface/constants.js");d=function(b,a){this.key=a||0;this.dataEntry=b;this.asyncDataEntry=null;this.parentChannels=[]};d.prototype.addChannel=function(b){this.parentChannels.push(b)};
d.prototype.removeChannel=function(b){b=this.parentChannels.indexOf(b);-1!=b&&this.parentChannels.splice(b,1)};d.prototype.swapAsync=function(){var b=this.dataEntry;this.dataEntry=this.asyncDataEntry;this.asyncDataEntry=b};d.prototype.setDataEntry=function(b,a){this.dataEntry=b;this.notifyOnChange(a==e.RESULT_STATE.CHANGED_DATA_VALUE?e.DATA_ENTRY_STATE.CHANGED_VALUE:e.DATA_ENTRY_STATE.CHANGED_SIZE)};d.prototype.notifyOnChange=function(b){for(var a=0;a<this.parentChannels.length;++a)this.parentChannels[a].notifyOnChange(b)};
m.exports=d},{"../base.js":188,"../interface/constants.js":189}],235:[function(d,m,l){function e(c,d,g,h){if(-1==c.blockedNodes.indexOf(d)){if(d.operator){var k;(k=h)||(k=d.operator,k=!((g==f.PLATFORM.ASYNC||!q.isOperatorAsync(k))&&(!c.firstOperator||g==f.PLATFORM.GLSL&&c.firstOperator.evaluate_glsl&&k.evaluate_glsl)));if(k){b(c,d);return}c.firstOperator||(c.firstOperator=d.operator);k=d.operator.mapping;for(var l=0;l<k.length;++l)k[l].sequence?(a(c,d,k[l].source),a(c,d,k[l].keySource)):k[l].array&&
a(c,d,k[l].source)}for(l=0;l<d.children.length;++l)e(c,d.children[l],g,h)}}function b(a,c){if(-1==a.blockedNodes.indexOf(c)){a.blockedNodes.push(c);for(var e=0;e<c.children.length;++e)b(a,c.children[e])}}function a(a,c,e){(c=c.inputChannels[e])&&c.creatorProcessNode&&b(a,c.creatorProcessNode)}function c(a,b,e){if(-1==a.doneNodes.indexOf(e))if(a.doneNodes.push(e),-1!=a.blockedNodes.indexOf(e))b.subNodes.push(e);else{for(var d=0;d<e.children.length;++d)c(a,b,e.children[d]);e.operator&&a.constructionOrder.push(e)}}
function h(a){for(var b=a.programData.inputs,c=0;c<a.programData.inputs.length;++c){var e=a.programData.getDataEntry(c);(e=e?e.getIterateCount?e.getIterateCount():1:0)?!b[c].arrayAccess&&1<e?a.operatorList.setInputIterateType(c,f.ITERATION_TYPE.MANY):a.operatorList.setInputIterateType(c,f.ITERATION_TYPE.ONE):a.operatorList.setInputIterateType(c,f.ITERATION_TYPE.NULL);b[c].arrayAccess&&a.platform==f.PLATFORM.GLSL&&a.operatorList.setInputSize(c,e)}}function g(a){for(var b=0;b<a.subNodes.length;++b)a.subNodes[b].process()}
d("../base.js");var f=d("../interface/constants.js"),k=d("../operator/operator-list.js"),u=d("../utils/utils.js"),q=d("../operator/operator.js"),n=d("../operator/operator-entry.js"),p=d("../operator/program.js");d=function(a,b){this.platform=b;this.mergedNodes=[];this.mergedOutputNodes=[];this.subNodes=[];this.unprocessedDataNames=[];this.operatorList=new k(b);this.programData=new p.ProgramData;this.program=null;var d={blockedNodes:[],doneNodes:[],constructionOrder:[],inputSlots:{},finalOutput:null,
firstOperator:null};d.finalOutput={};for(var f=a.filter||a.owner.outputChannels.getNames(),g=0;g<f.length;++g){var h=f[g],l=a.owner.outputChannels.getChannel(h);l&&l.creatorProcessNode&&(d.finalOutput[h]=l.getDataEntry())}u.nameset.add(this.unprocessedDataNames,f);e(d,a,this.platform,!1);c(d,this,a);for(f=0;f<d.constructionOrder.length;++f){for(var g=d.constructionOrder[f],l=h=new n(g.operator),m=d,q=g,B=q.operator.mapping,A=0;A<B.length;++A){var C=q.inputChannels[B[A].source],H;if(C&&C.creatorProcessNode&&
-1!=(H=this.mergedNodes.indexOf(C.creatorProcessNode))){a:{for(var E=C.creatorProcessNode,G=E.operator.outputs,I=0;I<G.length;++I)if(C.getDataEntry()==E.outputDataSlots[G[I].name].dataEntry){C=I;break a}C=null}l.setTransferInput(A,H,C);E=this.operatorList.entries[H];E.isFinalOutput(C)||E.setTransferOutput(C)}else{E=B[A].source;q.owner.owner._computeInputMapping&&(E=q.owner.owner._computeInputMapping.getScriptInputName(B[A].paramIdx,B[A].source));G=new p.ProgramInputConnection;G.channel=C;G.arrayAccess=
B[A].array||!1;G.sequenceAccessType=B[A].sequence||0;G.sequenceAccessType&&(G.sequenceKeySourceChannel=q.inputChannels[B[A].keySource]);var I=G.getKey(),K=m.inputSlots[I];C&&void 0!=K||(K=this.programData.inputs.length,m.inputSlots[I]=K,this.programData.inputs.push(G));l.setDirectInput(A,K,E)}}l=h;m=d;q=g;B=q.operator.outputs;A=!0;for(C=0;C<B.length;++C){E=q.outputDataSlots[B[C].name];a:if(m.finalOutput){G=void 0;for(G in m.finalOutput)if(m.finalOutput[G]==E.dataEntry)break a;G=!1}else G=!0;G?(I=
this.programData.outputs.length,this.programData.outputs.push(E),l.setFinalOutput(C,I),!0!==G&&u.nameset.remove(this.unprocessedDataNames,G)):A=!1}l=A;this.programData.operatorData.push({});this.operatorList.addEntry(h);this.mergedNodes.push(g);(l||f==d.constructionOrder.length-1)&&this.mergedOutputNodes.push(g)}for(H=0;H<d.constructionOrder.length;++H)for(f=d.constructionOrder[H],g=this.operatorList.entries[H],h=f.operator.outputs,l=0;l<h.length;++l)g.isFinalOutput(l)||g.isTransferOutput(l)||(m=
this.programData.outputs.length,this.programData.outputs.push(f.outputDataSlots[h[l].name]),g.setLostOutput(l,m))};d.prototype.isProcessed=function(){for(var a=this.mergedOutputNodes.length;a--;)if(this.mergedOutputNodes[a].status!=f.PROCESS_STATE.PROCESSED)return!1;return!0};d.prototype.run=function(a){g(this);h(this);if(this.program=p.createProgram(this.operatorList))this.operatorList.allocateOutput(this.programData,!!a),this.program.run(this.programData,a);if(this.platform!=f.PLATFORM.ASYNC)for(a=
this.mergedOutputNodes.length;a--;)this.mergedOutputNodes[a].status=f.PROCESS_STATE.PROCESSED};d.prototype.getVertexShader=function(){g(this);h(this);return this.program=p.createProgram(this.operatorList)};m.exports=d},{"../base.js":188,"../interface/constants.js":189,"../operator/operator-entry.js":227,"../operator/operator-list.js":228,"../operator/operator.js":229,"../operator/program.js":230,"../utils/utils.js":240}],236:[function(d,m,l){function e(c){for(var e=0;e<c._owners.length;++e)c._owners[e].notify(a.RESULT_STATE.CHANGED_STRUCTURE);
b._flushResultCallbacks()}var b=d("../base.js"),a=d("./../interface/constants.js"),c=/^([^:,{}]+)(,[^:{},]+)*$/,h=/^\{(([^:,{}]+:[^:{},]+)(,[^:{},]+:[^:},]+)*)}$/;d=function(){this._owners=[]};d.parse=function(a,e){a=a.trim();var d=a.trim().match(c);if(d)return g.parse(a,e);if(d=a.trim().match(h))return f.parse(d[1],e);b.notifyError("Cannot parse name mapping '"+a+"'",e);return null};d.prototype._addOwner=function(a){-1==this._owners.indexOf(a)&&this._owners.push(a)};d.prototype._removeOwner=function(a){a=
this._owners.indexOf(a);-1!=a&&this._owners.splice(a,-1)};var g=function(){this._owners=[];this._names=[]};b.createClass(g,d);g.parse=function(a,b){for(var c=new g(b),e=a.split(","),d=0;d<e.length;d++)c._names.push(e[d].trim());return c};Object.defineProperty(g.prototype,"length",{set:function(){throw Error("length is read-only");},get:function(){return this._names.length}});g.prototype.getName=function(a){return this._names[a]};g.prototype.clear=function(){this._names=[];e(this)};g.prototype.setName=
function(a,b){this._names[a]=b;e(this)};g.prototype.removeName=function(a){this._names.splice(a);e(this)};g.prototype.isEmpty=function(){return 0==this._names.length};g.prototype.applyFilterOnChannelMap=function(b,c,e,d){var f;if(e==a.DATA_FILTER_TYPE.KEEP)for(f=0;f<this._names.length;++f)e=this._names[f],c.map[e]&&d(b,e,c,e);else for(f in c.map){var g=this._names.indexOf(f);(e==a.DATA_FILTER_TYPE.RENAME||e==a.DATA_FILTER_TYPE.REMOVE&&-1==g)&&d(b,f,c,f)}};g.prototype.getScriptInputName=function(a){return this._names[a]?
this._names[a]:null};g.prototype.getScriptOutputName=function(a){return this._names[a]?this._names[a]:null};g.prototype.getScriptOutputNameInv=function(a,b){var c=this._names.indexOf(a);return-1==c?null:b[c].name};g.prototype.getRenameSrcName=function(a){return a};var f=function(){this._owners=[];this._destNames=[];this._srcNames=[]};b.createClass(f,d);f.parse=function(a,b){for(var c=new f(b),e=a.split(","),d=0;d<e.length;d++){var g=e[d].split(":"),h=g[0].trim(),g=g[1].trim();c.setNamePair(h,g)}return c};
Object.defineProperty(f.prototype,"length",{set:function(){throw Error("length is read-only");},get:function(){return this._srcNames.length}});f.prototype.getDestName=function(a){return this._destNames[a]};f.prototype.getSrcName=function(a){return this._srcNames[a]};f.prototype.getSrcNameFromDestName=function(a){a=this._destNames.indexOf(a);return-1==a?null:this._srcNames[a]};f.prototype.getDestNameFromSrcName=function(a){a=this._srcNames.indexOf(a);return-1==a?null:this._destNames[a]};f.prototype.clear=
function(){this._srcNames=[];this._destNames=[];e(this)};f.prototype.setNamePair=function(a,b){var c=this._destNames.indexOf(a);-1!=c&&(this._destNames.splice(c,1),this._srcNames.splice(c,1));this._destNames.push(a);this._srcNames.push(b);e(this)};f.prototype.removeNamePair=function(a){a=this._destNames.indexOf(a);-1!=a&&(this._destNames.splice(a,1),this._srcNames.splice(a,1));e(this)};f.prototype.isEmpty=function(){return 0==this._destNames.length};f.prototype.applyFilterOnChannelMap=function(b,
c,e,d){var f;if(e==a.DATA_FILTER_TYPE.REMOVE)for(f in c.map)-1==this._srcNames.indexOf(f)&&d(b,f,c,f);else{if(e==a.DATA_FILTER_TYPE.RENAME)for(f in c.map)-1==this._srcNames.indexOf(f)&&d(b,f,c,f);for(f in this._destNames)d(b,this._destNames[f],c,this._srcNames[f])}};f.prototype.getRenameSrcName=function(a){return this.getSrcNameFromDestName(a)||a};f.prototype.getScriptInputName=function(a,b){return this.getSrcNameFromDestName(b)};f.prototype.getScriptOutputName=function(a,b){return this.getDestNameFromSrcName(b)};
f.prototype.getScriptOutputNameInv=function(a){a=this._destNames.indexOf(a);return-1==a?null:this._srcNames[a]};m.exports={NameMapping:f,OrderMapping:g,Mapping:d}},{"../base.js":188,"./../interface/constants.js":189}],237:[function(d,m,l){function e(a,b,c){var e,d;for(d in c)(e=c[d])&&e.creatorProcessNode&&(h.set.add(a,e.creatorProcessNode),h.set.add(b,e.creatorProcessNode.descendants));h.set.remove(a,b);h.set.add(b,a)}function b(a,b){a.executers[b]||(a.executers[b]=new g(a,b));return a.executers[b]}
var a=d("../base.js"),c=d("../interface/constants.js"),h=d("../utils/utils.js"),g=d("./executor.js"),f=d("./result.js"),k=d("../operator/operator.js");l=d("../interface/data.js");var u=d("../processing/data-slot.js"),q=l.BufferEntry,n=l.TextureEntry,p=l.ImageDataTextureEntry;d=function(a){this.owner=a;this.operator=a.operator;this.inputChannels={};this.outputDataSlots={};this.status=c.PROCESS_STATE.MODIFIED;this.asyncProcessState=3;this.children=[];this.descendants=[];this._bindedAsyncCallback=null;
this.executers=[];for(var b=this.operator,d=a.owner._computeInputMapping,f=0;f<b.params.length;++f){var g=b.params[f].source,h=d?d.getScriptInputName(f,g):g;h&&((h=a.inputChannels.getChannel(h))&&h.addListener(this),this.inputChannels[g]=h)}e(this.children,this.descendants,this.inputChannels);a=this.operator;var b=this.outputDataSlots,d=k.isOperatorAsync(a),l;for(l in a.outputs){var f=a.outputs[l],m,h=f.type;h!=c.DATA_TYPE.TEXTURE?(g=new q(h,null),d&&(m=new q(h,null))):(g=window.document?new n(null):
new p(null),d&&(m=window.document?new n(null):new p(null)));b[f.name]=new u(g,0);d&&(b[f.name].asyncDataEntry=m)}k.isOperatorAsync(this.operator)&&(this._bindedAsyncCallback=this.receiveAsyncProcessing.bind(this))};d.prototype.onXflowChannelChange=function(a,b){if(k.isOperatorAsync(this.operator)){if(this.status==c.PROCESS_STATE.LOADING||3!=this.asyncProcessState)this.status=c.PROCESS_STATE.MODIFIED,this.updateState()}else this.status=b==c.DATA_ENTRY_STATE.CHANGED_VALUE&&this.status>c.PROCESS_STATE.UNPROCESSED?
c.PROCESS_STATE.UNPROCESSED:c.PROCESS_STATE.MODIFIED,this.notifyOutputChanged(b)};d.prototype.startAsyncProcessing=function(){0==this.asyncProcessState||3==this.asyncProcessState?(this.asyncProcessState=1,b(this,c.PLATFORM.ASYNC).run(this._bindedAsyncCallback)):this.asyncProcessState=2};d.prototype.receiveAsyncProcessing=function(){this.status=c.PROCESS_STATE.PROCESSED;this.notifyOutputChanged(c.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE);2==this.asyncProcessState?(this.asyncProcessState=0,this.status=c.PROCESS_STATE.MODIFIED,
this.updateState()):this.asyncProcessState=0;a._flushResultCallbacks()};d.prototype.notifyOutputChanged=function(a){for(var b in this.outputDataSlots)this.outputDataSlots[b].notifyOnChange(a)};d.prototype.clear=function(){for(var a in this.inputChannels)this.inputChannels[a]&&this.inputChannels[a].removeListener(this);for(a=0;a<this.children.length;a++)this.children[a].clear()};d.prototype.updateState=function(){if(this.status==c.PROCESS_STATE.MODIFIED)if(this.status=c.PROCESS_STATE.UNPROCESSED,XML3D.debug.assert(!this.owner.loading,
"This should never happen"),this.owner.loading)this.status=c.PROCESS_STATE.LOADING;else{for(var b=0;b<this.children.length;++b)this.status=Math.min(this.status,this.children[b].updateState());if(b=this.status>c.PROCESS_STATE.LOADING)a:{var b=this.operator,e=this.inputChannels,d;for(d in b.params){var f=e[b.params[d].source];if(f&&(f=f.getDataEntry())&&f.isLoading&&f.isLoading()){b=!0;break a}}b=!1}b&&(this.status=c.PROCESS_STATE.LOADING);if(d=this.status>c.PROCESS_STATE.INVALID){var g;a:{d=this.operator;
b=this.owner.owner._computeInputMapping;e=this.inputChannels;f=this.owner.owner;for(g in d.params){var h=d.params[g],l=b?b.getScriptInputName(g,h.source):h.source;if(!h.optional&&!l){a.notifyError("Xflow: operator "+d.name+": Missing input argument for "+h.source,f);g=!1;break a}if(l){var m=e[h.source];if(!m){if(!b)continue;a.notifyError("Xflow: operator "+d.name+": Input of name '"+l+"' not found. Used for parameter "+h.source,f);g=!1;break a}l=m.getDataEntry();if(!(m.creatorProcessNode||h.optional||
l&&!l.isEmpty())){a.notifyError("Xflow: operator "+d.name+": Input for "+h.source+" contains no data.",f);g=!1;break a}if(l&&l.type!=h.type){a.notifyError("Xflow: operator "+d.name+": Input for "+h.source+" has wrong type. Expected: "+c.getTypeName(h.type)+", but got: "+c.getTypeName(l.type),f);g=!1;break a}}}g=!0}d=!g}d&&(this.status=c.PROCESS_STATE.INVALID);this.status==c.PROCESS_STATE.UNPROCESSED&&k.isOperatorAsync(this.operator)&&(this.status=3==this.asyncProcessState?c.PROCESS_STATE.LOADING:
c.PROCESS_STATE.PROCESSED,this.startAsyncProcessing())}return this.status};d.prototype.process=function(){this.status==c.PROCESS_STATE.UNPROCESSED&&(b(this,this.owner.platform).run(),this.status=c.PROCESS_STATE.PROCESSED)};l=function(a,b){this.owner=a;this.filter=b;this.results={};this.status=c.PROCESS_STATE.MODIFIED;this.channels={};this.children=[];this.executers=[];this.outOfSync=!0};l.prototype.synchronize=function(){if(this.outOfSync){this.outOfSync=!1;var a=this.owner,b=this.filter;b||(b=a.outputChannels.getNames());
for(var c=0;c<b.length;++c){var d=b[c],f=a.outputChannels.getChannel(d);f&&(this.channels[d]=f,f.addListener(this))}e(this.children,[],this.channels)}};l.prototype.updateState=function(){this.synchronize();if(this.status==c.PROCESS_STATE.MODIFIED)if(this.status=c.PROCESS_STATE.UNPROCESSED,this.owner.loading)this.status=c.PROCESS_STATE.LOADING;else for(var a=0;a<this.children.length;++a)this.status=Math.min(this.status,this.children[a].updateState());return this.status};l.prototype.getResult=function(a){this.updateState();
if(this.status==c.PROCESS_STATE.UNPROCESSED){if(a==c.RESULT_TYPE.COMPUTE){var e=b(this,this.owner.platform);e.isProcessed()||e.run()}this.status=c.PROCESS_STATE.PROCESSED}e=null;if(a==c.RESULT_TYPE.COMPUTE){this.results[c.RESULT_TYPE.COMPUTE]||(this.results[c.RESULT_TYPE.COMPUTE]=new f.ComputeResult);a=this.results[c.RESULT_TYPE.COMPUTE];a._dataEntries={};a._outputNames=[];for(var d in this.channels)e=this.channels[d].getDataEntry(),a._dataEntries[d]=e&&!e.isEmpty()?e:null,a._outputNames.push(d);
e=a}else a==c.RESULT_TYPE.VS&&(d=b(this,c.PLATFORM.GLSL),this.results[c.RESULT_TYPE.VS]||(this.results[c.RESULT_TYPE.VS]=new f.VSDataResult),a=this.results[c.RESULT_TYPE.VS],e=d.getVertexShader(),a._program=e,a._programData=d.programData,e=a);e.loading=this.status==c.PROCESS_STATE.LOADING;return e};l.prototype.setStructureOutOfSync=function(){this.outOfSync=!0;this.status=c.PROCESS_STATE.MODIFIED;for(var a in this.results)this.results[a]._notifyChanged(c.RESULT_STATE.CHANGED_STRUCTURE);for(var b in this.channels)this.channels[b].removeListener(this);
this.channels=[];this.children=[];this.executers=[]};l.prototype.onXflowChannelChange=function(a,b){a.creatorProcessNode&&(this.status=c.PROCESS_STATE.MODIFIED);var e=b==c.DATA_ENTRY_STATE.CHANGED_VALUE?c.RESULT_STATE.CHANGED_DATA_VALUE:c.RESULT_STATE.CHANGED_DATA_SIZE,d;for(d in this.results)this.results[d]._notifyChanged(e)};l.prototype.clear=function(){this.setStructureOutOfSync();delete this.owner};m.exports={RequestNode:l,ProcessNode:d}},{"../base.js":188,"../interface/constants.js":189,"../interface/data.js":190,
"../operator/operator.js":229,"../processing/data-slot.js":234,"../utils/utils.js":240,"./executor.js":235,"./result.js":238}],238:[function(d,m,l){l=d("../base.js");d("../../utils/array.js");var e=l._queueResultCallback,b=function(){this.valid=this.loading=!1;this._listeners=[];this._requests=[]};b.prototype.addListener=function(a){this._listeners.push(a)};b.prototype.removeListener=function(a){Array.erase(this._listeners,a)};b.prototype._addRequest=function(a){this._requests.push(a)};b.prototype._removeRequest=
function(a){Array.erase(this._requests,a)};b.prototype._notifyChanged=function(a){this.valid=!1;for(var b=0;b<this._requests.length;++b)this._requests[b]._onResultChanged(a);e(this,a)};b.prototype._onPostponedResultChanged=function(a){for(var b=0;b<this._listeners.length;++b)this._listeners[b](this,a)};d=function(){b.call(this);this._outputNames=[];this._dataEntries={}};l.createClass(d,b);Object.defineProperty(d.prototype,"outputNames",{set:function(a){throw Error("outputNames is readonly");},get:function(){return this._outputNames}});
d.prototype.getOutputData=function(a){return this._dataEntries[a]};d.prototype.getOutputMap=function(){return this._dataEntries};var a=function(){b.call(this);this._programData=this._program=null};l.createClass(a,b);Object.defineProperty(a.prototype,"outputNames",{set:function(a){throw Error("shaderOutputNames is readonly");},get:function(){return this._program.getOutputNames()}});a.prototype.isOutputUniform=function(a){return this._program.isOutputUniform(a)};a.prototype.isOutputNull=function(a){return this._program.isOutputNull(a)};
a.prototype.getOutputType=function(a){return this._program.getOutputType(a)};a.prototype.getVertexShader=function(a){return this._program.createVertexShader(this._programData,a)};m.exports={ComputeResult:d,VSDataResult:a}},{"../../utils/array.js":180,"../base.js":188}],239:[function(d,m,l){d("../base.js");var e=d("./../interface/constants.js"),b=d("../operator/operator.js").initAnonymousOperator,a={};a[e.SHADER_CONSTANT_KEY.OBJECT_ID]="objectID";a[e.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM]="screenTransform";
a[e.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM_NORMAL]="screenTransformNormal";a[e.SHADER_CONSTANT_KEY.VIEW_TRANSFORM]="viewTransform";a[e.SHADER_CONSTANT_KEY.VIEW_TRANSFORM_NORMAL]="viewTransformNormal";a[e.SHADER_CONSTANT_KEY.WORLD_TRANSFORM]="worldTransform";a[e.SHADER_CONSTANT_KEY.WORLD_TRANSFORM_NORMAL]="worldTransformNormal";d=function(){this._attributes={};this._blockedNames=[];this._addInput={};this._addOutput={};this._codeFragments=[];this._outputChanneling={}};d.prototype.addAttribute=function(a,
b,c){if(this._attributes[b]){if(this._attributes[b].type!=a)throw Error("Tries to add two attributes with different types of name '"+b+'"');this._attributes[b].optional=this._attributes[b].optional&&c}else this._attributes[b]={type:a,optional:c,channeling:[]}};d.prototype.channelAttribute=function(a,b,c){this._attributes[a].channeling.push({outputName:b,code:c})};d.prototype.addInputParameter=function(a,b,c){this._addInput[b]||(this._addInput[b]={type:a,uniform:c},this._blockedNames.push(b))};d.prototype.addOutputParameter=
function(a,b){this._addOutput[b]||(this._addOutput[b]={type:a},this._blockedNames.push(b))};d.prototype.addCodeFragment=function(a){this._codeFragments.push(a)};d.prototype.addBlockedName=function(a){this._blockedNames.push(a)};d.prototype.getBlockedNames=function(){return this._blockedNames};d.prototype.getFilter=function(){return Object.keys(this._attributes)};d.prototype.getKey=function(){var a="",b;for(b in this._attributes)var c=this._attributes[b],a=a+(";"+c.type+","+b+","+c.optional);return a};
var c={};d.prototype.getOperator=function(){var a=this.getKey();if(c[a])return c[a];var d=[],f=[],k="VSConnect",l;for(l in this._attributes){var m=this._attributes[l],n=e.getTypeName(m.type);d.push({type:n,name:l});f.push({type:n,source:l,optional:m.optional});k+="T"+n+"N"+l+"O"+m.optional+"."}d=b(k,{outputs:d,params:f,evaluate_glsl:"\t// VS Connector\n"});return c[a]=d};l=function(a){this._programData=a;this._glslCode=null;this._inputNames=[];this._outputNames=[];this._inputInfo={};this._outputInfo=
{}};Object.defineProperty(l.prototype,"inputNames",{set:function(a){throw Error("inputNames is readonly");},get:function(){return this._inputNames}});Object.defineProperty(l.prototype,"outputNames",{set:function(a){throw Error("outputNames is readonly");},get:function(){return this._outputNames}});l.prototype.isInputUniform=function(a){return this._inputInfo[a].uniform};l.prototype.getInputData=function(a){return this._programData.getDataEntry(this._inputInfo[a].index)};l.prototype.isOutputNull=function(a){return this._outputInfo[a].iteration==
e.ITERATION_TYPE.NULL};l.prototype.isOutputFragmentUniform=function(a){return this._outputInfo[a].iteration==e.ITERATION_TYPE.ONE};l.prototype.getUniformOutputData=function(a){return this._programData.getDataEntry(this._outputInfo[a].index)};l.prototype.getOutputType=function(a){return this._outputInfo[a].type};l.prototype.getOutputSourceName=function(a){return this._outputInfo[a].sourceName};l.prototype.getGLSLCode=function(){return this._glslCode};m.exports={shaderConstant:a,setShaderConstant:function(b,
c){a[b]=c},VSConfig:d,VertexShader:l}},{"../base.js":188,"../operator/operator.js":229,"./../interface/constants.js":189}],240:[function(d,m,l){m.exports={set:{add:function(e,b){if(Array.isArray(b))for(var a=0;a<b.length;++a)-1==e.indexOf(b[a])&&e.push(b[a]);else-1==e.indexOf(b)&&e.push(b)},remove:function(e,b){var a;if(Array.isArray(b))for(var c=0;c<b.length;++c)-1!=(a=e.indexOf(b[c]))&&e.splice(a,1);else-1!=(a=e.indexOf(b))&&e.splice(a,1)},intersection:function(e,b,a){for(var c=b.length,d=0;d<c;++d)-1!=
a.indexOf(b[d])&&e.push(b[d])},isIntersecting:function(d,b){for(var a=d.length;a--;)if(-1!=b.indexOf(d[a]))return!0;return!1},isSubset:function(d,b){for(var a=d.length;a--;)if(-1==b.indexOf(d[a]))return!1;return!0}},nameset:{add:function(d,b){if(b)if("string"==typeof b)-1==d.indexOf(b)&&d.push(b);else for(var a=0;a<b.length;++a)-1==d.indexOf(b[a])&&d.push(b[a])},remove:function(d,b){if(b)if("string"==typeof b){var a=d.indexOf(b);-1!=a&&d.splice(a,1)}else for(var c=0;c<b.length;++c)a=d.indexOf(b[c]),
-1!=a&&d.splice(a,1)},intersection:function(d,b){for(var a=d.length;a--;)-1==b.indexOf(d[a])&&d.splice(a,1)}},binarySearch:function(d,b,a){var c=0;for(--a;c<=a;){var h=Math.floor((c+a)/2);if(d[h]==b)return h;d[h]<b?c=h+1:a=h-1}return a}}},{}],241:[function(d,m,l){m.exports=d("./init.js")},{"./init.js":68}]},{},[241]);
